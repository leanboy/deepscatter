!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Deepscatter=e()}(this,(function(){"use strict";var t="http://www.w3.org/1999/xhtml";const e={svg:"http://www.w3.org/2000/svg",xhtml:t,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function n(t){var n=t+="",r=n.indexOf(":");return r>=0&&"xmlns"!==(n=t.slice(0,r))&&(t=t.slice(r+1)),e.hasOwnProperty(n)?{space:e[n],local:t}:t}function r(e){return function(){var n=this.ownerDocument,r=this.namespaceURI;return r===t&&n.documentElement.namespaceURI===t?n.createElement(e):n.createElementNS(r,e)}}function i(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function o(t){var e=n(t);return(e.local?i:r)(e)}function a(){}function s(t){return null==t?a:function(){return this.querySelector(t)}}function u(){return[]}function c(t){return null==t?u:function(){return this.querySelectorAll(t)}}function f(t){return function(){return null==(e=t.apply(this,arguments))?[]:Array.isArray(e)?e:Array.from(e);var e}}function l(t){return function(){return this.matches(t)}}function d(t){return function(e){return e.matches(t)}}var h=Array.prototype.find;function p(){return this.firstElementChild}var _=Array.prototype.filter;function m(){return Array.from(this.children)}function b(t){return new Array(t.length)}function y(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function g(t,e,n,r,i,o){for(var a,s=0,u=e.length,c=o.length;s<c;++s)(a=e[s])?(a.__data__=o[s],r[s]=a):n[s]=new y(t,o[s]);for(;s<u;++s)(a=e[s])&&(i[s]=a)}function v(t,e,n,r,i,o,a){var s,u,c,f=new Map,l=e.length,d=o.length,h=new Array(l);for(s=0;s<l;++s)(u=e[s])&&(h[s]=c=a.call(u,u.__data__,s,e)+"",f.has(c)?i[s]=u:f.set(c,u));for(s=0;s<d;++s)c=a.call(t,o[s],s,o)+"",(u=f.get(c))?(r[s]=u,u.__data__=o[s],f.delete(c)):n[s]=new y(t,o[s]);for(s=0;s<l;++s)(u=e[s])&&f.get(h[s])===u&&(i[s]=u)}function w(t){return t.__data__}function x(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function A(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function S(t){return function(){this.removeAttribute(t)}}function I(t){return function(){this.removeAttributeNS(t.space,t.local)}}function O(t,e){return function(){this.setAttribute(t,e)}}function T(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function k(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function M(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function E(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function B(t){return function(){this.style.removeProperty(t)}}function j(t,e,n){return function(){this.style.setProperty(t,e,n)}}function D(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function z(t,e){return t.style.getPropertyValue(e)||E(t).getComputedStyle(t,null).getPropertyValue(e)}function N(t){return function(){delete this[t]}}function F(t,e){return function(){this[t]=e}}function C(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function L(t){return t.trim().split(/^|\s+/)}function R(t){return t.classList||new U(t)}function U(t){this._node=t,this._names=L(t.getAttribute("class")||"")}function P(t,e){for(var n=R(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function V(t,e){for(var n=R(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function $(t){return function(){P(this,t)}}function Y(t){return function(){V(this,t)}}function W(t,e){return function(){(e.apply(this,arguments)?P:V)(this,t)}}function G(){this.textContent=""}function q(t){return function(){this.textContent=t}}function H(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function X(){this.innerHTML=""}function Z(t){return function(){this.innerHTML=t}}function J(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function K(){this.nextSibling&&this.parentNode.appendChild(this)}function Q(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function tt(){return null}function et(){var t=this.parentNode;t&&t.removeChild(this)}function nt(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function rt(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function it(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,o=e.length;r<o;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?e.length=i:delete this.__on}}}function ot(t,e,n){return function(){var r,i=this.__on,o=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(i)for(var a=0,s=i.length;a<s;++a)if((r=i[a]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=n),void(r.value=e);this.addEventListener(t.type,o,n),r={type:t.type,name:t.name,value:e,listener:o,options:n},i?i.push(r):this.__on=[r]}}function at(t,e,n){var r=E(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function st(t,e){return function(){return at(this,t,e)}}function ut(t,e){return function(){return at(this,t,e.apply(this,arguments))}}y.prototype={constructor:y,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},U.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var ct=[null];function ft(t,e){this._groups=t,this._parents=e}function lt(){return new ft([[document.documentElement]],ct)}function dt(t){return"string"==typeof t?new ft([[document.querySelector(t)]],[document.documentElement]):new ft([[t]],ct)}function ht(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}function pt(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function _t(t,e){return null==t||null==e?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function mt(t){let e,n,r;function i(t,r,i=0,o=t.length){if(i<o){if(0!==e(r,r))return o;do{const e=i+o>>>1;n(t[e],r)<0?i=e+1:o=e}while(i<o)}return i}return 2!==t.length?(e=pt,n=(e,n)=>pt(t(e),n),r=(e,n)=>t(e)-n):(e=t===pt||t===_t?t:bt,n=t,r=t),{left:i,center:function(t,e,n=0,o=t.length){const a=i(t,e,n,o-1);return a>n&&r(t[a-1],e)>-r(t[a],e)?a-1:a},right:function(t,r,i=0,o=t.length){if(i<o){if(0!==e(r,r))return o;do{const e=i+o>>>1;n(t[e],r)<=0?i=e+1:o=e}while(i<o)}return i}}}function bt(){return 0}ft.prototype=lt.prototype={constructor:ft,select:function(t){"function"!=typeof t&&(t=s(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a,u=e[i],c=u.length,f=r[i]=new Array(c),l=0;l<c;++l)(o=u[l])&&(a=t.call(o,o.__data__,l,u))&&("__data__"in o&&(a.__data__=o.__data__),f[l]=a);return new ft(r,this._parents)},selectAll:function(t){t="function"==typeof t?f(t):c(t);for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var a,s=e[o],u=s.length,l=0;l<u;++l)(a=s[l])&&(r.push(t.call(a,a.__data__,l,s)),i.push(a));return new ft(r,i)},selectChild:function(t){return this.select(null==t?p:function(t){return function(){return h.call(this.children,t)}}("function"==typeof t?t:d(t)))},selectChildren:function(t){return this.selectAll(null==t?m:function(t){return function(){return _.call(this.children,t)}}("function"==typeof t?t:d(t)))},filter:function(t){"function"!=typeof t&&(t=l(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a=e[i],s=a.length,u=r[i]=[],c=0;c<s;++c)(o=a[c])&&t.call(o,o.__data__,c,a)&&u.push(o);return new ft(r,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,w);var n,r=e?v:g,i=this._parents,o=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var a=o.length,s=new Array(a),u=new Array(a),c=new Array(a),f=0;f<a;++f){var l=i[f],d=o[f],h=d.length,p=x(t.call(l,l&&l.__data__,f,i)),_=p.length,m=u[f]=new Array(_),b=s[f]=new Array(_);r(l,d,m,b,c[f]=new Array(h),p,e);for(var y,A,S=0,I=0;S<_;++S)if(y=m[S]){for(S>=I&&(I=S+1);!(A=b[I])&&++I<_;);y._next=A||null}}return(s=new ft(s,i))._enter=u,s._exit=c,s},enter:function(){return new ft(this._enter||this._groups.map(b),this._parents)},exit:function(){return new ft(this._exit||this._groups.map(b),this._parents)},join:function(t,e,n){var r=this.enter(),i=this,o=this.exit();return"function"==typeof t?(r=t(r))&&(r=r.selection()):r=r.append(t+""),null!=e&&(i=e(i))&&(i=i.selection()),null==n?o.remove():n(o),r&&i?r.merge(i).order():i},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,o=r.length,a=Math.min(i,o),s=new Array(i),u=0;u<a;++u)for(var c,f=n[u],l=r[u],d=f.length,h=s[u]=new Array(d),p=0;p<d;++p)(c=f[p]||l[p])&&(h[p]=c);for(;u<i;++u)s[u]=n[u];return new ft(s,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],o=i.length-1,a=i[o];--o>=0;)(r=i[o])&&(a&&4^r.compareDocumentPosition(a)&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=A);for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var a,s=n[o],u=s.length,c=i[o]=new Array(u),f=0;f<u;++f)(a=s[f])&&(c[f]=a);c.sort(e)}return new ft(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,o=e[n],a=0,s=o.length;a<s;++a)(i=o[a])&&t.call(i,i.__data__,a,o);return this},attr:function(t,e){var r=n(t);if(arguments.length<2){var i=this.node();return r.local?i.getAttributeNS(r.space,r.local):i.getAttribute(r)}return this.each((null==e?r.local?I:S:"function"==typeof e?r.local?M:k:r.local?T:O)(r,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?B:"function"==typeof e?D:j)(t,e,null==n?"":n)):z(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?N:"function"==typeof e?C:F)(t,e)):this.node()[t]},classed:function(t,e){var n=L(t+"");if(arguments.length<2){for(var r=R(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?W:e?$:Y)(n,e))},text:function(t){return arguments.length?this.each(null==t?G:("function"==typeof t?H:q)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?X:("function"==typeof t?J:Z)(t)):this.node().innerHTML},raise:function(){return this.each(K)},lower:function(){return this.each(Q)},append:function(t){var e="function"==typeof t?t:o(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:o(t),r=null==e?tt:"function"==typeof e?e:s(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(et)},clone:function(t){return this.select(t?rt:nt)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,o=function(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}(t+""),a=o.length;if(!(arguments.length<2)){for(s=e?ot:it,r=0;r<a;++r)this.each(s(o[r],e,n));return this}var s=this.node().__on;if(s)for(var u,c=0,f=s.length;c<f;++c)for(r=0,u=s[c];r<a;++r)if((i=o[r]).type===u.type&&i.name===u.name)return u.value},dispatch:function(t,e){return this.each(("function"==typeof e?ut:st)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,i=t[e],o=0,a=i.length;o<a;++o)(r=i[o])&&(yield r)}};const yt=mt(pt),gt=yt.right,vt=yt.left;function wt(t,e){let n,r;if(void 0===e)for(const i of t)null!=i&&(void 0===n?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)));else{let i=-1;for(let o of t)null!=(o=e(o,++i,t))&&(void 0===n?o>=o&&(n=r=o):(n>o&&(n=o),r<o&&(r=o)))}return[n,r]}mt((function(t){return null===t?NaN:+t})).center;class xt{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const i=e[r],o=t+i,a=Math.abs(t)<Math.abs(i)?t-(o-i):i-(o-t);a&&(e[n++]=a),t=o}return e[n]=t,this._n=n+1,this}valueOf(){const t=this._partials;let e,n,r,i=this._n,o=0;if(i>0){for(o=t[--i];i>0&&(e=o,n=t[--i],o=e+n,r=n-(o-e),!r););i>0&&(r<0&&t[i-1]<0||r>0&&t[i-1]>0)&&(n=2*r,e=o+n,n==e-o&&(o=e))}return o}}class At extends Map{constructor(t,e=It){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(const[n,r]of t)this.set(n,r)}get(t){return super.get(St(this,t))}has(t){return super.has(St(this,t))}set(t,e){return super.set(function({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}(this,t),e)}delete(t){return super.delete(function({_intern:t,_key:e},n){const r=e(n);t.has(r)&&(n=t.get(n),t.delete(r));return n}(this,t))}}function St({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function It(t){return null!==t&&"object"==typeof t?t.valueOf():t}const Ot=Math.sqrt(50),Tt=Math.sqrt(10),kt=Math.sqrt(2);function Mt(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),o=r/Math.pow(10,i),a=o>=Ot?10:o>=Tt?5:o>=kt?2:1;let s,u,c;return i<0?(c=Math.pow(10,-i)/a,s=Math.round(t*c),u=Math.round(e*c),s/c<t&&++s,u/c>e&&--u,c=-c):(c=Math.pow(10,i)*a,s=Math.round(t/c),u=Math.round(e/c),s*c<t&&++s,u*c>e&&--u),u<s&&.5<=n&&n<2?Mt(t,e,2*n):[s,u,c]}function Et(t,e,n){if(!((n=+n)>0))return[];if((t=+t)===(e=+e))return[t];const r=e<t,[i,o,a]=r?Mt(e,t,n):Mt(t,e,n);if(!(o>=i))return[];const s=o-i+1,u=new Array(s);if(r)if(a<0)for(let c=0;c<s;++c)u[c]=(o-c)/-a;else for(let c=0;c<s;++c)u[c]=(o-c)*a;else if(a<0)for(let c=0;c<s;++c)u[c]=(i+c)/-a;else for(let c=0;c<s;++c)u[c]=(i+c)*a;return u}function Bt(t,e,n){return Mt(t=+t,e=+e,n=+n)[2]}function jt(t,e){let n;if(void 0===e)for(const r of t)null!=r&&(n<r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function Dt(t,e){let n;if(void 0===e)for(const r of t)null!=r&&(n>r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function zt(t,e){let n=0,r=0;if(void 0===e)for(let i of t)null!=i&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let o of t)null!=(o=e(o,++i,t))&&(o=+o)>=o&&(++n,r+=o)}if(n)return r/n}function Nt(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((e-t)/n)),o=new Array(i);++r<i;)o[r]=t+r*n;return o}function Ft(t){return function(e,n=0,r=e.length){let i=r-(n=+n);for(;i;){const r=t()*i--|0,o=e[i+n];e[i+n]=e[r+n],e[r+n]=o}return e}}var Ct=1e-6,Lt=Math.PI,Rt=2*Lt,Ut=180/Lt,Pt=Lt/180,Vt=Math.abs,$t=Math.cos,Yt=Math.sin,Wt=Math.sqrt;function Gt(){}function qt(t,e){t&&Xt.hasOwnProperty(t.type)&&Xt[t.type](t,e)}var Ht={Feature:function(t,e){qt(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)qt(n[r].geometry,e)}},Xt={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){Zt(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)Zt(n[r],e,0)},Polygon:function(t,e){Jt(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)Jt(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)qt(n[r],e)}};function Zt(t,e,n){var r,i=-1,o=t.length-n;for(e.lineStart();++i<o;)r=t[i],e.point(r[0],r[1],r[2]);e.lineEnd()}function Jt(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)Zt(t[n],e,1);e.polygonEnd()}function Kt(t,e){t&&Ht.hasOwnProperty(t.type)?Ht[t.type](t,e):qt(t,e)}function Qt(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function te(t,e,n,r,i){var o,a,s=[],u=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,n,r,a,c=t[0],f=t[e];if(a=f,Vt((r=c)[0]-a[0])<Ct&&Vt(r[1]-a[1])<Ct){if(!c[2]&&!f[2]){for(i.lineStart(),o=0;o<e;++o)i.point((c=t[o])[0],c[1]);return void i.lineEnd()}f[0]+=2*Ct}s.push(n=new Qt(c,t,null,!0)),u.push(n.o=new Qt(c,null,n,!1)),s.push(n=new Qt(f,t,null,!1)),u.push(n.o=new Qt(f,null,n,!0))}})),s.length){for(u.sort(e),ee(s),ee(u),o=0,a=u.length;o<a;++o)u[o].e=n=!n;for(var c,f,l=s[0];;){for(var d=l,h=!0;d.v;)if((d=d.n)===l)return;c=d.z,i.lineStart();do{if(d.v=d.o.v=!0,d.e){if(h)for(o=0,a=c.length;o<a;++o)i.point((f=c[o])[0],f[1]);else r(d.x,d.n.x,1,i);d=d.n}else{if(h)for(c=d.p.z,o=c.length-1;o>=0;--o)i.point((f=c[o])[0],f[1]);else r(d.x,d.p.x,-1,i);d=d.p}c=(d=d.o).z,h=!h}while(!d.v);i.lineEnd()}}}function ee(t){if(e=t.length){for(var e,n,r=0,i=t[0];++r<e;)i.n=n=t[r],n.p=i,i=n;i.n=n=t[0],n.p=i}}var ne=1e9,re=-ne;function ie(t,e,n,r){function i(i,o){return t<=i&&i<=n&&e<=o&&o<=r}function o(i,o,s,c){var f=0,l=0;if(null==i||(f=a(i,s))!==(l=a(o,s))||u(i,o)<0^s>0)do{c.point(0===f||3===f?t:n,f>1?r:e)}while((f=(f+s+4)%4)!==l);else c.point(o[0],o[1])}function a(r,i){return Vt(r[0]-t)<Ct?i>0?0:3:Vt(r[0]-n)<Ct?i>0?2:1:Vt(r[1]-e)<Ct?i>0?1:0:i>0?3:2}function s(t,e){return u(t.x,e.x)}function u(t,e){var n=a(t,1),r=a(e,1);return n!==r?n-r:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(a){var u,c,f,l,d,h,p,_,m,b,y,g,v,w=a,x=(v=[],{point:function(t,e,n){g.push([t,e,n])},lineStart:function(){v.push(g=[])},lineEnd:Gt,rejoin:function(){v.length>1&&v.push(v.pop().concat(v.shift()))},result:function(){var t=v;return v=[],g=null,t}}),A={point:S,lineStart:function(){A.point=I,c&&c.push(f=[]);b=!0,m=!1,p=_=NaN},lineEnd:function(){u&&(I(l,d),h&&m&&x.rejoin(),u.push(x.result()));A.point=S,m&&w.lineEnd()},polygonStart:function(){w=x,u=[],c=[],y=!0},polygonEnd:function(){var e=function(){for(var e=0,n=0,i=c.length;n<i;++n)for(var o,a,s=c[n],u=1,f=s.length,l=s[0],d=l[0],h=l[1];u<f;++u)o=d,a=h,d=(l=s[u])[0],h=l[1],a<=r?h>r&&(d-o)*(r-a)>(h-a)*(t-o)&&++e:h<=r&&(d-o)*(r-a)<(h-a)*(t-o)&&--e;return e}(),n=y&&e,i=(l=u,u=Array.from(function*(t){for(const e of t)yield*e}(l))).length;var l;(n||i)&&(a.polygonStart(),n&&(a.lineStart(),o(null,null,1,a),a.lineEnd()),i&&te(u,s,e,o,a),a.polygonEnd());w=a,u=c=f=null}};function S(t,e){i(t,e)&&w.point(t,e)}function I(o,a){var s=i(o,a);if(c&&f.push([o,a]),b)l=o,d=a,h=s,b=!1,s&&(w.lineStart(),w.point(o,a));else if(s&&m)w.point(o,a);else{var u=[p=Math.max(re,Math.min(ne,p)),_=Math.max(re,Math.min(ne,_))],g=[o=Math.max(re,Math.min(ne,o)),a=Math.max(re,Math.min(ne,a))];!function(t,e,n,r,i,o){var a,s=t[0],u=t[1],c=0,f=1,l=e[0]-s,d=e[1]-u;if(a=n-s,l||!(a>0)){if(a/=l,l<0){if(a<c)return;a<f&&(f=a)}else if(l>0){if(a>f)return;a>c&&(c=a)}if(a=i-s,l||!(a<0)){if(a/=l,l<0){if(a>f)return;a>c&&(c=a)}else if(l>0){if(a<c)return;a<f&&(f=a)}if(a=r-u,d||!(a>0)){if(a/=d,d<0){if(a<c)return;a<f&&(f=a)}else if(d>0){if(a>f)return;a>c&&(c=a)}if(a=o-u,d||!(a<0)){if(a/=d,d<0){if(a>f)return;a>c&&(c=a)}else if(d>0){if(a<c)return;a<f&&(f=a)}return c>0&&(t[0]=s+c*l,t[1]=u+c*d),f<1&&(e[0]=s+f*l,e[1]=u+f*d),!0}}}}}(u,g,t,e,n,r)?s&&(w.lineStart(),w.point(o,a),y=!1):(m||(w.lineStart(),w.point(u[0],u[1])),w.point(g[0],g[1]),s||w.lineEnd(),y=!1)}p=o,_=a,m=s}return A}}const oe=t=>t;var ae,se,ue,ce,fe=new xt,le=new xt,de={point:Gt,lineStart:Gt,lineEnd:Gt,polygonStart:function(){de.lineStart=he,de.lineEnd=me},polygonEnd:function(){de.lineStart=de.lineEnd=de.point=Gt,fe.add(Vt(le)),le=new xt},result:function(){var t=fe/2;return fe=new xt,t}};function he(){de.point=pe}function pe(t,e){de.point=_e,ae=ue=t,se=ce=e}function _e(t,e){le.add(ce*t-ue*e),ue=t,ce=e}function me(){_e(ae,se)}const be=de;var ye=1/0,ge=ye,ve=-ye,we=ve;const xe={point:function(t,e){t<ye&&(ye=t);t>ve&&(ve=t);e<ge&&(ge=e);e>we&&(we=e)},lineStart:Gt,lineEnd:Gt,polygonStart:Gt,polygonEnd:Gt,result:function(){var t=[[ye,ge],[ve,we]];return ve=we=-(ge=ye=1/0),t}};var Ae,Se,Ie,Oe,Te=0,ke=0,Me=0,Ee=0,Be=0,je=0,De=0,ze=0,Ne=0,Fe={point:Ce,lineStart:Le,lineEnd:Pe,polygonStart:function(){Fe.lineStart=Ve,Fe.lineEnd=$e},polygonEnd:function(){Fe.point=Ce,Fe.lineStart=Le,Fe.lineEnd=Pe},result:function(){var t=Ne?[De/Ne,ze/Ne]:je?[Ee/je,Be/je]:Me?[Te/Me,ke/Me]:[NaN,NaN];return Te=ke=Me=Ee=Be=je=De=ze=Ne=0,t}};function Ce(t,e){Te+=t,ke+=e,++Me}function Le(){Fe.point=Re}function Re(t,e){Fe.point=Ue,Ce(Ie=t,Oe=e)}function Ue(t,e){var n=t-Ie,r=e-Oe,i=Wt(n*n+r*r);Ee+=i*(Ie+t)/2,Be+=i*(Oe+e)/2,je+=i,Ce(Ie=t,Oe=e)}function Pe(){Fe.point=Ce}function Ve(){Fe.point=Ye}function $e(){We(Ae,Se)}function Ye(t,e){Fe.point=We,Ce(Ae=Ie=t,Se=Oe=e)}function We(t,e){var n=t-Ie,r=e-Oe,i=Wt(n*n+r*r);Ee+=i*(Ie+t)/2,Be+=i*(Oe+e)/2,je+=i,De+=(i=Oe*t-Ie*e)*(Ie+t),ze+=i*(Oe+e),Ne+=3*i,Ce(Ie=t,Oe=e)}const Ge=Fe;function qe(t){this._context=t}qe.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,Rt)}},result:Gt};var He,Xe,Ze,Je,Ke,Qe=new xt,tn={point:Gt,lineStart:function(){tn.point=en},lineEnd:function(){He&&nn(Xe,Ze),tn.point=Gt},polygonStart:function(){He=!0},polygonEnd:function(){He=null},result:function(){var t=+Qe;return Qe=new xt,t}};function en(t,e){tn.point=nn,Xe=Je=t,Ze=Ke=e}function nn(t,e){Je-=t,Ke-=e,Qe.add(Wt(Je*Je+Ke*Ke)),Je=t,Ke=e}const rn=tn;let on,an,sn,un;class cn{constructor(t){this._append=null==t?fn:function(t){const e=Math.floor(t);if(!(e>=0))throw new RangeError(`invalid digits: ${t}`);if(e>15)return fn;if(e!==on){const t=10**e;on=e,an=function(e){let n=1;this._+=e[0];for(const r=e.length;n<r;++n)this._+=Math.round(arguments[n]*t)/t+e[n]}}return an}(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){0===this._line&&(this._+="Z"),this._point=NaN}point(t,e){switch(this._point){case 0:this._append`M${t},${e}`,this._point=1;break;case 1:this._append`L${t},${e}`;break;default:if(this._append`M${t},${e}`,this._radius!==sn||this._append!==an){const t=this._radius,e=this._;this._="",this._append`m0,${t}a${t},${t} 0 1,1 0,${-2*t}a${t},${t} 0 1,1 0,${2*t}z`,sn=t,an=this._append,un=this._,this._=e}this._+=un}}result(){const t=this._;return this._="",t.length?t:null}}function fn(t){let e=1;this._+=t[0];for(const n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function ln(t,e){let n,r,i=3,o=4.5;function a(t){return t&&("function"==typeof o&&r.pointRadius(+o.apply(this,arguments)),Kt(t,n(r))),r.result()}return a.area=function(t){return Kt(t,n(be)),be.result()},a.measure=function(t){return Kt(t,n(rn)),rn.result()},a.bounds=function(t){return Kt(t,n(xe)),xe.result()},a.centroid=function(t){return Kt(t,n(Ge)),Ge.result()},a.projection=function(e){return arguments.length?(n=null==e?(t=null,oe):(t=e).stream,a):t},a.context=function(t){return arguments.length?(r=null==t?(e=null,new cn(i)):new qe(e=t),"function"!=typeof o&&r.pointRadius(o),a):e},a.pointRadius=function(t){return arguments.length?(o="function"==typeof t?t:(r.pointRadius(+t),+t),a):o},a.digits=function(t){if(!arguments.length)return i;if(null==t)i=null;else{const e=Math.floor(t);if(!(e>=0))throw new RangeError(`invalid digits: ${t}`);i=e}return null===e&&(r=new cn(i)),a},a.projection(t).digits(i).context(e)}function dn(){}function hn(t,e,n){var r=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=r&&t.clipExtent(null),Kt(n,t.stream(xe)),e(xe.result()),null!=r&&t.clipExtent(r),t}function pn(t,e,n){return hn(t,(function(n){var r=e[1][0]-e[0][0],i=e[1][1]-e[0][1],o=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),a=+e[0][0]+(r-o*(n[1][0]+n[0][0]))/2,s=+e[0][1]+(i-o*(n[1][1]+n[0][1]))/2;t.scale(150*o).translate([a,s])}),n)}function _n(){var t,e,n,r,i,o,a,s,u=1,c=0,f=0,l=1,d=1,h=0,p=null,_=1,m=1,b=(s={point:function(t,e){var n=v([t,e]);this.stream.point(n[0],n[1])}},function(t){var e=new dn;for(var n in s)e[n]=s[n];return e.stream=t,e}),y=oe;function g(){return _=u*l,m=u*d,o=a=null,v}function v(n){var r=n[0]*_,i=n[1]*m;if(h){var o=i*t-r*e;r=r*t+i*e,i=o}return[r+c,i+f]}return v.invert=function(n){var r=n[0]-c,i=n[1]-f;if(h){var o=i*t+r*e;r=r*t-i*e,i=o}return[r/_,i/m]},v.stream=function(t){return o&&a===t?o:o=b(y(a=t))},v.postclip=function(t){return arguments.length?(y=t,p=n=r=i=null,g()):y},v.clipExtent=function(t){return arguments.length?(y=null==t?(p=n=r=i=null,oe):ie(p=+t[0][0],n=+t[0][1],r=+t[1][0],i=+t[1][1]),g()):null==p?null:[[p,n],[r,i]]},v.scale=function(t){return arguments.length?(u=+t,g()):u},v.translate=function(t){return arguments.length?(c=+t[0],f=+t[1],g()):[c,f]},v.angle=function(n){return arguments.length?(e=Yt(h=n%360*Pt),t=$t(h),g()):h*Ut},v.reflectX=function(t){return arguments.length?(l=t?-1:1,g()):l<0},v.reflectY=function(t){return arguments.length?(d=t?-1:1,g()):d<0},v.fitExtent=function(t,e){return pn(v,t,e)},v.fitSize=function(t,e){return function(t,e,n){return pn(t,[[0,0],e],n)}(v,t,e)},v.fitWidth=function(t,e){return function(t,e,n){return hn(t,(function(n){var r=+e,i=r/(n[1][0]-n[0][0]),o=(r-i*(n[1][0]+n[0][0]))/2,a=-i*n[0][1];t.scale(150*i).translate([o,a])}),n)}(v,t,e)},v.fitHeight=function(t,e){return function(t,e,n){return hn(t,(function(n){var r=+e,i=r/(n[1][1]-n[0][1]),o=-i*n[0][0],a=(r-i*(n[1][1]+n[0][1]))/2;t.scale(150*i).translate([o,a])}),n)}(v,t,e)},v}dn.prototype={constructor:dn,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var mn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},bn={};!function(t,e){var n=200,r="__lodash_hash_undefined__",i=800,o=16,a=9007199254740991,s="[object Arguments]",u="[object AsyncFunction]",c="[object Function]",f="[object GeneratorFunction]",l="[object Null]",d="[object Object]",h="[object Proxy]",p="[object Undefined]",_=/^\[object .+?Constructor\]$/,m=/^(?:0|[1-9]\d*)$/,b={};b["[object Float32Array]"]=b["[object Float64Array]"]=b["[object Int8Array]"]=b["[object Int16Array]"]=b["[object Int32Array]"]=b["[object Uint8Array]"]=b["[object Uint8ClampedArray]"]=b["[object Uint16Array]"]=b["[object Uint32Array]"]=!0,b[s]=b["[object Array]"]=b["[object ArrayBuffer]"]=b["[object Boolean]"]=b["[object DataView]"]=b["[object Date]"]=b["[object Error]"]=b[c]=b["[object Map]"]=b["[object Number]"]=b[d]=b["[object RegExp]"]=b["[object Set]"]=b["[object String]"]=b["[object WeakMap]"]=!1;var y="object"==typeof mn&&mn&&mn.Object===Object&&mn,g="object"==typeof self&&self&&self.Object===Object&&self,v=y||g||Function("return this")(),w=e&&!e.nodeType&&e,x=w&&t&&!t.nodeType&&t,A=x&&x.exports===w,S=A&&y.process,I=function(){try{var t=x&&x.require&&x.require("util").types;return t||S&&S.binding&&S.binding("util")}catch(e){}}(),O=I&&I.isTypedArray;var T,k,M,E=Array.prototype,B=Function.prototype,j=Object.prototype,D=v["__core-js_shared__"],z=B.toString,N=j.hasOwnProperty,F=(T=/[^.]+$/.exec(D&&D.keys&&D.keys.IE_PROTO||""))?"Symbol(src)_1."+T:"",C=j.toString,L=z.call(Object),R=RegExp("^"+z.call(N).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),U=A?v.Buffer:void 0,P=v.Symbol,V=v.Uint8Array,$=U?U.allocUnsafe:void 0,Y=(k=Object.getPrototypeOf,M=Object,function(t){return k(M(t))}),W=Object.create,G=j.propertyIsEnumerable,q=E.splice,H=P?P.toStringTag:void 0,X=function(){try{var t=wt(Object,"defineProperty");return t({},"",{}),t}catch(e){}}(),Z=U?U.isBuffer:void 0,J=Math.max,K=Date.now,Q=wt(v,"Map"),tt=wt(Object,"create"),et=function(){function t(){}return function(e){if(!Dt(e))return{};if(W)return W(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function nt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function rt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function it(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function ot(t){var e=this.__data__=new rt(t);this.size=e.size}function at(t,e){var n=kt(t),r=!n&&Tt(t),i=!n&&!r&&Et(t),o=!n&&!r&&!i&&Nt(t),a=n||r||i||o,s=a?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],u=s.length;for(var c in t)!e&&!N.call(t,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||xt(c,u))||s.push(c);return s}function st(t,e,n){(void 0!==n&&!Ot(t[e],n)||void 0===n&&!(e in t))&&ft(t,e,n)}function ut(t,e,n){var r=t[e];N.call(t,e)&&Ot(r,n)&&(void 0!==n||e in t)||ft(t,e,n)}function ct(t,e){for(var n=t.length;n--;)if(Ot(t[n][0],e))return n;return-1}function ft(t,e,n){"__proto__"==e&&X?X(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}nt.prototype.clear=function(){this.__data__=tt?tt(null):{},this.size=0},nt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},nt.prototype.get=function(t){var e=this.__data__;if(tt){var n=e[t];return n===r?void 0:n}return N.call(e,t)?e[t]:void 0},nt.prototype.has=function(t){var e=this.__data__;return tt?void 0!==e[t]:N.call(e,t)},nt.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=tt&&void 0===e?r:e,this},rt.prototype.clear=function(){this.__data__=[],this.size=0},rt.prototype.delete=function(t){var e=this.__data__,n=ct(e,t);return!(n<0)&&(n==e.length-1?e.pop():q.call(e,n,1),--this.size,!0)},rt.prototype.get=function(t){var e=this.__data__,n=ct(e,t);return n<0?void 0:e[n][1]},rt.prototype.has=function(t){return ct(this.__data__,t)>-1},rt.prototype.set=function(t,e){var n=this.__data__,r=ct(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},it.prototype.clear=function(){this.size=0,this.__data__={hash:new nt,map:new(Q||rt),string:new nt}},it.prototype.delete=function(t){var e=vt(this,t).delete(t);return this.size-=e?1:0,e},it.prototype.get=function(t){return vt(this,t).get(t)},it.prototype.has=function(t){return vt(this,t).has(t)},it.prototype.set=function(t,e){var n=vt(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},ot.prototype.clear=function(){this.__data__=new rt,this.size=0},ot.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},ot.prototype.get=function(t){return this.__data__.get(t)},ot.prototype.has=function(t){return this.__data__.has(t)},ot.prototype.set=function(t,e){var r=this.__data__;if(r instanceof rt){var i=r.__data__;if(!Q||i.length<n-1)return i.push([t,e]),this.size=++r.size,this;r=this.__data__=new it(i)}return r.set(t,e),this.size=r.size,this};var lt,dt=function(t,e,n){for(var r=-1,i=Object(t),o=n(t),a=o.length;a--;){var s=o[lt?a:++r];if(!1===e(i[s],s,i))break}return t};function ht(t){return null==t?void 0===t?p:l:H&&H in Object(t)?function(t){var e=N.call(t,H),n=t[H];try{t[H]=void 0;var r=!0}catch(o){}var i=C.call(t);r&&(e?t[H]=n:delete t[H]);return i}(t):function(t){return C.call(t)}(t)}function pt(t){return zt(t)&&ht(t)==s}function _t(t){return!(!Dt(t)||function(t){return!!F&&F in t}(t))&&(Bt(t)?R:_).test(function(t){if(null!=t){try{return z.call(t)}catch(e){}try{return t+""}catch(e){}}return""}(t))}function mt(t){if(!Dt(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=At(t),n=[];for(var r in t)("constructor"!=r||!e&&N.call(t,r))&&n.push(r);return n}function bt(t,e,n,r,i){t!==e&&dt(e,(function(o,a){if(i||(i=new ot),Dt(o))!function(t,e,n,r,i,o,a){var s=St(t,n),u=St(e,n),c=a.get(u);if(c)return void st(t,n,c);var f=o?o(s,u,n+"",t,e,a):void 0,l=void 0===f;if(l){var h=kt(u),p=!h&&Et(u),_=!h&&!p&&Nt(u);f=u,h||p||_?kt(s)?f=s:zt(v=s)&&Mt(v)?f=function(t,e){var n=-1,r=t.length;e||(e=Array(r));for(;++n<r;)e[n]=t[n];return e}(s):p?(l=!1,f=function(t,e){if(e)return t.slice();var n=t.length,r=$?$(n):new t.constructor(n);return t.copy(r),r}(u,!0)):_?(l=!1,m=u,b=!0?(y=m.buffer,g=new y.constructor(y.byteLength),new V(g).set(new V(y)),g):m.buffer,f=new m.constructor(b,m.byteOffset,m.length)):f=[]:function(t){if(!zt(t)||ht(t)!=d)return!1;var e=Y(t);if(null===e)return!0;var n=N.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&z.call(n)==L}(u)||Tt(u)?(f=s,Tt(s)?f=function(t){return function(t,e,n,r){var i=!n;n||(n={});var o=-1,a=e.length;for(;++o<a;){var s=e[o],u=r?r(n[s],t[s],s,n,t):void 0;void 0===u&&(u=t[s]),i?ft(n,s,u):ut(n,s,u)}return n}(t,Ft(t))}(s):Dt(s)&&!Bt(s)||(f=function(t){return"function"!=typeof t.constructor||At(t)?{}:et(Y(t))}(u))):l=!1}var m,b,y,g;var v;l&&(a.set(u,f),i(f,u,r,o,a),a.delete(u));st(t,n,f)}(t,e,a,n,bt,r,i);else{var s=r?r(St(t,a),o,a+"",t,e,i):void 0;void 0===s&&(s=o),st(t,a,s)}}),Ft)}function yt(t,e){return It(function(t,e,n){return e=J(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,o=J(r.length-e,0),a=Array(o);++i<o;)a[i]=r[e+i];i=-1;for(var s=Array(e+1);++i<e;)s[i]=r[i];return s[e]=n(a),function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}(t,this,s)}}(t,e,Rt),t+"")}var gt=X?function(t,e){return X(t,"toString",{configurable:!0,enumerable:!1,value:(n=e,function(){return n}),writable:!0});var n}:Rt;function vt(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function wt(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return _t(n)?n:void 0}function xt(t,e){var n=typeof t;return!!(e=null==e?a:e)&&("number"==n||"symbol"!=n&&m.test(t))&&t>-1&&t%1==0&&t<e}function At(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||j)}function St(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var It=function(t){var e=0,n=0;return function(){var r=K(),a=o-(r-n);if(n=r,a>0){if(++e>=i)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(gt);function Ot(t,e){return t===e||t!=t&&e!=e}var Tt=pt(function(){return arguments}())?pt:function(t){return zt(t)&&N.call(t,"callee")&&!G.call(t,"callee")},kt=Array.isArray;function Mt(t){return null!=t&&jt(t.length)&&!Bt(t)}var Et=Z||function(){return!1};function Bt(t){if(!Dt(t))return!1;var e=ht(t);return e==c||e==f||e==u||e==h}function jt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=a}function Dt(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function zt(t){return null!=t&&"object"==typeof t}var Nt=O?function(t){return function(e){return t(e)}}(O):function(t){return zt(t)&&jt(t.length)&&!!b[ht(t)]};function Ft(t){return Mt(t)?at(t,!0):mt(t)}var Ct,Lt=(Ct=function(t,e,n){bt(t,e,n)},yt((function(t,e){var n=-1,r=e.length,i=r>1?e[r-1]:void 0,o=r>2?e[2]:void 0;for(i=Ct.length>3&&"function"==typeof i?(r--,i):void 0,o&&function(t,e,n){if(!Dt(n))return!1;var r=typeof e;return!!("number"==r?Mt(n)&&xt(e,n.length):"string"==r&&e in n)&&Ot(n[e],t)}(e[0],e[1],o)&&(i=r<3?void 0:i,r=1),t=Object(t);++n<r;){var a=e[n];a&&Ct(t,a,n,i)}return t})));function Rt(t){return t}t.exports=Lt}({get exports(){return bn},set exports(t){bn=t}},bn);var yn,gn,vn=0,wn=0,xn=0,An=1e3,Sn=0,In=0,On=0,Tn="object"==typeof performance&&performance.now?performance:Date,kn="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Mn(){return In||(kn(En),In=Tn.now()+On)}function En(){In=0}function Bn(){this._call=this._time=this._next=null}function jn(t,e,n){var r=new Bn;return r.restart(t,e,n),r}function Dn(){In=(Sn=Tn.now())+On,vn=wn=0;try{!function(){Mn(),++vn;for(var t,e=yn;e;)(t=In-e._time)>=0&&e._call.call(void 0,t),e=e._next;--vn}()}finally{vn=0,function(){var t,e,n=yn,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:yn=e);gn=t,Nn(r)}(),In=0}}function zn(){var t=Tn.now(),e=t-Sn;e>An&&(On-=e,Sn=t)}function Nn(t){vn||(wn&&(wn=clearTimeout(wn)),t-In>24?(t<1/0&&(wn=setTimeout(Dn,t-Tn.now()-On)),xn&&(xn=clearInterval(xn))):(xn||(Sn=Tn.now(),xn=setInterval(zn,An)),vn=1,kn(Dn)))}function Fn(t,e,n){var r=new Bn;return e=null==e?0:+e,r.restart((n=>{r.stop(),t(n+e)}),e,n),r}Bn.prototype=jn.prototype={constructor:Bn,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Mn():+n)+(null==e?0:+e),this._next||gn===this||(gn?gn._next=this:yn=this,gn=this),this._call=t,this._time=n,Nn()},stop:function(){this._call&&(this._call=null,this._time=1/0,Nn())}};var Cn={value:()=>{}};function Ln(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new Rn(r)}function Rn(t){this._=t}function Un(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function Pn(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=Cn,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}Rn.prototype=Ln.prototype={constructor:Rn,on:function(t,e){var n,r,i=this._,o=(r=i,(t+"").trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))),a=-1,s=o.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++a<s;)if(n=(t=o[a]).type)i[n]=Pn(i[n],t.name,e);else if(null==e)for(n in i)i[n]=Pn(i[n],t.name,null);return this}for(;++a<s;)if((n=(t=o[a]).type)&&(n=Un(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Rn(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(r=this._[t]).length;o<n;++o)r[o].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};const Vn={passive:!1},$n={capture:!0,passive:!1};function Yn(t){t.stopImmediatePropagation()}function Wn(t){t.preventDefault(),t.stopImmediatePropagation()}function Gn(t){var e=t.document.documentElement,n=dt(t).on("dragstart.drag",Wn,$n);"onselectstart"in e?n.on("selectstart.drag",Wn,$n):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function qn(t,e){var n=t.document.documentElement,r=dt(t).on("dragstart.drag",null);e&&(r.on("click.drag",Wn,$n),setTimeout((function(){r.on("click.drag",null)}),0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Hn=t=>()=>t;function Xn(t,{sourceEvent:e,subject:n,target:r,identifier:i,active:o,x:a,y:s,dx:u,dy:c,dispatch:f}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:s,enumerable:!0,configurable:!0},dx:{value:u,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:f}})}function Zn(t){return!t.ctrlKey&&!t.button}function Jn(){return this.parentNode}function Kn(t,e){return null==e?{x:t.x,y:t.y}:e}function Qn(){return navigator.maxTouchPoints||"ontouchstart"in this}function tr(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function er(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function nr(){}Xn.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var rr=.7,ir=1/rr,or="\\s*([+-]?\\d+)\\s*",ar="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",sr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ur=/^#([0-9a-f]{3,8})$/,cr=new RegExp(`^rgb\\(${or},${or},${or}\\)$`),fr=new RegExp(`^rgb\\(${sr},${sr},${sr}\\)$`),lr=new RegExp(`^rgba\\(${or},${or},${or},${ar}\\)$`),dr=new RegExp(`^rgba\\(${sr},${sr},${sr},${ar}\\)$`),hr=new RegExp(`^hsl\\(${ar},${sr},${sr}\\)$`),pr=new RegExp(`^hsla\\(${ar},${sr},${sr},${ar}\\)$`),_r={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function mr(){return this.rgb().formatHex()}function br(){return this.rgb().formatRgb()}function yr(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=ur.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?gr(e):3===n?new Ar(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?vr(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?vr(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=cr.exec(t))?new Ar(e[1],e[2],e[3],1):(e=fr.exec(t))?new Ar(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=lr.exec(t))?vr(e[1],e[2],e[3],e[4]):(e=dr.exec(t))?vr(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=hr.exec(t))?Mr(e[1],e[2]/100,e[3]/100,1):(e=pr.exec(t))?Mr(e[1],e[2]/100,e[3]/100,e[4]):_r.hasOwnProperty(t)?gr(_r[t]):"transparent"===t?new Ar(NaN,NaN,NaN,0):null}function gr(t){return new Ar(t>>16&255,t>>8&255,255&t,1)}function vr(t,e,n,r){return r<=0&&(t=e=n=NaN),new Ar(t,e,n,r)}function wr(t){return t instanceof nr||(t=yr(t)),t?new Ar((t=t.rgb()).r,t.g,t.b,t.opacity):new Ar}function xr(t,e,n,r){return 1===arguments.length?wr(t):new Ar(t,e,n,null==r?1:r)}function Ar(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function Sr(){return`#${kr(this.r)}${kr(this.g)}${kr(this.b)}`}function Ir(){const t=Or(this.opacity);return`${1===t?"rgb(":"rgba("}${Tr(this.r)}, ${Tr(this.g)}, ${Tr(this.b)}${1===t?")":`, ${t})`}`}function Or(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Tr(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function kr(t){return((t=Tr(t))<16?"0":"")+t.toString(16)}function Mr(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Br(t,e,n,r)}function Er(t){if(t instanceof Br)return new Br(t.h,t.s,t.l,t.opacity);if(t instanceof nr||(t=yr(t)),!t)return new Br;if(t instanceof Br)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,s=o-i,u=(o+i)/2;return s?(a=e===o?(n-r)/s+6*(n<r):n===o?(r-e)/s+2:(e-n)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new Br(a,s,u,t.opacity)}function Br(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function jr(t){return(t=(t||0)%360)<0?t+360:t}function Dr(t){return Math.max(0,Math.min(1,t||0))}function zr(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}tr(nr,yr,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:mr,formatHex:mr,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Er(this).formatHsl()},formatRgb:br,toString:br}),tr(Ar,xr,er(nr,{brighter(t){return t=null==t?ir:Math.pow(ir,t),new Ar(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?rr:Math.pow(rr,t),new Ar(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Ar(Tr(this.r),Tr(this.g),Tr(this.b),Or(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Sr,formatHex:Sr,formatHex8:function(){return`#${kr(this.r)}${kr(this.g)}${kr(this.b)}${kr(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Ir,toString:Ir})),tr(Br,(function(t,e,n,r){return 1===arguments.length?Er(t):new Br(t,e,n,null==r?1:r)}),er(nr,{brighter(t){return t=null==t?ir:Math.pow(ir,t),new Br(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?rr:Math.pow(rr,t),new Br(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Ar(zr(t>=240?t-240:t+120,i,r),zr(t,i,r),zr(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new Br(jr(this.h),Dr(this.s),Dr(this.l),Or(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Or(this.opacity);return`${1===t?"hsl(":"hsla("}${jr(this.h)}, ${100*Dr(this.s)}%, ${100*Dr(this.l)}%${1===t?")":`, ${t})`}`}}));const Nr=Math.PI/180,Fr=180/Math.PI;var Cr=-.14861,Lr=1.78277,Rr=-.29227,Ur=-.90649,Pr=1.97294,Vr=Pr*Ur,$r=Pr*Lr,Yr=Lr*Rr-Ur*Cr;function Wr(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof Gr)return new Gr(t.h,t.s,t.l,t.opacity);t instanceof Ar||(t=wr(t));var e=t.r/255,n=t.g/255,r=t.b/255,i=(Yr*r+Vr*e-$r*n)/(Yr+Vr-$r),o=r-i,a=(Pr*(n-i)-Rr*o)/Ur,s=Math.sqrt(a*a+o*o)/(Pr*i*(1-i)),u=s?Math.atan2(a,o)*Fr-120:NaN;return new Gr(u<0?u+360:u,s,i,t.opacity)}(t):new Gr(t,e,n,null==r?1:r)}function Gr(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}tr(Gr,Wr,er(nr,{brighter(t){return t=null==t?ir:Math.pow(ir,t),new Gr(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?rr:Math.pow(rr,t),new Gr(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=isNaN(this.h)?0:(this.h+120)*Nr,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new Ar(255*(e+n*(Cr*r+Lr*i)),255*(e+n*(Rr*r+Ur*i)),255*(e+n*(Pr*r)),this.opacity)}}));const qr=t=>()=>t;function Hr(t,e){return function(n){return t+n*e}}function Xr(t){return 1==(t=+t)?Zr:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):qr(isNaN(e)?n:e)}}function Zr(t,e){var n=e-t;return n?Hr(t,n):qr(isNaN(t)?e:t)}const Jr=function t(e){var n=Xr(e);function r(t,e){var r=n((t=xr(t)).r,(e=xr(e)).r),i=n(t.g,e.g),o=n(t.b,e.b),a=Zr(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=o(e),t.opacity=a(e),t+""}}return r.gamma=t,r}(1);var Kr,Qr=(Kr=function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],o=t[r+1],a=r>0?t[r-1]:2*i-o,s=r<e-1?t[r+2]:2*o-i;return function(t,e,n,r,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*r+a*i)/6}((n-r/e)*e,a,i,o,s)}},function(t){var e,n,r=t.length,i=new Array(r),o=new Array(r),a=new Array(r);for(e=0;e<r;++e)n=xr(t[e]),i[e]=n.r||0,o[e]=n.g||0,a[e]=n.b||0;return i=Kr(i),o=Kr(o),a=Kr(a),n.opacity=1,function(t){return n.r=i(t),n.g=o(t),n.b=a(t),n+""}});function ti(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,i=e.slice();return function(o){for(n=0;n<r;++n)i[n]=t[n]*(1-o)+e[n]*o;return i}}function ei(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=ui(t[n],e[n]);for(;n<r;++n)a[n]=e[n];return function(t){for(n=0;n<i;++n)a[n]=o[n](t);return a}}function ni(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function ri(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function ii(t,e){var n,r={},i={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=ui(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}}var oi=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ai=new RegExp(oi.source,"g");function si(t,e){var n,r,i,o=oi.lastIndex=ai.lastIndex=0,a=-1,s=[],u=[];for(t+="",e+="";(n=oi.exec(t))&&(r=ai.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:ri(n,r)})),o=ai.lastIndex;return o<e.length&&(i=e.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?function(t){return function(e){return t(e)+""}}(u[0].x):function(t){return function(){return t}}(e):(e=u.length,function(t){for(var n,r=0;r<e;++r)s[(n=u[r]).i]=n.x(t);return s.join("")})}function ui(t,e){var n,r,i=typeof e;return null==e||"boolean"===i?qr(e):("number"===i?ri:"string"===i?(n=yr(e))?(e=n,Jr):si:e instanceof yr?Jr:e instanceof Date?ni:(r=e,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(e)?ei:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?ii:ri:ti))(t,e)}function ci(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var fi,li=180/Math.PI,di={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function hi(t,e,n,r,i,o){var a,s,u;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(u=t*n+e*r)&&(n-=t*u,r-=e*u),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,u/=s),t*r<e*n&&(t=-t,e=-e,u=-u,a=-a),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*li,skewX:Math.atan(u)*li,scaleX:a,scaleY:s}}function pi(t,e,n,r){function i(t){return t.length?t.pop()+" ":""}return function(o,a){var s=[],u=[];return o=t(o),a=t(a),function(t,r,i,o,a,s){if(t!==i||r!==o){var u=a.push("translate(",null,e,null,n);s.push({i:u-4,x:ri(t,i)},{i:u-2,x:ri(r,o)})}else(i||o)&&a.push("translate("+i+e+o+n)}(o.translateX,o.translateY,a.translateX,a.translateY,s,u),function(t,e,n,o){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),o.push({i:n.push(i(n)+"rotate(",null,r)-2,x:ri(t,e)})):e&&n.push(i(n)+"rotate("+e+r)}(o.rotate,a.rotate,s,u),function(t,e,n,o){t!==e?o.push({i:n.push(i(n)+"skewX(",null,r)-2,x:ri(t,e)}):e&&n.push(i(n)+"skewX("+e+r)}(o.skewX,a.skewX,s,u),function(t,e,n,r,o,a){if(t!==n||e!==r){var s=o.push(i(o)+"scale(",null,",",null,")");a.push({i:s-4,x:ri(t,n)},{i:s-2,x:ri(e,r)})}else 1===n&&1===r||o.push(i(o)+"scale("+n+","+r+")")}(o.scaleX,o.scaleY,a.scaleX,a.scaleY,s,u),o=a=null,function(t){for(var e,n=-1,r=u.length;++n<r;)s[(e=u[n]).i]=e.x(t);return s.join("")}}}var _i=pi((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?di:hi(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),mi=pi((function(t){return null==t?di:(fi||(fi=document.createElementNS("http://www.w3.org/2000/svg","g")),fi.setAttribute("transform",t),(t=fi.transform.baseVal.consolidate())?hi((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):di)}),", ",")",")");function bi(t){return((t=Math.exp(t))+1/t)/2}const yi=function t(e,n,r){function i(t,i){var o,a,s=t[0],u=t[1],c=t[2],f=i[0],l=i[1],d=i[2],h=f-s,p=l-u,_=h*h+p*p;if(_<1e-12)a=Math.log(d/c)/e,o=function(t){return[s+t*h,u+t*p,c*Math.exp(e*t*a)]};else{var m=Math.sqrt(_),b=(d*d-c*c+r*_)/(2*c*n*m),y=(d*d-c*c-r*_)/(2*d*n*m),g=Math.log(Math.sqrt(b*b+1)-b),v=Math.log(Math.sqrt(y*y+1)-y);a=(v-g)/e,o=function(t){var r,i=t*a,o=bi(g),f=c/(n*m)*(o*(r=e*i+g,((r=Math.exp(2*r))-1)/(r+1))-function(t){return((t=Math.exp(t))-1/t)/2}(g));return[s+f*h,u+f*p,c*o/bi(e*i+g)]}}return o.duration=1e3*a*e/Math.SQRT2,o}return i.rho=function(e){var n=Math.max(.001,+e),r=n*n;return t(n,r,r*r)},i}(Math.SQRT2,2,4);function gi(t){return function e(n){function r(e,r){var i=t((e=Wr(e)).h,(r=Wr(r)).h),o=Zr(e.s,r.s),a=Zr(e.l,r.l),s=Zr(e.opacity,r.opacity);return function(t){return e.h=i(t),e.s=o(t),e.l=a(Math.pow(t,n)),e.opacity=s(t),e+""}}return n=+n,r.gamma=e,r}(1)}gi((function(t,e){var n=e-t;return n?Hr(t,n>180||n<-180?n-360*Math.round(n/360):n):qr(isNaN(t)?e:t)}));var vi=gi(Zr),wi=Ln("start","end","cancel","interrupt"),xi=[],Ai=0,Si=1,Ii=2,Oi=3,Ti=4,ki=5,Mi=6;function Ei(t,e,n,r,i,o){var a=t.__transition;if(a){if(n in a)return}else t.__transition={};!function(t,e,n){var r,i=t.__transition;function o(t){n.state=Si,n.timer.restart(a,n.delay,n.time),n.delay<=t&&a(t-n.delay)}function a(o){var c,f,l,d;if(n.state!==Si)return u();for(c in i)if((d=i[c]).name===n.name){if(d.state===Oi)return Fn(a);d.state===Ti?(d.state=Mi,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete i[c]):+c<e&&(d.state=Mi,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete i[c])}if(Fn((function(){n.state===Oi&&(n.state=Ti,n.timer.restart(s,n.delay,n.time),s(o))})),n.state=Ii,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Ii){for(n.state=Oi,r=new Array(l=n.tween.length),c=0,f=-1;c<l;++c)(d=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(r[++f]=d);r.length=f+1}}function s(e){for(var i=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(u),n.state=ki,1),o=-1,a=r.length;++o<a;)r[o].call(t,i);n.state===ki&&(n.on.call("end",t,t.__data__,n.index,n.group),u())}function u(){for(var r in n.state=Mi,n.timer.stop(),delete i[e],i)return;delete t.__transition}i[e]=n,n.timer=jn(o,0,n.time)}(t,n,{name:e,index:r,group:i,on:wi,tween:xi,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:Ai})}function Bi(t,e){var n=Di(t,e);if(n.state>Ai)throw new Error("too late; already scheduled");return n}function ji(t,e){var n=Di(t,e);if(n.state>Oi)throw new Error("too late; already running");return n}function Di(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function zi(t,e){var n,r,i,o=t.__transition,a=!0;if(o){for(i in e=null==e?null:e+"",o)(n=o[i]).name===e?(r=n.state>Ii&&n.state<ki,n.state=Mi,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete o[i]):a=!1;a&&delete t.__transition}}function Ni(t,e){var n,r;return function(){var i=ji(this,t),o=i.tween;if(o!==n)for(var a=0,s=(r=n=o).length;a<s;++a)if(r[a].name===e){(r=r.slice()).splice(a,1);break}i.tween=r}}function Fi(t,e,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var o=ji(this,t),a=o.tween;if(a!==r){i=(r=a).slice();for(var s={name:e,value:n},u=0,c=i.length;u<c;++u)if(i[u].name===e){i[u]=s;break}u===c&&i.push(s)}o.tween=i}}function Ci(t,e,n){var r=t._id;return t.each((function(){var t=ji(this,r);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return Di(t,r).value[e]}}function Li(t,e){var n;return("number"==typeof e?ri:e instanceof yr?Jr:(n=yr(e))?(e=n,Jr):si)(t,e)}function Ri(t){return function(){this.removeAttribute(t)}}function Ui(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Pi(t,e,n){var r,i,o=n+"";return function(){var a=this.getAttribute(t);return a===o?null:a===r?i:i=e(r=a,n)}}function Vi(t,e,n){var r,i,o=n+"";return function(){var a=this.getAttributeNS(t.space,t.local);return a===o?null:a===r?i:i=e(r=a,n)}}function $i(t,e,n){var r,i,o;return function(){var a,s,u=n(this);if(null!=u)return(a=this.getAttribute(t))===(s=u+"")?null:a===r&&s===i?o:(i=s,o=e(r=a,u));this.removeAttribute(t)}}function Yi(t,e,n){var r,i,o;return function(){var a,s,u=n(this);if(null!=u)return(a=this.getAttributeNS(t.space,t.local))===(s=u+"")?null:a===r&&s===i?o:(i=s,o=e(r=a,u));this.removeAttributeNS(t.space,t.local)}}function Wi(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&function(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}(t,i)),n}return i._value=e,i}function Gi(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&function(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}(t,i)),n}return i._value=e,i}function qi(t,e){return function(){Bi(this,t).delay=+e.apply(this,arguments)}}function Hi(t,e){return e=+e,function(){Bi(this,t).delay=e}}function Xi(t,e){return function(){ji(this,t).duration=+e.apply(this,arguments)}}function Zi(t,e){return e=+e,function(){ji(this,t).duration=e}}var Ji=lt.prototype.constructor;function Ki(t){return function(){this.style.removeProperty(t)}}var Qi=0;function to(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function eo(){return++Qi}var no=lt.prototype;to.prototype={constructor:to,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=s(t));for(var r=this._groups,i=r.length,o=new Array(i),a=0;a<i;++a)for(var u,c,f=r[a],l=f.length,d=o[a]=new Array(l),h=0;h<l;++h)(u=f[h])&&(c=t.call(u,u.__data__,h,f))&&("__data__"in u&&(c.__data__=u.__data__),d[h]=c,Ei(d[h],e,n,h,d,Di(u,n)));return new to(o,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=c(t));for(var r=this._groups,i=r.length,o=[],a=[],s=0;s<i;++s)for(var u,f=r[s],l=f.length,d=0;d<l;++d)if(u=f[d]){for(var h,p=t.call(u,u.__data__,d,f),_=Di(u,n),m=0,b=p.length;m<b;++m)(h=p[m])&&Ei(h,e,n,m,p,_);o.push(p),a.push(u)}return new to(o,a,e,n)},selectChild:no.selectChild,selectChildren:no.selectChildren,filter:function(t){"function"!=typeof t&&(t=l(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a=e[i],s=a.length,u=r[i]=[],c=0;c<s;++c)(o=a[c])&&t.call(o,o.__data__,c,a)&&u.push(o);return new to(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),s=0;s<o;++s)for(var u,c=e[s],f=n[s],l=c.length,d=a[s]=new Array(l),h=0;h<l;++h)(u=c[h]||f[h])&&(d[h]=u);for(;s<r;++s)a[s]=e[s];return new to(a,this._parents,this._name,this._id)},selection:function(){return new Ji(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=eo(),r=this._groups,i=r.length,o=0;o<i;++o)for(var a,s=r[o],u=s.length,c=0;c<u;++c)if(a=s[c]){var f=Di(a,e);Ei(a,t,n,c,s,{time:f.time+f.delay+f.duration,delay:0,duration:f.duration,ease:f.ease})}return new to(r,this._parents,t,n)},call:no.call,nodes:no.nodes,node:no.node,size:no.size,empty:no.empty,each:no.each,on:function(t,e){var n=this._id;return arguments.length<2?Di(this.node(),n).on.on(t):this.each(function(t,e,n){var r,i,o=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?Bi:ji;return function(){var a=o(this,t),s=a.on;s!==r&&(i=(r=s).copy()).on(e,n),a.on=i}}(n,t,e))},attr:function(t,e){var r=n(t),i="transform"===r?mi:Li;return this.attrTween(t,"function"==typeof e?(r.local?Yi:$i)(r,i,Ci(this,"attr."+t,e)):null==e?(r.local?Ui:Ri)(r):(r.local?Vi:Pi)(r,i,e))},attrTween:function(t,e){var r="attr."+t;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;var i=n(t);return this.tween(r,(i.local?Wi:Gi)(i,e))},style:function(t,e,n){var r="transform"==(t+="")?_i:Li;return null==e?this.styleTween(t,function(t,e){var n,r,i;return function(){var o=z(this,t),a=(this.style.removeProperty(t),z(this,t));return o===a?null:o===n&&a===r?i:i=e(n=o,r=a)}}(t,r)).on("end.style."+t,Ki(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var r,i,o;return function(){var a=z(this,t),s=n(this),u=s+"";return null==s&&(this.style.removeProperty(t),u=s=z(this,t)),a===u?null:a===r&&u===i?o:(i=u,o=e(r=a,s))}}(t,r,Ci(this,"style."+t,e))).each(function(t,e){var n,r,i,o,a="style."+e,s="end."+a;return function(){var u=ji(this,t),c=u.on,f=null==u.value[a]?o||(o=Ki(e)):void 0;c===n&&i===f||(r=(n=c).copy()).on(s,i=f),u.on=r}}(this._id,t)):this.styleTween(t,function(t,e,n){var r,i,o=n+"";return function(){var a=z(this,t);return a===o?null:a===r?i:i=e(r=a,n)}}(t,r,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;return this.tween(r,function(t,e,n){var r,i;function o(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&function(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}(t,o,n)),r}return o._value=e,o}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(Ci(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,n;function r(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&function(t){return function(e){this.textContent=t.call(this,e)}}(r)),e}return r._value=t,r}(t))},remove:function(){return this.on("end.remove",(t=this._id,function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}));var t},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r,i=Di(this.node(),n).tween,o=0,a=i.length;o<a;++o)if((r=i[o]).name===t)return r.value;return null}return this.each((null==e?Ni:Fi)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?qi:Hi)(e,t)):Di(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?Xi:Zi)(e,t)):Di(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){ji(this,t).ease=e}}(e,t)):Di(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;ji(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,r=n._id,i=n.size();return new Promise((function(o,a){var s={value:a},u={value:function(){0==--i&&o()}};n.each((function(){var n=ji(this,r),i=n.on;i!==t&&((e=(t=i).copy())._.cancel.push(s),e._.interrupt.push(s),e._.end.push(u)),n.on=e})),0===i&&o()}))},[Symbol.iterator]:no[Symbol.iterator]};var ro={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function io(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}lt.prototype.interrupt=function(t){return this.each((function(){zi(this,t)}))},lt.prototype.transition=function(t){var e,n;t instanceof to?(e=t._id,t=t._name):(e=eo(),(n=ro).time=Mn(),t=null==t?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var a,s=r[o],u=s.length,c=0;c<u;++c)(a=s[c])&&Ei(a,t,e,c,s,n||io(a,e));return new to(r,this._parents,t,e)};const oo=t=>()=>t;function ao(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function so(t,e,n){this.k=t,this.x=e,this.y=n}so.prototype={constructor:so,scale:function(t){return 1===t?this:new so(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new so(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var uo=new so(1,0,0);function co(t){t.stopImmediatePropagation()}function fo(t){t.preventDefault(),t.stopImmediatePropagation()}function lo(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function ho(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function po(){return this.__zoom||uo}function _o(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function mo(){return navigator.maxTouchPoints||"ontouchstart"in this}function bo(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],o=t.invertY(e[0][1])-n[0][1],a=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),a>o?(o+a)/2:Math.min(0,o)||Math.max(0,a))}function yo(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function go(t,e){switch(arguments.length){case 0:break;case 1:"function"==typeof t?this.interpolator(t):this.range(t);break;default:this.domain(t),"function"==typeof e?this.interpolator(e):this.range(e)}return this}so.prototype;const vo=Symbol("implicit");function wo(){var t=new At,e=[],n=[],r=vo;function i(i){let o=t.get(i);if(void 0===o){if(r!==vo)return r;t.set(i,o=e.push(i)-1)}return n[o%n.length]}return i.domain=function(n){if(!arguments.length)return e.slice();e=[],t=new At;for(const r of n)t.has(r)||t.set(r,e.push(r)-1);return i},i.range=function(t){return arguments.length?(n=Array.from(t),i):n.slice()},i.unknown=function(t){return arguments.length?(r=t,i):r},i.copy=function(){return wo(e,n).unknown(r)},yo.apply(i,arguments),i}function xo(t){return+t}var Ao=[0,1];function So(t){return t}function Io(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function Oo(t,e,n){var r=t[0],i=t[1],o=e[0],a=e[1];return i<r?(r=Io(i,r),o=n(a,o)):(r=Io(r,i),o=n(o,a)),function(t){return o(r(t))}}function To(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),o=new Array(r),a=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<r;)i[a]=Io(t[a],t[a+1]),o[a]=n(e[a],e[a+1]);return function(e){var n=gt(t,e,1,r)-1;return o[n](i[n](e))}}function ko(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Mo(){var t,e,n,r,i,o,a=Ao,s=Ao,u=ui,c=So;function f(){var t,e,n,u=Math.min(a.length,s.length);return c!==So&&(t=a[0],e=a[u-1],t>e&&(n=t,t=e,e=n),c=function(n){return Math.max(t,Math.min(e,n))}),r=u>2?To:Oo,i=o=null,l}function l(e){return null==e||isNaN(e=+e)?n:(i||(i=r(a.map(t),s,u)))(t(c(e)))}return l.invert=function(n){return c(e((o||(o=r(s,a.map(t),ri)))(n)))},l.domain=function(t){return arguments.length?(a=Array.from(t,xo),f()):a.slice()},l.range=function(t){return arguments.length?(s=Array.from(t),f()):s.slice()},l.rangeRound=function(t){return s=Array.from(t),u=ci,f()},l.clamp=function(t){return arguments.length?(c=!!t||So,f()):c!==So},l.interpolate=function(t){return arguments.length?(u=t,f()):u},l.unknown=function(t){return arguments.length?(n=t,l):n},function(n,r){return t=n,e=r,f()}}function Eo(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Bo(t){return(t=Eo(Math.abs(t)))?t[1]:NaN}var jo,Do=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function zo(t){if(!(e=Do.exec(t)))throw new Error("invalid format: "+t);var e;return new No({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function No(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function Fo(t,e){var n=Eo(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}zo.prototype=No.prototype,No.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Co={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Fo(100*t,e),r:Fo,s:function(t,e){var n=Eo(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(jo=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Eo(t,Math.max(0,e+o-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Lo(t){return t}var Ro,Uo,Po,Vo=Array.prototype.map,$o=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Yo(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?Lo:(e=Vo.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,o=[],a=0,s=e[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(t.substring(i-=s,i+s)),!((u+=s+1)>r));)s=e[a=(a+1)%e.length];return o.reverse().join(n)}),i=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?Lo:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(Vo.call(t.numerals,String)),u=void 0===t.percent?"%":t.percent+"",c=void 0===t.minus?"−":t.minus+"",f=void 0===t.nan?"NaN":t.nan+"";function l(t){var e=(t=zo(t)).fill,n=t.align,l=t.sign,d=t.symbol,h=t.zero,p=t.width,_=t.comma,m=t.precision,b=t.trim,y=t.type;"n"===y?(_=!0,y="g"):Co[y]||(void 0===m&&(m=12),b=!0,y="g"),(h||"0"===e&&"="===n)&&(h=!0,e="0",n="=");var g="$"===d?i:"#"===d&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",v="$"===d?o:/[%p]/.test(y)?u:"",w=Co[y],x=/[defgprs%]/.test(y);function A(t){var i,o,u,d=g,A=v;if("c"===y)A=w(t)+A,t="";else{var S=(t=+t)<0||1/t<0;if(t=isNaN(t)?f:w(Math.abs(t),m),b&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),S&&0==+t&&"+"!==l&&(S=!1),d=(S?"("===l?l:c:"-"===l||"("===l?"":l)+d,A=("s"===y?$o[8+jo/3]:"")+A+(S&&"("===l?")":""),x)for(i=-1,o=t.length;++i<o;)if(48>(u=t.charCodeAt(i))||u>57){A=(46===u?a+t.slice(i+1):t.slice(i))+A,t=t.slice(0,i);break}}_&&!h&&(t=r(t,1/0));var I=d.length+t.length+A.length,O=I<p?new Array(p-I+1).join(e):"";switch(_&&h&&(t=r(O+t,O.length?p-A.length:1/0),O=""),n){case"<":t=d+t+A+O;break;case"=":t=d+O+t+A;break;case"^":t=O.slice(0,I=O.length>>1)+d+t+A+O.slice(I);break;default:t=O+d+t+A}return s(t)}return m=void 0===m?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),A.toString=function(){return t+""},A}return{format:l,formatPrefix:function(t,e){var n=l(((t=zo(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(Bo(e)/3))),i=Math.pow(10,-r),o=$o[8+r/3];return function(t){return n(i*t)+o}}}}function Wo(t,e,n,r){var i,o=function(t,e,n){n=+n;const r=(e=+e)<(t=+t),i=r?Bt(e,t,n):Bt(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}(t,e,n);switch((r=zo(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(i=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Bo(e)/3)))-Bo(Math.abs(t)))}(o,a))||(r.precision=i),Po(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Bo(e)-Bo(t))+1}(o,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(t){return Math.max(0,-Bo(Math.abs(t)))}(o))||(r.precision=i-2*("%"===r.type))}return Uo(r)}function Go(t){var e=t.domain;return t.ticks=function(t){var n=e();return Et(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return Wo(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,i,o=e(),a=0,s=o.length-1,u=o[a],c=o[s],f=10;for(c<u&&(i=u,u=c,c=i,i=a,a=s,s=i);f-- >0;){if((i=Bt(u,c,n))===r)return o[a]=u,o[s]=c,e(o);if(i>0)u=Math.floor(u/i)*i,c=Math.ceil(c/i)*i;else{if(!(i<0))break;u=Math.ceil(u*i)/i,c=Math.floor(c*i)/i}r=i}return t},t}function qo(){var t=Mo()(So,So);return t.copy=function(){return ko(t,qo())},yo.apply(t,arguments),Go(t)}function Ho(t){return Math.log(t)}function Xo(t){return Math.exp(t)}function Zo(t){return-Math.log(-t)}function Jo(t){return-Math.exp(-t)}function Ko(t){return isFinite(t)?+("1e"+t):t<0?0:t}function Qo(t){return(e,n)=>-t(-e,n)}function ta(t){const e=t(Ho,Xo),n=e.domain;let r,i,o=10;function a(){return r=function(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),e=>Math.log(e)/t)}(o),i=function(t){return 10===t?Ko:t===Math.E?Math.exp:e=>Math.pow(t,e)}(o),n()[0]<0?(r=Qo(r),i=Qo(i),t(Zo,Jo)):t(Ho,Xo),e}return e.base=function(t){return arguments.length?(o=+t,a()):o},e.domain=function(t){return arguments.length?(n(t),a()):n()},e.ticks=t=>{const e=n();let a=e[0],s=e[e.length-1];const u=s<a;u&&([a,s]=[s,a]);let c,f,l=r(a),d=r(s);const h=null==t?10:+t;let p=[];if(!(o%1)&&d-l<h){if(l=Math.floor(l),d=Math.ceil(d),a>0){for(;l<=d;++l)for(c=1;c<o;++c)if(f=l<0?c/i(-l):c*i(l),!(f<a)){if(f>s)break;p.push(f)}}else for(;l<=d;++l)for(c=o-1;c>=1;--c)if(f=l>0?c/i(-l):c*i(l),!(f<a)){if(f>s)break;p.push(f)}2*p.length<h&&(p=Et(a,s,h))}else p=Et(l,d,Math.min(d-l,h)).map(i);return u?p.reverse():p},e.tickFormat=(t,n)=>{if(null==t&&(t=10),null==n&&(n=10===o?"s":","),"function"!=typeof n&&(o%1||null!=(n=zo(n)).precision||(n.trim=!0),n=Uo(n)),t===1/0)return n;const a=Math.max(1,o*t/e.ticks().length);return t=>{let e=t/i(Math.round(r(t)));return e*o<o-.5&&(e*=o),e<=a?n(t):""}},e.nice=()=>n(function(t,e){var n,r=0,i=(t=t.slice()).length-1,o=t[r],a=t[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),t[r]=e.floor(o),t[i]=e.ceil(a),t}(n(),{floor:t=>i(Math.floor(r(t))),ceil:t=>i(Math.ceil(r(t)))})),e}function ea(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function na(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function ra(t){return t<0?-t*t:t*t}function ia(t){var e=t(So,So),n=1;return e.exponent=function(e){return arguments.length?1===(n=+e)?t(So,So):.5===n?t(na,ra):t(ea(n),ea(1/n)):n},Go(e)}function oa(){var t=ia(Mo());return t.copy=function(){return ko(t,oa()).exponent(t.exponent())},yo.apply(t,arguments),t}function aa(){var t,e,n,r,i,o=0,a=1,s=So,u=!1;function c(e){return null==e||isNaN(e=+e)?i:s(0===n?.5:(e=(r(e)-t)*n,u?Math.max(0,Math.min(1,e)):e))}function f(t){return function(e){var n,r;return arguments.length?([n,r]=e,s=t(n,r),c):[s(0),s(1)]}}return c.domain=function(i){return arguments.length?([o,a]=i,t=r(o=+o),e=r(a=+a),n=t===e?0:1/(e-t),c):[o,a]},c.clamp=function(t){return arguments.length?(u=!!t,c):u},c.interpolator=function(t){return arguments.length?(s=t,c):s},c.range=f(ui),c.rangeRound=f(ci),c.unknown=function(t){return arguments.length?(i=t,c):i},function(i){return r=i,t=i(o),e=i(a),n=t===e?0:1/(e-t),c}}function sa(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function ua(){var t=Go(aa()(So));return t.copy=function(){return sa(t,ua())},go.apply(t,arguments)}function ca(){var t=ta(aa()).domain([1,10]);return t.copy=function(){return sa(t,ca()).base(t.base())},go.apply(t,arguments)}function fa(){var t=ia(aa());return t.copy=function(){return sa(t,fa()).exponent(t.exponent())},go.apply(t,arguments)}Ro=Yo({thousands:",",grouping:[3],currency:["$",""]}),Uo=Ro.format,Po=Ro.formatPrefix;class la{constructor(t,e,n){this.prefs=e,this.svg_element_selection=dt(t),this.width=+this.svg_element_selection.attr("width"),this.height=+this.svg_element_selection.attr("height"),this.renderers=new Map,this.scatterplot=n,this.renderers=new Map}attach_tiles(t){return this.tileSet=t,this.tileSet._zoom=this,this}attach_renderer(t,e){return this.renderers.set(t,e),e.bind_zoom(this),e.zoom.initialize_zoom(),this}zoom_to(t,e,n,r=4e3){const i=this.scales(),{svg_element_selection:o,zoomer:a,width:s,height:u}=this,c=uo.translate(s/2,u/2).scale(t).translate(-i.x(e),-i.y(n));o.transition().duration(r).call(a.transform,c)}html_annotation(t){const e=this.svg_element_selection.node().parentNode.parentNode;let n=.75;void 0!==this.scatterplot.prefs.tooltip_opacity&&(n=this.scatterplot.prefs.tooltip_opacity);dt(e).selectAll("div.tooltip").data(t).join((t=>t.append("div").attr("class","tooltip").style("top",0).style("left",0).style("position","absolute").style("z-index",100).style("border-radius","8px").style("padding","10px").style("background","ivory").style("opacity",n)),(t=>t.html((t=>this.scatterplot.tooltip_html(t.data)))),(t=>t.call((t=>t.remove())))).html((t=>this.scatterplot.tooltip_html(t.data,this))).style("transform",(t=>`translate(${+t.x+t.dx}px, ${+t.y+t.dy}px)`))}zoom_to_bbox(t,e=4e3,n=1.111){const r=this.scales();let[i,o]=t.x.map(r.x);const[a,s]=t.y.map(r.y);if("right"===this.scatterplot.prefs.zoom_align){const t=this.width/this.height,e=(o-i)/(s-a);if(e<t){const n=e/t;console.log(n,{x0:i}),i-=(o-i)*n}}const{svg_element_selection:u,zoomer:c,width:f,height:l}=this,d=uo.translate(f/2,l/2).scale(1/n/Math.max((o-i)/f,(s-a)/l)).translate(-(i+o)/2,-(a+s)/2);u.transition().duration(e).call(c.transform,d)}initialize_zoom(){const{width:t,height:e,svg_element_selection:n}=this;this.transform=uo;const r=function(){var t,e,n,r=lo,i=ho,o=bo,a=_o,s=mo,u=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],f=250,l=yi,d=Ln("start","zoom","end"),h=500,p=150,_=0,m=10;function b(t){t.property("__zoom",po).on("wheel.zoom",S,{passive:!1}).on("mousedown.zoom",I).on("dblclick.zoom",O).filter(s).on("touchstart.zoom",T).on("touchmove.zoom",k).on("touchend.zoom touchcancel.zoom",M).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(t,e){return(e=Math.max(u[0],Math.min(u[1],e)))===t.k?t:new so(e,t.x,t.y)}function g(t,e,n){var r=e[0]-n[0]*t.k,i=e[1]-n[1]*t.k;return r===t.x&&i===t.y?t:new so(t.k,r,i)}function v(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function w(t,e,n,r){t.on("start.zoom",(function(){x(this,arguments).event(r).start()})).on("interrupt.zoom end.zoom",(function(){x(this,arguments).event(r).end()})).tween("zoom",(function(){var t=this,o=arguments,a=x(t,o).event(r),s=i.apply(t,o),u=null==n?v(s):"function"==typeof n?n.apply(t,o):n,c=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),f=t.__zoom,d="function"==typeof e?e.apply(t,o):e,h=l(f.invert(u).concat(c/f.k),d.invert(u).concat(c/d.k));return function(t){if(1===t)t=d;else{var e=h(t),n=c/e[2];t=new so(n,u[0]-e[0]*n,u[1]-e[1]*n)}a.zoom(null,t)}}))}function x(t,e,n){return!n&&t.__zooming||new A(t,e)}function A(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=i.apply(t,e),this.taps=0}function S(t,...e){if(r.apply(this,arguments)){var n=x(this,e).event(t),i=this.__zoom,s=Math.max(u[0],Math.min(u[1],i.k*Math.pow(2,a.apply(this,arguments)))),f=ht(t);if(n.wheel)n.mouse[0][0]===f[0]&&n.mouse[0][1]===f[1]||(n.mouse[1]=i.invert(n.mouse[0]=f)),clearTimeout(n.wheel);else{if(i.k===s)return;n.mouse=[f,i.invert(f)],zi(this),n.start()}fo(t),n.wheel=setTimeout((function(){n.wheel=null,n.end()}),p),n.zoom("mouse",o(g(y(i,s),n.mouse[0],n.mouse[1]),n.extent,c))}}function I(t,...e){if(!n&&r.apply(this,arguments)){var i=t.currentTarget,a=x(this,e,!0).event(t),s=dt(t.view).on("mousemove.zoom",(function(t){if(fo(t),!a.moved){var e=t.clientX-f,n=t.clientY-l;a.moved=e*e+n*n>_}a.event(t).zoom("mouse",o(g(a.that.__zoom,a.mouse[0]=ht(t,i),a.mouse[1]),a.extent,c))}),!0).on("mouseup.zoom",(function(t){s.on("mousemove.zoom mouseup.zoom",null),qn(t.view,a.moved),fo(t),a.event(t).end()}),!0),u=ht(t,i),f=t.clientX,l=t.clientY;Gn(t.view),co(t),a.mouse=[u,this.__zoom.invert(u)],zi(this),a.start()}}function O(t,...e){if(r.apply(this,arguments)){var n=this.__zoom,a=ht(t.changedTouches?t.changedTouches[0]:t,this),s=n.invert(a),u=n.k*(t.shiftKey?.5:2),l=o(g(y(n,u),a,s),i.apply(this,e),c);fo(t),f>0?dt(this).transition().duration(f).call(w,l,a,t):dt(this).call(b.transform,l,a,t)}}function T(n,...i){if(r.apply(this,arguments)){var o,a,s,u,c=n.touches,f=c.length,l=x(this,i,n.changedTouches.length===f).event(n);for(co(n),a=0;a<f;++a)u=[u=ht(s=c[a],this),this.__zoom.invert(u),s.identifier],l.touch0?l.touch1||l.touch0[2]===u[2]||(l.touch1=u,l.taps=0):(l.touch0=u,o=!0,l.taps=1+!!t);t&&(t=clearTimeout(t)),o&&(l.taps<2&&(e=u[0],t=setTimeout((function(){t=null}),h)),zi(this),l.start())}}function k(t,...e){if(this.__zooming){var n,r,i,a,s=x(this,e).event(t),u=t.changedTouches,f=u.length;for(fo(t),n=0;n<f;++n)i=ht(r=u[n],this),s.touch0&&s.touch0[2]===r.identifier?s.touch0[0]=i:s.touch1&&s.touch1[2]===r.identifier&&(s.touch1[0]=i);if(r=s.that.__zoom,s.touch1){var l=s.touch0[0],d=s.touch0[1],h=s.touch1[0],p=s.touch1[1],_=(_=h[0]-l[0])*_+(_=h[1]-l[1])*_,m=(m=p[0]-d[0])*m+(m=p[1]-d[1])*m;r=y(r,Math.sqrt(_/m)),i=[(l[0]+h[0])/2,(l[1]+h[1])/2],a=[(d[0]+p[0])/2,(d[1]+p[1])/2]}else{if(!s.touch0)return;i=s.touch0[0],a=s.touch0[1]}s.zoom("touch",o(g(r,i,a),s.extent,c))}}function M(t,...r){if(this.__zooming){var i,o,a=x(this,r).event(t),s=t.changedTouches,u=s.length;for(co(t),n&&clearTimeout(n),n=setTimeout((function(){n=null}),h),i=0;i<u;++i)o=s[i],a.touch0&&a.touch0[2]===o.identifier?delete a.touch0:a.touch1&&a.touch1[2]===o.identifier&&delete a.touch1;if(a.touch1&&!a.touch0&&(a.touch0=a.touch1,delete a.touch1),a.touch0)a.touch0[1]=this.__zoom.invert(a.touch0[0]);else if(a.end(),2===a.taps&&(o=ht(o,this),Math.hypot(e[0]-o[0],e[1]-o[1])<m)){var c=dt(this).on("dblclick.zoom");c&&c.apply(this,arguments)}}}return b.transform=function(t,e,n,r){var i=t.selection?t.selection():t;i.property("__zoom",po),t!==i?w(t,e,n,r):i.interrupt().each((function(){x(this,arguments).event(r).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},b.scaleBy=function(t,e,n,r){b.scaleTo(t,(function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)}),n,r)},b.scaleTo=function(t,e,n,r){b.transform(t,(function(){var t=i.apply(this,arguments),r=this.__zoom,a=null==n?v(t):"function"==typeof n?n.apply(this,arguments):n,s=r.invert(a),u="function"==typeof e?e.apply(this,arguments):e;return o(g(y(r,u),a,s),t,c)}),n,r)},b.translateBy=function(t,e,n,r){b.transform(t,(function(){return o(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),i.apply(this,arguments),c)}),null,r)},b.translateTo=function(t,e,n,r,a){b.transform(t,(function(){var t=i.apply(this,arguments),a=this.__zoom,s=null==r?v(t):"function"==typeof r?r.apply(this,arguments):r;return o(uo.translate(s[0],s[1]).scale(a.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,c)}),r,a)},A.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=dt(this.that).datum();d.call(t,this.that,new ao(t,{sourceEvent:this.sourceEvent,target:b,type:t,transform:this.that.__zoom,dispatch:d}),e)}},b.wheelDelta=function(t){return arguments.length?(a="function"==typeof t?t:oo(+t),b):a},b.filter=function(t){return arguments.length?(r="function"==typeof t?t:oo(!!t),b):r},b.touchable=function(t){return arguments.length?(s="function"==typeof t?t:oo(!!t),b):s},b.extent=function(t){return arguments.length?(i="function"==typeof t?t:oo([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),b):i},b.scaleExtent=function(t){return arguments.length?(u[0]=+t[0],u[1]=+t[1],b):[u[0],u[1]]},b.translateExtent=function(t){return arguments.length?(c[0][0]=+t[0][0],c[1][0]=+t[1][0],c[0][1]=+t[0][1],c[1][1]=+t[1][1],b):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},b.constrain=function(t){return arguments.length?(o=t,b):o},b.duration=function(t){return arguments.length?(f=+t,b):f},b.interpolate=function(t){return arguments.length?(l=t,b):l},b.on=function(){var t=d.on.apply(d,arguments);return t===d?b:t},b.clickDistance=function(t){return arguments.length?(_=(t=+t)*t,b):Math.sqrt(_)},b.tapDistance=function(t){return arguments.length?(m=+t,b):m},b}().scaleExtent([1/3,1e5]).extent([[0,0],[t,e]]).on("zoom",(t=>{var e,n,r;try{document.getElementById("tooltipcircle").remove()}catch(i){}this.transform=t.transform,this.restart_timer(1e4),null==(n=(e=this.scatterplot).on_zoom)||n.call(e,t.transform),null==(r=null==t?void 0:t.sourceEvent)||r.stopPropagation()}));n.call(r),this.add_mouseover(),this.zoomer=r}set_highlit_points(t){const{x_:e,y_:n}=this.scales(),r=this.scatterplot.dim("x"),i=this.scatterplot.dim("y"),o=t.map((t=>({x:e(r.apply(t)),y:n(i.apply(t)),data:t,dx:0,dy:30})));this.html_annotation(o);this.svg_element_selection.select("#mousepoints").selectAll("circle.label").data(t,(t=>t.ix)).join((t=>t.append("circle").attr("id","tooltipcircle").attr("class","label").attr("stroke","#110022").attr("r",12).attr("fill",(t=>this.scatterplot.dim("color").apply(t))).attr("cx",(t=>e(r.apply(t)))).attr("cy",(t=>n(i.apply(t))))),(t=>t.attr("fill",(t=>this.scatterplot.dim("color").apply(t)))),(t=>t.call((t=>{t.remove()})))).on("click",((t,e)=>{this.scatterplot.click_function(e,this.scatterplot)}))}set_highlit_point(t){this.set_highlit_points([t])}add_mouseover(){let t=0;const e=this.renderers.get("regl");this.svg_element_selection.on("mousemove",(n=>{if(Date.now()-t<75)return;t=Date.now();const r=e.color_pick(n.offsetX,n.offsetY);null===r?this.set_highlit_points([]):this.set_highlit_points([r])}))}current_corners(){const{width:t,height:e}=this,n=this.scales();if(void 0===n)return;const{x_:r,y_:i}=n;return{x:[r.invert(0),r.invert(t)],y:[i.invert(0),i.invert(e)]}}current_center(){const{x:t,y:e}=this.current_corners();return[(t[0]+t[1])/2,(e[0]+e[1])/2]}restart_timer(t=1e4){let e=Date.now()+t;this._timer&&(this._timer.stop_at>e&&(e=this._timer.stop_at),this._timer.stop());const n=jn(this.tick.bind(this));return this._timer=n,this._timer.stop_at=e,this._timer}data(t){return void 0===t?this.tileSet:(this.tileSet=t,this)}scales(t=!0){if(this._scales)return this._scales.x_=this.transform.rescaleX(this._scales.x),this._scales.y_=this.transform.rescaleY(this._scales.y),this._scales;const{width:e,height:n}=this;if(void 0===this.tileSet)throw new Error("Error--scales created before tileSet present.");const{extent:r}=this.tileSet,i={};if(void 0===r)throw new Error("Error--scales created before extent present.");const o={};for(const[l,d]of[["x",e],["y",n]]){const t=r[l],e=t[1]-t[0];o[l]={limits:t,size_range:e,pixels_per_unit:d/e}}const a=o.x.pixels_per_unit/o.y.pixels_per_unit;let s=0,u=0,c=e,f=n;return a>1?(c=e/a,s=(e-c)/2):(f=n*a,u=(n-f)/2),i.x=qo().domain(o.x.limits).range([s,e-s]),i.y=qo().domain(o.y.limits).range([u,n-u]),i.x_=this.transform.rescaleX(i.x),i.y_=this.transform.rescaleY(i.y),this._scales=i,i}webgl_scale(t=!0){const{x:e,y:n}=this.scales();return function(t,e){function n(t){return t[1]-t[0]}const r=zt(t.domain()),i=zt(e.domain()),o=n(t.range())/n(t.domain()),a=n(e.range())/n(e.domain());return[[o,0,-o*r+zt(t.range())],[0,a,-a*i+zt(e.range())],[0,0,1]]}(e,n).flat()}tick(t=!1){this._start=this._start||Date.now(),!0!==t&&this._timer&&this._timer.stop_at<=Date.now()&&this._timer.stop()}}var da={};({get exports(){return da},set exports(t){da=t}}).exports=function(){var t=function(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint8ClampedArray},e=function(t,e){for(var n=Object.keys(e),r=0;r<n.length;++r)t[n[r]]=e[n[r]];return t},n="\n";function r(t){return"undefined"!=typeof atob?atob(t):"base64:"+t}function i(t){var e=new Error("(regl) "+t);throw console.error(e),e}function o(t,e){t||i(e)}function a(t){return t?": "+t:""}function s(t,e,n){t in e||i("unknown parameter ("+t+")"+a(n)+". possible values: "+Object.keys(e).join())}function u(e,n){t(e)||i("invalid parameter type"+a(n)+". must be a typed array")}function c(t,e){switch(e){case"number":return"number"==typeof t;case"object":return"object"==typeof t;case"string":return"string"==typeof t;case"boolean":return"boolean"==typeof t;case"function":return"function"==typeof t;case"undefined":return void 0===t;case"symbol":return"symbol"==typeof t}}function f(t,e,n){c(t,e)||i("invalid parameter type"+a(n)+". expected "+e+", got "+typeof t)}function l(t,e){t>=0&&(0|t)===t||i("invalid parameter type, ("+t+")"+a(e)+". must be a nonnegative integer")}function d(t,e,n){e.indexOf(t)<0&&i("invalid value"+a(n)+". must be one of: "+e)}var h=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function p(t){Object.keys(t).forEach((function(t){h.indexOf(t)<0&&i('invalid regl constructor argument "'+t+'". must be one of '+h)}))}function _(t,e){for(t+="";t.length<e;)t=" "+t;return t}function m(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function b(t,e){this.number=t,this.line=e,this.errors=[]}function y(t,e,n){this.file=t,this.line=e,this.message=n}function g(){var t=new Error,e=(t.stack||t).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(e);return r?r[1]:"unknown"}function v(){var t=new Error,e=(t.stack||t).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(e);return r?r[1]:"unknown"}function w(t,e){var n=t.split("\n"),i=1,o=0,a={unknown:new m,0:new m};a.unknown.name=a[0].name=e||g(),a.unknown.lines.push(new b(0,""));for(var s=0;s<n.length;++s){var u=n[s],c=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(c)switch(c[1]){case"line":var f=/(\d+)(\s+\d+)?/.exec(c[2]);f&&(i=0|f[1],f[2]&&((o=0|f[2])in a||(a[o]=new m)));break;case"define":var l=/SHADER_NAME(_B64)?\s+(.*)$/.exec(c[2]);l&&(a[o].name=l[1]?r(l[2]):l[2])}a[o].lines.push(new b(i++,u))}return Object.keys(a).forEach((function(t){var e=a[t];e.lines.forEach((function(t){e.index[t.number]=t}))})),a}function x(t){var e=[];return t.split("\n").forEach((function(t){if(!(t.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(t);n?e.push(new y(0|n[1],0|n[2],n[3].trim())):t.length>0&&e.push(new y("unknown",0,t))}})),e}function A(t,e){e.forEach((function(e){var n=t[e.file];if(n){var r=n.index[e.line];if(r)return r.errors.push(e),void(n.hasErrors=!0)}t.unknown.hasErrors=!0,t.unknown.lines[0].errors.push(e)}))}function S(t,e,r,i,a){if(!t.getShaderParameter(e,t.COMPILE_STATUS)){var s=t.getShaderInfoLog(e),u=i===t.FRAGMENT_SHADER?"fragment":"vertex";B(r,"string",u+" shader source must be a string",a);var c=w(r,a),f=x(s);A(c,f),Object.keys(c).forEach((function(t){var e=c[t];if(e.hasErrors){var r=[""],i=[""];o("file number "+t+": "+e.name+"\n","color:red;text-decoration:underline;font-weight:bold"),e.lines.forEach((function(t){if(t.errors.length>0){o(_(t.number,4)+"|  ","background-color:yellow; font-weight:bold"),o(t.line+n,"color:red; background-color:yellow; font-weight:bold");var e=0;t.errors.forEach((function(r){var i=r.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(a){var s=a[1];i=a[2],"assign"===s&&(s="="),e=Math.max(t.line.indexOf(s,e),0)}else e=0;o(_("| ",6)),o(_("^^^",e+3)+n,"font-weight:bold"),o(_("| ",6)),o(i+n,"font-weight:bold")})),o(_("| ",6)+n)}else o(_(t.number,4)+"|  "),o(t.line+n,"color:red")})),"undefined"==typeof document||window.chrome?console.log(r.join("")):(i[0]=r.join("%c"),console.log.apply(console,i))}function o(t,e){r.push(t),i.push(e||"")}})),o.raise("Error compiling "+u+" shader, "+c[0].name)}}function I(t,e,r,i,a){if(!t.getProgramParameter(e,t.LINK_STATUS)){var s=t.getProgramInfoLog(e),u=w(r,a),c='Error linking program with vertex shader, "'+w(i,a)[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+c+n+"%c"+s,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(c+n+s),o.raise(c)}}function O(t){t._commandRef=g()}function T(t,e,n,r){function i(t){return t?r.id(t):0}function o(t,e){Object.keys(e).forEach((function(e){t[r.id(e)]=!0}))}O(t),t._fragId=i(t.static.frag),t._vertId=i(t.static.vert);var a=t._uniformSet={};o(a,e.static),o(a,e.dynamic);var s=t._attributeSet={};o(s,n.static),o(s,n.dynamic),t._hasCount="count"in t.static||"count"in t.dynamic||"elements"in t.static||"elements"in t.dynamic}function k(t,e){var n=v();i(t+" in command "+(e||g())+("unknown"===n?"":" called from "+n))}function M(t,e,n){t||k(e,n||g())}function E(t,e,n,r){t in e||k("unknown parameter ("+t+")"+a(n)+". possible values: "+Object.keys(e).join(),r||g())}function B(t,e,n,r){c(t,e)||k("invalid parameter type"+a(n)+". expected "+e+", got "+typeof t,r||g())}function j(t){t()}function D(t,e,n){t.texture?d(t.texture._texture.internalformat,e,"unsupported texture format for attachment"):d(t.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")}var z=33071,N=9728,F=9984,C=9985,L=9986,R=9987,U=5121,P=5122,V=5123,$=5124,Y=5125,W=5126,G=32819,q=32820,H=33635,X=34042,Z=36193,J={};function K(t,e){return t===q||t===G||t===H?2:t===X?4:J[t]*e}function Q(t){return!(t&t-1||!t)}function tt(t,e,n){var r,i=e.width,a=e.height,s=e.channels;o(i>0&&i<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),t.wrapS===z&&t.wrapT===z||o(Q(i)&&Q(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===e.mipmask?1!==i&&1!==a&&o(t.minFilter!==F&&t.minFilter!==L&&t.minFilter!==C&&t.minFilter!==R,"min filter requires mipmap"):(o(Q(i)&&Q(a),"texture must be a square power of 2 to support mipmapping"),o(e.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),e.type===W&&(n.extensions.indexOf("oes_texture_float_linear")<0&&o(t.minFilter===N&&t.magFilter===N,"filter not supported, must enable oes_texture_float_linear"),o(!t.genMipmaps,"mipmap generation not supported with float textures"));var u=e.images;for(r=0;r<16;++r)if(u[r]){var c=i>>r,f=a>>r;o(e.mipmask&1<<r,"missing mipmap data");var l=u[r];if(o(l.width===c&&l.height===f,"invalid shape for mip images"),o(l.format===e.format&&l.internalformat===e.internalformat&&l.type===e.type,"incompatible type for mip image"),l.compressed);else if(l.data){var d=Math.ceil(K(l.type,s)*c/l.unpackAlignment)*l.unpackAlignment;o(l.data.byteLength===d*f,"invalid data for image, buffer size is inconsistent with image format")}else l.element||l.copy}else t.genMipmaps||o(0==(e.mipmask&1<<r),"extra mipmap data");e.compressed&&o(!t.genMipmaps,"mipmap generation for compressed images not supported")}function et(t,e,n,r){var i=t.width,a=t.height,s=t.channels;o(i>0&&i<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),o(i===a,"cube map must be square"),o(e.wrapS===z&&e.wrapT===z,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var c=n[u];o(c.width===i&&c.height===a,"inconsistent cube map face shape"),e.genMipmaps&&(o(!c.compressed,"can not generate mipmap for compressed textures"),o(1===c.mipmask,"can not specify mipmaps and generate mipmaps"));for(var f=c.images,l=0;l<16;++l){var d=f[l];if(d){var h=i>>l,p=a>>l;o(c.mipmask&1<<l,"missing mipmap data"),o(d.width===h&&d.height===p,"invalid shape for mip images"),o(d.format===t.format&&d.internalformat===t.internalformat&&d.type===t.type,"incompatible type for mip image"),d.compressed||(d.data?o(d.data.byteLength===h*p*Math.max(K(d.type,s),d.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):d.element||d.copy)}}}}J[5120]=J[U]=1,J[P]=J[V]=J[Z]=J[H]=J[G]=J[q]=2,J[$]=J[Y]=J[W]=J[X]=4;var nt=e(o,{optional:j,raise:i,commandRaise:k,command:M,parameter:s,commandParameter:E,constructor:p,type:f,commandType:B,isTypedArray:u,nni:l,oneOf:d,shaderError:S,linkError:I,callSite:v,saveCommandRef:O,saveDrawInfo:T,framebufferFormat:D,guessCommand:g,texture2D:tt,textureCube:et}),rt=0,it=0,ot=5,at=6;function st(t,e){this.id=rt++,this.type=t,this.data=e}function ut(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function ct(t){if(0===t.length)return[];var e=t.charAt(0),n=t.charAt(t.length-1);if(t.length>1&&e===n&&('"'===e||"'"===e))return['"'+ut(t.substr(1,t.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(r)return ct(t.substr(0,r.index)).concat(ct(r[1])).concat(ct(t.substr(r.index+r[0].length)));var i=t.split(".");if(1===i.length)return['"'+ut(t)+'"'];for(var o=[],a=0;a<i.length;++a)o=o.concat(ct(i[a]));return o}function ft(t){return"["+ct(t).join("][")+"]"}function lt(t,e){return new st(t,ft(e+""))}function dt(t){return"function"==typeof t&&!t._reglType||t instanceof st}function ht(t,e){return"function"==typeof t?new st(it,t):"number"==typeof t||"boolean"==typeof t?new st(ot,t):Array.isArray(t)?new st(at,t.map((function(t,n){return ht(t,e+"["+n+"]")}))):t instanceof st?t:void nt(!1,"invalid option type in uniform "+e)}var pt={DynamicVariable:st,define:lt,isDynamic:dt,unbox:ht,accessor:ft},_t={next:"function"==typeof requestAnimationFrame?function(t){return requestAnimationFrame(t)}:function(t){return setTimeout(t,16)},cancel:"function"==typeof cancelAnimationFrame?function(t){return cancelAnimationFrame(t)}:clearTimeout},mt="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function bt(){var t={"":0},e=[""];return{id:function(n){var r=t[n];return r||(r=t[n]=e.length,e.push(n),r)},str:function(t){return e[t]}}}function yt(t,n,r){var i,o=document.createElement("canvas");function a(){var e=window.innerWidth,n=window.innerHeight;if(t!==document.body){var i=o.getBoundingClientRect();e=i.right-i.left,n=i.bottom-i.top}o.width=r*e,o.height=r*n}function s(){i?i.disconnect():window.removeEventListener("resize",a),t.removeChild(o)}return e(o.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),t.appendChild(o),t===document.body&&(o.style.position="absolute",e(t.style,{margin:0,padding:0})),t!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(t):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:s}}function gt(t,e){function n(n){try{return t.getContext(n,e)}catch(r){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}function vt(t){return"string"==typeof t.nodeName&&"function"==typeof t.appendChild&&"function"==typeof t.getBoundingClientRect}function wt(t){return"function"==typeof t.drawArrays||"function"==typeof t.drawElements}function xt(t){return"string"==typeof t?t.split():(nt(Array.isArray(t),"invalid extension array"),t)}function At(t){return"string"==typeof t?(nt("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(t)):t}function St(t){var e,n,r,i,o=t||{},a={},s=[],u=[],c="undefined"==typeof window?1:window.devicePixelRatio,f=!1,l=function(t){t&&nt.raise(t)},d=function(){};if("string"==typeof o?(nt("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),e=document.querySelector(o),nt(e,"invalid query string for element")):"object"==typeof o?vt(o)?e=o:wt(o)?r=(i=o).canvas:(nt.constructor(o),"gl"in o?i=o.gl:"canvas"in o?r=At(o.canvas):"container"in o&&(n=At(o.container)),"attributes"in o&&(a=o.attributes,nt.type(a,"object","invalid context attributes")),"extensions"in o&&(s=xt(o.extensions)),"optionalExtensions"in o&&(u=xt(o.optionalExtensions)),"onDone"in o&&(nt.type(o.onDone,"function","invalid or missing onDone callback"),l=o.onDone),"profile"in o&&(f=!!o.profile),"pixelRatio"in o&&(c=+o.pixelRatio,nt(c>0,"invalid pixel ratio"))):nt.raise("invalid arguments to regl"),e&&("canvas"===e.nodeName.toLowerCase()?r=e:n=e),!i){if(!r){nt("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var h=yt(n||document.body,l,c);if(!h)return null;r=h.canvas,d=h.onDestroy}void 0===a.premultipliedAlpha&&(a.premultipliedAlpha=!0),i=gt(r,a)}return i?{gl:i,canvas:r,container:n,extensions:s,optionalExtensions:u,pixelRatio:c,profile:f,onDone:l,onDestroy:d}:(d(),l("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function It(t,e){var n={};function r(e){nt.type(e,"string","extension name must be string");var r,i=e.toLowerCase();try{r=n[i]=t.getExtension(i)}catch(o){}return!!r}for(var i=0;i<e.extensions.length;++i){var o=e.extensions[i];if(!r(o))return e.onDestroy(),e.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return e.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(t){if(n[t]&&!r(t))throw new Error("(regl): error restoring extension "+t)}))}}}function Ot(t,e){for(var n=Array(t),r=0;r<t;++r)n[r]=e(r);return n}var Tt=5120,kt=5121,Mt=5122,Et=5123,Bt=5124,jt=5125,Dt=5126;function zt(t){for(var e=16;e<=1<<28;e*=16)if(t<=e)return e;return 0}function Nt(t){var e,n;return e=(t>65535)<<4,e|=n=((t>>>=e)>255)<<3,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1}function Ft(){var t=Ot(8,(function(){return[]}));function e(e){var n=zt(e),r=t[Nt(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(e){t[Nt(e.byteLength)>>2].push(e)}function r(t,n){var r=null;switch(t){case Tt:r=new Int8Array(e(n),0,n);break;case kt:r=new Uint8Array(e(n),0,n);break;case Mt:r=new Int16Array(e(2*n),0,n);break;case Et:r=new Uint16Array(e(2*n),0,n);break;case Bt:r=new Int32Array(e(4*n),0,n);break;case jt:r=new Uint32Array(e(4*n),0,n);break;case Dt:r=new Float32Array(e(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r}function i(t){n(t.buffer)}return{alloc:e,free:n,allocType:r,freeType:i}}var Ct=Ft();Ct.zero=Ft();var Lt=3408,Rt=3410,Ut=3411,Pt=3412,Vt=3413,$t=3414,Yt=3415,Wt=33901,Gt=33902,qt=3379,Ht=3386,Xt=34921,Zt=36347,Jt=36348,Kt=35661,Qt=35660,te=34930,ee=36349,ne=34076,re=34024,ie=7936,oe=7937,ae=7938,se=35724,ue=34047,ce=36063,fe=34852,le=3553,de=34067,he=34069,pe=33984,_e=6408,me=5126,be=5121,ye=36160,ge=36053,ve=36064,we=16384,xe=function(t,e){var n=1;e.ext_texture_filter_anisotropic&&(n=t.getParameter(ue));var r=1,i=1;e.webgl_draw_buffers&&(r=t.getParameter(fe),i=t.getParameter(ce));var o=!!e.oes_texture_float;if(o){var a=t.createTexture();t.bindTexture(le,a),t.texImage2D(le,0,_e,1,1,0,_e,me,null);var s=t.createFramebuffer();if(t.bindFramebuffer(ye,s),t.framebufferTexture2D(ye,ve,le,a,0),t.bindTexture(le,null),t.checkFramebufferStatus(ye)!==ge)o=!1;else{t.viewport(0,0,1,1),t.clearColor(1,0,0,1),t.clear(we);var u=Ct.allocType(me,4);t.readPixels(0,0,1,1,_e,me,u),t.getError()?o=!1:(t.deleteFramebuffer(s),t.deleteTexture(a),o=1===u[0]),Ct.freeType(u)}}var c=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var f=t.createTexture(),l=Ct.allocType(be,36);t.activeTexture(pe),t.bindTexture(de,f),t.texImage2D(he,0,_e,3,3,0,_e,be,l),Ct.freeType(l),t.bindTexture(de,null),t.deleteTexture(f),c=!t.getError()}return{colorBits:[t.getParameter(Rt),t.getParameter(Ut),t.getParameter(Pt),t.getParameter(Vt)],depthBits:t.getParameter($t),stencilBits:t.getParameter(Yt),subpixelBits:t.getParameter(Lt),extensions:Object.keys(e).filter((function(t){return!!e[t]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:t.getParameter(Wt),lineWidthDims:t.getParameter(Gt),maxViewportDims:t.getParameter(Ht),maxCombinedTextureUnits:t.getParameter(Kt),maxCubeMapSize:t.getParameter(ne),maxRenderbufferSize:t.getParameter(re),maxTextureUnits:t.getParameter(te),maxTextureSize:t.getParameter(qt),maxAttributes:t.getParameter(Xt),maxVertexUniforms:t.getParameter(Zt),maxVertexTextureUnits:t.getParameter(Qt),maxVaryingVectors:t.getParameter(Jt),maxFragmentUniforms:t.getParameter(ee),glsl:t.getParameter(se),renderer:t.getParameter(oe),vendor:t.getParameter(ie),version:t.getParameter(ae),readFloat:o,npotTextureCube:c}};function Ae(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||t(e.data))}var Se=function(t){return Object.keys(t).map((function(e){return t[e]}))},Ie={shape:Be,flatten:Ee};function Oe(t,e,n){for(var r=0;r<e;++r)n[r]=t[r]}function Te(t,e,n,r){for(var i=0,o=0;o<e;++o)for(var a=t[o],s=0;s<n;++s)r[i++]=a[s]}function ke(t,e,n,r,i,o){for(var a=o,s=0;s<e;++s)for(var u=t[s],c=0;c<n;++c)for(var f=u[c],l=0;l<r;++l)i[a++]=f[l]}function Me(t,e,n,r,i){for(var o=1,a=n+1;a<e.length;++a)o*=e[a];var s=e[n];if(e.length-n==4){var u=e[n+1],c=e[n+2],f=e[n+3];for(a=0;a<s;++a)ke(t[a],u,c,f,r,i),i+=o}else for(a=0;a<s;++a)Me(t[a],e,n+1,r,i),i+=o}function Ee(t,e,n,r){var i=1;if(e.length)for(var o=0;o<e.length;++o)i*=e[o];else i=0;var a=r||Ct.allocType(n,i);switch(e.length){case 0:break;case 1:Oe(t,e[0],a);break;case 2:Te(t,e[0],e[1],a);break;case 3:ke(t,e[0],e[1],e[2],a,0);break;default:Me(t,e,0,a,0)}return a}function Be(t){for(var e=[],n=t;n.length;n=n[0])e.push(n.length);return e}var je={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},De={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},ze={dynamic:35048,stream:35040,static:35044},Ne=Ie.flatten,Fe=Ie.shape,Ce=35044,Le=35040,Re=5121,Ue=5126,Pe=[];function Ve(t){return 0|je[Object.prototype.toString.call(t)]}function $e(t,e){for(var n=0;n<e.length;++n)t[n]=e[n]}function Ye(t,e,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var c=0;c<r;++c)t[s++]=e[i*u+o*c+a]}function We(e,n,r,i){var o=0,a={};function s(t){this.id=o++,this.buffer=e.createBuffer(),this.type=t,this.usage=Ce,this.byteLength=0,this.dimension=1,this.dtype=Re,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){h(this)};var u=[];function c(t,e){var n=u.pop();return n||(n=new s(t)),n.bind(),d(n,e,Le,0,1,!1),n}function f(t){u.push(t)}function l(t,n,r){t.byteLength=n.byteLength,e.bufferData(t.type,n,r)}function d(e,n,r,i,o,a){var s,u;if(e.usage=r,Array.isArray(n)){if(e.dtype=i||Ue,n.length>0)if(Array.isArray(n[0])){s=Fe(n);for(var c=1,f=1;f<s.length;++f)c*=s[f];e.dimension=c,l(e,u=Ne(n,s,e.dtype),r),a?e.persistentData=u:Ct.freeType(u)}else if("number"==typeof n[0]){e.dimension=o;var d=Ct.allocType(e.dtype,n.length);$e(d,n),l(e,d,r),a?e.persistentData=d:Ct.freeType(d)}else t(n[0])?(e.dimension=n[0].length,e.dtype=i||Ve(n[0])||Ue,l(e,u=Ne(n,[n.length,n[0].length],e.dtype),r),a?e.persistentData=u:Ct.freeType(u)):nt.raise("invalid buffer data")}else if(t(n))e.dtype=i||Ve(n),e.dimension=o,l(e,n,r),a&&(e.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(Ae(n)){s=n.shape;var h=n.stride,p=n.offset,_=0,m=0,b=0,y=0;1===s.length?(_=s[0],m=1,b=h[0],y=0):2===s.length?(_=s[0],m=s[1],b=h[0],y=h[1]):nt.raise("invalid shape"),e.dtype=i||Ve(n.data)||Ue,e.dimension=m;var g=Ct.allocType(e.dtype,_*m);Ye(g,n.data,_,m,b,y,p),l(e,g,r),a?e.persistentData=g:Ct.freeType(g)}else n instanceof ArrayBuffer?(e.dtype=Re,e.dimension=o,l(e,n,r),a&&(e.persistentData=new Uint8Array(new Uint8Array(n)))):nt.raise("invalid buffer data")}function h(t){n.bufferCount--,i(t);var r=t.buffer;nt(r,"buffer must not be deleted already"),e.deleteBuffer(r),t.buffer=null,delete a[t.id]}function p(i,o,u,c){n.bufferCount++;var f=new s(o);function l(n){var i=Ce,o=null,a=0,s=0,u=1;return Array.isArray(n)||t(n)||Ae(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(nt.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(nt(null===o||Array.isArray(o)||t(o)||Ae(o),"invalid data for buffer"),o=n.data),"usage"in n&&(nt.parameter(n.usage,ze,"invalid buffer usage"),i=ze[n.usage]),"type"in n&&(nt.parameter(n.type,De,"invalid buffer type"),s=De[n.type]),"dimension"in n&&(nt.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(nt.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),f.bind(),o?d(f,o,i,s,u,c):(a&&e.bufferData(f.type,a,i),f.dtype=s||Re,f.usage=i,f.dimension=u,f.byteLength=a),r.profile&&(f.stats.size=f.byteLength*Pe[f.dtype]),l}function p(t,n){nt(n+t.byteLength<=f.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+t.byteLength+" starting from offset "+n+" to a buffer of size "+f.byteLength),e.bufferSubData(f.type,n,t)}function _(e,n){var r,i=0|(n||0);if(f.bind(),t(e)||e instanceof ArrayBuffer)p(e,i);else if(Array.isArray(e)){if(e.length>0)if("number"==typeof e[0]){var o=Ct.allocType(f.dtype,e.length);$e(o,e),p(o,i),Ct.freeType(o)}else if(Array.isArray(e[0])||t(e[0])){r=Fe(e);var a=Ne(e,r,f.dtype);p(a,i),Ct.freeType(a)}else nt.raise("invalid buffer data")}else if(Ae(e)){r=e.shape;var s=e.stride,u=0,c=0,d=0,h=0;1===r.length?(u=r[0],c=1,d=s[0],h=0):2===r.length?(u=r[0],c=r[1],d=s[0],h=s[1]):nt.raise("invalid shape");var _=Array.isArray(e.data)?f.dtype:Ve(e.data),m=Ct.allocType(_,u*c);Ye(m,e.data,u,c,d,h,e.offset),p(m,i),Ct.freeType(m)}else nt.raise("invalid data for buffer subdata");return l}return a[f.id]=f,u||l(i),l._reglType="buffer",l._buffer=f,l.subdata=_,r.profile&&(l.stats=f.stats),l.destroy=function(){h(f)},l}function _(){Se(a).forEach((function(t){t.buffer=e.createBuffer(),e.bindBuffer(t.type,t.buffer),e.bufferData(t.type,t.persistentData||t.byteLength,t.usage)}))}return r.profile&&(n.getTotalBufferSize=function(){var t=0;return Object.keys(a).forEach((function(e){t+=a[e].stats.size})),t}),{create:p,createStream:c,destroyStream:f,clear:function(){Se(a).forEach(h),u.forEach(h)},getBuffer:function(t){return t&&t._buffer instanceof s?t._buffer:null},restore:_,_initBuffer:d}}Pe[5120]=1,Pe[5122]=2,Pe[5124]=4,Pe[5121]=1,Pe[5123]=2,Pe[5125]=4,Pe[5126]=4;var Ge={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},qe=0,He=1,Xe=4,Ze=5120,Je=5121,Ke=5122,Qe=5123,tn=5124,en=5125,nn=34963,rn=35040,on=35044;function an(e,n,r,i){var o={},a=0,s={uint8:Je,uint16:Qe};function u(t){this.id=a++,o[this.id]=this,this.buffer=t,this.primType=Xe,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=en),u.prototype.bind=function(){this.buffer.bind()};var c=[];function f(t){var e=c.pop();return e||(e=new u(r.create(null,nn,!0,!1)._buffer)),d(e,t,rn,-1,-1,0,0),e}function l(t){c.push(t)}function d(i,o,a,s,u,c,f){var l;if(i.buffer.bind(),o){var d=f;f||t(o)&&(!Ae(o)||t(o.data))||(d=n.oes_element_index_uint?en:Qe),r._initBuffer(i.buffer,o,a,d,3)}else e.bufferData(nn,c,a),i.buffer.dtype=l||Je,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=c;if(l=f,!f){switch(i.buffer.dtype){case Je:case Ze:l=Je;break;case Qe:case Ke:l=Qe;break;case en:case tn:l=en;break;default:nt.raise("unsupported type for element array")}i.buffer.dtype=l}i.type=l,nt(l!==en||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var h=u;h<0&&(h=i.buffer.byteLength,l===Qe?h>>=1:l===en&&(h>>=2)),i.vertCount=h;var p=s;if(s<0){p=Xe;var _=i.buffer.dimension;1===_&&(p=qe),2===_&&(p=He),3===_&&(p=Xe)}i.primType=p}function h(t){i.elementsCount--,nt(null!==t.buffer,"must not double destroy elements"),delete o[t.id],t.buffer.destroy(),t.buffer=null}function p(e,n){var o=r.create(null,nn,!0),a=new u(o._buffer);function c(e){if(e)if("number"==typeof e)o(e),a.primType=Xe,a.vertCount=0|e,a.type=Je;else{var n=null,r=on,i=-1,u=-1,f=0,l=0;Array.isArray(e)||t(e)||Ae(e)?n=e:(nt.type(e,"object","invalid arguments for elements"),"data"in e&&(n=e.data,nt(Array.isArray(n)||t(n)||Ae(n),"invalid data for element buffer")),"usage"in e&&(nt.parameter(e.usage,ze,"invalid element buffer usage"),r=ze[e.usage]),"primitive"in e&&(nt.parameter(e.primitive,Ge,"invalid element buffer primitive"),i=Ge[e.primitive]),"count"in e&&(nt("number"==typeof e.count&&e.count>=0,"invalid vertex count for elements"),u=0|e.count),"type"in e&&(nt.parameter(e.type,s,"invalid buffer type"),l=s[e.type]),"length"in e?f=0|e.length:(f=u,l===Qe||l===Ke?f*=2:l!==en&&l!==tn||(f*=4))),d(a,n,r,i,u,f,l)}else o(),a.primType=Xe,a.vertCount=0,a.type=Je;return c}return i.elementsCount++,c(e),c._reglType="elements",c._elements=a,c.subdata=function(t,e){return o.subdata(t,e),c},c.destroy=function(){h(a)},c}return{create:p,createStream:f,destroyStream:l,getElements:function(t){return"function"==typeof t&&t._elements instanceof u?t._elements:null},clear:function(){Se(o).forEach(h)}}}var sn=new Float32Array(1),un=new Uint32Array(sn.buffer),cn=5123;function fn(t){for(var e=Ct.allocType(cn,t.length),n=0;n<t.length;++n)if(isNaN(t[n]))e[n]=65535;else if(t[n]===1/0)e[n]=31744;else if(t[n]===-1/0)e[n]=64512;else{sn[0]=t[n];var r=un[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)e[n]=i;else if(o<-14){var s=-14-o;e[n]=i+(a+1024>>s)}else e[n]=o>15?i+31744:i+(o+15<<10)+a}return e}function ln(e){return Array.isArray(e)||t(e)}var dn=function(t){return!(t&t-1||!t)},hn=34467,pn=3553,_n=34067,mn=34069,bn=6408,yn=6406,gn=6407,vn=6409,wn=6410,xn=32854,An=32855,Sn=36194,In=32819,On=32820,Tn=33635,kn=34042,Mn=6402,En=34041,Bn=35904,jn=35906,Dn=36193,zn=33776,Nn=33777,Fn=33778,Cn=33779,Ln=35986,Rn=35987,Un=34798,Pn=35840,Vn=35841,$n=35842,Yn=35843,Wn=36196,Gn=5121,qn=5123,Hn=5125,Xn=5126,Zn=10242,Jn=10243,Kn=10497,Qn=33071,tr=33648,er=10240,nr=10241,rr=9728,ir=9729,or=9984,ar=9985,sr=9986,ur=9987,cr=33170,fr=4352,lr=4353,dr=4354,hr=34046,pr=3317,_r=37440,mr=37441,br=37443,yr=37444,gr=33984,vr=[or,sr,ar,ur],wr=[0,vn,wn,gn,bn],xr={};function Ar(t){return"[object "+t+"]"}xr[vn]=xr[yn]=xr[Mn]=1,xr[En]=xr[wn]=2,xr[gn]=xr[Bn]=3,xr[bn]=xr[jn]=4;var Sr=Ar("HTMLCanvasElement"),Ir=Ar("OffscreenCanvas"),Or=Ar("CanvasRenderingContext2D"),Tr=Ar("ImageBitmap"),kr=Ar("HTMLImageElement"),Mr=Ar("HTMLVideoElement"),Er=Object.keys(je).concat([Sr,Ir,Or,Tr,kr,Mr]),Br=[];Br[Gn]=1,Br[Xn]=4,Br[Dn]=2,Br[qn]=2,Br[Hn]=4;var jr=[];function Dr(t){return Array.isArray(t)&&(0===t.length||"number"==typeof t[0])}function zr(t){return!!Array.isArray(t)&&!(0===t.length||!ln(t[0]))}function Nr(t){return Object.prototype.toString.call(t)}function Fr(t){return Nr(t)===Sr}function Cr(t){return Nr(t)===Ir}function Lr(t){return Nr(t)===Or}function Rr(t){return Nr(t)===Tr}function Ur(t){return Nr(t)===kr}function Pr(t){return Nr(t)===Mr}function Vr(t){if(!t)return!1;var e=Nr(t);return Er.indexOf(e)>=0||Dr(t)||zr(t)||Ae(t)}function $r(t){return 0|je[Object.prototype.toString.call(t)]}function Yr(t,e){var n=e.length;switch(t.type){case Gn:case qn:case Hn:case Xn:var r=Ct.allocType(t.type,n);r.set(e),t.data=r;break;case Dn:t.data=fn(e);break;default:nt.raise("unsupported texture type, must specify a typed array")}}function Wr(t,e){return Ct.allocType(t.type===Dn?Xn:t.type,e)}function Gr(t,e){t.type===Dn?(t.data=fn(e),Ct.freeType(e)):t.data=e}function qr(t,e,n,r,i,o){for(var a=t.width,s=t.height,u=t.channels,c=Wr(t,a*s*u),f=0,l=0;l<s;++l)for(var d=0;d<a;++d)for(var h=0;h<u;++h)c[f++]=e[n*d+r*l+i*h+o];Gr(t,c)}function Hr(t,e,n,r,i,o){var a;if(a=void 0!==jr[t]?jr[t]:xr[t]*Br[e],o&&(a*=6),i){for(var s=0,u=n;u>=1;)s+=a*u*u,u/=2;return s}return a*n*r}function Xr(n,r,i,o,a,s,u){var c={"don't care":fr,"dont care":fr,nice:dr,fast:lr},f={repeat:Kn,clamp:Qn,mirror:tr},l={nearest:rr,linear:ir},d=e({mipmap:ur,"nearest mipmap nearest":or,"linear mipmap nearest":ar,"nearest mipmap linear":sr,"linear mipmap linear":ur},l),h={none:0,browser:yr},p={uint8:Gn,rgba4:In,rgb565:Tn,"rgb5 a1":On},_={alpha:yn,luminance:vn,"luminance alpha":wn,rgb:gn,rgba:bn,rgba4:xn,"rgb5 a1":An,rgb565:Sn},m={};r.ext_srgb&&(_.srgb=Bn,_.srgba=jn),r.oes_texture_float&&(p.float32=p.float=Xn),r.oes_texture_half_float&&(p.float16=p["half float"]=Dn),r.webgl_depth_texture&&(e(_,{depth:Mn,"depth stencil":En}),e(p,{uint16:qn,uint32:Hn,"depth stencil":kn})),r.webgl_compressed_texture_s3tc&&e(m,{"rgb s3tc dxt1":zn,"rgba s3tc dxt1":Nn,"rgba s3tc dxt3":Fn,"rgba s3tc dxt5":Cn}),r.webgl_compressed_texture_atc&&e(m,{"rgb atc":Ln,"rgba atc explicit alpha":Rn,"rgba atc interpolated alpha":Un}),r.webgl_compressed_texture_pvrtc&&e(m,{"rgb pvrtc 4bppv1":Pn,"rgb pvrtc 2bppv1":Vn,"rgba pvrtc 4bppv1":$n,"rgba pvrtc 2bppv1":Yn}),r.webgl_compressed_texture_etc1&&(m["rgb etc1"]=Wn);var b=Array.prototype.slice.call(n.getParameter(hn));Object.keys(m).forEach((function(t){var e=m[t];b.indexOf(e)>=0&&(_[t]=e)}));var y=Object.keys(_);i.textureFormats=y;var g=[];Object.keys(_).forEach((function(t){var e=_[t];g[e]=t}));var v=[];Object.keys(p).forEach((function(t){var e=p[t];v[e]=t}));var w=[];Object.keys(l).forEach((function(t){var e=l[t];w[e]=t}));var x=[];Object.keys(d).forEach((function(t){var e=d[t];x[e]=t}));var A=[];Object.keys(f).forEach((function(t){var e=f[t];A[e]=t}));var S=y.reduce((function(t,e){var n=_[e];return n===vn||n===yn||n===vn||n===wn||n===Mn||n===En||r.ext_srgb&&(n===Bn||n===jn)?t[n]=n:n===An||e.indexOf("rgba")>=0?t[n]=bn:t[n]=gn,t}),{});function I(){this.internalformat=bn,this.format=bn,this.type=Gn,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=yr,this.width=0,this.height=0,this.channels=0}function O(t,e){t.internalformat=e.internalformat,t.format=e.format,t.type=e.type,t.compressed=e.compressed,t.premultiplyAlpha=e.premultiplyAlpha,t.flipY=e.flipY,t.unpackAlignment=e.unpackAlignment,t.colorSpace=e.colorSpace,t.width=e.width,t.height=e.height,t.channels=e.channels}function T(t,e){if("object"==typeof e&&e){if("premultiplyAlpha"in e&&(nt.type(e.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),t.premultiplyAlpha=e.premultiplyAlpha),"flipY"in e&&(nt.type(e.flipY,"boolean","invalid texture flip"),t.flipY=e.flipY),"alignment"in e&&(nt.oneOf(e.alignment,[1,2,4,8],"invalid texture unpack alignment"),t.unpackAlignment=e.alignment),"colorSpace"in e&&(nt.parameter(e.colorSpace,h,"invalid colorSpace"),t.colorSpace=h[e.colorSpace]),"type"in e){var n=e.type;nt(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),nt(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),nt(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),nt.parameter(n,p,"invalid texture type"),t.type=p[n]}var o=t.width,a=t.height,s=t.channels,u=!1;"shape"in e?(nt(Array.isArray(e.shape)&&e.shape.length>=2,"shape must be an array"),o=e.shape[0],a=e.shape[1],3===e.shape.length&&(s=e.shape[2],nt(s>0&&s<=4,"invalid number of channels"),u=!0),nt(o>=0&&o<=i.maxTextureSize,"invalid width"),nt(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in e&&(o=a=e.radius,nt(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in e&&(o=e.width,nt(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in e&&(a=e.height,nt(a>=0&&a<=i.maxTextureSize,"invalid height")),"channels"in e&&(s=e.channels,nt(s>0&&s<=4,"invalid number of channels"),u=!0)),t.width=0|o,t.height=0|a,t.channels=0|s;var c=!1;if("format"in e){var f=e.format;nt(r.webgl_depth_texture||!("depth"===f||"depth stencil"===f),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),nt.parameter(f,_,"invalid texture format");var l=t.internalformat=_[f];t.format=S[l],f in p&&("type"in e||(t.type=p[f])),f in m&&(t.compressed=!0),c=!0}!u&&c?t.channels=xr[t.format]:u&&!c?t.channels!==wr[t.format]&&(t.format=t.internalformat=wr[t.channels]):c&&u&&nt(t.channels===xr[t.format],"number of channels inconsistent with specified format")}}function k(t){n.pixelStorei(_r,t.flipY),n.pixelStorei(mr,t.premultiplyAlpha),n.pixelStorei(br,t.colorSpace),n.pixelStorei(pr,t.unpackAlignment)}function M(){I.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function E(e,n){var r=null;if(Vr(n)?r=n:n&&(nt.type(n,"object","invalid pixel data type"),T(e,n),"x"in n&&(e.xOffset=0|n.x),"y"in n&&(e.yOffset=0|n.y),Vr(n.data)&&(r=n.data)),nt(!e.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){nt(!r,"can not specify copy and data field for the same texture");var o=a.viewportWidth,s=a.viewportHeight;e.width=e.width||o-e.xOffset,e.height=e.height||s-e.yOffset,e.needsCopy=!0,nt(e.xOffset>=0&&e.xOffset<o&&e.yOffset>=0&&e.yOffset<s&&e.width>0&&e.width<=o&&e.height>0&&e.height<=s,"copy texture read out of bounds")}else if(r){if(t(r))e.channels=e.channels||4,e.data=r,"type"in n||e.type!==Gn||(e.type=$r(r));else if(Dr(r))e.channels=e.channels||4,Yr(e,r),e.alignment=1,e.needsFree=!0;else if(Ae(r)){var u=r.data;Array.isArray(u)||e.type!==Gn||(e.type=$r(u));var c,f,l,d,h,p,_=r.shape,m=r.stride;3===_.length?(l=_[2],p=m[2]):(nt(2===_.length,"invalid ndarray pixel data, must be 2 or 3D"),l=1,p=1),c=_[0],f=_[1],d=m[0],h=m[1],e.alignment=1,e.width=c,e.height=f,e.channels=l,e.format=e.internalformat=wr[l],e.needsFree=!0,qr(e,u,d,h,p,r.offset)}else if(Fr(r)||Cr(r)||Lr(r))Fr(r)||Cr(r)?e.element=r:e.element=r.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(Rr(r))e.element=r,e.width=r.width,e.height=r.height,e.channels=4;else if(Ur(r))e.element=r,e.width=r.naturalWidth,e.height=r.naturalHeight,e.channels=4;else if(Pr(r))e.element=r,e.width=r.videoWidth,e.height=r.videoHeight,e.channels=4;else if(zr(r)){var b=e.width||r[0].length,y=e.height||r.length,g=e.channels;g=ln(r[0][0])?g||r[0][0].length:g||1;for(var v=Ie.shape(r),w=1,x=0;x<v.length;++x)w*=v[x];var A=Wr(e,w);Ie.flatten(r,v,"",A),Gr(e,A),e.alignment=1,e.width=b,e.height=y,e.channels=g,e.format=e.internalformat=wr[g],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4;e.type===Xn?nt(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):e.type===Dn&&nt(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function B(t,e,r){var i=t.element,a=t.data,s=t.internalformat,u=t.format,c=t.type,f=t.width,l=t.height;k(t),i?n.texImage2D(e,r,u,u,c,i):t.compressed?n.compressedTexImage2D(e,r,s,f,l,0,a):t.needsCopy?(o(),n.copyTexImage2D(e,r,u,t.xOffset,t.yOffset,f,l,0)):n.texImage2D(e,r,u,f,l,0,u,c,a||null)}function j(t,e,r,i,a){var s=t.element,u=t.data,c=t.internalformat,f=t.format,l=t.type,d=t.width,h=t.height;k(t),s?n.texSubImage2D(e,a,r,i,f,l,s):t.compressed?n.compressedTexSubImage2D(e,a,r,i,c,d,h,u):t.needsCopy?(o(),n.copyTexSubImage2D(e,a,r,i,t.xOffset,t.yOffset,d,h)):n.texSubImage2D(e,a,r,i,d,h,f,l,u)}var D=[];function z(){return D.pop()||new M}function N(t){t.needsFree&&Ct.freeType(t.data),M.call(t),D.push(t)}function F(){I.call(this),this.genMipmaps=!1,this.mipmapHint=fr,this.mipmask=0,this.images=Array(16)}function C(t,e,n){var r=t.images[0]=z();t.mipmask=1,r.width=t.width=e,r.height=t.height=n,r.channels=t.channels=4}function L(t,e){var n=null;if(Vr(e))O(n=t.images[0]=z(),t),E(n,e),t.mipmask=1;else if(T(t,e),Array.isArray(e.mipmap))for(var r=e.mipmap,i=0;i<r.length;++i)O(n=t.images[i]=z(),t),n.width>>=i,n.height>>=i,E(n,r[i]),t.mipmask|=1<<i;else O(n=t.images[0]=z(),t),E(n,e),t.mipmask=1;O(t,t.images[0]),!t.compressed||t.internalformat!==zn&&t.internalformat!==Nn&&t.internalformat!==Fn&&t.internalformat!==Cn||nt(t.width%4==0&&t.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function R(t,e){for(var n=t.images,r=0;r<n.length;++r){if(!n[r])return;B(n[r],e,r)}}var U=[];function P(){var t=U.pop()||new F;I.call(t),t.mipmask=0;for(var e=0;e<16;++e)t.images[e]=null;return t}function V(t){for(var e=t.images,n=0;n<e.length;++n)e[n]&&N(e[n]),e[n]=null;U.push(t)}function $(){this.minFilter=rr,this.magFilter=rr,this.wrapS=Qn,this.wrapT=Qn,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=fr}function Y(t,e){if("min"in e){var n=e.min;nt.parameter(n,d),t.minFilter=d[n],vr.indexOf(t.minFilter)>=0&&!("faces"in e)&&(t.genMipmaps=!0)}if("mag"in e){var r=e.mag;nt.parameter(r,l),t.magFilter=l[r]}var o=t.wrapS,a=t.wrapT;if("wrap"in e){var s=e.wrap;"string"==typeof s?(nt.parameter(s,f),o=a=f[s]):Array.isArray(s)&&(nt.parameter(s[0],f),nt.parameter(s[1],f),o=f[s[0]],a=f[s[1]])}else{if("wrapS"in e){var u=e.wrapS;nt.parameter(u,f),o=f[u]}if("wrapT"in e){var h=e.wrapT;nt.parameter(h,f),a=f[h]}}if(t.wrapS=o,t.wrapT=a,"anisotropic"in e){var p=e.anisotropic;nt("number"==typeof p&&p>=1&&p<=i.maxAnisotropic,"aniso samples must be between 1 and "),t.anisotropic=e.anisotropic}if("mipmap"in e){var _=!1;switch(typeof e.mipmap){case"string":nt.parameter(e.mipmap,c,"invalid mipmap hint"),t.mipmapHint=c[e.mipmap],t.genMipmaps=!0,_=!0;break;case"boolean":_=t.genMipmaps=e.mipmap;break;case"object":nt(Array.isArray(e.mipmap),"invalid mipmap type"),t.genMipmaps=!1,_=!0;break;default:nt.raise("invalid mipmap type")}_&&!("min"in e)&&(t.minFilter=or)}}function W(t,e){n.texParameteri(e,nr,t.minFilter),n.texParameteri(e,er,t.magFilter),n.texParameteri(e,Zn,t.wrapS),n.texParameteri(e,Jn,t.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(e,hr,t.anisotropic),t.genMipmaps&&(n.hint(cr,t.mipmapHint),n.generateMipmap(e))}var G=0,q={},H=i.maxTextureUnits,X=Array(H).map((function(){return null}));function Z(t){I.call(this),this.mipmask=0,this.internalformat=bn,this.id=G++,this.refCount=1,this.target=t,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new $,u.profile&&(this.stats={size:0})}function J(t){n.activeTexture(gr),n.bindTexture(t.target,t.texture)}function K(){var t=X[0];t?n.bindTexture(t.target,t.texture):n.bindTexture(pn,null)}function Q(t){var e=t.texture;nt(e,"must not double destroy texture");var r=t.unit,i=t.target;r>=0&&(n.activeTexture(gr+r),n.bindTexture(i,null),X[r]=null),n.deleteTexture(e),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete q[t.id],s.textureCount--}function tt(t,e){var r=new Z(pn);function o(t,e){var n=r.texInfo;$.call(n);var a=P();return"number"==typeof t?C(a,0|t,"number"==typeof e?0|e:0|t):t?(nt.type(t,"object","invalid arguments to regl.texture"),Y(n,t),L(a,t)):C(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,O(r,a),nt.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,J(r),R(a,pn),W(n,pn),K(),V(a),u.profile&&(r.stats.size=Hr(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=g[r.internalformat],o.type=v[r.type],o.mag=w[n.magFilter],o.min=x[n.minFilter],o.wrapS=A[n.wrapS],o.wrapT=A[n.wrapT],o}function a(t,e,n,i){nt(!!t,"must specify image data");var a=0|e,s=0|n,u=0|i,c=z();return O(c,r),c.width=0,c.height=0,E(c,t),c.width=c.width||(r.width>>u)-a,c.height=c.height||(r.height>>u)-s,nt(r.type===c.type&&r.format===c.format&&r.internalformat===c.internalformat,"incompatible format for texture.subimage"),nt(a>=0&&s>=0&&a+c.width<=r.width&&s+c.height<=r.height,"texture.subimage write out of bounds"),nt(r.mipmask&1<<u,"missing mipmap data"),nt(c.data||c.element||c.needsCopy,"missing image data"),J(r),j(c,pn,a,s,u),K(),N(c),o}function c(t,e){var i=0|t,a=0|e||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,J(r);for(var s=0;r.mipmask>>s;++s){var c=i>>s,f=a>>s;if(!c||!f)break;n.texImage2D(pn,s,r.format,c,f,0,r.format,r.type,null)}return K(),u.profile&&(r.stats.size=Hr(r.internalformat,r.type,i,a,!1,!1)),o}return q[r.id]=r,s.textureCount++,o(t,e),o.subimage=a,o.resize=c,o._reglType="texture2d",o._texture=r,u.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o}function et(t,e,r,o,a,c){var f=new Z(_n);q[f.id]=f,s.cubeCount++;var l=new Array(6);function d(t,e,n,r,o,a){var s,c=f.texInfo;for($.call(c),s=0;s<6;++s)l[s]=P();if("number"!=typeof t&&t)if("object"==typeof t)if(e)L(l[0],t),L(l[1],e),L(l[2],n),L(l[3],r),L(l[4],o),L(l[5],a);else if(Y(c,t),T(f,t),"faces"in t){var h=t.faces;for(nt(Array.isArray(h)&&6===h.length,"cube faces must be a length 6 array"),s=0;s<6;++s)nt("object"==typeof h[s]&&!!h[s],"invalid input for cube map face"),O(l[s],f),L(l[s],h[s])}else for(s=0;s<6;++s)L(l[s],t);else nt.raise("invalid arguments to cube map");else{var p=0|t||1;for(s=0;s<6;++s)C(l[s],p,p)}for(O(f,l[0]),nt.optional((function(){i.npotTextureCube||nt(dn(f.width)&&dn(f.height),"your browser does not support non power or two texture dimensions")})),c.genMipmaps?f.mipmask=(l[0].width<<1)-1:f.mipmask=l[0].mipmask,nt.textureCube(f,c,l,i),f.internalformat=l[0].internalformat,d.width=l[0].width,d.height=l[0].height,J(f),s=0;s<6;++s)R(l[s],mn+s);for(W(c,_n),K(),u.profile&&(f.stats.size=Hr(f.internalformat,f.type,d.width,d.height,c.genMipmaps,!0)),d.format=g[f.internalformat],d.type=v[f.type],d.mag=w[c.magFilter],d.min=x[c.minFilter],d.wrapS=A[c.wrapS],d.wrapT=A[c.wrapT],s=0;s<6;++s)V(l[s]);return d}function h(t,e,n,r,i){nt(!!e,"must specify image data"),nt("number"==typeof t&&t===(0|t)&&t>=0&&t<6,"invalid face");var o=0|n,a=0|r,s=0|i,u=z();return O(u,f),u.width=0,u.height=0,E(u,e),u.width=u.width||(f.width>>s)-o,u.height=u.height||(f.height>>s)-a,nt(f.type===u.type&&f.format===u.format&&f.internalformat===u.internalformat,"incompatible format for texture.subimage"),nt(o>=0&&a>=0&&o+u.width<=f.width&&a+u.height<=f.height,"texture.subimage write out of bounds"),nt(f.mipmask&1<<s,"missing mipmap data"),nt(u.data||u.element||u.needsCopy,"missing image data"),J(f),j(u,mn+t,o,a,s),K(),N(u),d}function p(t){var e=0|t;if(e!==f.width){d.width=f.width=e,d.height=f.height=e,J(f);for(var r=0;r<6;++r)for(var i=0;f.mipmask>>i;++i)n.texImage2D(mn+r,i,f.format,e>>i,e>>i,0,f.format,f.type,null);return K(),u.profile&&(f.stats.size=Hr(f.internalformat,f.type,d.width,d.height,!1,!0)),d}}return d(t,e,r,o,a,c),d.subimage=h,d.resize=p,d._reglType="textureCube",d._texture=f,u.profile&&(d.stats=f.stats),d.destroy=function(){f.decRef()},d}function rt(){for(var t=0;t<H;++t)n.activeTexture(gr+t),n.bindTexture(pn,null),X[t]=null;Se(q).forEach(Q),s.cubeCount=0,s.textureCount=0}function it(){for(var t=0;t<H;++t){var e=X[t];e&&(e.bindCount=0,e.unit=-1,X[t]=null)}Se(q).forEach((function(t){t.texture=n.createTexture(),n.bindTexture(t.target,t.texture);for(var e=0;e<32;++e)if(0!=(t.mipmask&1<<e))if(t.target===pn)n.texImage2D(pn,e,t.internalformat,t.width>>e,t.height>>e,0,t.internalformat,t.type,null);else for(var r=0;r<6;++r)n.texImage2D(mn+r,e,t.internalformat,t.width>>e,t.height>>e,0,t.internalformat,t.type,null);W(t.texInfo,t.target)}))}function ot(){for(var t=0;t<H;++t){var e=X[t];e&&(e.bindCount=0,e.unit=-1,X[t]=null),n.activeTexture(gr+t),n.bindTexture(pn,null),n.bindTexture(_n,null)}}return e(Z.prototype,{bind:function(){var t=this;t.bindCount+=1;var e=t.unit;if(e<0){for(var r=0;r<H;++r){var i=X[r];if(i){if(i.bindCount>0)continue;i.unit=-1}X[r]=t,e=r;break}e>=H&&nt.raise("insufficient number of texture units"),u.profile&&s.maxTextureUnits<e+1&&(s.maxTextureUnits=e+1),t.unit=e,n.activeTexture(gr+e),n.bindTexture(t.target,t.texture)}return e},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Q(this)}}),u.profile&&(s.getTotalTextureSize=function(){var t=0;return Object.keys(q).forEach((function(e){t+=q[e].stats.size})),t}),{create2D:tt,createCube:et,clear:rt,getTexture:function(t){return null},restore:it,refresh:ot}}jr[xn]=2,jr[An]=2,jr[Sn]=2,jr[En]=4,jr[zn]=.5,jr[Nn]=.5,jr[Fn]=1,jr[Cn]=1,jr[Ln]=.5,jr[Rn]=1,jr[Un]=1,jr[Pn]=.5,jr[Vn]=.25,jr[$n]=.5,jr[Yn]=.25,jr[Wn]=.5;var Zr=36161,Jr=32854,Kr=32855,Qr=36194,ti=33189,ei=36168,ni=34041,ri=35907,ii=34836,oi=34842,ai=34843,si=[];function ui(t,e,n){return si[t]*e*n}si[Jr]=2,si[Kr]=2,si[Qr]=2,si[ti]=2,si[ei]=1,si[ni]=4,si[ri]=4,si[ii]=16,si[oi]=8,si[ai]=6;var ci=function(t,e,n,r,i){var o={rgba4:Jr,rgb565:Qr,"rgb5 a1":Kr,depth:ti,stencil:ei,"depth stencil":ni};e.ext_srgb&&(o.srgba=ri),e.ext_color_buffer_half_float&&(o.rgba16f=oi,o.rgb16f=ai),e.webgl_color_buffer_float&&(o.rgba32f=ii);var a=[];Object.keys(o).forEach((function(t){var e=o[t];a[e]=t}));var s=0,u={};function c(t){this.id=s++,this.refCount=1,this.renderbuffer=t,this.format=Jr,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function f(e){var n=e.renderbuffer;nt(n,"must not double destroy renderbuffer"),t.bindRenderbuffer(Zr,null),t.deleteRenderbuffer(n),e.renderbuffer=null,e.refCount=0,delete u[e.id],r.renderbufferCount--}function l(e,s){var f=new c(t.createRenderbuffer());function l(e,r){var s=0,u=0,c=Jr;if("object"==typeof e&&e){var d=e;if("shape"in d){var h=d.shape;nt(Array.isArray(h)&&h.length>=2,"invalid renderbuffer shape"),s=0|h[0],u=0|h[1]}else"radius"in d&&(s=u=0|d.radius),"width"in d&&(s=0|d.width),"height"in d&&(u=0|d.height);"format"in d&&(nt.parameter(d.format,o,"invalid renderbuffer format"),c=o[d.format])}else"number"==typeof e?(s=0|e,u="number"==typeof r?0|r:s):e?nt.raise("invalid arguments to renderbuffer constructor"):s=u=1;if(nt(s>0&&u>0&&s<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==f.width||u!==f.height||c!==f.format)return l.width=f.width=s,l.height=f.height=u,f.format=c,t.bindRenderbuffer(Zr,f.renderbuffer),t.renderbufferStorage(Zr,c,s,u),nt(0===t.getError(),"invalid render buffer format"),i.profile&&(f.stats.size=ui(f.format,f.width,f.height)),l.format=a[f.format],l}function d(e,r){var o=0|e,a=0|r||o;return o===f.width&&a===f.height||(nt(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),l.width=f.width=o,l.height=f.height=a,t.bindRenderbuffer(Zr,f.renderbuffer),t.renderbufferStorage(Zr,f.format,o,a),nt(0===t.getError(),"invalid render buffer format"),i.profile&&(f.stats.size=ui(f.format,f.width,f.height))),l}return u[f.id]=f,r.renderbufferCount++,l(e,s),l.resize=d,l._reglType="renderbuffer",l._renderbuffer=f,i.profile&&(l.stats=f.stats),l.destroy=function(){f.decRef()},l}function d(){Se(u).forEach((function(e){e.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(Zr,e.renderbuffer),t.renderbufferStorage(Zr,e.format,e.width,e.height)})),t.bindRenderbuffer(Zr,null)}return c.prototype.decRef=function(){--this.refCount<=0&&f(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var t=0;return Object.keys(u).forEach((function(e){t+=u[e].stats.size})),t}),{create:l,clear:function(){Se(u).forEach(f)},restore:d}},fi=36160,li=36161,di=3553,hi=34069,pi=36064,_i=36096,mi=36128,bi=33306,yi=36053,gi=36054,vi=36055,wi=36057,xi=36061,Ai=36193,Si=5121,Ii=5126,Oi=6407,Ti=6408,ki=6402,Mi=[Oi,Ti],Ei=[];Ei[Ti]=4,Ei[Oi]=3;var Bi=[];Bi[Si]=1,Bi[Ii]=4,Bi[Ai]=2;var ji=33189,Di=36168,zi=34041,Ni=[32854,32855,36194,35907,34842,34843,34836],Fi={};function Ci(t,n,r,i,o,a){var s={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],c=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&c.push("srgba"),n.ext_color_buffer_half_float&&c.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&c.push("rgba32f");var f=["uint8"];function l(t,e,n){this.target=t,this.texture=e,this.renderbuffer=n;var r=0,i=0;e?(r=e.width,i=e.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function d(t){t&&(t.texture&&t.texture._texture.decRef(),t.renderbuffer&&t.renderbuffer._renderbuffer.decRef())}function h(t,e,n){if(t)if(t.texture){var r=t.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);nt(i===e&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=t.renderbuffer._renderbuffer;nt(a.width===e&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function p(e,n){n&&(n.texture?t.framebufferTexture2D(fi,e,n.target,n.texture._texture.texture,0):t.framebufferRenderbuffer(fi,e,li,n.renderbuffer._renderbuffer.renderbuffer))}function _(t){var e=di,n=null,r=null,i=t;"object"==typeof t&&(i=t.data,"target"in t&&(e=0|t.target)),nt.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,nt(e===di)):"textureCube"===o?(n=i,nt(e>=hi&&e<hi+6,"invalid cube map target")):"renderbuffer"===o?(r=i,e=li):nt.raise("invalid regl object for attachment"),new l(e,n,r)}function m(t,e,n,r,a){if(n){var s=i.create2D({width:t,height:e,format:r,type:a});return s._texture.refCount=0,new l(di,s,null)}var u=o.create({width:t,height:e,format:r});return u._renderbuffer.refCount=0,new l(li,null,u)}function b(t){return t&&(t.texture||t.renderbuffer)}function y(t,e,n){t&&(t.texture?t.texture.resize(e,n):t.renderbuffer&&t.renderbuffer.resize(e,n),t.width=e,t.height=n)}n.oes_texture_half_float&&f.push("half float","float16"),n.oes_texture_float&&f.push("float","float32");var g=0,v={};function w(){this.id=g++,v[this.id]=this,this.framebuffer=t.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function x(t){t.colorAttachments.forEach(d),d(t.depthAttachment),d(t.stencilAttachment),d(t.depthStencilAttachment)}function A(e){var n=e.framebuffer;nt(n,"must not double destroy framebuffer"),t.deleteFramebuffer(n),e.framebuffer=null,a.framebufferCount--,delete v[e.id]}function S(e){var n;t.bindFramebuffer(fi,e.framebuffer);var i=e.colorAttachments;for(n=0;n<i.length;++n)p(pi+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)t.framebufferTexture2D(fi,pi+n,di,null,0);t.framebufferTexture2D(fi,bi,di,null,0),t.framebufferTexture2D(fi,_i,di,null,0),t.framebufferTexture2D(fi,mi,di,null,0),p(_i,e.depthAttachment),p(mi,e.stencilAttachment),p(bi,e.depthStencilAttachment);var o=t.checkFramebufferStatus(fi);t.isContextLost()||o===yi||nt.raise("framebuffer configuration not supported, status = "+Fi[o]),t.bindFramebuffer(fi,s.next?s.next.framebuffer:null),s.cur=s.next,t.getError()}function I(t,i){var o=new w;function l(t,e){var i;nt(s.next!==o,"can not update framebuffer which is currently in use");var a=0,d=0,p=!0,y=!0,g=null,v=!0,w="rgba",A="uint8",I=1,O=null,T=null,k=null,M=!1;if("number"==typeof t)a=0|t,d=0|e||a;else if(t){nt.type(t,"object","invalid arguments for framebuffer");var E=t;if("shape"in E){var B=E.shape;nt(Array.isArray(B)&&B.length>=2,"invalid shape for framebuffer"),a=B[0],d=B[1]}else"radius"in E&&(a=d=E.radius),"width"in E&&(a=E.width),"height"in E&&(d=E.height);("color"in E||"colors"in E)&&(g=E.color||E.colors,Array.isArray(g)&&nt(1===g.length||n.webgl_draw_buffers,"multiple render targets not supported")),g||("colorCount"in E&&(I=0|E.colorCount,nt(I>0,"invalid color buffer count")),"colorTexture"in E&&(v=!!E.colorTexture,w="rgba4"),"colorType"in E&&(A=E.colorType,v?(nt(n.oes_texture_float||!("float"===A||"float32"===A),"you must enable OES_texture_float in order to use floating point framebuffer objects"),nt(n.oes_texture_half_float||!("half float"===A||"float16"===A),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===A||"float16"===A?(nt(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),w="rgba16f"):"float"!==A&&"float32"!==A||(nt(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),w="rgba32f"),nt.oneOf(A,f,"invalid color type")),"colorFormat"in E&&(w=E.colorFormat,u.indexOf(w)>=0?v=!0:c.indexOf(w)>=0?v=!1:nt.optional((function(){v?nt.oneOf(E.colorFormat,u,"invalid color format for texture"):nt.oneOf(E.colorFormat,c,"invalid color format for renderbuffer")})))),("depthTexture"in E||"depthStencilTexture"in E)&&(M=!(!E.depthTexture&&!E.depthStencilTexture),nt(!M||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in E&&("boolean"==typeof E.depth?p=E.depth:(O=E.depth,y=!1)),"stencil"in E&&("boolean"==typeof E.stencil?y=E.stencil:(T=E.stencil,p=!1)),"depthStencil"in E&&("boolean"==typeof E.depthStencil?p=y=E.depthStencil:(k=E.depthStencil,p=!1,y=!1))}else a=d=1;var j=null,D=null,z=null,N=null;if(Array.isArray(g))j=g.map(_);else if(g)j=[_(g)];else for(j=new Array(I),i=0;i<I;++i)j[i]=m(a,d,v,w,A);nt(n.webgl_draw_buffers||j.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),nt(j.length<=r.maxColorAttachments,"too many color attachments, not supported"),a=a||j[0].width,d=d||j[0].height,O?D=_(O):p&&!y&&(D=m(a,d,M,"depth","uint32")),T?z=_(T):y&&!p&&(z=m(a,d,!1,"stencil","uint8")),k?N=_(k):!O&&!T&&y&&p&&(N=m(a,d,M,"depth stencil","depth stencil")),nt(!!O+!!T+!!k<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var F=null;for(i=0;i<j.length;++i)if(h(j[i],a,d),nt(!j[i]||j[i].texture&&Mi.indexOf(j[i].texture._texture.format)>=0||j[i].renderbuffer&&Ni.indexOf(j[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),j[i]&&j[i].texture){var C=Ei[j[i].texture._texture.format]*Bi[j[i].texture._texture.type];null===F?F=C:nt(F===C,"all color attachments much have the same number of bits per pixel.")}return h(D,a,d),nt(!D||D.texture&&D.texture._texture.format===ki||D.renderbuffer&&D.renderbuffer._renderbuffer.format===ji,"invalid depth attachment for framebuffer object"),h(z,a,d),nt(!z||z.renderbuffer&&z.renderbuffer._renderbuffer.format===Di,"invalid stencil attachment for framebuffer object"),h(N,a,d),nt(!N||N.texture&&N.texture._texture.format===zi||N.renderbuffer&&N.renderbuffer._renderbuffer.format===zi,"invalid depth-stencil attachment for framebuffer object"),x(o),o.width=a,o.height=d,o.colorAttachments=j,o.depthAttachment=D,o.stencilAttachment=z,o.depthStencilAttachment=N,l.color=j.map(b),l.depth=b(D),l.stencil=b(z),l.depthStencil=b(N),l.width=o.width,l.height=o.height,S(o),l}function d(t,e){nt(s.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|t,1),r=Math.max(0|e||n,1);if(n===o.width&&r===o.height)return l;for(var i=o.colorAttachments,a=0;a<i.length;++a)y(i[a],n,r);return y(o.depthAttachment,n,r),y(o.stencilAttachment,n,r),y(o.depthStencilAttachment,n,r),o.width=l.width=n,o.height=l.height=r,S(o),l}return a.framebufferCount++,l(t,i),e(l,{resize:d,_reglType:"framebuffer",_framebuffer:o,destroy:function(){A(o),x(o)},use:function(t){s.setFBO({framebuffer:l},t)}})}function O(t){var o=Array(6);function a(t){var r;nt(o.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var c,l={color:null},d=0,h=null,p="rgba",_="uint8",m=1;if("number"==typeof t)d=0|t;else if(t){nt.type(t,"object","invalid arguments for framebuffer");var b=t;if("shape"in b){var y=b.shape;nt(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),nt(y[0]===y[1],"cube framebuffer must be square"),d=y[0]}else"radius"in b&&(d=0|b.radius),"width"in b?(d=0|b.width,"height"in b&&nt(b.height===d,"must be square")):"height"in b&&(d=0|b.height);("color"in b||"colors"in b)&&(h=b.color||b.colors,Array.isArray(h)&&nt(1===h.length||n.webgl_draw_buffers,"multiple render targets not supported")),h||("colorCount"in b&&(m=0|b.colorCount,nt(m>0,"invalid color buffer count")),"colorType"in b&&(nt.oneOf(b.colorType,f,"invalid color type"),_=b.colorType),"colorFormat"in b&&(p=b.colorFormat,nt.oneOf(b.colorFormat,u,"invalid color format for texture"))),"depth"in b&&(l.depth=b.depth),"stencil"in b&&(l.stencil=b.stencil),"depthStencil"in b&&(l.depthStencil=b.depthStencil)}else d=1;if(h)if(Array.isArray(h))for(c=[],r=0;r<h.length;++r)c[r]=h[r];else c=[h];else{c=Array(m);var g={radius:d,format:p,type:_};for(r=0;r<m;++r)c[r]=i.createCube(g)}for(l.color=Array(c.length),r=0;r<c.length;++r){var v=c[r];nt("function"==typeof v&&"textureCube"===v._reglType,"invalid cube map"),d=d||v.width,nt(v.width===d&&v.height===d,"invalid cube map shape"),l.color[r]={target:hi,data:c[r]}}for(r=0;r<6;++r){for(var w=0;w<c.length;++w)l.color[w].target=hi+r;r>0&&(l.depth=o[0].depth,l.stencil=o[0].stencil,l.depthStencil=o[0].depthStencil),o[r]?o[r](l):o[r]=I(l)}return e(a,{width:d,height:d,color:c})}function c(t){var e,n=0|t;if(nt(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(e=0;e<i.length;++e)i[e].resize(n);for(e=0;e<6;++e)o[e].resize(n);return a.width=a.height=n,a}return a(t),e(a,{faces:o,resize:c,_reglType:"framebufferCube",destroy:function(){o.forEach((function(t){t.destroy()}))}})}function T(){s.cur=null,s.next=null,s.dirty=!0,Se(v).forEach((function(e){e.framebuffer=t.createFramebuffer(),S(e)}))}return e(s,{getFramebuffer:function(t){if("function"==typeof t&&"framebuffer"===t._reglType){var e=t._framebuffer;if(e instanceof w)return e}return null},create:I,createCube:O,clear:function(){Se(v).forEach(A)},restore:T})}Fi[yi]="complete",Fi[gi]="incomplete attachment",Fi[wi]="incomplete dimensions",Fi[vi]="incomplete, missing attachment",Fi[xi]="unsupported";var Li=5126,Ri=34962,Ui=34963,Pi=["attributes","elements","offset","count","primitive","instances"];function Vi(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Li,this.offset=0,this.stride=0,this.divisor=0}function $i(e,n,r,i,o,a,s){for(var u=r.maxAttributes,c=new Array(u),f=0;f<u;++f)c[f]=new Vi;var l=0,d={},h={Record:Vi,scope:{},state:c,currentVAO:null,targetVAO:null,restore:_()?x:function(){},createVAO:A,getVAO:b,destroyBuffer:p,setVAO:_()?y:g,clear:_()?v:function(){}};function p(t){for(var n=0;n<c.length;++n){var r=c[n];r.buffer===t&&(e.disableVertexAttribArray(n),r.buffer=null)}}function _(){return n.oes_vertex_array_object}function m(){return n.angle_instanced_arrays}function b(t){return"function"==typeof t&&t._vao?t._vao:null}function y(t){if(t!==h.currentVAO){var e=_();t?e.bindVertexArrayOES(t.vao):e.bindVertexArrayOES(null),h.currentVAO=t}}function g(t){if(t!==h.currentVAO){if(t)t.bindAttrs();else{for(var n=m(),r=0;r<c.length;++r){var i=c[r];i.buffer?(e.enableVertexAttribArray(r),i.buffer.bind(),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}s.elements?e.bindBuffer(Ui,s.elements.buffer.buffer):e.bindBuffer(Ui,null)}h.currentVAO=t}}function v(){Se(d).forEach((function(t){t.destroy()}))}function w(){this.id=++l,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var t=_();this.vao=t?t.createVertexArrayOES():null,d[this.id]=this,this.buffers=[]}function x(){_()&&Se(d).forEach((function(t){t.refresh()}))}function A(e){var r=new w;function s(e){var i;if(Array.isArray(e))i=e,r.elements&&r.ownsElements&&r.elements.destroy(),r.elements=null,r.ownsElements=!1,r.offset=0,r.count=0,r.instances=-1,r.primitive=4;else{if(nt("object"==typeof e,"invalid arguments for create vao"),nt("attributes"in e,"must specify attributes for vao"),e.elements){var c=e.elements;r.ownsElements?"function"==typeof c&&"elements"===c._reglType?(r.elements.destroy(),r.ownsElements=!1):(r.elements(c),r.ownsElements=!1):a.getElements(e.elements)?(r.elements=e.elements,r.ownsElements=!1):(r.elements=a.create(e.elements),r.ownsElements=!0)}else r.elements=null,r.ownsElements=!1;i=e.attributes,r.offset=0,r.count=-1,r.instances=-1,r.primitive=4,r.elements&&(r.count=r.elements._elements.vertCount,r.primitive=r.elements._elements.primType),"offset"in e&&(r.offset=0|e.offset),"count"in e&&(r.count=0|e.count),"instances"in e&&(r.instances=0|e.instances),"primitive"in e&&(nt(e.primitive in Ge,"bad primitive type: "+e.primitive),r.primitive=Ge[e.primitive]),nt.optional((()=>{for(var t=Object.keys(e),n=0;n<t.length;++n)nt(Pi.indexOf(t[n])>=0,'invalid option for vao: "'+t[n]+'" valid options are '+Pi)})),nt(Array.isArray(i),"attributes must be an array")}nt(i.length<u,"too many attributes"),nt(i.length>0,"must specify at least one attribute");var f={},l=r.attributes;l.length=i.length;for(var d=0;d<i.length;++d){var h,p=i[d],_=l[d]=new Vi,m=p.data||p;Array.isArray(m)||t(m)||Ae(m)?(r.buffers[d]&&(h=r.buffers[d],t(m)&&h._buffer.byteLength>=m.byteLength?h.subdata(m):(h.destroy(),r.buffers[d]=null)),r.buffers[d]||(h=r.buffers[d]=o.create(p,Ri,!1,!0)),_.buffer=o.getBuffer(h),_.size=0|_.buffer.dimension,_.normalized=!1,_.type=_.buffer.dtype,_.offset=0,_.stride=0,_.divisor=0,_.state=1,f[d]=1):o.getBuffer(p)?(_.buffer=o.getBuffer(p),_.size=0|_.buffer.dimension,_.normalized=!1,_.type=_.buffer.dtype,_.offset=0,_.stride=0,_.divisor=0,_.state=1):o.getBuffer(p.buffer)?(_.buffer=o.getBuffer(p.buffer),_.size=0|(+p.size||_.buffer.dimension),_.normalized=!!p.normalized||!1,"type"in p?(nt.parameter(p.type,De,"invalid buffer type"),_.type=De[p.type]):_.type=_.buffer.dtype,_.offset=0|(p.offset||0),_.stride=0|(p.stride||0),_.divisor=0|(p.divisor||0),_.state=1,nt(_.size>=1&&_.size<=4,"size must be between 1 and 4"),nt(_.offset>=0,"invalid offset"),nt(_.stride>=0&&_.stride<=255,"stride must be between 0 and 255"),nt(_.divisor>=0,"divisor must be positive"),nt(!_.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in p?(nt(d>0,"first attribute must not be a constant"),_.x=+p.x||0,_.y=+p.y||0,_.z=+p.z||0,_.w=+p.w||0,_.state=2):nt(!1,"invalid attribute spec for location "+d)}for(var b=0;b<r.buffers.length;++b)!f[b]&&r.buffers[b]&&(r.buffers[b].destroy(),r.buffers[b]=null);return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){for(var t=0;t<r.buffers.length;++t)r.buffers[t]&&r.buffers[t].destroy();r.buffers.length=0,r.ownsElements&&(r.elements.destroy(),r.elements=null,r.ownsElements=!1),r.destroy()},s._vao=r,s._reglType="vao",s(e)}return w.prototype.bindAttrs=function(){for(var t=m(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(e.enableVertexAttribArray(r),e.bindBuffer(Ri,i.buffer.buffer),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),t&&i.divisor&&t.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<u;++o)e.disableVertexAttribArray(o);var s=a.getElements(this.elements);s?e.bindBuffer(Ui,s.buffer.buffer):e.bindBuffer(Ui,null)},w.prototype.refresh=function(){var t=_();t&&(t.bindVertexArrayOES(this.vao),this.bindAttrs(),h.currentVAO=null,t.bindVertexArrayOES(null))},w.prototype.destroy=function(){if(this.vao){var t=_();this===h.currentVAO&&(h.currentVAO=null,t.bindVertexArrayOES(null)),t.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),d[this.id]&&(delete d[this.id],i.vaoCount-=1)},h}var Yi=35632,Wi=35633,Gi=35718,qi=35721;function Hi(t,n,r,i){var o={},a={};function s(t,e,n,r){this.name=t,this.id=e,this.location=n,this.info=r}function u(t,e){for(var n=0;n<t.length;++n)if(t[n].id===e.id)return void(t[n].location=e.location);t.push(e)}function c(e,r,i){var s=e===Yi?o:a,u=s[r];if(!u){var c=n.str(r);u=t.createShader(e),t.shaderSource(u,c),t.compileShader(u),nt.shaderError(t,u,c,e,i),s[r]=u}return u}var f={},l=[],d=0;function h(t,e){this.id=d++,this.fragId=t,this.vertId=e,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function p(e,r,o){var a,f,l=c(Yi,e.fragId),d=c(Wi,e.vertId),h=e.program=t.createProgram();if(t.attachShader(h,l),t.attachShader(h,d),o)for(a=0;a<o.length;++a){var p=o[a];t.bindAttribLocation(h,p[0],p[1])}t.linkProgram(h),nt.linkError(t,h,n.str(e.fragId),n.str(e.vertId),r);var _=t.getProgramParameter(h,Gi);i.profile&&(e.stats.uniformsCount=_);var m=e.uniforms;for(a=0;a<_;++a)if(f=t.getActiveUniform(h,a)){if(f.size>1)for(var b=0;b<f.size;++b){var y=f.name.replace("[0]","["+b+"]");u(m,new s(y,n.id(y),t.getUniformLocation(h,y),f))}var g=f.name;f.size>1&&(g=g.replace("[0]","")),u(m,new s(g,n.id(g),t.getUniformLocation(h,g),f))}var v=t.getProgramParameter(h,qi);i.profile&&(e.stats.attributesCount=v);var w=e.attributes;for(a=0;a<v;++a)(f=t.getActiveAttrib(h,a))&&u(w,new s(f.name,n.id(f.name),t.getAttribLocation(h,f.name),f))}function _(){o={},a={};for(var t=0;t<l.length;++t)p(l[t],null,l[t].attributes.map((function(t){return[t.location,t.name]})))}return i.profile&&(r.getMaxUniformsCount=function(){var t=0;return l.forEach((function(e){e.stats.uniformsCount>t&&(t=e.stats.uniformsCount)})),t},r.getMaxAttributesCount=function(){var t=0;return l.forEach((function(e){e.stats.attributesCount>t&&(t=e.stats.attributesCount)})),t}),{clear:function(){var e=t.deleteShader.bind(t);Se(o).forEach(e),o={},Se(a).forEach(e),a={},l.forEach((function(e){t.deleteProgram(e.program)})),l.length=0,f={},r.shaderCount=0},program:function(n,i,s,u){nt.command(n>=0,"missing vertex shader",s),nt.command(i>=0,"missing fragment shader",s);var c=f[i];c||(c=f[i]={});var d=c[n];if(d&&(d.refCount++,!u))return d;var _=new h(i,n);return r.shaderCount++,p(_,s,u),d||(c[n]=_),l.push(_),e(_,{destroy:function(){if(_.refCount--,_.refCount<=0){t.deleteProgram(_.program);var e=l.indexOf(_);l.splice(e,1),r.shaderCount--}c[_.vertId].refCount<=0&&(t.deleteShader(a[_.vertId]),delete a[_.vertId],delete f[_.fragId][_.vertId]),Object.keys(f[_.fragId]).length||(t.deleteShader(o[_.fragId]),delete o[_.fragId],delete f[_.fragId])}})},restore:_,shader:c,frag:-1,vert:-1}}var Xi=6408,Zi=5121,Ji=3333,Ki=5126;function Qi(e,n,r,i,o,a,s){function u(u){var c;null===n.next?(nt(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),c=Zi):(nt(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),c=n.next.colorAttachments[0].texture._texture.type,nt.optional((function(){a.oes_texture_float?(nt(c===Zi||c===Ki,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),c===Ki&&nt(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):nt(c===Zi,"Reading from a framebuffer is only allowed for the type 'uint8'")})));var f=0,l=0,d=i.framebufferWidth,h=i.framebufferHeight,p=null;t(u)?p=u:u&&(nt.type(u,"object","invalid arguments to regl.read()"),f=0|u.x,l=0|u.y,nt(f>=0&&f<i.framebufferWidth,"invalid x offset for regl.read"),nt(l>=0&&l<i.framebufferHeight,"invalid y offset for regl.read"),d=0|(u.width||i.framebufferWidth-f),h=0|(u.height||i.framebufferHeight-l),p=u.data||null),p&&(c===Zi?nt(p instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):c===Ki&&nt(p instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),nt(d>0&&d+f<=i.framebufferWidth,"invalid width for read pixels"),nt(h>0&&h+l<=i.framebufferHeight,"invalid height for read pixels"),r();var _=d*h*4;return p||(c===Zi?p=new Uint8Array(_):c===Ki&&(p=p||new Float32Array(_))),nt.isTypedArray(p,"data buffer for regl.read() must be a typedarray"),nt(p.byteLength>=_,"data buffer for regl.read() too small"),e.pixelStorei(Ji,4),e.readPixels(f,l,d,h,Xi,c,p),p}function c(t){var e;return n.setFBO({framebuffer:t.framebuffer},(function(){e=u(t)})),e}function f(t){return t&&"framebuffer"in t?c(t):u(t)}return f}function to(t){return Array.prototype.slice.call(t)}function eo(t){return to(t).join("")}function no(){var t=0,n=[],r=[];function i(e){for(var i=0;i<r.length;++i)if(r[i]===e)return n[i];var o="g"+t++;return n.push(o),r.push(e),o}function o(){var n=[];function r(){n.push.apply(n,to(arguments))}var i=[];function o(){var e="v"+t++;return i.push(e),arguments.length>0&&(n.push(e,"="),n.push.apply(n,to(arguments)),n.push(";")),e}return e(r,{def:o,toString:function(){return eo([i.length>0?"var "+i.join(",")+";":"",eo(n)])}})}function a(){var t=o(),n=o(),r=t.toString,i=n.toString;function a(e,r){n(e,r,"=",t.def(e,r),";")}return e((function(){t.apply(t,to(arguments))}),{def:t.def,entry:t,exit:n,save:a,set:function(e,n,r){a(e,n),t(e,n,"=",r,";")},toString:function(){return r()+i()}})}function s(){var t=eo(arguments),n=a(),r=a(),i=n.toString,o=r.toString;return e(n,{then:function(){return n.apply(n,to(arguments)),this},else:function(){return r.apply(r,to(arguments)),this},toString:function(){var e=o();return e&&(e="else{"+e+"}"),eo(["if(",t,"){",i(),"}",e])}})}var u=o(),c={};function f(t,n){var r=[];function i(){var t="a"+r.length;return r.push(t),t}n=n||0;for(var o=0;o<n;++o)i();var s=a(),u=s.toString;return c[t]=e(s,{arg:i,toString:function(){return eo(["function(",r.join(),"){",u(),"}"])}})}function l(){var t=['"use strict";',u,"return {"];Object.keys(c).forEach((function(e){t.push('"',e,'":',c[e].toString(),",")})),t.push("}");var e=eo(t).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(e)).apply(null,r)}return{global:u,link:i,block:o,proc:f,scope:a,cond:s,compile:l}}var ro="xyzw".split(""),io=5121,oo=1,ao=2,so=0,uo=1,co=2,fo=3,lo=4,ho=5,po=6,_o="dither",mo="blend.enable",bo="blend.color",yo="blend.equation",go="blend.func",vo="depth.enable",wo="depth.func",xo="depth.range",Ao="depth.mask",So="colorMask",Io="cull.enable",Oo="cull.face",To="frontFace",ko="lineWidth",Mo="polygonOffset.enable",Eo="polygonOffset.offset",Bo="sample.alpha",jo="sample.enable",Do="sample.coverage",zo="stencil.enable",No="stencil.mask",Fo="stencil.func",Co="stencil.opFront",Lo="stencil.opBack",Ro="scissor.enable",Uo="scissor.box",Po="viewport",Vo="profile",$o="framebuffer",Yo="vert",Wo="frag",Go="elements",qo="primitive",Ho="count",Xo="offset",Zo="instances",Jo="vao",Ko="Width",Qo="Height",ta=$o+Ko,ea=$o+Qo,na=Po+Ko,ra=Po+Qo,ia="drawingBuffer",oa=ia+Ko,aa=ia+Qo,sa=[go,yo,Fo,Co,Lo,Do,Po,Uo,Eo],ua=34962,ca=34963,fa=3553,la=34067,da=2884,ha=3042,pa=3024,_a=2960,ma=2929,ba=3089,ya=32823,ga=32926,va=32928,wa=5126,xa=35664,Aa=35665,Sa=35666,Ia=5124,Oa=35667,Ta=35668,ka=35669,Ma=35670,Ea=35671,Ba=35672,ja=35673,Da=35674,za=35675,Na=35676,Fa=35678,Ca=35680,La=4,Ra=1028,Ua=1029,Pa=2304,Va=2305,$a=32775,Ya=32776,Wa=519,Ga=7680,qa=0,Ha=1,Xa=32774,Za=513,Ja=36160,Ka=36064,Qa={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},ts=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],es={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},ns={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},rs={frag:35632,vert:35633},is={cw:Pa,ccw:Va};function os(e){return Array.isArray(e)||t(e)||Ae(e)}function as(t){return t.sort((function(t,e){return t===Po?-1:e===Po?1:t<e?-1:1}))}function ss(t,e,n,r){this.thisDep=t,this.contextDep=e,this.propDep=n,this.append=r}function us(t){return t&&!(t.thisDep||t.contextDep||t.propDep)}function cs(t){return new ss(!1,!1,!1,t)}function fs(t,e){var n=t.type;if(n===so){var r=t.data.length;return new ss(!0,r>=1,r>=2,e)}if(n===lo){var i=t.data;return new ss(i.thisDep,i.contextDep,i.propDep,e)}if(n===ho)return new ss(!1,!1,!1,e);if(n===po){for(var o=!1,a=!1,s=!1,u=0;u<t.data.length;++u){var c=t.data[u];if(c.type===uo)s=!0;else if(c.type===co)a=!0;else if(c.type===fo)o=!0;else if(c.type===so){o=!0;var f=c.data;f>=1&&(a=!0),f>=2&&(s=!0)}else c.type===lo&&(o=o||c.data.thisDep,a=a||c.data.contextDep,s=s||c.data.propDep)}return new ss(o,a,s,e)}return new ss(n===fo,n===co,n===uo,e)}var ls=new ss(!1,!1,!1,(function(){}));function ds(t,n,r,i,o,a,s,u,c,f,l,d,h,p,_){var m=f.Record,b={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(b.min=$a,b.max=Ya);var y=r.angle_instanced_arrays,g=r.webgl_draw_buffers,v=r.oes_vertex_array_object,w={dirty:!0,profile:_.profile},x={},A=[],S={},I={};function O(t){return t.replace(".","_")}function T(t,e,n){var r=O(t);A.push(t),x[r]=w[r]=!!n,S[r]=e}function k(t,e,n){var r=O(t);A.push(t),Array.isArray(n)?(w[r]=n.slice(),x[r]=n.slice()):w[r]=x[r]=n,I[r]=e}T(_o,pa),T(mo,ha),k(bo,"blendColor",[0,0,0,0]),k(yo,"blendEquationSeparate",[Xa,Xa]),k(go,"blendFuncSeparate",[Ha,qa,Ha,qa]),T(vo,ma,!0),k(wo,"depthFunc",Za),k(xo,"depthRange",[0,1]),k(Ao,"depthMask",!0),k(So,So,[!0,!0,!0,!0]),T(Io,da),k(Oo,"cullFace",Ua),k(To,To,Va),k(ko,ko,1),T(Mo,ya),k(Eo,"polygonOffset",[0,0]),T(Bo,ga),T(jo,va),k(Do,"sampleCoverage",[1,!1]),T(zo,_a),k(No,"stencilMask",-1),k(Fo,"stencilFunc",[Wa,0,-1]),k(Co,"stencilOpSeparate",[Ra,Ga,Ga,Ga]),k(Lo,"stencilOpSeparate",[Ua,Ga,Ga,Ga]),T(Ro,ba),k(Uo,"scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]),k(Po,Po,[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var M={gl:t,context:h,strings:n,next:x,current:w,draw:d,elements:a,buffer:o,shader:l,attributes:f.state,vao:f,uniforms:c,framebuffer:u,extensions:r,timer:p,isBufferArgs:os},E={primTypes:Ge,compareFuncs:es,blendFuncs:Qa,blendEquations:b,stencilOps:ns,glTypes:De,orientationType:is};nt.optional((function(){M.isArrayLike=ln})),g&&(E.backBuffer=[Ua],E.drawBuffer=Ot(i.maxDrawbuffers,(function(t){return 0===t?[0]:Ot(t,(function(t){return Ka+t}))})));var B=0;function j(){var t=no(),e=t.link,r=t.global;t.id=B++,t.batchId="0";var i=e(M),o=t.shared={props:"a0"};Object.keys(M).forEach((function(t){o[t]=r.def(i,".",t)})),nt.optional((function(){t.CHECK=e(nt),t.commandStr=nt.guessCommand(),t.command=e(t.commandStr),t.assert=function(t,n,r){t("if(!(",n,"))",this.CHECK,".commandRaise(",e(r),",",this.command,");")},E.invalidBlendCombinations=ts}));var a=t.next={},s=t.current={};Object.keys(I).forEach((function(t){Array.isArray(w[t])&&(a[t]=r.def(o.next,".",t),s[t]=r.def(o.current,".",t))}));var u=t.constants={};Object.keys(E).forEach((function(t){u[t]=r.def(JSON.stringify(E[t]))})),t.invoke=function(n,r){switch(r.type){case so:var i=["this",o.context,o.props,t.batchId];return n.def(e(r.data),".call(",i.slice(0,Math.max(r.data.length+1,4)),")");case uo:return n.def(o.props,r.data);case co:return n.def(o.context,r.data);case fo:return n.def("this",r.data);case lo:return r.data.append(t,n),r.data.ref;case ho:return r.data.toString();case po:return r.data.map((function(e){return t.invoke(n,e)}))}},t.attribCache={};var c={};return t.scopeAttrib=function(t){var r=n.id(t);if(r in c)return c[r];var i=f.scope[r];return i||(i=f.scope[r]=new m),c[r]=e(i)},t}function D(t){var e,n=t.static,r=t.dynamic;if(Vo in n){var i=!!n[Vo];(e=cs((function(t,e){return i}))).enable=i}else if(Vo in r){var o=r[Vo];e=fs(o,(function(t,e){return t.invoke(e,o)}))}return e}function z(t,e){var n=t.static,r=t.dynamic;if($o in n){var i=n[$o];return i?(i=u.getFramebuffer(i),nt.command(i,"invalid framebuffer object"),cs((function(t,e){var n=t.link(i),r=t.shared;e.set(r.framebuffer,".next",n);var o=r.context;return e.set(o,"."+ta,n+".width"),e.set(o,"."+ea,n+".height"),n}))):cs((function(t,e){var n=t.shared;e.set(n.framebuffer,".next","null");var r=n.context;return e.set(r,"."+ta,r+"."+oa),e.set(r,"."+ea,r+"."+aa),"null"}))}if($o in r){var o=r[$o];return fs(o,(function(t,e){var n=t.invoke(e,o),r=t.shared,i=r.framebuffer,a=e.def(i,".getFramebuffer(",n,")");nt.optional((function(){t.assert(e,"!"+n+"||"+a,"invalid framebuffer object")})),e.set(i,".next",a);var s=r.context;return e.set(s,"."+ta,a+"?"+a+".width:"+s+"."+oa),e.set(s,"."+ea,a+"?"+a+".height:"+s+"."+aa),a}))}return null}function N(t,e,n){var r=t.static,i=t.dynamic;function o(t){if(t in r){var o=r[t];nt.commandType(o,"object","invalid "+t,n.commandStr);var a,s,u=!0,c=0|o.x,f=0|o.y;return"width"in o?(a=0|o.width,nt.command(a>=0,"invalid "+t,n.commandStr)):u=!1,"height"in o?(s=0|o.height,nt.command(s>=0,"invalid "+t,n.commandStr)):u=!1,new ss(!u&&e&&e.thisDep,!u&&e&&e.contextDep,!u&&e&&e.propDep,(function(t,e){var n=t.shared.context,r=a;"width"in o||(r=e.def(n,".",ta,"-",c));var i=s;return"height"in o||(i=e.def(n,".",ea,"-",f)),[c,f,r,i]}))}if(t in i){var l=i[t],d=fs(l,(function(e,n){var r=e.invoke(n,l);nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)}));var i=e.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",ta,"-",o,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",ea,"-",a,")");return nt.optional((function(){e.assert(n,s+">=0&&"+u+">=0","invalid "+t)})),[o,a,s,u]}));return e&&(d.thisDep=d.thisDep||e.thisDep,d.contextDep=d.contextDep||e.contextDep,d.propDep=d.propDep||e.propDep),d}return e?new ss(e.thisDep,e.contextDep,e.propDep,(function(t,e){var n=t.shared.context;return[0,0,e.def(n,".",ta),e.def(n,".",ea)]})):null}var a=o(Po);if(a){var s=a;a=new ss(a.thisDep,a.contextDep,a.propDep,(function(t,e){var n=s.append(t,e),r=t.shared.context;return e.set(r,"."+na,n[2]),e.set(r,"."+ra,n[3]),n}))}return{viewport:a,scissor_box:o(Uo)}}function F(t,e){var n=t.static;if("string"==typeof n[Wo]&&"string"==typeof n[Yo]){if(Object.keys(e.dynamic).length>0)return null;var r=e.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)nt("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}function C(t,e,r){var i=t.static,o=t.dynamic;function a(t){if(t in i){var e=n.id(i[t]);nt.optional((function(){l.shader(rs[t],e,nt.guessCommand())}));var r=cs((function(){return e}));return r.id=e,r}if(t in o){var a=o[t];return fs(a,(function(e,n){var r=e.invoke(n,a),i=n.def(e.shared.strings,".id(",r,")");return nt.optional((function(){n(e.shared.shader,".shader(",rs[t],",",i,",",e.command,");")})),i}))}return null}var s,u=a(Wo),c=a(Yo),f=null;return us(u)&&us(c)?(f=l.program(c.id,u.id,null,r),s=cs((function(t,e){return t.link(f)}))):s=new ss(u&&u.thisDep||c&&c.thisDep,u&&u.contextDep||c&&c.contextDep,u&&u.propDep||c&&c.propDep,(function(t,e){var n,r=t.shared.shader;n=u?u.append(t,e):e.def(r,".",Wo);var i=r+".program("+(c?c.append(t,e):e.def(r,".",Yo))+","+n;return nt.optional((function(){i+=","+t.command})),e.def(i+")")})),{frag:u,vert:c,progVar:s,program:f}}function L(t,e){var n=t.static,r=t.dynamic,i={},o=!1;function s(){if(Jo in n){var t=n[Jo];return null!==t&&null===f.getVAO(t)&&(t=f.createVAO(t)),o=!0,i.vao=t,cs((function(e){var n=f.getVAO(t);return n?e.link(n):"null"}))}if(Jo in r){o=!0;var e=r[Jo];return fs(e,(function(t,n){var r=t.invoke(n,e);return n.def(t.shared.vao+".getVAO("+r+")")}))}return null}var u=s(),c=!1;function l(){if(Go in n){var t=n[Go];if(i.elements=t,os(t)){var s=i.elements=a.create(t,!0);t=a.getElements(s),c=!0}else t&&(t=a.getElements(t),c=!0,nt.command(t,"invalid elements",e.commandStr));var f=cs((function(e,n){if(t){var r=e.link(t);return e.ELEMENTS=r,r}return e.ELEMENTS=null,null}));return f.value=t,f}if(Go in r){c=!0;var l=r[Go];return fs(l,(function(t,e){var n=t.shared,r=n.isBufferArgs,i=n.elements,o=t.invoke(e,l),a=e.def("null"),s=e.def(r,"(",o,")"),u=t.cond(s).then(a,"=",i,".createStream(",o,");").else(a,"=",i,".getElements(",o,");");return nt.optional((function(){t.assert(u.else,"!"+o+"||"+a,"invalid elements")})),e.entry(u),e.exit(t.cond(s).then(i,".destroyStream(",a,");")),t.ELEMENTS=a,a}))}return o?new ss(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.elements+".getElements("+t.shared.vao+".currentVAO.elements):null")})):null}var d=l();function h(){if(qo in n){var t=n[qo];return i.primitive=t,nt.commandParameter(t,Ge,"invalid primitve",e.commandStr),cs((function(e,n){return Ge[t]}))}if(qo in r){var a=r[qo];return fs(a,(function(t,e){var n=t.constants.primTypes,r=t.invoke(e,a);return nt.optional((function(){t.assert(e,r+" in "+n,"invalid primitive, must be one of "+Object.keys(Ge))})),e.def(n,"[",r,"]")}))}return c?us(d)?d.value?cs((function(t,e){return e.def(t.ELEMENTS,".primType")})):cs((function(){return La})):new ss(d.thisDep,d.contextDep,d.propDep,(function(t,e){var n=t.ELEMENTS;return e.def(n,"?",n,".primType:",La)})):o?new ss(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.primitive:"+La)})):null}function p(t,a){if(t in n){var s=0|n[t];return a?i.offset=s:i.instances=s,nt.command(!a||s>=0,"invalid "+t,e.commandStr),cs((function(t,e){return a&&(t.OFFSET=s),s}))}if(t in r){var f=r[t];return fs(f,(function(e,n){var r=e.invoke(n,f);return a&&(e.OFFSET=r,nt.optional((function(){e.assert(n,r+">=0","invalid "+t)}))),r}))}if(a){if(c)return cs((function(t,e){return t.OFFSET=0,0}));if(o)return new ss(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.offset:0")}))}else if(o)return new ss(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.instances:-1")}));return null}var _=p(Xo,!0);function m(){if(Ho in n){var t=0|n[Ho];return i.count=t,nt.command("number"==typeof t&&t>=0,"invalid vertex count",e.commandStr),cs((function(){return t}))}if(Ho in r){var a=r[Ho];return fs(a,(function(t,e){var n=t.invoke(e,a);return nt.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(c){if(us(d)){if(d)return _?new ss(_.thisDep,_.contextDep,_.propDep,(function(t,e){var n=e.def(t.ELEMENTS,".vertCount-",t.OFFSET);return nt.optional((function(){t.assert(e,n+">=0","invalid vertex offset/element buffer too small")})),n})):cs((function(t,e){return e.def(t.ELEMENTS,".vertCount")}));var s=cs((function(){return-1}));return nt.optional((function(){s.MISSING=!0})),s}var f=new ss(d.thisDep||_.thisDep,d.contextDep||_.contextDep,d.propDep||_.propDep,(function(t,e){var n=t.ELEMENTS;return t.OFFSET?e.def(n,"?",n,".vertCount-",t.OFFSET,":-1"):e.def(n,"?",n,".vertCount:-1")}));return nt.optional((function(){f.DYNAMIC=!0})),f}return o?new ss(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao,".currentVAO?",t.shared.vao,".currentVAO.count:-1")})):null}var b=h(),y=m(),g=p(Zo,!1);return{elements:d,primitive:b,count:y,instances:g,offset:_,vao:u,vaoActive:o,elementsActive:c,static:i}}function R(t,e){var n=t.static,r=t.dynamic,o={};return A.forEach((function(t){var a=O(t);function s(e,i){if(t in n){var s=e(n[t]);o[a]=cs((function(){return s}))}else if(t in r){var u=r[t];o[a]=fs(u,(function(t,e){return i(t,e,t.invoke(e,u))}))}}switch(t){case Io:case mo:case _o:case zo:case vo:case Ro:case Mo:case Bo:case jo:case Ao:return s((function(n){return nt.commandType(n,"boolean",t,e.commandStr),n}),(function(e,n,r){return nt.optional((function(){e.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+t,e.commandStr)})),r}));case wo:return s((function(n){return nt.commandParameter(n,es,"invalid "+t,e.commandStr),es[n]}),(function(e,n,r){var i=e.constants.compareFuncs;return nt.optional((function(){e.assert(n,r+" in "+i,"invalid "+t+", must be one of "+Object.keys(es))})),n.def(i,"[",r,"]")}));case xo:return s((function(t){return nt.command(ln(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]&&t[0]<=t[1],"depth range is 2d array",e.commandStr),t}),(function(t,e,n){return nt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[e.def("+",n,"[0]"),e.def("+",n,"[1]")]}));case go:return s((function(t){nt.commandType(t,"object","blend.func",e.commandStr);var n="srcRGB"in t?t.srcRGB:t.src,r="srcAlpha"in t?t.srcAlpha:t.src,i="dstRGB"in t?t.dstRGB:t.dst,o="dstAlpha"in t?t.dstAlpha:t.dst;return nt.commandParameter(n,Qa,a+".srcRGB",e.commandStr),nt.commandParameter(r,Qa,a+".srcAlpha",e.commandStr),nt.commandParameter(i,Qa,a+".dstRGB",e.commandStr),nt.commandParameter(o,Qa,a+".dstAlpha",e.commandStr),nt.command(-1===ts.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",e.commandStr),[Qa[n],Qa[i],Qa[r],Qa[o]]}),(function(e,n,r){var i=e.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return nt.optional((function(){e.assert(n,s+" in "+i,"invalid "+t+"."+o+a+", must be one of "+Object.keys(Qa))})),s}nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");nt.optional((function(){var t=e.constants.invalidBlendCombinations;e.assert(n,t+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",a,"]"),c=n.def(i,"[",o("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),c,n.def(i,"[",o("dst","Alpha"),"]")]}));case yo:return s((function(n){return"string"==typeof n?(nt.commandParameter(n,b,"invalid "+t,e.commandStr),[b[n],b[n]]):"object"==typeof n?(nt.commandParameter(n.rgb,b,t+".rgb",e.commandStr),nt.commandParameter(n.alpha,b,t+".alpha",e.commandStr),[b[n.rgb],b[n.alpha]]):void nt.commandRaise("invalid blend.equation",e.commandStr)}),(function(e,n,r){var i=e.constants.blendEquations,o=n.def(),a=n.def(),s=e.cond("typeof ",r,'==="string"');return nt.optional((function(){function n(t,n,r){e.assert(t,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(b))}n(s.then,t,r),e.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+t),n(s.else,t+".rgb",r+".rgb"),n(s.else,t+".alpha",r+".alpha")})),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]}));case bo:return s((function(t){return nt.command(ln(t)&&4===t.length,"blend.color must be a 4d array",e.commandStr),Ot(4,(function(e){return+t[e]}))}),(function(t,e,n){return nt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),Ot(4,(function(t){return e.def("+",n,"[",t,"]")}))}));case No:return s((function(t){return nt.commandType(t,"number",a,e.commandStr),0|t}),(function(t,e,n){return nt.optional((function(){t.assert(e,"typeof "+n+'==="number"',"invalid stencil.mask")})),e.def(n,"|0")}));case Fo:return s((function(n){nt.commandType(n,"object",a,e.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return nt.commandParameter(r,es,t+".cmp",e.commandStr),nt.commandType(i,"number",t+".ref",e.commandStr),nt.commandType(o,"number",t+".mask",e.commandStr),[es[r],i,o]}),(function(t,e,n){var r=t.constants.compareFuncs;return nt.optional((function(){function i(){t.assert(e,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[e.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",Ga),e.def(n,".ref|0"),e.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case Co:case Lo:return s((function(n){nt.commandType(n,"object",a,e.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return nt.commandParameter(r,ns,t+".fail",e.commandStr),nt.commandParameter(i,ns,t+".zfail",e.commandStr),nt.commandParameter(o,ns,t+".zpass",e.commandStr),[t===Lo?Ua:Ra,ns[r],ns[i],ns[o]]}),(function(e,n,r){var i=e.constants.stencilOps;function o(o){return nt.optional((function(){e.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+t+"."+o+", must be one of "+Object.keys(ns))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",Ga)}return nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[t===Lo?Ua:Ra,o("fail"),o("zfail"),o("zpass")]}));case Eo:return s((function(t){nt.commandType(t,"object",a,e.commandStr);var n=0|t.factor,r=0|t.units;return nt.commandType(n,"number",a+".factor",e.commandStr),nt.commandType(r,"number",a+".units",e.commandStr),[n,r]}),(function(e,n,r){return nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case Oo:return s((function(t){var n=0;return"front"===t?n=Ra:"back"===t&&(n=Ua),nt.command(!!n,a,e.commandStr),n}),(function(t,e,n){return nt.optional((function(){t.assert(e,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),e.def(n,'==="front"?',Ra,":",Ua)}));case ko:return s((function(t){return nt.command("number"==typeof t&&t>=i.lineWidthDims[0]&&t<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],e.commandStr),t}),(function(t,e,n){return nt.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")})),n}));case To:return s((function(t){return nt.commandParameter(t,is,a,e.commandStr),is[t]}),(function(t,e,n){return nt.optional((function(){t.assert(e,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),e.def(n+'==="cw"?'+Pa+":"+Va)}));case So:return s((function(t){return nt.command(ln(t)&&4===t.length,"color.mask must be length 4 array",e.commandStr),t.map((function(t){return!!t}))}),(function(t,e,n){return nt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),Ot(4,(function(t){return"!!"+n+"["+t+"]"}))}));case Do:return s((function(t){nt.command("object"==typeof t&&t,a,e.commandStr);var n="value"in t?t.value:1,r=!!t.invert;return nt.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",e.commandStr),[n,r]}),(function(t,e,n){return nt.optional((function(){t.assert(e,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[e.def('"value" in ',n,"?+",n,".value:1"),e.def("!!",n,".invert")]}))}})),o}function U(t,e){var n=t.static,r=t.dynamic,i={};return Object.keys(n).forEach((function(t){var r,o=n[t];if("number"==typeof o||"boolean"==typeof o)r=cs((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=cs((function(t){return t.link(o)})):"framebuffer"===a||"framebufferCube"===a?(nt.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+t+'"',e.commandStr),r=cs((function(t){return t.link(o.color[0])}))):nt.commandRaise('invalid data for uniform "'+t+'"',e.commandStr)}else ln(o)?r=cs((function(e){return e.global.def("[",Ot(o.length,(function(n){return nt.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+t,e.commandStr),o[n]})),"]")})):nt.commandRaise('invalid or missing data for uniform "'+t+'"',e.commandStr);r.value=o,i[t]=r})),Object.keys(r).forEach((function(t){var e=r[t];i[t]=fs(e,(function(t,n){return t.invoke(n,e)}))})),i}function P(t,e){var r=t.static,i=t.dynamic,a={};return Object.keys(r).forEach((function(t){var i=r[t],s=n.id(t),u=new m;if(os(i))u.state=oo,u.buffer=o.getBuffer(o.create(i,ua,!1,!0)),u.type=0;else{var c=o.getBuffer(i);if(c)u.state=oo,u.buffer=c,u.type=0;else if(nt.command("object"==typeof i&&i,"invalid data for attribute "+t,e.commandStr),"constant"in i){var f=i.constant;u.buffer="null",u.state=ao,"number"==typeof f?u.x=f:(nt.command(ln(f)&&f.length>0&&f.length<=4,"invalid constant for attribute "+t,e.commandStr),ro.forEach((function(t,e){e<f.length&&(u[t]=f[e])})))}else{c=os(i.buffer)?o.getBuffer(o.create(i.buffer,ua,!1,!0)):o.getBuffer(i.buffer),nt.command(!!c,'missing buffer for attribute "'+t+'"',e.commandStr);var l=0|i.offset;nt.command(l>=0,'invalid offset for attribute "'+t+'"',e.commandStr);var d=0|i.stride;nt.command(d>=0&&d<256,'invalid stride for attribute "'+t+'", must be integer betweeen [0, 255]',e.commandStr);var h=0|i.size;nt.command(!("size"in i)||h>0&&h<=4,'invalid size for attribute "'+t+'", must be 1,2,3,4',e.commandStr);var p=!!i.normalized,_=0;"type"in i&&(nt.commandParameter(i.type,De,"invalid type for attribute "+t,e.commandStr),_=De[i.type]);var b=0|i.divisor;nt.optional((function(){"divisor"in i&&(nt.command(0===b||y,'cannot specify divisor for attribute "'+t+'", instancing not supported',e.commandStr),nt.command(b>=0,'invalid divisor for attribute "'+t+'"',e.commandStr));var n=e.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(e){nt.command(r.indexOf(e)>=0,'unknown parameter "'+e+'" for attribute pointer "'+t+'" (valid parameters are '+r+")",n)}))})),u.buffer=c,u.state=oo,u.size=h,u.normalized=p,u.type=_||c.dtype,u.offset=l,u.stride=d,u.divisor=b}}a[t]=cs((function(t,e){var n=t.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(u).forEach((function(t){r[t]=u[t]})),u.buffer&&(r.buffer=t.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r}))})),Object.keys(i).forEach((function(t){var e=i[t];function n(n,r){var i=n.invoke(r,e),o=n.shared,a=n.constants,s=o.isBufferArgs,u=o.buffer;nt.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+t+'"')}));var c={isStream:r.def(!1)},f=new m;f.state=oo,Object.keys(f).forEach((function(t){c[t]=r.def(""+f[t])}));var l=c.buffer,d=c.type;function h(t){r(c[t],"=",i,".",t,"|0;")}return r("if(",s,"(",i,")){",c.isStream,"=true;",l,"=",u,".createStream(",ua,",",i,");",d,"=",l,".dtype;","}else{",l,"=",u,".getBuffer(",i,");","if(",l,"){",d,"=",l,".dtype;",'}else if("constant" in ',i,"){",c.state,"=",ao,";","if(typeof "+i+'.constant === "number"){',c[ro[0]],"=",i,".constant;",ro.slice(1).map((function(t){return c[t]})).join("="),"=0;","}else{",ro.map((function(t,e){return c[t]+"="+i+".constant.length>"+e+"?"+i+".constant["+e+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",l,"=",u,".createStream(",ua,",",i,".buffer);","}else{",l,"=",u,".getBuffer(",i,".buffer);","}",d,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",l,".dtype;",c.normalized,"=!!",i,".normalized;"),h("size"),h("offset"),h("stride"),h("divisor"),r("}}"),r.exit("if(",c.isStream,"){",u,".destroyStream(",l,");","}"),c}a[t]=fs(e,n)})),a}function V(t){var e=t.static,n=t.dynamic,r={};return Object.keys(e).forEach((function(t){var n=e[t];r[t]=cs((function(t,e){return"number"==typeof n||"boolean"==typeof n?""+n:t.link(n)}))})),Object.keys(n).forEach((function(t){var e=n[t];r[t]=fs(e,(function(t,n){return t.invoke(n,e)}))})),r}function $(t,e,n,i,o){var a=t.static,s=t.dynamic;nt.optional((function(){var t=[$o,Yo,Wo,Go,qo,Xo,Ho,Zo,Vo,Jo].concat(A);function e(e){Object.keys(e).forEach((function(e){nt.command(t.indexOf(e)>=0,'unknown parameter "'+e+'"',o.commandStr)}))}e(a),e(s)}));var u=F(t,e),c=z(t),l=N(t,c,o),d=L(t,o),h=R(t,o),p=C(t,o,u);function _(t){var e=l[t];e&&(h[t]=e)}_(Po),_(O(Uo));var m=Object.keys(h).length>0,b={framebuffer:c,draw:d,shader:p,state:h,dirty:m,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(b.profile=D(t),b.uniforms=U(n,o),b.drawVAO=b.scopeVAO=d.vao,!b.drawVAO&&p.program&&!u&&r.angle_instanced_arrays&&d.static.elements){var y=!0,g=p.program.attributes.map((function(t){var n=e.static[t];return y=y&&!!n,n}));if(y&&g.length>0){var v=f.getVAO(f.createVAO({attributes:g,elements:d.static.elements}));b.drawVAO=new ss(null,null,null,(function(t,e){return t.link(v)})),b.useVAO=!0}}return u?b.useVAO=!0:b.attributes=P(e,o),b.context=V(i),b}function Y(t,e,n){var r=t.shared.context,i=t.scope();Object.keys(n).forEach((function(o){e.save(r,"."+o);var a=n[o].append(t,e);Array.isArray(a)?i(r,".",o,"=[",a.join(),"];"):i(r,".",o,"=",a,";")})),e(i)}function W(t,e,n,r){var i,o=t.shared,a=o.gl,s=o.framebuffer;g&&(i=e.def(o.extensions,".webgl_draw_buffers"));var u,c=t.constants,f=c.drawBuffer,l=c.backBuffer;u=n?n.append(t,e):e.def(s,".next"),r||e("if(",u,"!==",s,".cur){"),e("if(",u,"){",a,".bindFramebuffer(",Ja,",",u,".framebuffer);"),g&&e(i,".drawBuffersWEBGL(",f,"[",u,".colorAttachments.length]);"),e("}else{",a,".bindFramebuffer(",Ja,",null);"),g&&e(i,".drawBuffersWEBGL(",l,");"),e("}",s,".cur=",u,";"),r||e("}")}function G(t,e,n){var r=t.shared,i=r.gl,o=t.current,a=t.next,s=r.current,u=r.next,c=t.cond(s,".dirty");A.forEach((function(e){var r,f,l=O(e);if(!(l in n.state))if(l in a){r=a[l],f=o[l];var d=Ot(w[l].length,(function(t){return c.def(r,"[",t,"]")}));c(t.cond(d.map((function(t,e){return t+"!=="+f+"["+e+"]"})).join("||")).then(i,".",I[l],"(",d,");",d.map((function(t,e){return f+"["+e+"]="+t})).join(";"),";"))}else{r=c.def(u,".",l);var h=t.cond(r,"!==",s,".",l);c(h),l in S?h(t.cond(r).then(i,".enable(",S[l],");").else(i,".disable(",S[l],");"),s,".",l,"=",r,";"):h(i,".",I[l],"(",r,");",s,".",l,"=",r,";")}})),0===Object.keys(n.state).length&&c(s,".dirty=false;"),e(c)}function q(t,e,n,r){var i=t.shared,o=t.current,a=i.current,s=i.gl;as(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var c=u.append(t,e);if(S[i]){var f=S[i];us(u)?e(s,c?".enable(":".disable(",f,");"):e(t.cond(c).then(s,".enable(",f,");").else(s,".disable(",f,");")),e(a,".",i,"=",c,";")}else if(ln(c)){var l=o[i];e(s,".",I[i],"(",c,");",c.map((function(t,e){return l+"["+e+"]="+t})).join(";"),";")}else e(s,".",I[i],"(",c,");",a,".",i,"=",c,";")}}))}function H(t,e){y&&(t.instancing=e.def(t.shared.extensions,".angle_instanced_arrays"))}function X(t,e,n,r,i){var o,a,s,u=t.shared,c=t.stats,f=u.current,l=u.timer,d=n.profile;function h(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function _(t){t(o=e.def(),"=",h(),";"),"string"==typeof i?t(c,".count+=",i,";"):t(c,".count++;"),p&&(r?t(a=e.def(),"=",l,".getNumPendingQueries();"):t(l,".beginQuery(",c,");"))}function m(t){t(c,".cpuTime+=",h(),"-",o,";"),p&&(r?t(l,".pushScopeStats(",a,",",l,".getNumPendingQueries(),",c,");"):t(l,".endQuery();"))}function b(t){var n=e.def(f,".profile");e(f,".profile=",t,";"),e.exit(f,".profile=",n,";")}if(d){if(us(d))return void(d.enable?(_(e),m(e.exit),b("true")):b("false"));b(s=d.append(t,e))}else s=e.def(f,".profile");var y=t.block();_(y),e("if(",s,"){",y,"}");var g=t.block();m(g),e.exit("if(",s,"){",g,"}")}function Z(t,e,n,r,i){var o=t.shared;function a(t){switch(t){case xa:case Oa:case Ea:return 2;case Aa:case Ta:case Ba:return 3;case Sa:case ka:case ja:return 4;default:return 1}}function s(n,r,i){var a=o.gl,s=e.def(n,".location"),u=e.def(o.attributes,"[",s,"]"),c=i.state,f=i.buffer,l=[i.x,i.y,i.z,i.w],d=["buffer","normalized","offset","stride"];function h(){e("if(!",u,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?e.def(i.size,"||",r):r,e("if(",u,".type!==",o,"||",u,".size!==",n,"||",d.map((function(t){return u+"."+t+"!=="+i[t]})).join("||"),"){",a,".bindBuffer(",ua,",",f,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",u,".type=",o,";",u,".size=",n,";",d.map((function(t){return u+"."+t+"="+i[t]+";"})).join(""),"}"),y){var c=i.divisor;e("if(",u,".divisor!==",c,"){",t.instancing,".vertexAttribDivisorANGLE(",[s,c],");",u,".divisor=",c,";}")}}function p(){e("if(",u,".buffer){",a,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",ro.map((function(t,e){return u+"."+t+"!=="+l[e]})).join("||"),"){",a,".vertexAttrib4f(",s,",",l,");",ro.map((function(t,e){return u+"."+t+"="+l[e]+";"})).join(""),"}")}c===oo?h():c===ao?p():(e("if(",c,"===",oo,"){"),h(),e("}else{"),p(),e("}"))}r.forEach((function(r){var o,u=r.name,c=n.attributes[u];if(c){if(!i(c))return;o=c.append(t,e)}else{if(!i(ls))return;var f=t.scopeAttrib(u);nt.optional((function(){t.assert(e,f+".state","missing attribute "+u)})),o={},Object.keys(new m).forEach((function(t){o[t]=e.def(f,".",t)}))}s(t.link(r),a(r.info.type),o)}))}function J(t,e,r,i,o,a){for(var s,u=t.shared,c=u.gl,f={},l=0;l<i.length;++l){var d=i[l],h=d.name,p=d.info.type,_=d.info.size,m=r.uniforms[h];if(_>1){if(!m)continue;var b=h.replace("[0]","");if(f[b])continue;f[b]=1}var y,g=t.link(d)+".location";if(m){if(!o(m))continue;if(us(m)){var v=m.value;if(nt.command(null!=v,'missing uniform "'+h+'"',t.commandStr),p===Fa||p===Ca){nt.command("function"==typeof v&&(p===Fa&&("texture2d"===v._reglType||"framebuffer"===v._reglType)||p===Ca&&("textureCube"===v._reglType||"framebufferCube"===v._reglType)),"invalid texture for uniform "+h,t.commandStr);var w=t.link(v._texture||v.color[0]._texture);e(c,".uniform1i(",g,",",w+".bind());"),e.exit(w,".unbind();")}else if(p===Da||p===za||p===Na){nt.optional((function(){nt.command(ln(v),"invalid matrix for uniform "+h,t.commandStr),nt.command(p===Da&&4===v.length||p===za&&9===v.length||p===Na&&16===v.length,"invalid length for matrix uniform "+h,t.commandStr)}));var x=t.global.def("new Float32Array(["+Array.prototype.slice.call(v)+"])"),A=2;p===za?A=3:p===Na&&(A=4),e(c,".uniformMatrix",A,"fv(",g,",false,",x,");")}else{switch(p){case wa:1===_?nt.commandType(v,"number","uniform "+h,t.commandStr):nt.command(ln(v)&&v.length===_,"uniform "+h,t.commandStr),s="1f";break;case xa:nt.command(ln(v)&&v.length&&v.length%2==0&&v.length<=2*_,"uniform "+h,t.commandStr),s="2f";break;case Aa:nt.command(ln(v)&&v.length&&v.length%3==0&&v.length<=3*_,"uniform "+h,t.commandStr),s="3f";break;case Sa:nt.command(ln(v)&&v.length&&v.length%4==0&&v.length<=4*_,"uniform "+h,t.commandStr),s="4f";break;case Ma:1===_?nt.commandType(v,"boolean","uniform "+h,t.commandStr):nt.command(ln(v)&&v.length===_,"uniform "+h,t.commandStr),s="1i";break;case Ia:1===_?nt.commandType(v,"number","uniform "+h,t.commandStr):nt.command(ln(v)&&v.length===_,"uniform "+h,t.commandStr),s="1i";break;case Ea:case Oa:nt.command(ln(v)&&v.length&&v.length%2==0&&v.length<=2*_,"uniform "+h,t.commandStr),s="2i";break;case Ba:case Ta:nt.command(ln(v)&&v.length&&v.length%3==0&&v.length<=3*_,"uniform "+h,t.commandStr),s="3i";break;case ja:case ka:nt.command(ln(v)&&v.length&&v.length%4==0&&v.length<=4*_,"uniform "+h,t.commandStr),s="4i"}_>1?(s+="v",v=t.global.def("["+Array.prototype.slice.call(v)+"]")):v=ln(v)?Array.prototype.slice.call(v):v,e(c,".uniform",s,"(",g,",",v,");")}continue}y=m.append(t,e)}else{if(!o(ls))continue;y=e.def(u.uniforms,"[",n.id(h),"]")}p===Fa?(nt(!Array.isArray(y),"must specify a scalar prop for textures"),e("if(",y,"&&",y,'._reglType==="framebuffer"){',y,"=",y,".color[0];","}")):p===Ca&&(nt(!Array.isArray(y),"must specify a scalar prop for cube maps"),e("if(",y,"&&",y,'._reglType==="framebufferCube"){',y,"=",y,".color[0];","}")),nt.optional((function(){function n(n,r){t.assert(e,n,'bad data or missing for uniform "'+h+'".  '+r)}function r(t,e){1===e&&nt(!Array.isArray(y),"must not specify an array type for uniform"),n("Array.isArray("+y+") && typeof "+y+'[0]===" '+t+'" || typeof '+y+'==="'+t+'"',"invalid type, expected "+t)}function i(e,r,i){Array.isArray(y)?nt(y.length&&y.length%e==0&&y.length<=e*i,"must have length of "+(1===i?"":"n * ")+e):n(u.isArrayLike+"("+y+")&&"+y+".length && "+y+".length % "+e+" === 0 && "+y+".length<="+e*i,"invalid vector, should have length of "+(1===i?"":"n * ")+e,t.commandStr)}function o(e){nt(!Array.isArray(y),"must not specify a value type"),n("typeof "+y+'==="function"&&'+y+'._reglType==="texture'+(e===fa?"2d":"Cube")+'"',"invalid texture type",t.commandStr)}switch(p){case Ia:r("number",_);break;case Oa:i(2,"number",_);break;case Ta:i(3,"number",_);break;case ka:i(4,"number",_);break;case wa:r("number",_);break;case xa:i(2,"number",_);break;case Aa:i(3,"number",_);break;case Sa:i(4,"number",_);break;case Ma:r("boolean",_);break;case Ea:i(2,"boolean",_);break;case Ba:i(3,"boolean",_);break;case ja:i(4,"boolean",_);break;case Da:i(4,"number",_);break;case za:i(9,"number",_);break;case Na:i(16,"number",_);break;case Fa:o(fa);break;case Ca:o(la)}}));var S=1;switch(p){case Fa:case Ca:var I=e.def(y,"._texture");e(c,".uniform1i(",g,",",I,".bind());"),e.exit(I,".unbind();");continue;case Ia:case Ma:s="1i";break;case Oa:case Ea:s="2i",S=2;break;case Ta:case Ba:s="3i",S=3;break;case ka:case ja:s="4i",S=4;break;case wa:s="1f";break;case xa:s="2f",S=2;break;case Aa:s="3f",S=3;break;case Sa:s="4f",S=4;break;case Da:s="Matrix2fv";break;case za:s="Matrix3fv";break;case Na:s="Matrix4fv"}if(-1===s.indexOf("Matrix")&&_>1&&(s+="v",S=1),"M"===s.charAt(0)){e(c,".uniform",s,"(",g,",");var O=Math.pow(p-Da+2,2),T=t.global.def("new Float32Array(",O,")");Array.isArray(y)?e("false,(",Ot(O,(function(t){return T+"["+t+"]="+y[t]})),",",T,")"):e("false,(Array.isArray(",y,")||",y," instanceof Float32Array)?",y,":(",Ot(O,(function(t){return T+"["+t+"]="+y+"["+t+"]"})),",",T,")"),e(");")}else if(S>1){for(var k=[],M=[],E=0;E<S;++E)Array.isArray(y)?M.push(y[E]):M.push(e.def(y+"["+E+"]")),a&&k.push(e.def());a&&e("if(!",t.batchId,"||",k.map((function(t,e){return t+"!=="+M[e]})).join("||"),"){",k.map((function(t,e){return t+"="+M[e]+";"})).join("")),e(c,".uniform",s,"(",g,",",M.join(","),");"),a&&e("}")}else{if(nt(!Array.isArray(y),"uniform value must not be an array"),a){var B=e.def();e("if(!",t.batchId,"||",B,"!==",y,"){",B,"=",y,";")}e(c,".uniform",s,"(",g,",",y,");"),a&&e("}")}}}function K(t,e,n,r){var i=t.shared,o=i.gl,a=i.draw,s=r.draw;function u(){var u,c=s.elements,f=e;return c?((c.contextDep&&r.contextDynamic||c.propDep)&&(f=n),u=c.append(t,f),s.elementsActive&&f("if("+u+")"+o+".bindBuffer("+ca+","+u+".buffer.buffer);")):(u=f.def(),f(u,"=",a,".",Go,";","if(",u,"){",o,".bindBuffer(",ca,",",u,".buffer.buffer);}","else if(",i.vao,".currentVAO){",u,"=",t.shared.elements+".getElements("+i.vao,".currentVAO.elements);",v?"":"if("+u+")"+o+".bindBuffer("+ca+","+u+".buffer.buffer);","}")),u}function c(){var i,o=s.count,u=e;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(u=n),i=o.append(t,u),nt.optional((function(){o.MISSING&&t.assert(e,"false","missing vertex count"),o.DYNAMIC&&t.assert(u,i+">=0","missing vertex count")}))):(i=u.def(a,".",Ho),nt.optional((function(){t.assert(u,i+">=0","missing vertex count")}))),i}var f=u();function l(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(t,n):o.append(t,e):e.def(a,".",i)}var d,h,p=l(qo),_=l(Xo),m=c();if("number"==typeof m){if(0===m)return}else n("if(",m,"){"),n.exit("}");y&&(d=l(Zo),h=t.instancing);var b=f+".type",g=s.elements&&us(s.elements)&&!s.vaoActive;function w(){function t(){n(h,".drawElementsInstancedANGLE(",[p,m,b,_+"<<(("+b+"-"+io+")>>1)",d],");")}function e(){n(h,".drawArraysInstancedANGLE(",[p,_,m,d],");")}f&&"null"!==f?g?t():(n("if(",f,"){"),t(),n("}else{"),e(),n("}")):e()}function x(){function t(){n(o+".drawElements("+[p,m,b,_+"<<(("+b+"-"+io+")>>1)"]+");")}function e(){n(o+".drawArrays("+[p,_,m]+");")}f&&"null"!==f?g?t():(n("if(",f,"){"),t(),n("}else{"),e(),n("}")):e()}y&&("number"!=typeof d||d>=0)?"string"==typeof d?(n("if(",d,">0){"),w(),n("}else if(",d,"<0){"),x(),n("}")):w():x()}function Q(t,e,n,r,i){var o=j(),a=o.proc("body",i);return nt.optional((function(){o.commandStr=e.commandStr,o.command=o.link(e.commandStr)})),y&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),t(o,a,n,r),o.compile().body}function tt(t,e,n,r){H(t,e),n.useVAO?n.drawVAO?e(t.shared.vao,".setVAO(",n.drawVAO.append(t,e),");"):e(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(e(t.shared.vao,".setVAO(null);"),Z(t,e,n,r.attributes,(function(){return!0}))),J(t,e,n,r.uniforms,(function(){return!0}),!1),K(t,e,e,n)}function et(t,e){var n=t.proc("draw",1);H(t,n),Y(t,n,e.context),W(t,n,e.framebuffer),G(t,n,e),q(t,n,e.state),X(t,n,e,!1,!0);var r=e.shader.progVar.append(t,n);if(n(t.shared.gl,".useProgram(",r,".program);"),e.shader.program)tt(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var i=t.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(t.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",t.link((function(n){return Q(tt,t,e,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;"),t.shared.vao&&n(t.shared.vao,".setVAO(null);")}function rt(t,e,n,r){function i(){return!0}t.batchId="a1",H(t,e),Z(t,e,n,r.attributes,i),J(t,e,n,r.uniforms,i,!1),K(t,e,e,n)}function it(t,e,n,r){H(t,e);var i=n.contextDep,o=e.def(),a="a0",s="a1",u=e.def();t.shared.props=u,t.batchId=o;var c=t.scope(),f=t.scope();function l(t){return t.contextDep&&i||t.propDep}function d(t){return!l(t)}if(e(c.entry,"for(",o,"=0;",o,"<",s,";++",o,"){",u,"=",a,"[",o,"];",f,"}",c.exit),n.needsContext&&Y(t,f,n.context),n.needsFramebuffer&&W(t,f,n.framebuffer),q(t,f,n.state,l),n.profile&&l(n.profile)&&X(t,f,n,!1,!0),r)n.useVAO?n.drawVAO?l(n.drawVAO)?f(t.shared.vao,".setVAO(",n.drawVAO.append(t,f),");"):c(t.shared.vao,".setVAO(",n.drawVAO.append(t,c),");"):c(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(c(t.shared.vao,".setVAO(null);"),Z(t,c,n,r.attributes,d),Z(t,f,n,r.attributes,l)),J(t,c,n,r.uniforms,d,!1),J(t,f,n,r.uniforms,l,!0),K(t,c,f,n);else{var h=t.global.def("{}"),p=n.shader.progVar.append(t,f),_=f.def(p,".id"),m=f.def(h,"[",_,"]");f(t.shared.gl,".useProgram(",p,".program);","if(!",m,"){",m,"=",h,"[",_,"]=",t.link((function(e){return Q(rt,t,n,e,2)})),"(",p,");}",m,".call(this,a0[",o,"],",o,");")}}function ot(t,e){var n=t.proc("batch",2);t.batchId="0",H(t,n);var r=!1,i=!0;Object.keys(e.context).forEach((function(t){r=r||e.context[t].propDep})),r||(Y(t,n,e.context),i=!1);var o=e.framebuffer,a=!1;function s(t){return t.contextDep&&r||t.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||W(t,n,o)):W(t,n,null),e.state.viewport&&e.state.viewport.propDep&&(r=!0),G(t,n,e),q(t,n,e.state,(function(t){return!s(t)})),e.profile&&s(e.profile)||X(t,n,e,!1,"a1"),e.contextDep=r,e.needsContext=i,e.needsFramebuffer=a;var u=e.shader.progVar;if(u.contextDep&&r||u.propDep)it(t,n,e,null);else{var c=u.append(t,n);if(n(t.shared.gl,".useProgram(",c,".program);"),e.shader.program)it(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var f=t.global.def("{}"),l=n.def(c,".id"),d=n.def(f,"[",l,"]");n(t.cond(d).then(d,".call(this,a0,a1);").else(d,"=",f,"[",l,"]=",t.link((function(n){return Q(it,t,e,n,2)})),"(",c,");",d,".call(this,a0,a1);"))}}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;"),t.shared.vao&&n(t.shared.vao,".setVAO(null);")}function at(t,e){var r=t.proc("scope",3);t.batchId="a2";var i=t.shared,o=i.current;function a(n){var o=e.shader[n];o&&r.set(i.shader,"."+n,o.append(t,r))}Y(t,r,e.context),e.framebuffer&&e.framebuffer.append(t,r),as(Object.keys(e.state)).forEach((function(n){var o=e.state[n].append(t,r);ln(o)?o.forEach((function(e,i){r.set(t.next[n],"["+i+"]",e)})):r.set(i.next,"."+n,o)})),X(t,r,e,!0,!0),[Go,Xo,Ho,Zo,qo].forEach((function(n){var o=e.draw[n];o&&r.set(i.draw,"."+n,""+o.append(t,r))})),Object.keys(e.uniforms).forEach((function(o){var a=e.uniforms[o].append(t,r);Array.isArray(a)&&(a="["+a.join()+"]"),r.set(i.uniforms,"["+n.id(o)+"]",a)})),Object.keys(e.attributes).forEach((function(n){var i=e.attributes[n].append(t,r),o=t.scopeAttrib(n);Object.keys(new m).forEach((function(t){r.set(o,"."+t,i[t])}))})),e.scopeVAO&&r.set(i.vao,".targetVAO",e.scopeVAO.append(t,r)),a(Yo),a(Wo),Object.keys(e.state).length>0&&(r(o,".dirty=true;"),r.exit(o,".dirty=true;")),r("a1(",t.shared.context,",a0,",t.batchId,");")}function st(t){if("object"==typeof t&&!ln(t)){for(var e=Object.keys(t),n=0;n<e.length;++n)if(pt.isDynamic(t[e[n]]))return!0;return!1}}function ut(t,e,n){var r=e.static[n];if(r&&st(r)){var i=t.global,o=Object.keys(r),a=!1,s=!1,u=!1,c=t.global.def("{}");o.forEach((function(e){var n=r[e];if(pt.isDynamic(n)){"function"==typeof n&&(n=r[e]=pt.unbox(n));var o=fs(n,null);a=a||o.thisDep,u=u||o.propDep,s=s||o.contextDep}else{switch(i(c,".",e,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(t.link(n))}i(";")}})),e.dynamic[n]=new pt.DynamicVariable(lo,{thisDep:a,contextDep:s,propDep:u,ref:c,append:f}),delete e.static[n]}function f(t,e){o.forEach((function(n){var i=r[n];if(pt.isDynamic(i)){var o=t.invoke(e,i);e(c,".",n,"=",o,";")}}))}}function ct(t,n,r,i,o){var a=j();a.stats=a.link(o),Object.keys(n.static).forEach((function(t){ut(a,n,t)})),sa.forEach((function(e){ut(a,t,e)}));var s=$(t,n,r,i,a);return et(a,s),at(a,s),ot(a,s),e(a.compile(),{destroy:function(){s.shader.program.destroy()}})}return{next:x,current:w,procs:function(){var t=j(),e=t.proc("poll"),n=t.proc("refresh"),o=t.block();e(o),n(o);var a,s=t.shared,u=s.gl,c=s.next,f=s.current;o(f,".dirty=false;"),W(t,e),W(t,n,null,!0),y&&(a=t.link(y)),r.oes_vertex_array_object&&n(t.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var l=0;l<i.maxAttributes;++l){var d=n.def(s.attributes,"[",l,"]"),h=t.cond(d,".buffer");h.then(u,".enableVertexAttribArray(",l,");",u,".bindBuffer(",ua,",",d,".buffer.buffer);",u,".vertexAttribPointer(",l,",",d,".size,",d,".type,",d,".normalized,",d,".stride,",d,".offset);").else(u,".disableVertexAttribArray(",l,");",u,".vertexAttrib4f(",l,",",d,".x,",d,".y,",d,".z,",d,".w);",d,".buffer=null;"),n(h),y&&n(a,".vertexAttribDivisorANGLE(",l,",",d,".divisor);")}return n(t.shared.vao,".currentVAO=null;",t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"),Object.keys(S).forEach((function(r){var i=S[r],a=o.def(c,".",r),s=t.block();s("if(",a,"){",u,".enable(",i,")}else{",u,".disable(",i,")}",f,".",r,"=",a,";"),n(s),e("if(",a,"!==",f,".",r,"){",s,"}")})),Object.keys(I).forEach((function(r){var i,a,s=I[r],l=w[r],d=t.block();if(d(u,".",s,"("),ln(l)){var h=l.length;i=t.global.def(c,".",r),a=t.global.def(f,".",r),d(Ot(h,(function(t){return i+"["+t+"]"})),");",Ot(h,(function(t){return a+"["+t+"]="+i+"["+t+"];"})).join("")),e("if(",Ot(h,(function(t){return i+"["+t+"]!=="+a+"["+t+"]"})).join("||"),"){",d,"}")}else i=o.def(c,".",r),a=o.def(f,".",r),d(i,");",f,".",r,"=",i,";"),e("if(",i,"!==",a,"){",d,"}");n(d)})),t.compile()}(),compile:ct}}function hs(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var ps=34918,_s=34919,ms=35007,bs=function(t,e){if(!e.ext_disjoint_timer_query)return null;var n=[];function r(){return n.pop()||e.ext_disjoint_timer_query.createQueryEXT()}function i(t){n.push(t)}var o=[];function a(t){var n=r();e.ext_disjoint_timer_query.beginQueryEXT(ms,n),o.push(n),h(o.length-1,o.length,t)}function s(){e.ext_disjoint_timer_query.endQueryEXT(ms)}function u(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var c=[];function f(){return c.pop()||new u}function l(t){c.push(t)}var d=[];function h(t,e,n){var r=f();r.startQueryIndex=t,r.endQueryIndex=e,r.sum=0,r.stats=n,d.push(r)}var p=[],_=[];function m(){var t,n,r=o.length;if(0!==r){_.length=Math.max(_.length,r+1),p.length=Math.max(p.length,r+1),p[0]=0,_[0]=0;var a=0;for(t=0,n=0;n<o.length;++n){var s=o[n];e.ext_disjoint_timer_query.getQueryObjectEXT(s,_s)?(a+=e.ext_disjoint_timer_query.getQueryObjectEXT(s,ps),i(s)):o[t++]=s,p[n+1]=a,_[n+1]=t}for(o.length=t,t=0,n=0;n<d.length;++n){var u=d[n],c=u.startQueryIndex,f=u.endQueryIndex;u.sum+=p[f]-p[c];var h=_[c],m=_[f];m===h?(u.stats.gpuTime+=u.sum/1e6,l(u)):(u.startQueryIndex=h,u.endQueryIndex=m,d[t++]=u)}d.length=t}}return{beginQuery:a,endQuery:s,pushScopeStats:h,update:m,getNumPendingQueries:function(){return o.length},clear:function(){n.push.apply(n,o);for(var t=0;t<n.length;t++)e.ext_disjoint_timer_query.deleteQueryEXT(n[t]);o.length=0,n.length=0},restore:function(){o.length=0,n.length=0}}},ys=16384,gs=256,vs=1024,ws=34962,xs="webglcontextlost",As="webglcontextrestored",Ss=1,Is=2,Os=3;function Ts(t,e){for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}function ks(t){var n=St(t);if(!n)return null;var r=n.gl,i=r.getContextAttributes(),o=r.isContextLost(),a=It(r,n);if(!a)return null;var s=bt(),u=hs(),c=a.extensions,f=bs(r,c),l=mt(),d=r.drawingBufferWidth,h=r.drawingBufferHeight,p={tick:0,time:0,viewportWidth:d,viewportHeight:h,framebufferWidth:d,framebufferHeight:h,drawingBufferWidth:d,drawingBufferHeight:h,pixelRatio:n.pixelRatio},_={},m={elements:null,primitive:4,count:-1,offset:0,instances:-1},b=xe(r,c),y=We(r,u,n,w),g=an(r,c,y,u),v=$i(r,c,b,u,y,g,m);function w(t){return v.destroyBuffer(t)}var x=Hi(r,s,u,n),A=Xr(r,c,b,(function(){O.procs.poll()}),p,u,n),S=ci(r,c,b,u,n),I=Ci(r,c,b,A,S,u),O=ds(r,s,c,b,y,g,A,I,_,v,x,m,p,f,n),T=Qi(r,I,O.procs.poll,p,i,c,b),k=O.next,M=r.canvas,E=[],B=[],j=[],D=[n.onDestroy],z=null;function N(){if(0===E.length)return f&&f.update(),void(z=null);z=_t.next(N),q();for(var t=E.length-1;t>=0;--t){var e=E[t];e&&e(p,null,0)}r.flush(),f&&f.update()}function F(){!z&&E.length>0&&(z=_t.next(N))}function C(){z&&(_t.cancel(N),z=null)}function L(t){t.preventDefault(),o=!0,C(),B.forEach((function(t){t()}))}function R(t){r.getError(),o=!1,a.restore(),x.restore(),y.restore(),A.restore(),S.restore(),I.restore(),v.restore(),f&&f.restore(),O.procs.refresh(),F(),j.forEach((function(t){t()}))}function U(){E.length=0,C(),M&&(M.removeEventListener(xs,L),M.removeEventListener(As,R)),x.clear(),I.clear(),S.clear(),v.clear(),A.clear(),g.clear(),y.clear(),f&&f.clear(),D.forEach((function(t){t()}))}function P(t){function n(t){var n=e({},t);function r(t){if(t in n){var e=n[t];delete n[t],Object.keys(e).forEach((function(r){n[t+"."+r]=e[r]}))}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in t&&(n.vao=t.vao),n}function r(t,e){var n={},r={};return Object.keys(t).forEach((function(i){var o=t[i];if(pt.isDynamic(o))r[i]=pt.unbox(o,i);else{if(e&&Array.isArray(o))for(var a=0;a<o.length;++a)if(pt.isDynamic(o[a]))return void(r[i]=pt.unbox(o,i));n[i]=o}})),{dynamic:r,static:n}}nt(!!t,"invalid args to regl({...})"),nt.type(t,"object","invalid args to regl({...})");var i=r(t.context||{},!0),a=r(t.uniforms||{},!0),s=r(t.attributes||{},!1),u=r(n(t),!1),c={gpuTime:0,cpuTime:0,count:0},f=O.compile(u,s,a,i,c),l=f.draw,d=f.batch,h=f.scope,p=[];function _(t){for(;p.length<t;)p.push(null);return p}function m(t,e){var n;if(o&&nt.raise("context lost"),"function"==typeof t)return h.call(this,null,t,0);if("function"==typeof e)if("number"==typeof t)for(n=0;n<t;++n)h.call(this,null,e,n);else{if(!Array.isArray(t))return h.call(this,t,e,0);for(n=0;n<t.length;++n)h.call(this,t[n],e,n)}else if("number"==typeof t){if(t>0)return d.call(this,_(0|t),0|t)}else{if(!Array.isArray(t))return l.call(this,t);if(t.length)return d.call(this,t,t.length)}}return e(m,{stats:c,destroy:function(){f.destroy()}})}M&&(M.addEventListener(xs,L,!1),M.addEventListener(As,R,!1));var V=I.setFBO=P({framebuffer:pt.define.call(null,Ss,"framebuffer")});function $(t,e){var n=0;O.procs.poll();var i=e.color;i&&(r.clearColor(+i[0]||0,+i[1]||0,+i[2]||0,+i[3]||0),n|=ys),"depth"in e&&(r.clearDepth(+e.depth),n|=gs),"stencil"in e&&(r.clearStencil(0|e.stencil),n|=vs),nt(!!n,"called regl.clear with no buffer specified"),r.clear(n)}function Y(t){if(nt("object"==typeof t&&t,"regl.clear() takes an object as input"),"framebuffer"in t)if(t.framebuffer&&"framebufferCube"===t.framebuffer_reglType)for(var n=0;n<6;++n)V(e({framebuffer:t.framebuffer.faces[n]},t),$);else V(t,$);else $(null,t)}function W(t){function e(){var e=Ts(E,t);function n(){var t=Ts(E,n);E[t]=E[E.length-1],E.length-=1,E.length<=0&&C()}nt(e>=0,"cannot cancel a frame twice"),E[e]=n}return nt.type(t,"function","regl.frame() callback must be a function"),E.push(t),F(),{cancel:e}}function G(){var t=k.viewport,e=k.scissor_box;t[0]=t[1]=e[0]=e[1]=0,p.viewportWidth=p.framebufferWidth=p.drawingBufferWidth=t[2]=e[2]=r.drawingBufferWidth,p.viewportHeight=p.framebufferHeight=p.drawingBufferHeight=t[3]=e[3]=r.drawingBufferHeight}function q(){p.tick+=1,p.time=X(),G(),O.procs.poll()}function H(){A.refresh(),G(),O.procs.refresh(),f&&f.update()}function X(){return(mt()-l)/1e3}function Z(t,e){var n;switch(nt.type(e,"function","listener callback must be a function"),t){case"frame":return W(e);case"lost":n=B;break;case"restore":n=j;break;case"destroy":n=D;break;default:nt.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(e),{cancel:function(){for(var t=0;t<n.length;++t)if(n[t]===e)return n[t]=n[n.length-1],void n.pop()}}}H();var J=e(P,{clear:Y,prop:pt.define.bind(null,Ss),context:pt.define.bind(null,Is),this:pt.define.bind(null,Os),draw:P({}),buffer:function(t){return y.create(t,ws,!1,!1)},elements:function(t){return g.create(t,!1)},texture:A.create2D,cube:A.createCube,renderbuffer:S.create,framebuffer:I.create,framebufferCube:I.createCube,vao:v.createVAO,attributes:i,frame:W,on:Z,limits:b,hasExtension:function(t){return b.extensions.indexOf(t.toLowerCase())>=0},read:T,destroy:U,_gl:r,_refresh:H,poll:function(){q(),f&&f.update()},now:X,stats:u});return n.onDone(null,J),J}return ks}();var ha=function(t,e,n,r){return pa[0]=r,pa[1]=n,pa[2]=e,pa[3]=t,_a[0]},pa=new Uint8Array(4),_a=new Float32Array(pa.buffer);class ma{constructor(t,e="arithmetic"){this.transform="arithmetic",this.transform=e,this.start=t,this.value=t,this.target=t}update(t,e){if(0===e)return this.value=t,void(void 0!==this.timer&&this.timer.stop());this.start=this.value,this.target=t,this.start_timer(e)}start_timer(t){void 0!==this.timer&&this.timer.stop();const e=jn((n=>{const r=n/t;if(r>=1)return this.value=this.target,void e.stop();const i=1-r,o=r;this.value="geometric"===this.transform?this.start**i*this.target**o:this.start*i+this.target*o}));this.timer=e}}class ba{constructor(){this.maxPoints=new ma(1e4,"geometric"),this.pointSize=new ma(1,"geometric"),this.targetOpacity=new ma(50),this.foregroundOpacity=new ma(1),this.backgroundOpacity=new ma(.5),this.foregroundSize=new ma(1,"geometric"),this.backgroundSize=new ma(1,"geometric")}apply_prefs(t){const{duration:e}=t;this.maxPoints.update(t.max_points,e),this.targetOpacity.update(t.alpha,e),this.pointSize.update(t.point_size,e),this.foregroundOpacity.update(t.background_options.opacity[1],e),this.backgroundOpacity.update(t.background_options.opacity[0],e),this.foregroundSize.update(t.background_options.size[1],e),this.backgroundSize.update(t.background_options.size[0],e)}get max_points(){return this.maxPoints.value}get alpha(){return this.targetOpacity.value}get point_size(){return this.pointSize.value}get foreground_opacity(){return this.foregroundOpacity.value}get background_opacity(){return this.backgroundOpacity.value}get foreground_size(){return this.foregroundSize.value}get background_size(){return this.backgroundSize.value}}class ya{constructor(t,e,n){this._use_scale_to_download_tiles=!0,this._initializations=[],this.render_props=new ba,this.scatterplot=n,this.holder=dt(t),this.canvas=dt(this.holder.node().firstElementChild).node(),this.dataset=e,this.width=+dt(this.canvas).attr("width"),this.height=+dt(this.canvas).attr("height"),this.deferred_functions=[],this._use_scale_to_download_tiles=!0}get discard_share(){return 0}get prefs(){const t={...this.scatterplot.prefs};return t.arrow_table=void 0,t.arrow_buffer=void 0,t}get alpha(){return this.render_props.alpha}get optimal_alpha(){var t,e,n,r;const i=null!=(t=this.prefs.zoom_balance)?t:1,{alpha:o,point_size:a,max_ix:s,width:u,discard_share:c,height:f}=this,l=null!=(r=null==(n=null==(e=this.zoom)?void 0:e.transform)?void 0:n.k)?r:1,d=o/100,h=1/l**2,p=window.devicePixelRatio||1,_=u*f/p,m=Dt([s,this.dataset.highest_known_ix||1e10])*(1-c),b=Math.exp(Math.log(l)*i),y=d*_/(m*h*(Math.PI*(b*a/p/2)**2));return y<1/255?1/255:y}get point_size(){return this.render_props.point_size}get max_ix(){const{prefs:t}=this,{max_points:e}=this.render_props;if(!this._use_scale_to_download_tiles)return e;const{k:n}=this.zoom.transform,r=Math.exp(Math.log(n)*t.zoom_balance);return e*n*n/r/r}visible_tiles(){const{max_ix:t}=this,{dataset:e}=this,n="x"==this.aes.dim("x").current.field&&"y"==this.aes.dim("y").current.field&&"x"==this.aes.dim("x").last.field&&"y"==this.aes.dim("y").last.field?e.map((t=>t)).filter((e=>e.is_visible(t,this.zoom.current_corners()))):e.map((t=>t)).filter((t=>t.min_ix<this.max_ix));return n.sort(((t,e)=>t.min_ix-e.min_ix)),n}bind_zoom(t){return this.zoom=t,this}async initialize(){}}function ga(t){return void 0!==t.op}function va(t){return void 0!==t.lambda}function wa(t){return void 0!==t.constant}var xa={};
/**
   * @license
   * Lodash <https://lodash.com/>
   * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   */
!function(t,e){(function(){var n,r="Expected a function",i="__lodash_hash_undefined__",o="__lodash_placeholder__",a=16,s=32,u=64,c=128,f=256,l=1/0,d=9007199254740991,h=NaN,p=4294967295,_=[["ary",c],["bind",1],["bindKey",2],["curry",8],["curryRight",a],["flip",512],["partial",s],["partialRight",u],["rearg",f]],m="[object Arguments]",b="[object Array]",y="[object Boolean]",g="[object Date]",v="[object Error]",w="[object Function]",x="[object GeneratorFunction]",A="[object Map]",S="[object Number]",I="[object Object]",O="[object Promise]",T="[object RegExp]",k="[object Set]",M="[object String]",E="[object Symbol]",B="[object WeakMap]",j="[object ArrayBuffer]",D="[object DataView]",z="[object Float32Array]",N="[object Float64Array]",F="[object Int8Array]",C="[object Int16Array]",L="[object Int32Array]",R="[object Uint8Array]",U="[object Uint8ClampedArray]",P="[object Uint16Array]",V="[object Uint32Array]",$=/\b__p \+= '';/g,Y=/\b(__p \+=) '' \+/g,W=/(__e\(.*?\)|\b__t\)) \+\n'';/g,G=/&(?:amp|lt|gt|quot|#39);/g,q=/[&<>"']/g,H=RegExp(G.source),X=RegExp(q.source),Z=/<%-([\s\S]+?)%>/g,J=/<%([\s\S]+?)%>/g,K=/<%=([\s\S]+?)%>/g,Q=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,tt=/^\w*$/,et=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,nt=/[\\^$.*+?()[\]{}|]/g,rt=RegExp(nt.source),it=/^\s+/,ot=/\s/,at=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,st=/\{\n\/\* \[wrapped with (.+)\] \*/,ut=/,? & /,ct=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ft=/[()=,{}\[\]\/\s]/,lt=/\\(\\)?/g,dt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ht=/\w*$/,pt=/^[-+]0x[0-9a-f]+$/i,_t=/^0b[01]+$/i,mt=/^\[object .+?Constructor\]$/,bt=/^0o[0-7]+$/i,yt=/^(?:0|[1-9]\d*)$/,gt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,vt=/($^)/,wt=/['\n\r\u2028\u2029\\]/g,xt="\\ud800-\\udfff",At="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",St="\\u2700-\\u27bf",It="a-z\\xdf-\\xf6\\xf8-\\xff",Ot="A-Z\\xc0-\\xd6\\xd8-\\xde",Tt="\\ufe0e\\ufe0f",kt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Mt="['’]",Et="["+xt+"]",Bt="["+kt+"]",jt="["+At+"]",Dt="\\d+",zt="["+St+"]",Nt="["+It+"]",Ft="[^"+xt+kt+Dt+St+It+Ot+"]",Ct="\\ud83c[\\udffb-\\udfff]",Lt="[^"+xt+"]",Rt="(?:\\ud83c[\\udde6-\\uddff]){2}",Ut="[\\ud800-\\udbff][\\udc00-\\udfff]",Pt="["+Ot+"]",Vt="\\u200d",$t="(?:"+Nt+"|"+Ft+")",Yt="(?:"+Pt+"|"+Ft+")",Wt="(?:['’](?:d|ll|m|re|s|t|ve))?",Gt="(?:['’](?:D|LL|M|RE|S|T|VE))?",qt="(?:"+jt+"|"+Ct+")"+"?",Ht="["+Tt+"]?",Xt=Ht+qt+("(?:"+Vt+"(?:"+[Lt,Rt,Ut].join("|")+")"+Ht+qt+")*"),Zt="(?:"+[zt,Rt,Ut].join("|")+")"+Xt,Jt="(?:"+[Lt+jt+"?",jt,Rt,Ut,Et].join("|")+")",Kt=RegExp(Mt,"g"),Qt=RegExp(jt,"g"),te=RegExp(Ct+"(?="+Ct+")|"+Jt+Xt,"g"),ee=RegExp([Pt+"?"+Nt+"+"+Wt+"(?="+[Bt,Pt,"$"].join("|")+")",Yt+"+"+Gt+"(?="+[Bt,Pt+$t,"$"].join("|")+")",Pt+"?"+$t+"+"+Wt,Pt+"+"+Gt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Dt,Zt].join("|"),"g"),ne=RegExp("["+Vt+xt+At+Tt+"]"),re=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ie=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],oe=-1,ae={};ae[z]=ae[N]=ae[F]=ae[C]=ae[L]=ae[R]=ae[U]=ae[P]=ae[V]=!0,ae[m]=ae[b]=ae[j]=ae[y]=ae[D]=ae[g]=ae[v]=ae[w]=ae[A]=ae[S]=ae[I]=ae[T]=ae[k]=ae[M]=ae[B]=!1;var se={};se[m]=se[b]=se[j]=se[D]=se[y]=se[g]=se[z]=se[N]=se[F]=se[C]=se[L]=se[A]=se[S]=se[I]=se[T]=se[k]=se[M]=se[E]=se[R]=se[U]=se[P]=se[V]=!0,se[v]=se[w]=se[B]=!1;var ue={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ce=parseFloat,fe=parseInt,le="object"==typeof mn&&mn&&mn.Object===Object&&mn,de="object"==typeof self&&self&&self.Object===Object&&self,he=le||de||Function("return this")(),pe=e&&!e.nodeType&&e,_e=pe&&t&&!t.nodeType&&t,me=_e&&_e.exports===pe,be=me&&le.process,ye=function(){try{var t=_e&&_e.require&&_e.require("util").types;return t||be&&be.binding&&be.binding("util")}catch(e){}}(),ge=ye&&ye.isArrayBuffer,ve=ye&&ye.isDate,we=ye&&ye.isMap,xe=ye&&ye.isRegExp,Ae=ye&&ye.isSet,Se=ye&&ye.isTypedArray;function Ie(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Oe(t,e,n,r){for(var i=-1,o=null==t?0:t.length;++i<o;){var a=t[i];e(r,a,n(a),t)}return r}function Te(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function ke(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function Me(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function Ee(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o}function Be(t,e){return!!(null==t?0:t.length)&&Pe(t,e,0)>-1}function je(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function De(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function ze(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function Ne(t,e,n,r){var i=-1,o=null==t?0:t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}function Fe(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function Ce(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var Le=We("length");function Re(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,!1})),r}function Ue(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return-1}function Pe(t,e,n){return e==e?function(t,e,n){var r=n-1,i=t.length;for(;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):Ue(t,$e,n)}function Ve(t,e,n,r){for(var i=n-1,o=t.length;++i<o;)if(r(t[i],e))return i;return-1}function $e(t){return t!=t}function Ye(t,e){var n=null==t?0:t.length;return n?He(t,e)/n:h}function We(t){return function(e){return null==e?n:e[t]}}function Ge(t){return function(e){return null==t?n:t[e]}}function qe(t,e,n,r,i){return i(t,(function(t,i,o){n=r?(r=!1,t):e(n,t,i,o)})),n}function He(t,e){for(var r,i=-1,o=t.length;++i<o;){var a=e(t[i]);a!==n&&(r=r===n?a:r+a)}return r}function Xe(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function Ze(t){return t?t.slice(0,hn(t)+1).replace(it,""):t}function Je(t){return function(e){return t(e)}}function Ke(t,e){return De(e,(function(e){return t[e]}))}function Qe(t,e){return t.has(e)}function tn(t,e){for(var n=-1,r=t.length;++n<r&&Pe(e,t[n],0)>-1;);return n}function en(t,e){for(var n=t.length;n--&&Pe(e,t[n],0)>-1;);return n}var nn=Ge({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),rn=Ge({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function on(t){return"\\"+ue[t]}function an(t){return ne.test(t)}function sn(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function un(t,e){return function(n){return t(e(n))}}function cn(t,e){for(var n=-1,r=t.length,i=0,a=[];++n<r;){var s=t[n];s!==e&&s!==o||(t[n]=o,a[i++]=n)}return a}function fn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function ln(t){return an(t)?function(t){var e=te.lastIndex=0;for(;te.test(t);)++e;return e}(t):Le(t)}function dn(t){return an(t)?function(t){return t.match(te)||[]}(t):function(t){return t.split("")}(t)}function hn(t){for(var e=t.length;e--&&ot.test(t.charAt(e)););return e}var pn=Ge({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var _n=function t(e){var ot,xt=(e=null==e?he:_n.defaults(he.Object(),e,_n.pick(he,ie))).Array,At=e.Date,St=e.Error,It=e.Function,Ot=e.Math,Tt=e.Object,kt=e.RegExp,Mt=e.String,Et=e.TypeError,Bt=xt.prototype,jt=It.prototype,Dt=Tt.prototype,zt=e["__core-js_shared__"],Nt=jt.toString,Ft=Dt.hasOwnProperty,Ct=0,Lt=(ot=/[^.]+$/.exec(zt&&zt.keys&&zt.keys.IE_PROTO||""))?"Symbol(src)_1."+ot:"",Rt=Dt.toString,Ut=Nt.call(Tt),Pt=he._,Vt=kt("^"+Nt.call(Ft).replace(nt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),$t=me?e.Buffer:n,Yt=e.Symbol,Wt=e.Uint8Array,Gt=$t?$t.allocUnsafe:n,qt=un(Tt.getPrototypeOf,Tt),Ht=Tt.create,Xt=Dt.propertyIsEnumerable,Zt=Bt.splice,Jt=Yt?Yt.isConcatSpreadable:n,te=Yt?Yt.iterator:n,ne=Yt?Yt.toStringTag:n,ue=function(){try{var t=lo(Tt,"defineProperty");return t({},"",{}),t}catch(e){}}(),le=e.clearTimeout!==he.clearTimeout&&e.clearTimeout,de=At&&At.now!==he.Date.now&&At.now,pe=e.setTimeout!==he.setTimeout&&e.setTimeout,_e=Ot.ceil,be=Ot.floor,ye=Tt.getOwnPropertySymbols,Le=$t?$t.isBuffer:n,Ge=e.isFinite,mn=Bt.join,bn=un(Tt.keys,Tt),yn=Ot.max,gn=Ot.min,vn=At.now,wn=e.parseInt,xn=Ot.random,An=Bt.reverse,Sn=lo(e,"DataView"),In=lo(e,"Map"),On=lo(e,"Promise"),Tn=lo(e,"Set"),kn=lo(e,"WeakMap"),Mn=lo(Tt,"create"),En=kn&&new kn,Bn={},jn=Po(Sn),Dn=Po(In),zn=Po(On),Nn=Po(Tn),Fn=Po(kn),Cn=Yt?Yt.prototype:n,Ln=Cn?Cn.valueOf:n,Rn=Cn?Cn.toString:n;function Un(t){if(is(t)&&!qa(t)&&!(t instanceof Yn)){if(t instanceof $n)return t;if(Ft.call(t,"__wrapped__"))return Vo(t)}return new $n(t)}var Pn=function(){function t(){}return function(e){if(!rs(e))return{};if(Ht)return Ht(e);t.prototype=e;var r=new t;return t.prototype=n,r}}();function Vn(){}function $n(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=n}function Yn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=p,this.__views__=[]}function Wn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Gn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function qn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Hn(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new qn;++e<n;)this.add(t[e])}function Xn(t){var e=this.__data__=new Gn(t);this.size=e.size}function Zn(t,e){var n=qa(t),r=!n&&Ga(t),i=!n&&!r&&Ja(t),o=!n&&!r&&!i&&ds(t),a=n||r||i||o,s=a?Xe(t.length,Mt):[],u=s.length;for(var c in t)!e&&!Ft.call(t,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||go(c,u))||s.push(c);return s}function Jn(t){var e=t.length;return e?t[Hr(0,e-1)]:n}function Kn(t,e){return No(Mi(t),sr(e,0,t.length))}function Qn(t){return No(Mi(t))}function tr(t,e,r){(r!==n&&!$a(t[e],r)||r===n&&!(e in t))&&or(t,e,r)}function er(t,e,r){var i=t[e];Ft.call(t,e)&&$a(i,r)&&(r!==n||e in t)||or(t,e,r)}function nr(t,e){for(var n=t.length;n--;)if($a(t[n][0],e))return n;return-1}function rr(t,e,n,r){return dr(t,(function(t,i,o){e(r,t,n(t),o)})),r}function ir(t,e){return t&&Ei(e,zs(e),t)}function or(t,e,n){"__proto__"==e&&ue?ue(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function ar(t,e){for(var r=-1,i=e.length,o=xt(i),a=null==t;++r<i;)o[r]=a?n:Ms(t,e[r]);return o}function sr(t,e,r){return t==t&&(r!==n&&(t=t<=r?t:r),e!==n&&(t=t>=e?t:e)),t}function ur(t,e,r,i,o,a){var s,u=1&e,c=2&e,f=4&e;if(r&&(s=o?r(t,i,o,a):r(t)),s!==n)return s;if(!rs(t))return t;var l=qa(t);if(l){if(s=function(t){var e=t.length,n=new t.constructor(e);e&&"string"==typeof t[0]&&Ft.call(t,"index")&&(n.index=t.index,n.input=t.input);return n}(t),!u)return Mi(t,s)}else{var d=_o(t),h=d==w||d==x;if(Ja(t))return Ai(t,u);if(d==I||d==m||h&&!o){if(s=c||h?{}:bo(t),!u)return c?function(t,e){return Ei(t,po(t),e)}(t,function(t,e){return t&&Ei(e,Ns(e),t)}(s,t)):function(t,e){return Ei(t,ho(t),e)}(t,ir(s,t))}else{if(!se[d])return o?t:{};s=function(t,e,n){var r=t.constructor;switch(e){case j:return Si(t);case y:case g:return new r(+t);case D:return function(t,e){var n=e?Si(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case z:case N:case F:case C:case L:case R:case U:case P:case V:return Ii(t,n);case A:return new r;case S:case M:return new r(t);case T:return function(t){var e=new t.constructor(t.source,ht.exec(t));return e.lastIndex=t.lastIndex,e}(t);case k:return new r;case E:return i=t,Ln?Tt(Ln.call(i)):{}}var i}(t,d,u)}}a||(a=new Xn);var p=a.get(t);if(p)return p;a.set(t,s),cs(t)?t.forEach((function(n){s.add(ur(n,e,r,n,t,a))})):os(t)&&t.forEach((function(n,i){s.set(i,ur(n,e,r,i,t,a))}));var _=l?n:(f?c?io:ro:c?Ns:zs)(t);return Te(_||t,(function(n,i){_&&(n=t[i=n]),er(s,i,ur(n,e,r,i,t,a))})),s}function cr(t,e,r){var i=r.length;if(null==t)return!i;for(t=Tt(t);i--;){var o=r[i],a=e[o],s=t[o];if(s===n&&!(o in t)||!a(s))return!1}return!0}function fr(t,e,i){if("function"!=typeof t)throw new Et(r);return Bo((function(){t.apply(n,i)}),e)}function lr(t,e,n,r){var i=-1,o=Be,a=!0,s=t.length,u=[],c=e.length;if(!s)return u;n&&(e=De(e,Je(n))),r?(o=je,a=!1):e.length>=200&&(o=Qe,a=!1,e=new Hn(e));t:for(;++i<s;){var f=t[i],l=null==n?f:n(f);if(f=r||0!==f?f:0,a&&l==l){for(var d=c;d--;)if(e[d]===l)continue t;u.push(f)}else o(e,l,r)||u.push(f)}return u}Un.templateSettings={escape:Z,evaluate:J,interpolate:K,variable:"",imports:{_:Un}},Un.prototype=Vn.prototype,Un.prototype.constructor=Un,$n.prototype=Pn(Vn.prototype),$n.prototype.constructor=$n,Yn.prototype=Pn(Vn.prototype),Yn.prototype.constructor=Yn,Wn.prototype.clear=function(){this.__data__=Mn?Mn(null):{},this.size=0},Wn.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Wn.prototype.get=function(t){var e=this.__data__;if(Mn){var r=e[t];return r===i?n:r}return Ft.call(e,t)?e[t]:n},Wn.prototype.has=function(t){var e=this.__data__;return Mn?e[t]!==n:Ft.call(e,t)},Wn.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Mn&&e===n?i:e,this},Gn.prototype.clear=function(){this.__data__=[],this.size=0},Gn.prototype.delete=function(t){var e=this.__data__,n=nr(e,t);return!(n<0)&&(n==e.length-1?e.pop():Zt.call(e,n,1),--this.size,!0)},Gn.prototype.get=function(t){var e=this.__data__,r=nr(e,t);return r<0?n:e[r][1]},Gn.prototype.has=function(t){return nr(this.__data__,t)>-1},Gn.prototype.set=function(t,e){var n=this.__data__,r=nr(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},qn.prototype.clear=function(){this.size=0,this.__data__={hash:new Wn,map:new(In||Gn),string:new Wn}},qn.prototype.delete=function(t){var e=co(this,t).delete(t);return this.size-=e?1:0,e},qn.prototype.get=function(t){return co(this,t).get(t)},qn.prototype.has=function(t){return co(this,t).has(t)},qn.prototype.set=function(t,e){var n=co(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Hn.prototype.add=Hn.prototype.push=function(t){return this.__data__.set(t,i),this},Hn.prototype.has=function(t){return this.__data__.has(t)},Xn.prototype.clear=function(){this.__data__=new Gn,this.size=0},Xn.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Xn.prototype.get=function(t){return this.__data__.get(t)},Xn.prototype.has=function(t){return this.__data__.has(t)},Xn.prototype.set=function(t,e){var n=this.__data__;if(n instanceof Gn){var r=n.__data__;if(!In||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new qn(r)}return n.set(t,e),this.size=n.size,this};var dr=Di(vr),hr=Di(wr,!0);function pr(t,e){var n=!0;return dr(t,(function(t,r,i){return n=!!e(t,r,i)})),n}function _r(t,e,r){for(var i=-1,o=t.length;++i<o;){var a=t[i],s=e(a);if(null!=s&&(u===n?s==s&&!ls(s):r(s,u)))var u=s,c=a}return c}function mr(t,e){var n=[];return dr(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n}function br(t,e,n,r,i){var o=-1,a=t.length;for(n||(n=yo),i||(i=[]);++o<a;){var s=t[o];e>0&&n(s)?e>1?br(s,e-1,n,r,i):ze(i,s):r||(i[i.length]=s)}return i}var yr=zi(),gr=zi(!0);function vr(t,e){return t&&yr(t,e,zs)}function wr(t,e){return t&&gr(t,e,zs)}function xr(t,e){return Ee(e,(function(e){return ts(t[e])}))}function Ar(t,e){for(var r=0,i=(e=gi(e,t)).length;null!=t&&r<i;)t=t[Uo(e[r++])];return r&&r==i?t:n}function Sr(t,e,n){var r=e(t);return qa(t)?r:ze(r,n(t))}function Ir(t){return null==t?t===n?"[object Undefined]":"[object Null]":ne&&ne in Tt(t)?function(t){var e=Ft.call(t,ne),r=t[ne];try{t[ne]=n;var i=!0}catch(a){}var o=Rt.call(t);i&&(e?t[ne]=r:delete t[ne]);return o}(t):function(t){return Rt.call(t)}(t)}function Or(t,e){return t>e}function Tr(t,e){return null!=t&&Ft.call(t,e)}function kr(t,e){return null!=t&&e in Tt(t)}function Mr(t,e,r){for(var i=r?je:Be,o=t[0].length,a=t.length,s=a,u=xt(a),c=1/0,f=[];s--;){var l=t[s];s&&e&&(l=De(l,Je(e))),c=gn(l.length,c),u[s]=!r&&(e||o>=120&&l.length>=120)?new Hn(s&&l):n}l=t[0];var d=-1,h=u[0];t:for(;++d<o&&f.length<c;){var p=l[d],_=e?e(p):p;if(p=r||0!==p?p:0,!(h?Qe(h,_):i(f,_,r))){for(s=a;--s;){var m=u[s];if(!(m?Qe(m,_):i(t[s],_,r)))continue t}h&&h.push(_),f.push(p)}}return f}function Er(t,e,r){var i=null==(t=ko(t,e=gi(e,t)))?t:t[Uo(Qo(e))];return null==i?n:Ie(i,t,r)}function Br(t){return is(t)&&Ir(t)==m}function jr(t,e,r,i,o){return t===e||(null==t||null==e||!is(t)&&!is(e)?t!=t&&e!=e:function(t,e,r,i,o,a){var s=qa(t),u=qa(e),c=s?b:_o(t),f=u?b:_o(e),l=(c=c==m?I:c)==I,d=(f=f==m?I:f)==I,h=c==f;if(h&&Ja(t)){if(!Ja(e))return!1;s=!0,l=!1}if(h&&!l)return a||(a=new Xn),s||ds(t)?eo(t,e,r,i,o,a):function(t,e,n,r,i,o,a){switch(n){case D:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case j:return!(t.byteLength!=e.byteLength||!o(new Wt(t),new Wt(e)));case y:case g:case S:return $a(+t,+e);case v:return t.name==e.name&&t.message==e.message;case T:case M:return t==e+"";case A:var s=sn;case k:var u=1&r;if(s||(s=fn),t.size!=e.size&&!u)return!1;var c=a.get(t);if(c)return c==e;r|=2,a.set(t,e);var f=eo(s(t),s(e),r,i,o,a);return a.delete(t),f;case E:if(Ln)return Ln.call(t)==Ln.call(e)}return!1}(t,e,c,r,i,o,a);if(!(1&r)){var p=l&&Ft.call(t,"__wrapped__"),_=d&&Ft.call(e,"__wrapped__");if(p||_){var w=p?t.value():t,x=_?e.value():e;return a||(a=new Xn),o(w,x,r,i,a)}}if(!h)return!1;return a||(a=new Xn),function(t,e,r,i,o,a){var s=1&r,u=ro(t),c=u.length,f=ro(e),l=f.length;if(c!=l&&!s)return!1;var d=c;for(;d--;){var h=u[d];if(!(s?h in e:Ft.call(e,h)))return!1}var p=a.get(t),_=a.get(e);if(p&&_)return p==e&&_==t;var m=!0;a.set(t,e),a.set(e,t);var b=s;for(;++d<c;){var y=t[h=u[d]],g=e[h];if(i)var v=s?i(g,y,h,e,t,a):i(y,g,h,t,e,a);if(!(v===n?y===g||o(y,g,r,i,a):v)){m=!1;break}b||(b="constructor"==h)}if(m&&!b){var w=t.constructor,x=e.constructor;w==x||!("constructor"in t)||!("constructor"in e)||"function"==typeof w&&w instanceof w&&"function"==typeof x&&x instanceof x||(m=!1)}return a.delete(t),a.delete(e),m}(t,e,r,i,o,a)}(t,e,r,i,jr,o))}function Dr(t,e,r,i){var o=r.length,a=o,s=!i;if(null==t)return!a;for(t=Tt(t);o--;){var u=r[o];if(s&&u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}for(;++o<a;){var c=(u=r[o])[0],f=t[c],l=u[1];if(s&&u[2]){if(f===n&&!(c in t))return!1}else{var d=new Xn;if(i)var h=i(f,l,c,t,e,d);if(!(h===n?jr(l,f,3,i,d):h))return!1}}return!0}function zr(t){return!(!rs(t)||(e=t,Lt&&Lt in e))&&(ts(t)?Vt:mt).test(Po(t));var e}function Nr(t){return"function"==typeof t?t:null==t?au:"object"==typeof t?qa(t)?Pr(t[0],t[1]):Ur(t):_u(t)}function Fr(t){if(!So(t))return bn(t);var e=[];for(var n in Tt(t))Ft.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Cr(t){if(!rs(t))return function(t){var e=[];if(null!=t)for(var n in Tt(t))e.push(n);return e}(t);var e=So(t),n=[];for(var r in t)("constructor"!=r||!e&&Ft.call(t,r))&&n.push(r);return n}function Lr(t,e){return t<e}function Rr(t,e){var n=-1,r=Xa(t)?xt(t.length):[];return dr(t,(function(t,i,o){r[++n]=e(t,i,o)})),r}function Ur(t){var e=fo(t);return 1==e.length&&e[0][2]?Oo(e[0][0],e[0][1]):function(n){return n===t||Dr(n,t,e)}}function Pr(t,e){return wo(t)&&Io(e)?Oo(Uo(t),e):function(r){var i=Ms(r,t);return i===n&&i===e?Es(r,t):jr(e,i,3)}}function Vr(t,e,r,i,o){t!==e&&yr(e,(function(a,s){if(o||(o=new Xn),rs(a))!function(t,e,r,i,o,a,s){var u=Mo(t,r),c=Mo(e,r),f=s.get(c);if(f)return void tr(t,r,f);var l=a?a(u,c,r+"",t,e,s):n,d=l===n;if(d){var h=qa(c),p=!h&&Ja(c),_=!h&&!p&&ds(c);l=c,h||p||_?qa(u)?l=u:Za(u)?l=Mi(u):p?(d=!1,l=Ai(c,!0)):_?(d=!1,l=Ii(c,!0)):l=[]:ss(c)||Ga(c)?(l=u,Ga(u)?l=vs(u):rs(u)&&!ts(u)||(l=bo(c))):d=!1}d&&(s.set(c,l),o(l,c,i,a,s),s.delete(c));tr(t,r,l)}(t,e,s,r,Vr,i,o);else{var u=i?i(Mo(t,s),a,s+"",t,e,o):n;u===n&&(u=a),tr(t,s,u)}}),Ns)}function $r(t,e){var r=t.length;if(r)return go(e+=e<0?r:0,r)?t[e]:n}function Yr(t,e,n){e=e.length?De(e,(function(t){return qa(t)?function(e){return Ar(e,1===t.length?t[0]:t)}:t})):[au];var r=-1;return e=De(e,Je(uo())),function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(Rr(t,(function(t,n,i){return{criteria:De(e,(function(e){return e(t)})),index:++r,value:t}})),(function(t,e){return function(t,e,n){var r=-1,i=t.criteria,o=e.criteria,a=i.length,s=n.length;for(;++r<a;){var u=Oi(i[r],o[r]);if(u)return r>=s?u:u*("desc"==n[r]?-1:1)}return t.index-e.index}(t,e,n)}))}function Wr(t,e,n){for(var r=-1,i=e.length,o={};++r<i;){var a=e[r],s=Ar(t,a);n(s,a)&&Qr(o,gi(a,t),s)}return o}function Gr(t,e,n,r){var i=r?Ve:Pe,o=-1,a=e.length,s=t;for(t===e&&(e=Mi(e)),n&&(s=De(t,Je(n)));++o<a;)for(var u=0,c=e[o],f=n?n(c):c;(u=i(s,f,u,r))>-1;)s!==t&&Zt.call(s,u,1),Zt.call(t,u,1);return t}function qr(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==o){var o=i;go(i)?Zt.call(t,i,1):li(t,i)}}return t}function Hr(t,e){return t+be(xn()*(e-t+1))}function Xr(t,e){var n="";if(!t||e<1||e>d)return n;do{e%2&&(n+=t),(e=be(e/2))&&(t+=t)}while(e);return n}function Zr(t,e){return jo(To(t,e,au),t+"")}function Jr(t){return Jn($s(t))}function Kr(t,e){var n=$s(t);return No(n,sr(e,0,n.length))}function Qr(t,e,r,i){if(!rs(t))return t;for(var o=-1,a=(e=gi(e,t)).length,s=a-1,u=t;null!=u&&++o<a;){var c=Uo(e[o]),f=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return t;if(o!=s){var l=u[c];(f=i?i(l,c,u):n)===n&&(f=rs(l)?l:go(e[o+1])?[]:{})}er(u,c,f),u=u[c]}return t}var ti=En?function(t,e){return En.set(t,e),t}:au,ei=ue?function(t,e){return ue(t,"toString",{configurable:!0,enumerable:!1,value:ru(e),writable:!0})}:au;function ni(t){return No($s(t))}function ri(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=xt(i);++r<i;)o[r]=t[r+e];return o}function ii(t,e){var n;return dr(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n}function oi(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e==e&&i<=2147483647){for(;r<i;){var o=r+i>>>1,a=t[o];null!==a&&!ls(a)&&(n?a<=e:a<e)?r=o+1:i=o}return i}return ai(t,e,au,n)}function ai(t,e,r,i){var o=0,a=null==t?0:t.length;if(0===a)return 0;for(var s=(e=r(e))!=e,u=null===e,c=ls(e),f=e===n;o<a;){var l=be((o+a)/2),d=r(t[l]),h=d!==n,p=null===d,_=d==d,m=ls(d);if(s)var b=i||_;else b=f?_&&(i||h):u?_&&h&&(i||!p):c?_&&h&&!p&&(i||!m):!p&&!m&&(i?d<=e:d<e);b?o=l+1:a=l}return gn(a,4294967294)}function si(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n],s=e?e(a):a;if(!n||!$a(s,u)){var u=s;o[i++]=0===a?0:a}}return o}function ui(t){return"number"==typeof t?t:ls(t)?h:+t}function ci(t){if("string"==typeof t)return t;if(qa(t))return De(t,ci)+"";if(ls(t))return Rn?Rn.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function fi(t,e,n){var r=-1,i=Be,o=t.length,a=!0,s=[],u=s;if(n)a=!1,i=je;else if(o>=200){var c=e?null:Xi(t);if(c)return fn(c);a=!1,i=Qe,u=new Hn}else u=e?[]:s;t:for(;++r<o;){var f=t[r],l=e?e(f):f;if(f=n||0!==f?f:0,a&&l==l){for(var d=u.length;d--;)if(u[d]===l)continue t;e&&u.push(l),s.push(f)}else i(u,l,n)||(u!==s&&u.push(l),s.push(f))}return s}function li(t,e){return null==(t=ko(t,e=gi(e,t)))||delete t[Uo(Qo(e))]}function di(t,e,n,r){return Qr(t,e,n(Ar(t,e)),r)}function hi(t,e,n,r){for(var i=t.length,o=r?i:-1;(r?o--:++o<i)&&e(t[o],o,t););return n?ri(t,r?0:o,r?o+1:i):ri(t,r?o+1:0,r?i:o)}function pi(t,e){var n=t;return n instanceof Yn&&(n=n.value()),Ne(e,(function(t,e){return e.func.apply(e.thisArg,ze([t],e.args))}),n)}function _i(t,e,n){var r=t.length;if(r<2)return r?fi(t[0]):[];for(var i=-1,o=xt(r);++i<r;)for(var a=t[i],s=-1;++s<r;)s!=i&&(o[i]=lr(o[i]||a,t[s],e,n));return fi(br(o,1),e,n)}function mi(t,e,r){for(var i=-1,o=t.length,a=e.length,s={};++i<o;){var u=i<a?e[i]:n;r(s,t[i],u)}return s}function bi(t){return Za(t)?t:[]}function yi(t){return"function"==typeof t?t:au}function gi(t,e){return qa(t)?t:wo(t,e)?[t]:Ro(ws(t))}var vi=Zr;function wi(t,e,r){var i=t.length;return r=r===n?i:r,!e&&r>=i?t:ri(t,e,r)}var xi=le||function(t){return he.clearTimeout(t)};function Ai(t,e){if(e)return t.slice();var n=t.length,r=Gt?Gt(n):new t.constructor(n);return t.copy(r),r}function Si(t){var e=new t.constructor(t.byteLength);return new Wt(e).set(new Wt(t)),e}function Ii(t,e){var n=e?Si(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Oi(t,e){if(t!==e){var r=t!==n,i=null===t,o=t==t,a=ls(t),s=e!==n,u=null===e,c=e==e,f=ls(e);if(!u&&!f&&!a&&t>e||a&&s&&c&&!u&&!f||i&&s&&c||!r&&c||!o)return 1;if(!i&&!a&&!f&&t<e||f&&r&&o&&!i&&!a||u&&r&&o||!s&&o||!c)return-1}return 0}function Ti(t,e,n,r){for(var i=-1,o=t.length,a=n.length,s=-1,u=e.length,c=yn(o-a,0),f=xt(u+c),l=!r;++s<u;)f[s]=e[s];for(;++i<a;)(l||i<o)&&(f[n[i]]=t[i]);for(;c--;)f[s++]=t[i++];return f}function ki(t,e,n,r){for(var i=-1,o=t.length,a=-1,s=n.length,u=-1,c=e.length,f=yn(o-s,0),l=xt(f+c),d=!r;++i<f;)l[i]=t[i];for(var h=i;++u<c;)l[h+u]=e[u];for(;++a<s;)(d||i<o)&&(l[h+n[a]]=t[i++]);return l}function Mi(t,e){var n=-1,r=t.length;for(e||(e=xt(r));++n<r;)e[n]=t[n];return e}function Ei(t,e,r,i){var o=!r;r||(r={});for(var a=-1,s=e.length;++a<s;){var u=e[a],c=i?i(r[u],t[u],u,r,t):n;c===n&&(c=t[u]),o?or(r,u,c):er(r,u,c)}return r}function Bi(t,e){return function(n,r){var i=qa(n)?Oe:rr,o=e?e():{};return i(n,t,uo(r,2),o)}}function ji(t){return Zr((function(e,r){var i=-1,o=r.length,a=o>1?r[o-1]:n,s=o>2?r[2]:n;for(a=t.length>3&&"function"==typeof a?(o--,a):n,s&&vo(r[0],r[1],s)&&(a=o<3?n:a,o=1),e=Tt(e);++i<o;){var u=r[i];u&&t(e,u,i,a)}return e}))}function Di(t,e){return function(n,r){if(null==n)return n;if(!Xa(n))return t(n,r);for(var i=n.length,o=e?i:-1,a=Tt(n);(e?o--:++o<i)&&!1!==r(a[o],o,a););return n}}function zi(t){return function(e,n,r){for(var i=-1,o=Tt(e),a=r(e),s=a.length;s--;){var u=a[t?s:++i];if(!1===n(o[u],u,o))break}return e}}function Ni(t){return function(e){var r=an(e=ws(e))?dn(e):n,i=r?r[0]:e.charAt(0),o=r?wi(r,1).join(""):e.slice(1);return i[t]()+o}}function Fi(t){return function(e){return Ne(tu(Gs(e).replace(Kt,"")),t,"")}}function Ci(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Pn(t.prototype),r=t.apply(n,e);return rs(r)?r:n}}function Li(t){return function(e,r,i){var o=Tt(e);if(!Xa(e)){var a=uo(r,3);e=zs(e),r=function(t){return a(o[t],t,o)}}var s=t(e,r,i);return s>-1?o[a?e[s]:s]:n}}function Ri(t){return no((function(e){var i=e.length,o=i,a=$n.prototype.thru;for(t&&e.reverse();o--;){var s=e[o];if("function"!=typeof s)throw new Et(r);if(a&&!u&&"wrapper"==ao(s))var u=new $n([],!0)}for(o=u?o:i;++o<i;){var c=ao(s=e[o]),f="wrapper"==c?oo(s):n;u=f&&xo(f[0])&&424==f[1]&&!f[4].length&&1==f[9]?u[ao(f[0])].apply(u,f[3]):1==s.length&&xo(s)?u[c]():u.thru(s)}return function(){var t=arguments,n=t[0];if(u&&1==t.length&&qa(n))return u.plant(n).value();for(var r=0,o=i?e[r].apply(this,t):n;++r<i;)o=e[r].call(this,o);return o}}))}function Ui(t,e,r,i,o,a,s,u,f,l){var d=e&c,h=1&e,p=2&e,_=24&e,m=512&e,b=p?n:Ci(t);return function c(){for(var y=arguments.length,g=xt(y),v=y;v--;)g[v]=arguments[v];if(_)var w=so(c),x=function(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}(g,w);if(i&&(g=Ti(g,i,o,_)),a&&(g=ki(g,a,s,_)),y-=x,_&&y<l){var A=cn(g,w);return qi(t,e,Ui,c.placeholder,r,g,A,u,f,l-y)}var S=h?r:this,I=p?S[t]:t;return y=g.length,u?g=function(t,e){var r=t.length,i=gn(e.length,r),o=Mi(t);for(;i--;){var a=e[i];t[i]=go(a,r)?o[a]:n}return t}(g,u):m&&y>1&&g.reverse(),d&&f<y&&(g.length=f),this&&this!==he&&this instanceof c&&(I=b||Ci(I)),I.apply(S,g)}}function Pi(t,e){return function(n,r){return function(t,e,n,r){return vr(t,(function(t,i,o){e(r,n(t),i,o)})),r}(n,t,e(r),{})}}function Vi(t,e){return function(r,i){var o;if(r===n&&i===n)return e;if(r!==n&&(o=r),i!==n){if(o===n)return i;"string"==typeof r||"string"==typeof i?(r=ci(r),i=ci(i)):(r=ui(r),i=ui(i)),o=t(r,i)}return o}}function $i(t){return no((function(e){return e=De(e,Je(uo())),Zr((function(n){var r=this;return t(e,(function(t){return Ie(t,r,n)}))}))}))}function Yi(t,e){var r=(e=e===n?" ":ci(e)).length;if(r<2)return r?Xr(e,t):e;var i=Xr(e,_e(t/ln(e)));return an(e)?wi(dn(i),0,t).join(""):i.slice(0,t)}function Wi(t){return function(e,r,i){return i&&"number"!=typeof i&&vo(e,r,i)&&(r=i=n),e=ms(e),r===n?(r=e,e=0):r=ms(r),function(t,e,n,r){for(var i=-1,o=yn(_e((e-t)/(n||1)),0),a=xt(o);o--;)a[r?o:++i]=t,t+=n;return a}(e,r,i=i===n?e<r?1:-1:ms(i),t)}}function Gi(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=gs(e),n=gs(n)),t(e,n)}}function qi(t,e,r,i,o,a,c,f,l,d){var h=8&e;e|=h?s:u,4&(e&=~(h?u:s))||(e&=-4);var p=[t,e,o,h?a:n,h?c:n,h?n:a,h?n:c,f,l,d],_=r.apply(n,p);return xo(t)&&Eo(_,p),_.placeholder=i,Do(_,t,e)}function Hi(t){var e=Ot[t];return function(t,n){if(t=gs(t),(n=null==n?0:gn(bs(n),292))&&Ge(t)){var r=(ws(t)+"e").split("e");return+((r=(ws(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}var Xi=Tn&&1/fn(new Tn([,-0]))[1]==l?function(t){return new Tn(t)}:lu;function Zi(t){return function(e){var n=_o(e);return n==A?sn(e):n==k?function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t]})),n}(e):function(t,e){return De(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function Ji(t,e,i,l,d,h,p,_){var m=2&e;if(!m&&"function"!=typeof t)throw new Et(r);var b=l?l.length:0;if(b||(e&=-97,l=d=n),p=p===n?p:yn(bs(p),0),_=_===n?_:bs(_),b-=d?d.length:0,e&u){var y=l,g=d;l=d=n}var v=m?n:oo(t),w=[t,e,i,l,d,y,g,h,p,_];if(v&&function(t,e){var n=t[1],r=e[1],i=n|r,a=i<131,s=r==c&&8==n||r==c&&n==f&&t[7].length<=e[8]||384==r&&e[7].length<=e[8]&&8==n;if(!a&&!s)return t;1&r&&(t[2]=e[2],i|=1&n?0:4);var u=e[3];if(u){var l=t[3];t[3]=l?Ti(l,u,e[4]):u,t[4]=l?cn(t[3],o):e[4]}(u=e[5])&&(l=t[5],t[5]=l?ki(l,u,e[6]):u,t[6]=l?cn(t[5],o):e[6]);(u=e[7])&&(t[7]=u);r&c&&(t[8]=null==t[8]?e[8]:gn(t[8],e[8]));null==t[9]&&(t[9]=e[9]);t[0]=e[0],t[1]=i}(w,v),t=w[0],e=w[1],i=w[2],l=w[3],d=w[4],!(_=w[9]=w[9]===n?m?0:t.length:yn(w[9]-b,0))&&24&e&&(e&=-25),e&&1!=e)x=8==e||e==a?function(t,e,r){var i=Ci(t);return function o(){for(var a=arguments.length,s=xt(a),u=a,c=so(o);u--;)s[u]=arguments[u];var f=a<3&&s[0]!==c&&s[a-1]!==c?[]:cn(s,c);return(a-=f.length)<r?qi(t,e,Ui,o.placeholder,n,s,f,n,n,r-a):Ie(this&&this!==he&&this instanceof o?i:t,this,s)}}(t,e,_):e!=s&&33!=e||d.length?Ui.apply(n,w):function(t,e,n,r){var i=1&e,o=Ci(t);return function e(){for(var a=-1,s=arguments.length,u=-1,c=r.length,f=xt(c+s),l=this&&this!==he&&this instanceof e?o:t;++u<c;)f[u]=r[u];for(;s--;)f[u++]=arguments[++a];return Ie(l,i?n:this,f)}}(t,e,i,l);else var x=function(t,e,n){var r=1&e,i=Ci(t);return function e(){return(this&&this!==he&&this instanceof e?i:t).apply(r?n:this,arguments)}}(t,e,i);return Do((v?ti:Eo)(x,w),t,e)}function Ki(t,e,r,i){return t===n||$a(t,Dt[r])&&!Ft.call(i,r)?e:t}function Qi(t,e,r,i,o,a){return rs(t)&&rs(e)&&(a.set(e,t),Vr(t,e,n,Qi,a),a.delete(e)),t}function to(t){return ss(t)?n:t}function eo(t,e,r,i,o,a){var s=1&r,u=t.length,c=e.length;if(u!=c&&!(s&&c>u))return!1;var f=a.get(t),l=a.get(e);if(f&&l)return f==e&&l==t;var d=-1,h=!0,p=2&r?new Hn:n;for(a.set(t,e),a.set(e,t);++d<u;){var _=t[d],m=e[d];if(i)var b=s?i(m,_,d,e,t,a):i(_,m,d,t,e,a);if(b!==n){if(b)continue;h=!1;break}if(p){if(!Ce(e,(function(t,e){if(!Qe(p,e)&&(_===t||o(_,t,r,i,a)))return p.push(e)}))){h=!1;break}}else if(_!==m&&!o(_,m,r,i,a)){h=!1;break}}return a.delete(t),a.delete(e),h}function no(t){return jo(To(t,n,Ho),t+"")}function ro(t){return Sr(t,zs,ho)}function io(t){return Sr(t,Ns,po)}var oo=En?function(t){return En.get(t)}:lu;function ao(t){for(var e=t.name+"",n=Bn[e],r=Ft.call(Bn,e)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==t)return i.name}return e}function so(t){return(Ft.call(Un,"placeholder")?Un:t).placeholder}function uo(){var t=Un.iteratee||su;return t=t===su?Nr:t,arguments.length?t(arguments[0],arguments[1]):t}function co(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function fo(t){for(var e=zs(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Io(i)]}return e}function lo(t,e){var r=function(t,e){return null==t?n:t[e]}(t,e);return zr(r)?r:n}var ho=ye?function(t){return null==t?[]:(t=Tt(t),Ee(ye(t),(function(e){return Xt.call(t,e)})))}:yu,po=ye?function(t){for(var e=[];t;)ze(e,ho(t)),t=qt(t);return e}:yu,_o=Ir;function mo(t,e,n){for(var r=-1,i=(e=gi(e,t)).length,o=!1;++r<i;){var a=Uo(e[r]);if(!(o=null!=t&&n(t,a)))break;t=t[a]}return o||++r!=i?o:!!(i=null==t?0:t.length)&&ns(i)&&go(a,i)&&(qa(t)||Ga(t))}function bo(t){return"function"!=typeof t.constructor||So(t)?{}:Pn(qt(t))}function yo(t){return qa(t)||Ga(t)||!!(Jt&&t&&t[Jt])}function go(t,e){var n=typeof t;return!!(e=null==e?d:e)&&("number"==n||"symbol"!=n&&yt.test(t))&&t>-1&&t%1==0&&t<e}function vo(t,e,n){if(!rs(n))return!1;var r=typeof e;return!!("number"==r?Xa(n)&&go(e,n.length):"string"==r&&e in n)&&$a(n[e],t)}function wo(t,e){if(qa(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!ls(t))||(tt.test(t)||!Q.test(t)||null!=e&&t in Tt(e))}function xo(t){var e=ao(t),n=Un[e];if("function"!=typeof n||!(e in Yn.prototype))return!1;if(t===n)return!0;var r=oo(n);return!!r&&t===r[0]}(Sn&&_o(new Sn(new ArrayBuffer(1)))!=D||In&&_o(new In)!=A||On&&_o(On.resolve())!=O||Tn&&_o(new Tn)!=k||kn&&_o(new kn)!=B)&&(_o=function(t){var e=Ir(t),r=e==I?t.constructor:n,i=r?Po(r):"";if(i)switch(i){case jn:return D;case Dn:return A;case zn:return O;case Nn:return k;case Fn:return B}return e});var Ao=zt?ts:gu;function So(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Dt)}function Io(t){return t==t&&!rs(t)}function Oo(t,e){return function(r){return null!=r&&(r[t]===e&&(e!==n||t in Tt(r)))}}function To(t,e,r){return e=yn(e===n?t.length-1:e,0),function(){for(var n=arguments,i=-1,o=yn(n.length-e,0),a=xt(o);++i<o;)a[i]=n[e+i];i=-1;for(var s=xt(e+1);++i<e;)s[i]=n[i];return s[e]=r(a),Ie(t,this,s)}}function ko(t,e){return e.length<2?t:Ar(t,ri(e,0,-1))}function Mo(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Eo=zo(ti),Bo=pe||function(t,e){return he.setTimeout(t,e)},jo=zo(ei);function Do(t,e,n){var r=e+"";return jo(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(at,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return Te(_,(function(n){var r="_."+n[0];e&n[1]&&!Be(t,r)&&t.push(r)})),t.sort()}(function(t){var e=t.match(st);return e?e[1].split(ut):[]}(r),n)))}function zo(t){var e=0,r=0;return function(){var i=vn(),o=16-(i-r);if(r=i,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(n,arguments)}}function No(t,e){var r=-1,i=t.length,o=i-1;for(e=e===n?i:e;++r<e;){var a=Hr(r,o),s=t[a];t[a]=t[r],t[r]=s}return t.length=e,t}var Fo,Co,Lo,Ro=(Fo=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(et,(function(t,n,r,i){e.push(r?i.replace(lt,"$1"):n||t)})),e},Co=Ca(Fo,(function(t){return 500===Lo.size&&Lo.clear(),t})),Lo=Co.cache,Co);function Uo(t){if("string"==typeof t||ls(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function Po(t){if(null!=t){try{return Nt.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function Vo(t){if(t instanceof Yn)return t.clone();var e=new $n(t.__wrapped__,t.__chain__);return e.__actions__=Mi(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var $o=Zr((function(t,e){return Za(t)?lr(t,br(e,1,Za,!0)):[]})),Yo=Zr((function(t,e){var r=Qo(e);return Za(r)&&(r=n),Za(t)?lr(t,br(e,1,Za,!0),uo(r,2)):[]})),Wo=Zr((function(t,e){var r=Qo(e);return Za(r)&&(r=n),Za(t)?lr(t,br(e,1,Za,!0),n,r):[]}));function Go(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:bs(n);return i<0&&(i=yn(r+i,0)),Ue(t,uo(e,3),i)}function qo(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var o=i-1;return r!==n&&(o=bs(r),o=r<0?yn(i+o,0):gn(o,i-1)),Ue(t,uo(e,3),o,!0)}function Ho(t){return(null==t?0:t.length)?br(t,1):[]}function Xo(t){return t&&t.length?t[0]:n}var Zo=Zr((function(t){var e=De(t,bi);return e.length&&e[0]===t[0]?Mr(e):[]})),Jo=Zr((function(t){var e=Qo(t),r=De(t,bi);return e===Qo(r)?e=n:r.pop(),r.length&&r[0]===t[0]?Mr(r,uo(e,2)):[]})),Ko=Zr((function(t){var e=Qo(t),r=De(t,bi);return(e="function"==typeof e?e:n)&&r.pop(),r.length&&r[0]===t[0]?Mr(r,n,e):[]}));function Qo(t){var e=null==t?0:t.length;return e?t[e-1]:n}var ta=Zr(ea);function ea(t,e){return t&&t.length&&e&&e.length?Gr(t,e):t}var na=no((function(t,e){var n=null==t?0:t.length,r=ar(t,e);return qr(t,De(e,(function(t){return go(t,n)?+t:t})).sort(Oi)),r}));function ra(t){return null==t?t:An.call(t)}var ia=Zr((function(t){return fi(br(t,1,Za,!0))})),oa=Zr((function(t){var e=Qo(t);return Za(e)&&(e=n),fi(br(t,1,Za,!0),uo(e,2))})),aa=Zr((function(t){var e=Qo(t);return e="function"==typeof e?e:n,fi(br(t,1,Za,!0),n,e)}));function sa(t){if(!t||!t.length)return[];var e=0;return t=Ee(t,(function(t){if(Za(t))return e=yn(t.length,e),!0})),Xe(e,(function(e){return De(t,We(e))}))}function ua(t,e){if(!t||!t.length)return[];var r=sa(t);return null==e?r:De(r,(function(t){return Ie(e,n,t)}))}var ca=Zr((function(t,e){return Za(t)?lr(t,e):[]})),fa=Zr((function(t){return _i(Ee(t,Za))})),la=Zr((function(t){var e=Qo(t);return Za(e)&&(e=n),_i(Ee(t,Za),uo(e,2))})),da=Zr((function(t){var e=Qo(t);return e="function"==typeof e?e:n,_i(Ee(t,Za),n,e)})),ha=Zr(sa);var pa=Zr((function(t){var e=t.length,r=e>1?t[e-1]:n;return r="function"==typeof r?(t.pop(),r):n,ua(t,r)}));function _a(t){var e=Un(t);return e.__chain__=!0,e}function ma(t,e){return e(t)}var ba=no((function(t){var e=t.length,r=e?t[0]:0,i=this.__wrapped__,o=function(e){return ar(e,t)};return!(e>1||this.__actions__.length)&&i instanceof Yn&&go(r)?((i=i.slice(r,+r+(e?1:0))).__actions__.push({func:ma,args:[o],thisArg:n}),new $n(i,this.__chain__).thru((function(t){return e&&!t.length&&t.push(n),t}))):this.thru(o)}));var ya=Bi((function(t,e,n){Ft.call(t,n)?++t[n]:or(t,n,1)}));var ga=Li(Go),va=Li(qo);function wa(t,e){return(qa(t)?Te:dr)(t,uo(e,3))}function xa(t,e){return(qa(t)?ke:hr)(t,uo(e,3))}var Aa=Bi((function(t,e,n){Ft.call(t,n)?t[n].push(e):or(t,n,[e])}));var Sa=Zr((function(t,e,n){var r=-1,i="function"==typeof e,o=Xa(t)?xt(t.length):[];return dr(t,(function(t){o[++r]=i?Ie(e,t,n):Er(t,e,n)})),o})),Ia=Bi((function(t,e,n){or(t,n,e)}));function Oa(t,e){return(qa(t)?De:Rr)(t,uo(e,3))}var Ta=Bi((function(t,e,n){t[n?0:1].push(e)}),(function(){return[[],[]]}));var ka=Zr((function(t,e){if(null==t)return[];var n=e.length;return n>1&&vo(t,e[0],e[1])?e=[]:n>2&&vo(e[0],e[1],e[2])&&(e=[e[0]]),Yr(t,br(e,1),[])})),Ma=de||function(){return he.Date.now()};function Ea(t,e,r){return e=r?n:e,e=t&&null==e?t.length:e,Ji(t,c,n,n,n,n,e)}function Ba(t,e){var i;if("function"!=typeof e)throw new Et(r);return t=bs(t),function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=n),i}}var ja=Zr((function(t,e,n){var r=1;if(n.length){var i=cn(n,so(ja));r|=s}return Ji(t,r,e,n,i)})),Da=Zr((function(t,e,n){var r=3;if(n.length){var i=cn(n,so(Da));r|=s}return Ji(e,r,t,n,i)}));function za(t,e,i){var o,a,s,u,c,f,l=0,d=!1,h=!1,p=!0;if("function"!=typeof t)throw new Et(r);function _(e){var r=o,i=a;return o=a=n,l=e,u=t.apply(i,r)}function m(t){var r=t-f;return f===n||r>=e||r<0||h&&t-l>=s}function b(){var t=Ma();if(m(t))return y(t);c=Bo(b,function(t){var n=e-(t-f);return h?gn(n,s-(t-l)):n}(t))}function y(t){return c=n,p&&o?_(t):(o=a=n,u)}function g(){var t=Ma(),r=m(t);if(o=arguments,a=this,f=t,r){if(c===n)return function(t){return l=t,c=Bo(b,e),d?_(t):u}(f);if(h)return xi(c),c=Bo(b,e),_(f)}return c===n&&(c=Bo(b,e)),u}return e=gs(e)||0,rs(i)&&(d=!!i.leading,s=(h="maxWait"in i)?yn(gs(i.maxWait)||0,e):s,p="trailing"in i?!!i.trailing:p),g.cancel=function(){c!==n&&xi(c),l=0,o=f=a=c=n},g.flush=function(){return c===n?u:y(Ma())},g}var Na=Zr((function(t,e){return fr(t,1,e)})),Fa=Zr((function(t,e,n){return fr(t,gs(e)||0,n)}));function Ca(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new Et(r);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(Ca.Cache||qn),n}function La(t){if("function"!=typeof t)throw new Et(r);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}Ca.Cache=qn;var Ra=vi((function(t,e){var n=(e=1==e.length&&qa(e[0])?De(e[0],Je(uo())):De(br(e,1),Je(uo()))).length;return Zr((function(r){for(var i=-1,o=gn(r.length,n);++i<o;)r[i]=e[i].call(this,r[i]);return Ie(t,this,r)}))})),Ua=Zr((function(t,e){var r=cn(e,so(Ua));return Ji(t,s,n,e,r)})),Pa=Zr((function(t,e){var r=cn(e,so(Pa));return Ji(t,u,n,e,r)})),Va=no((function(t,e){return Ji(t,f,n,n,n,e)}));function $a(t,e){return t===e||t!=t&&e!=e}var Ya=Gi(Or),Wa=Gi((function(t,e){return t>=e})),Ga=Br(function(){return arguments}())?Br:function(t){return is(t)&&Ft.call(t,"callee")&&!Xt.call(t,"callee")},qa=xt.isArray,Ha=ge?Je(ge):function(t){return is(t)&&Ir(t)==j};function Xa(t){return null!=t&&ns(t.length)&&!ts(t)}function Za(t){return is(t)&&Xa(t)}var Ja=Le||gu,Ka=ve?Je(ve):function(t){return is(t)&&Ir(t)==g};function Qa(t){if(!is(t))return!1;var e=Ir(t);return e==v||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!ss(t)}function ts(t){if(!rs(t))return!1;var e=Ir(t);return e==w||e==x||"[object AsyncFunction]"==e||"[object Proxy]"==e}function es(t){return"number"==typeof t&&t==bs(t)}function ns(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=d}function rs(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function is(t){return null!=t&&"object"==typeof t}var os=we?Je(we):function(t){return is(t)&&_o(t)==A};function as(t){return"number"==typeof t||is(t)&&Ir(t)==S}function ss(t){if(!is(t)||Ir(t)!=I)return!1;var e=qt(t);if(null===e)return!0;var n=Ft.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Nt.call(n)==Ut}var us=xe?Je(xe):function(t){return is(t)&&Ir(t)==T};var cs=Ae?Je(Ae):function(t){return is(t)&&_o(t)==k};function fs(t){return"string"==typeof t||!qa(t)&&is(t)&&Ir(t)==M}function ls(t){return"symbol"==typeof t||is(t)&&Ir(t)==E}var ds=Se?Je(Se):function(t){return is(t)&&ns(t.length)&&!!ae[Ir(t)]};var hs=Gi(Lr),ps=Gi((function(t,e){return t<=e}));function _s(t){if(!t)return[];if(Xa(t))return fs(t)?dn(t):Mi(t);if(te&&t[te])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[te]());var e=_o(t);return(e==A?sn:e==k?fn:$s)(t)}function ms(t){return t?(t=gs(t))===l||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function bs(t){var e=ms(t),n=e%1;return e==e?n?e-n:e:0}function ys(t){return t?sr(bs(t),0,p):0}function gs(t){if("number"==typeof t)return t;if(ls(t))return h;if(rs(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=rs(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Ze(t);var n=_t.test(t);return n||bt.test(t)?fe(t.slice(2),n?2:8):pt.test(t)?h:+t}function vs(t){return Ei(t,Ns(t))}function ws(t){return null==t?"":ci(t)}var xs=ji((function(t,e){if(So(e)||Xa(e))Ei(e,zs(e),t);else for(var n in e)Ft.call(e,n)&&er(t,n,e[n])})),As=ji((function(t,e){Ei(e,Ns(e),t)})),Ss=ji((function(t,e,n,r){Ei(e,Ns(e),t,r)})),Is=ji((function(t,e,n,r){Ei(e,zs(e),t,r)})),Os=no(ar);var Ts=Zr((function(t,e){t=Tt(t);var r=-1,i=e.length,o=i>2?e[2]:n;for(o&&vo(e[0],e[1],o)&&(i=1);++r<i;)for(var a=e[r],s=Ns(a),u=-1,c=s.length;++u<c;){var f=s[u],l=t[f];(l===n||$a(l,Dt[f])&&!Ft.call(t,f))&&(t[f]=a[f])}return t})),ks=Zr((function(t){return t.push(n,Qi),Ie(Cs,n,t)}));function Ms(t,e,r){var i=null==t?n:Ar(t,e);return i===n?r:i}function Es(t,e){return null!=t&&mo(t,e,kr)}var Bs=Pi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Rt.call(e)),t[e]=n}),ru(au)),js=Pi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Rt.call(e)),Ft.call(t,e)?t[e].push(n):t[e]=[n]}),uo),Ds=Zr(Er);function zs(t){return Xa(t)?Zn(t):Fr(t)}function Ns(t){return Xa(t)?Zn(t,!0):Cr(t)}var Fs=ji((function(t,e,n){Vr(t,e,n)})),Cs=ji((function(t,e,n,r){Vr(t,e,n,r)})),Ls=no((function(t,e){var n={};if(null==t)return n;var r=!1;e=De(e,(function(e){return e=gi(e,t),r||(r=e.length>1),e})),Ei(t,io(t),n),r&&(n=ur(n,7,to));for(var i=e.length;i--;)li(n,e[i]);return n}));var Rs=no((function(t,e){return null==t?{}:function(t,e){return Wr(t,e,(function(e,n){return Es(t,n)}))}(t,e)}));function Us(t,e){if(null==t)return{};var n=De(io(t),(function(t){return[t]}));return e=uo(e),Wr(t,n,(function(t,n){return e(t,n[0])}))}var Ps=Zi(zs),Vs=Zi(Ns);function $s(t){return null==t?[]:Ke(t,zs(t))}var Ys=Fi((function(t,e,n){return e=e.toLowerCase(),t+(n?Ws(e):e)}));function Ws(t){return Qs(ws(t).toLowerCase())}function Gs(t){return(t=ws(t))&&t.replace(gt,nn).replace(Qt,"")}var qs=Fi((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()})),Hs=Fi((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),Xs=Ni("toLowerCase");var Zs=Fi((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}));var Js=Fi((function(t,e,n){return t+(n?" ":"")+Qs(e)}));var Ks=Fi((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),Qs=Ni("toUpperCase");function tu(t,e,r){return t=ws(t),(e=r?n:e)===n?function(t){return re.test(t)}(t)?function(t){return t.match(ee)||[]}(t):function(t){return t.match(ct)||[]}(t):t.match(e)||[]}var eu=Zr((function(t,e){try{return Ie(t,n,e)}catch(r){return Qa(r)?r:new St(r)}})),nu=no((function(t,e){return Te(e,(function(e){e=Uo(e),or(t,e,ja(t[e],t))})),t}));function ru(t){return function(){return t}}var iu=Ri(),ou=Ri(!0);function au(t){return t}function su(t){return Nr("function"==typeof t?t:ur(t,1))}var uu=Zr((function(t,e){return function(n){return Er(n,t,e)}})),cu=Zr((function(t,e){return function(n){return Er(t,n,e)}}));function fu(t,e,n){var r=zs(e),i=xr(e,r);null!=n||rs(e)&&(i.length||!r.length)||(n=e,e=t,t=this,i=xr(e,zs(e)));var o=!(rs(n)&&"chain"in n&&!n.chain),a=ts(t);return Te(i,(function(n){var r=e[n];t[n]=r,a&&(t.prototype[n]=function(){var e=this.__chain__;if(o||e){var n=t(this.__wrapped__);return(n.__actions__=Mi(this.__actions__)).push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,ze([this.value()],arguments))})})),t}function lu(){}var du=$i(De),hu=$i(Me),pu=$i(Ce);function _u(t){return wo(t)?We(Uo(t)):function(t){return function(e){return Ar(e,t)}}(t)}var mu=Wi(),bu=Wi(!0);function yu(){return[]}function gu(){return!1}var vu=Vi((function(t,e){return t+e}),0),wu=Hi("ceil"),xu=Vi((function(t,e){return t/e}),1),Au=Hi("floor");var Su,Iu=Vi((function(t,e){return t*e}),1),Ou=Hi("round"),Tu=Vi((function(t,e){return t-e}),0);return Un.after=function(t,e){if("function"!=typeof e)throw new Et(r);return t=bs(t),function(){if(--t<1)return e.apply(this,arguments)}},Un.ary=Ea,Un.assign=xs,Un.assignIn=As,Un.assignInWith=Ss,Un.assignWith=Is,Un.at=Os,Un.before=Ba,Un.bind=ja,Un.bindAll=nu,Un.bindKey=Da,Un.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return qa(t)?t:[t]},Un.chain=_a,Un.chunk=function(t,e,r){e=(r?vo(t,e,r):e===n)?1:yn(bs(e),0);var i=null==t?0:t.length;if(!i||e<1)return[];for(var o=0,a=0,s=xt(_e(i/e));o<i;)s[a++]=ri(t,o,o+=e);return s},Un.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var o=t[e];o&&(i[r++]=o)}return i},Un.concat=function(){var t=arguments.length;if(!t)return[];for(var e=xt(t-1),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return ze(qa(n)?Mi(n):[n],br(e,1))},Un.cond=function(t){var e=null==t?0:t.length,n=uo();return t=e?De(t,(function(t){if("function"!=typeof t[1])throw new Et(r);return[n(t[0]),t[1]]})):[],Zr((function(n){for(var r=-1;++r<e;){var i=t[r];if(Ie(i[0],this,n))return Ie(i[1],this,n)}}))},Un.conforms=function(t){return function(t){var e=zs(t);return function(n){return cr(n,t,e)}}(ur(t,1))},Un.constant=ru,Un.countBy=ya,Un.create=function(t,e){var n=Pn(t);return null==e?n:ir(n,e)},Un.curry=function t(e,r,i){var o=Ji(e,8,n,n,n,n,n,r=i?n:r);return o.placeholder=t.placeholder,o},Un.curryRight=function t(e,r,i){var o=Ji(e,a,n,n,n,n,n,r=i?n:r);return o.placeholder=t.placeholder,o},Un.debounce=za,Un.defaults=Ts,Un.defaultsDeep=ks,Un.defer=Na,Un.delay=Fa,Un.difference=$o,Un.differenceBy=Yo,Un.differenceWith=Wo,Un.drop=function(t,e,r){var i=null==t?0:t.length;return i?ri(t,(e=r||e===n?1:bs(e))<0?0:e,i):[]},Un.dropRight=function(t,e,r){var i=null==t?0:t.length;return i?ri(t,0,(e=i-(e=r||e===n?1:bs(e)))<0?0:e):[]},Un.dropRightWhile=function(t,e){return t&&t.length?hi(t,uo(e,3),!0,!0):[]},Un.dropWhile=function(t,e){return t&&t.length?hi(t,uo(e,3),!0):[]},Un.fill=function(t,e,r,i){var o=null==t?0:t.length;return o?(r&&"number"!=typeof r&&vo(t,e,r)&&(r=0,i=o),function(t,e,r,i){var o=t.length;for((r=bs(r))<0&&(r=-r>o?0:o+r),(i=i===n||i>o?o:bs(i))<0&&(i+=o),i=r>i?0:ys(i);r<i;)t[r++]=e;return t}(t,e,r,i)):[]},Un.filter=function(t,e){return(qa(t)?Ee:mr)(t,uo(e,3))},Un.flatMap=function(t,e){return br(Oa(t,e),1)},Un.flatMapDeep=function(t,e){return br(Oa(t,e),l)},Un.flatMapDepth=function(t,e,r){return r=r===n?1:bs(r),br(Oa(t,e),r)},Un.flatten=Ho,Un.flattenDeep=function(t){return(null==t?0:t.length)?br(t,l):[]},Un.flattenDepth=function(t,e){return(null==t?0:t.length)?br(t,e=e===n?1:bs(e)):[]},Un.flip=function(t){return Ji(t,512)},Un.flow=iu,Un.flowRight=ou,Un.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},Un.functions=function(t){return null==t?[]:xr(t,zs(t))},Un.functionsIn=function(t){return null==t?[]:xr(t,Ns(t))},Un.groupBy=Aa,Un.initial=function(t){return(null==t?0:t.length)?ri(t,0,-1):[]},Un.intersection=Zo,Un.intersectionBy=Jo,Un.intersectionWith=Ko,Un.invert=Bs,Un.invertBy=js,Un.invokeMap=Sa,Un.iteratee=su,Un.keyBy=Ia,Un.keys=zs,Un.keysIn=Ns,Un.map=Oa,Un.mapKeys=function(t,e){var n={};return e=uo(e,3),vr(t,(function(t,r,i){or(n,e(t,r,i),t)})),n},Un.mapValues=function(t,e){var n={};return e=uo(e,3),vr(t,(function(t,r,i){or(n,r,e(t,r,i))})),n},Un.matches=function(t){return Ur(ur(t,1))},Un.matchesProperty=function(t,e){return Pr(t,ur(e,1))},Un.memoize=Ca,Un.merge=Fs,Un.mergeWith=Cs,Un.method=uu,Un.methodOf=cu,Un.mixin=fu,Un.negate=La,Un.nthArg=function(t){return t=bs(t),Zr((function(e){return $r(e,t)}))},Un.omit=Ls,Un.omitBy=function(t,e){return Us(t,La(uo(e)))},Un.once=function(t){return Ba(2,t)},Un.orderBy=function(t,e,r,i){return null==t?[]:(qa(e)||(e=null==e?[]:[e]),qa(r=i?n:r)||(r=null==r?[]:[r]),Yr(t,e,r))},Un.over=du,Un.overArgs=Ra,Un.overEvery=hu,Un.overSome=pu,Un.partial=Ua,Un.partialRight=Pa,Un.partition=Ta,Un.pick=Rs,Un.pickBy=Us,Un.property=_u,Un.propertyOf=function(t){return function(e){return null==t?n:Ar(t,e)}},Un.pull=ta,Un.pullAll=ea,Un.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?Gr(t,e,uo(n,2)):t},Un.pullAllWith=function(t,e,r){return t&&t.length&&e&&e.length?Gr(t,e,n,r):t},Un.pullAt=na,Un.range=mu,Un.rangeRight=bu,Un.rearg=Va,Un.reject=function(t,e){return(qa(t)?Ee:mr)(t,La(uo(e,3)))},Un.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],o=t.length;for(e=uo(e,3);++r<o;){var a=t[r];e(a,r,t)&&(n.push(a),i.push(r))}return qr(t,i),n},Un.rest=function(t,e){if("function"!=typeof t)throw new Et(r);return Zr(t,e=e===n?e:bs(e))},Un.reverse=ra,Un.sampleSize=function(t,e,r){return e=(r?vo(t,e,r):e===n)?1:bs(e),(qa(t)?Kn:Kr)(t,e)},Un.set=function(t,e,n){return null==t?t:Qr(t,e,n)},Un.setWith=function(t,e,r,i){return i="function"==typeof i?i:n,null==t?t:Qr(t,e,r,i)},Un.shuffle=function(t){return(qa(t)?Qn:ni)(t)},Un.slice=function(t,e,r){var i=null==t?0:t.length;return i?(r&&"number"!=typeof r&&vo(t,e,r)?(e=0,r=i):(e=null==e?0:bs(e),r=r===n?i:bs(r)),ri(t,e,r)):[]},Un.sortBy=ka,Un.sortedUniq=function(t){return t&&t.length?si(t):[]},Un.sortedUniqBy=function(t,e){return t&&t.length?si(t,uo(e,2)):[]},Un.split=function(t,e,r){return r&&"number"!=typeof r&&vo(t,e,r)&&(e=r=n),(r=r===n?p:r>>>0)?(t=ws(t))&&("string"==typeof e||null!=e&&!us(e))&&!(e=ci(e))&&an(t)?wi(dn(t),0,r):t.split(e,r):[]},Un.spread=function(t,e){if("function"!=typeof t)throw new Et(r);return e=null==e?0:yn(bs(e),0),Zr((function(n){var r=n[e],i=wi(n,0,e);return r&&ze(i,r),Ie(t,this,i)}))},Un.tail=function(t){var e=null==t?0:t.length;return e?ri(t,1,e):[]},Un.take=function(t,e,r){return t&&t.length?ri(t,0,(e=r||e===n?1:bs(e))<0?0:e):[]},Un.takeRight=function(t,e,r){var i=null==t?0:t.length;return i?ri(t,(e=i-(e=r||e===n?1:bs(e)))<0?0:e,i):[]},Un.takeRightWhile=function(t,e){return t&&t.length?hi(t,uo(e,3),!1,!0):[]},Un.takeWhile=function(t,e){return t&&t.length?hi(t,uo(e,3)):[]},Un.tap=function(t,e){return e(t),t},Un.throttle=function(t,e,n){var i=!0,o=!0;if("function"!=typeof t)throw new Et(r);return rs(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),za(t,e,{leading:i,maxWait:e,trailing:o})},Un.thru=ma,Un.toArray=_s,Un.toPairs=Ps,Un.toPairsIn=Vs,Un.toPath=function(t){return qa(t)?De(t,Uo):ls(t)?[t]:Mi(Ro(ws(t)))},Un.toPlainObject=vs,Un.transform=function(t,e,n){var r=qa(t),i=r||Ja(t)||ds(t);if(e=uo(e,4),null==n){var o=t&&t.constructor;n=i?r?new o:[]:rs(t)&&ts(o)?Pn(qt(t)):{}}return(i?Te:vr)(t,(function(t,r,i){return e(n,t,r,i)})),n},Un.unary=function(t){return Ea(t,1)},Un.union=ia,Un.unionBy=oa,Un.unionWith=aa,Un.uniq=function(t){return t&&t.length?fi(t):[]},Un.uniqBy=function(t,e){return t&&t.length?fi(t,uo(e,2)):[]},Un.uniqWith=function(t,e){return e="function"==typeof e?e:n,t&&t.length?fi(t,n,e):[]},Un.unset=function(t,e){return null==t||li(t,e)},Un.unzip=sa,Un.unzipWith=ua,Un.update=function(t,e,n){return null==t?t:di(t,e,yi(n))},Un.updateWith=function(t,e,r,i){return i="function"==typeof i?i:n,null==t?t:di(t,e,yi(r),i)},Un.values=$s,Un.valuesIn=function(t){return null==t?[]:Ke(t,Ns(t))},Un.without=ca,Un.words=tu,Un.wrap=function(t,e){return Ua(yi(e),t)},Un.xor=fa,Un.xorBy=la,Un.xorWith=da,Un.zip=ha,Un.zipObject=function(t,e){return mi(t||[],e||[],er)},Un.zipObjectDeep=function(t,e){return mi(t||[],e||[],Qr)},Un.zipWith=pa,Un.entries=Ps,Un.entriesIn=Vs,Un.extend=As,Un.extendWith=Ss,fu(Un,Un),Un.add=vu,Un.attempt=eu,Un.camelCase=Ys,Un.capitalize=Ws,Un.ceil=wu,Un.clamp=function(t,e,r){return r===n&&(r=e,e=n),r!==n&&(r=(r=gs(r))==r?r:0),e!==n&&(e=(e=gs(e))==e?e:0),sr(gs(t),e,r)},Un.clone=function(t){return ur(t,4)},Un.cloneDeep=function(t){return ur(t,5)},Un.cloneDeepWith=function(t,e){return ur(t,5,e="function"==typeof e?e:n)},Un.cloneWith=function(t,e){return ur(t,4,e="function"==typeof e?e:n)},Un.conformsTo=function(t,e){return null==e||cr(t,e,zs(e))},Un.deburr=Gs,Un.defaultTo=function(t,e){return null==t||t!=t?e:t},Un.divide=xu,Un.endsWith=function(t,e,r){t=ws(t),e=ci(e);var i=t.length,o=r=r===n?i:sr(bs(r),0,i);return(r-=e.length)>=0&&t.slice(r,o)==e},Un.eq=$a,Un.escape=function(t){return(t=ws(t))&&X.test(t)?t.replace(q,rn):t},Un.escapeRegExp=function(t){return(t=ws(t))&&rt.test(t)?t.replace(nt,"\\$&"):t},Un.every=function(t,e,r){var i=qa(t)?Me:pr;return r&&vo(t,e,r)&&(e=n),i(t,uo(e,3))},Un.find=ga,Un.findIndex=Go,Un.findKey=function(t,e){return Re(t,uo(e,3),vr)},Un.findLast=va,Un.findLastIndex=qo,Un.findLastKey=function(t,e){return Re(t,uo(e,3),wr)},Un.floor=Au,Un.forEach=wa,Un.forEachRight=xa,Un.forIn=function(t,e){return null==t?t:yr(t,uo(e,3),Ns)},Un.forInRight=function(t,e){return null==t?t:gr(t,uo(e,3),Ns)},Un.forOwn=function(t,e){return t&&vr(t,uo(e,3))},Un.forOwnRight=function(t,e){return t&&wr(t,uo(e,3))},Un.get=Ms,Un.gt=Ya,Un.gte=Wa,Un.has=function(t,e){return null!=t&&mo(t,e,Tr)},Un.hasIn=Es,Un.head=Xo,Un.identity=au,Un.includes=function(t,e,n,r){t=Xa(t)?t:$s(t),n=n&&!r?bs(n):0;var i=t.length;return n<0&&(n=yn(i+n,0)),fs(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&Pe(t,e,n)>-1},Un.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:bs(n);return i<0&&(i=yn(r+i,0)),Pe(t,e,i)},Un.inRange=function(t,e,r){return e=ms(e),r===n?(r=e,e=0):r=ms(r),function(t,e,n){return t>=gn(e,n)&&t<yn(e,n)}(t=gs(t),e,r)},Un.invoke=Ds,Un.isArguments=Ga,Un.isArray=qa,Un.isArrayBuffer=Ha,Un.isArrayLike=Xa,Un.isArrayLikeObject=Za,Un.isBoolean=function(t){return!0===t||!1===t||is(t)&&Ir(t)==y},Un.isBuffer=Ja,Un.isDate=Ka,Un.isElement=function(t){return is(t)&&1===t.nodeType&&!ss(t)},Un.isEmpty=function(t){if(null==t)return!0;if(Xa(t)&&(qa(t)||"string"==typeof t||"function"==typeof t.splice||Ja(t)||ds(t)||Ga(t)))return!t.length;var e=_o(t);if(e==A||e==k)return!t.size;if(So(t))return!Fr(t).length;for(var n in t)if(Ft.call(t,n))return!1;return!0},Un.isEqual=function(t,e){return jr(t,e)},Un.isEqualWith=function(t,e,r){var i=(r="function"==typeof r?r:n)?r(t,e):n;return i===n?jr(t,e,n,r):!!i},Un.isError=Qa,Un.isFinite=function(t){return"number"==typeof t&&Ge(t)},Un.isFunction=ts,Un.isInteger=es,Un.isLength=ns,Un.isMap=os,Un.isMatch=function(t,e){return t===e||Dr(t,e,fo(e))},Un.isMatchWith=function(t,e,r){return r="function"==typeof r?r:n,Dr(t,e,fo(e),r)},Un.isNaN=function(t){return as(t)&&t!=+t},Un.isNative=function(t){if(Ao(t))throw new St("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return zr(t)},Un.isNil=function(t){return null==t},Un.isNull=function(t){return null===t},Un.isNumber=as,Un.isObject=rs,Un.isObjectLike=is,Un.isPlainObject=ss,Un.isRegExp=us,Un.isSafeInteger=function(t){return es(t)&&t>=-9007199254740991&&t<=d},Un.isSet=cs,Un.isString=fs,Un.isSymbol=ls,Un.isTypedArray=ds,Un.isUndefined=function(t){return t===n},Un.isWeakMap=function(t){return is(t)&&_o(t)==B},Un.isWeakSet=function(t){return is(t)&&"[object WeakSet]"==Ir(t)},Un.join=function(t,e){return null==t?"":mn.call(t,e)},Un.kebabCase=qs,Un.last=Qo,Un.lastIndexOf=function(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var o=i;return r!==n&&(o=(o=bs(r))<0?yn(i+o,0):gn(o,i-1)),e==e?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(t,e,o):Ue(t,$e,o,!0)},Un.lowerCase=Hs,Un.lowerFirst=Xs,Un.lt=hs,Un.lte=ps,Un.max=function(t){return t&&t.length?_r(t,au,Or):n},Un.maxBy=function(t,e){return t&&t.length?_r(t,uo(e,2),Or):n},Un.mean=function(t){return Ye(t,au)},Un.meanBy=function(t,e){return Ye(t,uo(e,2))},Un.min=function(t){return t&&t.length?_r(t,au,Lr):n},Un.minBy=function(t,e){return t&&t.length?_r(t,uo(e,2),Lr):n},Un.stubArray=yu,Un.stubFalse=gu,Un.stubObject=function(){return{}},Un.stubString=function(){return""},Un.stubTrue=function(){return!0},Un.multiply=Iu,Un.nth=function(t,e){return t&&t.length?$r(t,bs(e)):n},Un.noConflict=function(){return he._===this&&(he._=Pt),this},Un.noop=lu,Un.now=Ma,Un.pad=function(t,e,n){t=ws(t);var r=(e=bs(e))?ln(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return Yi(be(i),n)+t+Yi(_e(i),n)},Un.padEnd=function(t,e,n){t=ws(t);var r=(e=bs(e))?ln(t):0;return e&&r<e?t+Yi(e-r,n):t},Un.padStart=function(t,e,n){t=ws(t);var r=(e=bs(e))?ln(t):0;return e&&r<e?Yi(e-r,n)+t:t},Un.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),wn(ws(t).replace(it,""),e||0)},Un.random=function(t,e,r){if(r&&"boolean"!=typeof r&&vo(t,e,r)&&(e=r=n),r===n&&("boolean"==typeof e?(r=e,e=n):"boolean"==typeof t&&(r=t,t=n)),t===n&&e===n?(t=0,e=1):(t=ms(t),e===n?(e=t,t=0):e=ms(e)),t>e){var i=t;t=e,e=i}if(r||t%1||e%1){var o=xn();return gn(t+o*(e-t+ce("1e-"+((o+"").length-1))),e)}return Hr(t,e)},Un.reduce=function(t,e,n){var r=qa(t)?Ne:qe,i=arguments.length<3;return r(t,uo(e,4),n,i,dr)},Un.reduceRight=function(t,e,n){var r=qa(t)?Fe:qe,i=arguments.length<3;return r(t,uo(e,4),n,i,hr)},Un.repeat=function(t,e,r){return e=(r?vo(t,e,r):e===n)?1:bs(e),Xr(ws(t),e)},Un.replace=function(){var t=arguments,e=ws(t[0]);return t.length<3?e:e.replace(t[1],t[2])},Un.result=function(t,e,r){var i=-1,o=(e=gi(e,t)).length;for(o||(o=1,t=n);++i<o;){var a=null==t?n:t[Uo(e[i])];a===n&&(i=o,a=r),t=ts(a)?a.call(t):a}return t},Un.round=Ou,Un.runInContext=t,Un.sample=function(t){return(qa(t)?Jn:Jr)(t)},Un.size=function(t){if(null==t)return 0;if(Xa(t))return fs(t)?ln(t):t.length;var e=_o(t);return e==A||e==k?t.size:Fr(t).length},Un.snakeCase=Zs,Un.some=function(t,e,r){var i=qa(t)?Ce:ii;return r&&vo(t,e,r)&&(e=n),i(t,uo(e,3))},Un.sortedIndex=function(t,e){return oi(t,e)},Un.sortedIndexBy=function(t,e,n){return ai(t,e,uo(n,2))},Un.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=oi(t,e);if(r<n&&$a(t[r],e))return r}return-1},Un.sortedLastIndex=function(t,e){return oi(t,e,!0)},Un.sortedLastIndexBy=function(t,e,n){return ai(t,e,uo(n,2),!0)},Un.sortedLastIndexOf=function(t,e){if(null==t?0:t.length){var n=oi(t,e,!0)-1;if($a(t[n],e))return n}return-1},Un.startCase=Js,Un.startsWith=function(t,e,n){return t=ws(t),n=null==n?0:sr(bs(n),0,t.length),e=ci(e),t.slice(n,n+e.length)==e},Un.subtract=Tu,Un.sum=function(t){return t&&t.length?He(t,au):0},Un.sumBy=function(t,e){return t&&t.length?He(t,uo(e,2)):0},Un.template=function(t,e,r){var i=Un.templateSettings;r&&vo(t,e,r)&&(e=n),t=ws(t),e=Ss({},e,i,Ki);var o,a,s=Ss({},e.imports,i.imports,Ki),u=zs(s),c=Ke(s,u),f=0,l=e.interpolate||vt,d="__p += '",h=kt((e.escape||vt).source+"|"+l.source+"|"+(l===K?dt:vt).source+"|"+(e.evaluate||vt).source+"|$","g"),p="//# sourceURL="+(Ft.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++oe+"]")+"\n";t.replace(h,(function(e,n,r,i,s,u){return r||(r=i),d+=t.slice(f,u).replace(wt,on),n&&(o=!0,d+="' +\n__e("+n+") +\n'"),s&&(a=!0,d+="';\n"+s+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),f=u+e.length,e})),d+="';\n";var _=Ft.call(e,"variable")&&e.variable;if(_){if(ft.test(_))throw new St("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(a?d.replace($,""):d).replace(Y,"$1").replace(W,"$1;"),d="function("+(_||"obj")+") {\n"+(_?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var m=eu((function(){return It(u,p+"return "+d).apply(n,c)}));if(m.source=d,Qa(m))throw m;return m},Un.times=function(t,e){if((t=bs(t))<1||t>d)return[];var n=p,r=gn(t,p);e=uo(e),t-=p;for(var i=Xe(r,e);++n<t;)e(n);return i},Un.toFinite=ms,Un.toInteger=bs,Un.toLength=ys,Un.toLower=function(t){return ws(t).toLowerCase()},Un.toNumber=gs,Un.toSafeInteger=function(t){return t?sr(bs(t),-9007199254740991,d):0===t?t:0},Un.toString=ws,Un.toUpper=function(t){return ws(t).toUpperCase()},Un.trim=function(t,e,r){if((t=ws(t))&&(r||e===n))return Ze(t);if(!t||!(e=ci(e)))return t;var i=dn(t),o=dn(e);return wi(i,tn(i,o),en(i,o)+1).join("")},Un.trimEnd=function(t,e,r){if((t=ws(t))&&(r||e===n))return t.slice(0,hn(t)+1);if(!t||!(e=ci(e)))return t;var i=dn(t);return wi(i,0,en(i,dn(e))+1).join("")},Un.trimStart=function(t,e,r){if((t=ws(t))&&(r||e===n))return t.replace(it,"");if(!t||!(e=ci(e)))return t;var i=dn(t);return wi(i,tn(i,dn(e))).join("")},Un.truncate=function(t,e){var r=30,i="...";if(rs(e)){var o="separator"in e?e.separator:o;r="length"in e?bs(e.length):r,i="omission"in e?ci(e.omission):i}var a=(t=ws(t)).length;if(an(t)){var s=dn(t);a=s.length}if(r>=a)return t;var u=r-ln(i);if(u<1)return i;var c=s?wi(s,0,u).join(""):t.slice(0,u);if(o===n)return c+i;if(s&&(u+=c.length-u),us(o)){if(t.slice(u).search(o)){var f,l=c;for(o.global||(o=kt(o.source,ws(ht.exec(o))+"g")),o.lastIndex=0;f=o.exec(l);)var d=f.index;c=c.slice(0,d===n?u:d)}}else if(t.indexOf(ci(o),u)!=u){var h=c.lastIndexOf(o);h>-1&&(c=c.slice(0,h))}return c+i},Un.unescape=function(t){return(t=ws(t))&&H.test(t)?t.replace(G,pn):t},Un.uniqueId=function(t){var e=++Ct;return ws(t)+e},Un.upperCase=Ks,Un.upperFirst=Qs,Un.each=wa,Un.eachRight=xa,Un.first=Xo,fu(Un,(Su={},vr(Un,(function(t,e){Ft.call(Un.prototype,e)||(Su[e]=t)})),Su),{chain:!1}),Un.VERSION="4.17.21",Te(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){Un[t].placeholder=Un})),Te(["drop","take"],(function(t,e){Yn.prototype[t]=function(r){r=r===n?1:yn(bs(r),0);var i=this.__filtered__&&!e?new Yn(this):this.clone();return i.__filtered__?i.__takeCount__=gn(r,i.__takeCount__):i.__views__.push({size:gn(r,p),type:t+(i.__dir__<0?"Right":"")}),i},Yn.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),Te(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=1==n||3==n;Yn.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:uo(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}})),Te(["head","last"],(function(t,e){var n="take"+(e?"Right":"");Yn.prototype[t]=function(){return this[n](1).value()[0]}})),Te(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");Yn.prototype[t]=function(){return this.__filtered__?new Yn(this):this[n](1)}})),Yn.prototype.compact=function(){return this.filter(au)},Yn.prototype.find=function(t){return this.filter(t).head()},Yn.prototype.findLast=function(t){return this.reverse().find(t)},Yn.prototype.invokeMap=Zr((function(t,e){return"function"==typeof t?new Yn(this):this.map((function(n){return Er(n,t,e)}))})),Yn.prototype.reject=function(t){return this.filter(La(uo(t)))},Yn.prototype.slice=function(t,e){t=bs(t);var r=this;return r.__filtered__&&(t>0||e<0)?new Yn(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),e!==n&&(r=(e=bs(e))<0?r.dropRight(-e):r.take(e-t)),r)},Yn.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Yn.prototype.toArray=function(){return this.take(p)},vr(Yn.prototype,(function(t,e){var r=/^(?:filter|find|map|reject)|While$/.test(e),i=/^(?:head|last)$/.test(e),o=Un[i?"take"+("last"==e?"Right":""):e],a=i||/^find/.test(e);o&&(Un.prototype[e]=function(){var e=this.__wrapped__,s=i?[1]:arguments,u=e instanceof Yn,c=s[0],f=u||qa(e),l=function(t){var e=o.apply(Un,ze([t],s));return i&&d?e[0]:e};f&&r&&"function"==typeof c&&1!=c.length&&(u=f=!1);var d=this.__chain__,h=!!this.__actions__.length,p=a&&!d,_=u&&!h;if(!a&&f){e=_?e:new Yn(this);var m=t.apply(e,s);return m.__actions__.push({func:ma,args:[l],thisArg:n}),new $n(m,d)}return p&&_?t.apply(this,s):(m=this.thru(l),p?i?m.value()[0]:m.value():m)})})),Te(["pop","push","shift","sort","splice","unshift"],(function(t){var e=Bt[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);Un.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(qa(i)?i:[],t)}return this[n]((function(n){return e.apply(qa(n)?n:[],t)}))}})),vr(Yn.prototype,(function(t,e){var n=Un[e];if(n){var r=n.name+"";Ft.call(Bn,r)||(Bn[r]=[]),Bn[r].push({name:e,func:n})}})),Bn[Ui(n,2).name]=[{name:"wrapper",func:n}],Yn.prototype.clone=function(){var t=new Yn(this.__wrapped__);return t.__actions__=Mi(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Mi(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Mi(this.__views__),t},Yn.prototype.reverse=function(){if(this.__filtered__){var t=new Yn(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Yn.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=qa(t),r=e<0,i=n?t.length:0,o=function(t,e,n){var r=-1,i=n.length;for(;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=gn(e,t+a);break;case"takeRight":t=yn(t,e-a)}}return{start:t,end:e}}(0,i,this.__views__),a=o.start,s=o.end,u=s-a,c=r?s:a-1,f=this.__iteratees__,l=f.length,d=0,h=gn(u,this.__takeCount__);if(!n||!r&&i==u&&h==u)return pi(t,this.__actions__);var p=[];t:for(;u--&&d<h;){for(var _=-1,m=t[c+=e];++_<l;){var b=f[_],y=b.iteratee,g=b.type,v=y(m);if(2==g)m=v;else if(!v){if(1==g)continue t;break t}}p[d++]=m}return p},Un.prototype.at=ba,Un.prototype.chain=function(){return _a(this)},Un.prototype.commit=function(){return new $n(this.value(),this.__chain__)},Un.prototype.next=function(){this.__values__===n&&(this.__values__=_s(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?n:this.__values__[this.__index__++]}},Un.prototype.plant=function(t){for(var e,r=this;r instanceof Vn;){var i=Vo(r);i.__index__=0,i.__values__=n,e?o.__wrapped__=i:e=i;var o=i;r=r.__wrapped__}return o.__wrapped__=t,e},Un.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof Yn){var e=t;return this.__actions__.length&&(e=new Yn(this)),(e=e.reverse()).__actions__.push({func:ma,args:[ra],thisArg:n}),new $n(e,this.__chain__)}return this.thru(ra)},Un.prototype.toJSON=Un.prototype.valueOf=Un.prototype.value=function(){return pi(this.__wrapped__,this.__actions__)},Un.prototype.first=Un.prototype.head,te&&(Un.prototype[te]=function(){return this}),Un}();_e?((_e.exports=_n)._=_n,pe._=_n):he._=_n}).call(mn)}({get exports(){return xa},set exports(t){xa=t}},xa);const Aa={sqrt:function(){return oa.apply(null,arguments).exponent(.5)},log:function t(){const e=ta(Mo()).domain([1,10]);return e.copy=()=>ko(e,t()).base(e.base()),yo.apply(e,arguments),e},linear:qo,literal:function t(e){var n;function r(t){return null==t||isNaN(t=+t)?n:t}return r.invert=r,r.domain=r.range=function(t){return arguments.length?(e=Array.from(t,xo),r):e.slice()},r.unknown=function(t){return arguments.length?(n=t,r):n},r.copy=function(){return t(e).unknown(n)},e=arguments.length?Array.from(e,xo):[0,1],Go(r)}};class Sa{constructor(t,e,n,r){if(this.field=null,this._texture_buffer=null,this.partner=null,this._textures={},this.current_encoding=null,this.aesthetic_map=r,void 0===this.aesthetic_map)throw new Error("Aesthetic map is undefined");this.scatterplot=t,this.regl=e,this._range=[0,1],this.dataset=n,this.id=Math.random().toString()}apply(t){return void 0===this.scale?this.default_constant:this.scale(this.value_for(t))}get transform(){return this._transform?this._transform:this.default_transform}set transform(t){this._transform=t}get scale(){if(this._scale)return this._scale;if(this.is_dictionary()){console.warn("Dictionary scales only supported for colors");const t=wo().domain(this.domain);return this._scale=t.range(this.range)}const t=Aa[this.transform]();return t.domain(this.domain).range(this.range),this._scale=t}get column(){var t,e;if(null===this.field)throw new Error("Can't retrieve column for aesthetic without a field");if(null==(e=null==(t=this.dataset)?void 0:t.root_tile)?void 0:e.record_batch){const t=this.dataset.root_tile.record_batch.getChild(this.field);if(null==t)throw new Error("Can't find column "+this.field);return t}throw new Error("Table is null")}get default_domain(){var t;if(null==this.field)return[1,1];if(!this.scatterplot._root._schema)return[1,1];const{column:e}=this;return e?void 0!==(null==(t=e.type)?void 0:t.dictionary)?[-2047,Math.floor(this.aesthetic_map.texture_size/2)-1]:(this.dataset.domain(this.field),this.dataset.domain(this.field)):[1,1]}default_data(){const t=this.toGLType(this.default_constant);return Array(this.aesthetic_map.texture_size).fill(t)}get webGLDomain(){return this.is_dictionary()?[-2047,2047]:this.domain}get domain(){return void 0===this._domain&&(this._domain=this.default_domain),this._domain||this.default_domain}get range(){return this._range||this.default_range}value_for(t){return this.field&&t[this.field]?t[this.field]:null}get map_position(){return 0===this.use_map_on_regl?0:this.aesthetic_map.get_position(this.id)}get texture_buffer(){return this._texture_buffer||(this._texture_buffer=new Float32Array(this.aesthetic_map.texture_size),this._texture_buffer.set(this.default_data())),this._texture_buffer}post_to_regl_buffer(){this.aesthetic_map.set_one_d(this.id,this.texture_buffer)}convert_string_encoding(t){return{field:t,domain:this.default_domain,range:this.default_range}}complete_domain(t){return t.domain=t.domain||this.default_domain,t}reset_to_defaults(){this._domain=this.default_domain,this._range=[0,1],this._transform=void 0,this._constant=this.default_constant,this.field=null,this.current_encoding=null,this._scale=void 0}update(t){if(void 0!==t){if(null===t||"null"===t)return this.current_encoding=null,void this.reset_to_defaults();if(this._scale=void 0,"string"==typeof t&&(t=this.convert_string_encoding(t)),xa.isNumber(t)){const e={constant:t};this.current_encoding=e}else{if(0===Object.keys(t).length)return console.warn("Resetting parameters with an empty object is deprecated: use 'null'"),void this.reset_to_defaults();if(this.current_encoding=t,!wa(t)&&(this.field=t.field,!ga(t)))if(va(t)){const{lambda:e,field:n}=t;e&&(this.apply_function_for_textures(n,this.domain,e),this.post_to_regl_buffer())}else void 0===t.domain&&(t.domain=this.default_domain),t.range&&(this._domain=t.domain,this._range=t.range),this._transform=t.transform||void 0}}else console.warn("Should never be calling update with undefined.")}encode_for_textures(t){const{texture_size:e}=this.aesthetic_map,n=Array(e),r=Aa[this.transform]().range(t).domain([0,e-1]);for(let i=0;i<e;i+=1)n[i]=r(i)}arrow_column(){if(null===this.field)throw new Error("Can't retrieve column for aesthetic without a field");const t=this.dataset.root_tile.record_batch.getChild(this.field);if(null===t)throw new Error(`No column ${this.field} on arrow table for aesthetic`);return t}is_dictionary(){var t,e;return null!==this.field&&void 0!==this.field&&void 0!==(null==(e=null==(t=this.arrow_column())?void 0:t.type)?void 0:e.dictionary)}get constant(){return null!==this.current_encoding&&wa(this.current_encoding)?this.toGLType(this.current_encoding.constant):this.toGLType(this.default_constant)}get use_map_on_regl(){return this.is_dictionary()?1:0}materialize_function(t){const e="string"==typeof t?function(t){if("function"==typeof t.lambda)throw"Must pass a string to lambda, not a function.";const{lambda:e,field:n}=t;if(void 0===n)throw"Must pass a field to lambda.";const r=Ba(e).lambda,[i,o]=r.split("=>",2).map((t=>t.trim())),a=new Function(i,o);return a}(Ba(t)):t;return this._func=e,e}apply_function_for_textures(t,e,n){var r;const{texture_size:i}=this.aesthetic_map,o=this.materialize_function(n);let a=Nt(i);if(void 0===t||void 0===this.dataset.root_tile.record_batch)return void 0===t&&console.warn("SETTING EMPTY FIELD"),void 0===this.dataset.root_tile.record_batch&&console.warn("SETTING EMPTY TABLE"),void this.texture_buffer.set(Nt(i).map((t=>1)));const{column:s}=this;if(!s)throw new Error(`Column ${t} does not exist on table.`);if(null==(r=null==s?void 0:s.type)?void 0:r.dictionary){a.fill("");const t=s.data[0].dictionary.toArray();for(const[e,n]of t.entries())a[e]=n}else a=a.map((t=>this.scale(t)));const u=a.map((t=>o(t)));this.texture_buffer.set(u)}}class Ia extends Sa{constructor(t,e,n,r){super(t,e,n,r),this.current_encoding=null}toGLType(t){return t}static get_default_domain(){return[0,1]}get default_domain(){return[0,1]}}class Oa extends Ia{constructor(t,e,n,r){super(t,e,n,r),this.default_range=[-1,1],this.default_constant=0,this.default_transform="literal",this._constant=0,this._transform="literal"}get range(){return this._range?this._range:this.dataset.extent&&this.field&&this.dataset.extent[this.field]?this.dataset.extent[this.field]:this.default_range}static get default_constant(){return 0}}class Ta extends Oa{constructor(){super(...arguments),this.field="x"}}class ka extends Oa{constructor(){super(...arguments),this.field="y"}}class Ma extends Sa{constructor(t,e,n,r){super(t,e,n,r)}toGLType(t){return t?1:0}update(t){super.update(t),null!==this.current_encoding&&0===Object.keys(this.current_encoding).length&&(this.current_encoding=null)}ops_to_array(){const t=this.current_encoding;if(null===t)return[0,0,0];if(void 0===t)return[0,0,0];if(!ga(t))return[0,0,0];if("within"===t.op)return[4,t.a,t.b];if("between"===t.op)return[4,(t.b-t.a)/2,(t.b+t.a)/2];return[[null,"lt","gt","eq"].indexOf(t.op),t.a,0]}apply(t){const e=this.current_encoding;if(null==e)return!0;if(ga(e))return this.apply_op(t,e);if(wa(e))return 0!==e.constant;if(va(e)){if(void 0===this._func)throw new Error("_func should have been bound"+JSON.stringify(this.current_encoding));const e=this.value_for(t);return null!==e&&!!this._func(e)}return!0}apply_op(t,e){const{op:n,a:r}=e,i=this.value_for(t);if(null===i)return!1;if("eq"===n)return i==r;if("gt"===n)return i>r;if("lt"===n)return i<r;if("within"===n)return Math.abs(i-e.b)<r;if("between"===n){const t=(e.a+e.b)/2,n=Math.abs(e.a-e.b)/2;return Math.abs(i-t)<n}return!1}get default_domain(){return[0,1]}}class Ea extends Ma{constructor(){super(...arguments),this.current_encoding=null,this._constant=1,this.default_constant=1,this.default_transform="literal",this.default_range=[0,1]}}function Ba(t){let[e,n]=t.split("=>").map((t=>t.trim()));if(void 0===n)throw new Error(`Couldn't parse ${t} into a function`);"{"!==n.slice(0,1)&&"return"!==n.slice(0,6)&&(n=`return ${n}`);return{field:e,lambda:`${e} => ${n}`}}function ja(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(6*r,6*++r);return n}const Da=ja("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),za=ja("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),Na=ja("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),Fa=ja("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),Ca=ja("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),La=ja("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),Ra=ja("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),Ua=ja("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),Pa=ja("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),Va=ja("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab"),$a=t=>Qr(t[t.length-1]);var Ya=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(ja);const Wa=$a(Ya);var Ga=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(ja);const qa=$a(Ga);var Ha=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(ja);const Xa=$a(Ha);var Za=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(ja);const Ja=$a(Za);var Ka=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(ja);const Qa=$a(Ka);var ts=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(ja);const es=$a(ts);var ns=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(ja);const rs=$a(ns);var is=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(ja);const os=$a(is);var as=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(ja);const ss=$a(as);var us=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(ja);const cs=$a(us);var fs=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(ja);const ls=$a(fs);var ds=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(ja);const hs=$a(ds);var ps=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(ja);const _s=$a(ps);var ms=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(ja);const bs=$a(ms);var ys=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(ja);const gs=$a(ys);var vs=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(ja);const ws=$a(vs);var xs=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(ja);const As=$a(xs);var Ss=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(ja);const Is=$a(Ss);var Os=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(ja);const Ts=$a(Os);var ks=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(ja);const Ms=$a(ks);var Es=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(ja);const Bs=$a(Es);var js=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(ja);const Ds=$a(js);var zs=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(ja);const Ns=$a(zs);var Fs=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(ja);const Cs=$a(Fs);var Ls=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(ja);const Rs=$a(Ls);var Us=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(ja);const Ps=$a(Us);var Vs=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(ja);const $s=$a(Vs);const Ys=vi(Wr(300,.5,0),Wr(-240,.5,1));var Ws=vi(Wr(-100,.75,.35),Wr(80,1.5,.8)),Gs=vi(Wr(260,.75,.35),Wr(80,1.5,.8)),qs=Wr();var Hs=xr(),Xs=Math.PI/3,Zs=2*Math.PI/3;function Js(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}const Ks=Js(ja("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var Qs=Js(ja("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),tu=Js(ja("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),eu=Js(ja("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));const nu=Object.freeze(Object.defineProperty({__proto__:null,interpolateBlues:Ds,interpolateBrBG:Wa,interpolateBuGn:cs,interpolateBuPu:ls,interpolateCividis:function(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-t*(35.34-t*(2381.73-t*(6402.7-t*(7024.72-2710.57*t)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+t*(170.73+t*(52.82-t*(131.46-t*(176.58-67.37*t)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+t*(442.36-t*(2482.43-t*(6167.24-t*(6614.94-2475.67*t)))))))+")"},interpolateCool:Gs,interpolateCubehelixDefault:Ys,interpolateGnBu:hs,interpolateGreens:Ns,interpolateGreys:Cs,interpolateInferno:tu,interpolateMagma:Qs,interpolateOrRd:_s,interpolateOranges:$s,interpolatePRGn:qa,interpolatePiYG:Xa,interpolatePlasma:eu,interpolatePuBu:gs,interpolatePuBuGn:bs,interpolatePuOr:Ja,interpolatePuRd:ws,interpolatePurples:Rs,interpolateRainbow:function(t){(t<0||t>1)&&(t-=Math.floor(t));var e=Math.abs(t-.5);return qs.h=360*t-100,qs.s=1.5-1.5*e,qs.l=.8-.9*e,qs+""},interpolateRdBu:Qa,interpolateRdGy:es,interpolateRdPu:As,interpolateRdYlBu:rs,interpolateRdYlGn:os,interpolateReds:Ps,interpolateSinebow:function(t){var e;return t=(.5-t)*Math.PI,Hs.r=255*(e=Math.sin(t))*e,Hs.g=255*(e=Math.sin(t+Xs))*e,Hs.b=255*(e=Math.sin(t+Zs))*e,Hs+""},interpolateSpectral:ss,interpolateTurbo:function(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+t*(1172.33-t*(10793.56-t*(33300.12-t*(38394.49-14825.05*t)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+t*(557.33+t*(1225.33-t*(3574.96-t*(1073.77+707.56*t)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+t*(3211.1-t*(15327.97-t*(27814-t*(22569.18-6838.66*t)))))))+")"},interpolateViridis:Ks,interpolateWarm:Ws,interpolateYlGn:Ts,interpolateYlGnBu:Is,interpolateYlOrBr:Ms,interpolateYlOrRd:Bs,schemeAccent:za,schemeBlues:js,schemeBrBG:Ya,schemeBuGn:us,schemeBuPu:fs,schemeCategory10:Da,schemeDark2:Na,schemeGnBu:ds,schemeGreens:zs,schemeGreys:Fs,schemeOrRd:ps,schemeOranges:Vs,schemePRGn:Ga,schemePaired:Fa,schemePastel1:Ca,schemePastel2:La,schemePiYG:Ha,schemePuBu:ys,schemePuBuGn:ms,schemePuOr:Za,schemePuRd:vs,schemePurples:Ls,schemeRdBu:Ka,schemeRdGy:ts,schemeRdPu:xs,schemeRdYlBu:ns,schemeRdYlGn:is,schemeReds:Us,schemeSet1:Ra,schemeSet2:Ua,schemeSet3:Pa,schemeSpectral:as,schemeTableau10:Va,schemeYlGn:Os,schemeYlGnBu:Ss,schemeYlOrBr:ks,schemeYlOrRd:Es},Symbol.toStringTag,{value:"Module"})),ru=1664525,iu=1013904223,ou=1/4294967296;function au(t=Math.random()){let e=0|(0<=t&&t<1?t/ou:Math.abs(t));return()=>(e=ru*e+iu|0,ou*(e>>>0))}const su=4096;function uu(t){const e=new Uint8Array(4*su);return Nt(su).forEach((n=>{const r=xr(t(n/su));e.set([r.r,r.g,r.b,255],4*n)})),e}const cu={white:new Uint8Array(4*su).fill(255)},fu={};function lu(t){const e=t.map((t=>{const e=xr(t);return[e.r,e.g,e.b,255]})),n=new Uint8Array(4*su);for(let r=0;r<su;r++)n.set(e[r%t.length],4*r);return n}for(const H_ of["schemeAccent","schemeCategory10","schemeDark2","schemePaired","schemePastel1","schemePastel2","schemeSet1","schemeSet2","schemeSet3","schemeTableau10"]){const t=nu[H_],e=H_.replace("scheme","").toLowerCase();cu[e]=lu(t),fu[e]=t}for(const H_ of["interpolateBlues","interpolateBrBG","interpolateBuGn","interpolateBuPu","interpolateCividis","interpolateCool","interpolateCubehelixDefault","interpolateGnBu","interpolateGreens","interpolateGreys","interpolateInferno","interpolateMagma","interpolateOrRd","interpolateOranges","interpolatePRGn","interpolatePiYG","interpolatePlasma","interpolatePuBu","interpolatePuBuGn","interpolatePuOr","interpolatePuRd","interpolatePurples","interpolateRainbow","interpolateRdBu","interpolateRdGy","interpolateRdPu","interpolateRdYlBu","interpolateRdYlGn","interpolateReds","interpolateSinebow","interpolateSpectral","interpolateTurbo","interpolateViridis","interpolateWarm","interpolateYlGn","interpolateYlGnBu","interpolateYlOrBr","interpolateYlOrRd"]){const t=H_.replace("interpolate","").toLowerCase(),e=nu[H_];if(cu[t]=uu(e),"rainbow"===t){const e=Ft(au(1));cu.shufbow=e(cu[t])}}!function(){const t=["#E69F00","#CC79A7","#56B4E9","#009E73","#0072B2","#D55E00","#F0E442"];cu.okabe=lu(t),fu.okabe=t}();const du={size:class extends Ia{constructor(){super(...arguments),this._constant=1,this.default_constant=1,this.default_transform="sqrt"}static get default_constant(){return 1.5}get default_range(){return[0,1]}},jitter_speed:class extends Ia{constructor(){super(...arguments),this.default_transform="linear",this.default_range=[0,1],this.default_constant=.5,this._constant=0}},jitter_radius:class extends Sa{constructor(){super(...arguments),this._constant=0,this.jitter_int_formatted=0,this.default_transform="linear",this._method="None"}toGLType(t){return t}get default_constant(){return 0}get default_range(){return[0,1]}get method(){var t,e;return null!=(e=null==(t=this.current_encoding)?void 0:t.method)?e:"None"}set method(t){this._method=t}get jitter_int_format(){return"spiral"===(t=this.method)?1:"uniform"===t?2:"normal"===t?3:"circle"===t?4:"time"===t?5:0;var t}},color:class extends Sa{constructor(){super(...arguments),this._constant="#CC5500",this.texture_type="uint8",this.default_constant="#CC5500",this.default_transform="linear",this.current_encoding=null}get default_range(){return[0,1]}default_data(){return cu.viridis}get use_map_on_regl(){return 1}get scale(){if(this._scale)return this._scale;Aa[this.transform]().domain(this.domain).range(this.range);const t=this.range;if(this.is_dictionary()){const e=wo().domain(this.domain);if("string"==typeof t&&fu[t]){if(null===this.column.data[0].dictionary)throw new Error("Dictionary is null");return this._scale=e.range(fu[t]).domain(this.column.data[0].dictionary.toArray())}return this._scale=e.range(this.range)}if("string"==typeof t){const n=nu["interpolate"+(e=t,"ylorrd"===e?"YlOrRd":e.charAt(0).toUpperCase()+e.slice(1))];if(void 0!==n)return"sqrt"===this.transform?this._scale=fa(n).exponent(.5).domain(this.domain):"log"===this.transform?this._scale=ca(n).domain(this.domain):this._scale=ua(n).domain(this.domain)}var e}get texture_buffer(){return this._texture_buffer||(this._texture_buffer=new Uint8Array(4*this.aesthetic_map.texture_size),this._texture_buffer.set(this.default_data())),this._texture_buffer}post_to_regl_buffer(){this.aesthetic_map.set_color(this.id,this.texture_buffer)}update(t){super.update(t),this.current_encoding=t,null===t&&(t={constant:this.default_constant}),wa(t)||(t.range&&"string"==typeof t.range[0]?(this.encode_for_textures(t.range),this.post_to_regl_buffer()):t.range&&this.post_to_regl_buffer())}toGLType(t){const{r:e,g:n,b:r}=xr(t);return[e/255,n/255,r/255]}encode_for_textures(t){if(Array.isArray(t)){const e=t.join("/");if(cu[e])return void this.texture_buffer.set(cu[e]);{let e;if(this.is_dictionary()){const n=this.column.data[0].dictionary.toArray(),r=Object.fromEntries(n.map(((t,e)=>[t,e]))),i=[];for(let e=0;e<this.domain.length;e++){const n=this.domain[e],o=t[e];void 0!==r[n]&&(i[r[n]]=o)}for(let t=0;t<n.length;t++)void 0===i[t]&&(i[t]="gray");e=lu(i)}else e=lu(t);return void this.texture_buffer.set(e)}}cu[t]?this.texture_buffer.set(cu[t]):(t.length===4*this.aesthetic_map.texture_size&&(console.warn("SETTING FULL RANGE IS DEPRECATED,"),this.texture_buffer.set(t)),console.error(`request range of ${t} for color ${this.field} unknown`))}},filter:Ea,filter2:Ea,x:Ta,y:ka,x0:class extends Ta{},y0:class extends ka{},foreground:class extends Ma{constructor(){super(...arguments),this.current_encoding=null,this._constant=1,this.default_constant=1,this.default_range=[0,1],this.default_transform="literal"}get active(){return null!==this.current_encoding&&!wa(this.current_encoding)}}};class hu{constructor(t,e,n,r,i){if(this.needs_transitions=!1,void 0===r)throw new Error("Aesthetic map is undefined.");this.scatterplot=t,this.regl=e,this.dataset=n,this.aesthetic_map=r,this.states=[new i(this.scatterplot,this.regl,this.dataset,this.aesthetic_map),new i(this.scatterplot,this.regl,this.dataset,this.aesthetic_map)]}get current(){return this.states[0]}get last(){return this.states[1]}update(t){JSON.stringify(t)===JSON.stringify(this.states[0].current_encoding)||void 0===t?(this.needs_transitions&&this.states[1].update(this.states[0].current_encoding),this.needs_transitions=!1):(this.states.reverse(),this.states[0].update(t),this.needs_transitions=!0)}}class pu{constructor(t,e,n){return this.encoding={},this.scatterplot=t,this.store={},this.regl=e,this.tileSet=n,this.position_interpolation=!1,this.aesthetic_map=new _u(this.regl),this}dim(t){if(this.store[t])return this.store[t];if(!du[t])throw new Error(`Unknown aesthetic ${t}`);const e=du[t],n=this.scatterplot,r=this.regl,i=this.aesthetic_map,o=new hu(n,r,this.tileSet,i,e);return this.store[t]=o,o}*[Symbol.iterator](){for(const[t,e]of Object.entries(this.store))yield[t,e]}interpret_position(t){if(t){t.x0||t.position0?this.position_interpolation=!0:(t.x||t.position)&&(this.position_interpolation=!1);for(const e of["position","position0"]){const n=e.replace("position","");if(t[e]){if("literal"===t[e])t[`x${n}`]={field:"x",transform:"literal"},t[`y${n}`]={field:"y",transform:"literal"};else{const r=t[e];t[`x${n}`]={field:`${r}.x`,transform:"literal"},t[`y${n}`]={field:`${r}.y`,transform:"literal"}}delete t[e]}}}delete t.position,delete t.position0}apply_encoding(t){if(void 0===t&&(t={}),t.filter1)throw new Error('filter1 is not supported; just say "filter"');this.interpret_position(t);for(const e of Object.keys(du))this.dim(e).update(t[e])}}class _u{constructor(t,e=4096){this.id_locs={},this.offsets={},this.texture_size=e,this.texture_widths=32,this.regl=t,this._one_d_position=1,this._color_position=-1}get_position(t){return this.offsets[t]||0}set_one_d(t,e){let n;const{offsets:r}=this;r[t]?n=r[t]:(n=this._one_d_position++,r[t]=n),this.one_d_texture.subimage({data:e,width:1,height:this.texture_size},n,0)}set_color(t,e){let n;const{offsets:r}=this;r[t]?n=r[t]:(n=this._color_position--,r[t]=n),this.color_texture.subimage({data:e,width:1,height:this.texture_size},-n-1,0)}get one_d_texture(){if(this._one_d_texture)return this._one_d_texture;const t=this.regl.hasExtension("OES_texture_float")?"float":this.regl.hasExtension("OES_texture_half_float")?"half float":"uint8",e="uint8"===t?"rgba":"alpha",n={width:this.texture_widths,height:this.texture_size,type:t,format:e};return this._one_d_texture=this.regl.texture(n),this._one_d_texture}get color_texture(){return this._color_texture||(this._color_texture=this.regl.texture({width:this.texture_widths,height:this.texture_size,type:"uint8",format:"rgba"})),this._color_texture}}class mu extends ya{constructor(t,e,n){super(t,e,n),this.buffer_size=67108864,this._use_scale_to_download_tiles=!0,this.fbos={},this.textures={};const r=this.canvas;if(void 0===this.canvas)throw new Error("No canvas found");this.regl=da({optionalExtensions:["OES_standard_derivatives","OES_element_index_uint","OES_texture_float","OES_texture_half_float"],canvas:r}),this.tileSet=e,this.aes=new pu(n,this.regl,e),this.initialize_textures(),this._initializations=[this.tileSet.promise.then((()=>{this.remake_renderer(),this._webgl_scale_history=[this.default_webgl_scale,this.default_webgl_scale]}))],this.initialize(),this._buffers=new yu(this.regl,this.buffer_size)}get buffers(){return this._buffers=this._buffers||new yu(this.regl,this.buffer_size),this._buffers}data(t){return void 0===t?this.tileSet:(this.tileSet=t,this)}get props(){this.allocate_aesthetic_buffers();const{prefs:t,aes_to_buffer_num:e,buffer_num_to_variable:n,variable_to_buffer_num:r}=this,{transform:i}=this.zoom,o={aes:{encoding:this.aes.encoding},colors_as_grid:0,corners:this.zoom.current_corners(),zoom_balance:t.zoom_balance,transform:i,max_ix:this.max_ix,point_size:this.point_size,alpha:this.optimal_alpha,time:Date.now()-this.zoom._start,update_time:Date.now()-this.most_recent_restart,relative_time:(Date.now()-this.most_recent_restart)/t.duration,string_index:0,prefs:JSON.parse(JSON.stringify(t)),color_type:void 0,start_time:this.most_recent_restart,webgl_scale:this._webgl_scale_history[0],last_webgl_scale:this._webgl_scale_history[1],use_scale_for_tiles:this._use_scale_to_download_tiles,grid_mode:0,buffer_num_to_variable:n,aes_to_buffer_num:e,variable_to_buffer_num:r,color_picker_mode:0,zoom_matrix:[[i.k,0,i.x],[0,i.k,i.y],[0,0,1]].flat()};return JSON.parse(JSON.stringify(o))}get default_webgl_scale(){return this._default_webgl_scale||(this._default_webgl_scale=this.zoom.webgl_scale()),this._default_webgl_scale}render_points(t){const e=[];let n=0;const r=this.aes.store.foreground.states[0].active||this.aes.store.foreground.states[1].active;for(const i of this.visible_tiles()){if(i._buffer_manager=i._buffer_manager||new bu(this.regl,i,this),!i._buffer_manager.ready(t.block_for_buffers))continue;const o={manager:i._buffer_manager,number:n++,foreground:r?1:-1,tile_id:i.numeric_id,sprites:this.sprites};if(Object.assign(o,t),e.push(o),r){const t={...o,foreground:0};e.push(t)}}e.sort(((t,e)=>1e3*(3+t.foreground)-1e3*(3+e.foreground)+e.number-t.number)),this._renderer(e)}tick(){const{prefs:t}=this,{regl:e,tileSet:n}=this,{props:r}=this;this.tick_num=this.tick_num||0,this.tick_num++,this._use_scale_to_download_tiles?n.download_most_needed_tiles(this.zoom.current_corners(),this.props.max_ix,5):n.download_most_needed_tiles(t.max_points,this.max_ix,5),e.clear({color:[.9,.9,.93,0],depth:1});const i=Date.now();!async function(t){for(;Date.now()-i<10&&t.length>0;){const n=t.shift();if(void 0!==n)try{await n()}catch(e){console.warn(e,n)}}}(this.deferred_functions);try{this.render_all(r)}catch(o){throw console.warn("ERROR NOTED"),this.reglframe.cancel(),o}}single_blur_pass(t,e,n){const{regl:r}=this;e.use((()=>{r.clear({color:[0,0,0,0]}),r({frag:"precision mediump float;\n#define GLSLIFY 1\n\nvec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.411764705882353) * direction;\n  vec2 off2 = vec2(3.2941176470588234) * direction;\n  vec2 off3 = vec2(5.176470588235294) * direction;\n  color += texture2D(image, uv) * 0.1964825501511404;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;\n  color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;\n  color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;\n  return color;\n}\n\nuniform vec2 iResolution;\nuniform sampler2D iChannel0;\nuniform vec2 direction;\n\nvoid main() {\n  vec2 uv = vec2(gl_FragCoord.xy / iResolution.xy);\n  gl_FragColor = blur13(iChannel0, uv, iResolution.xy, direction);\n}\n",uniforms:{iResolution:({viewportWidth:t,viewportHeight:e})=>[t,e],iChannel0:t,direction:n},vert:"\n        precision mediump float;\n        attribute vec2 position;\n        varying vec2 uv;\n        void main() {\n          uv = 0.5 * (position + 1.0);\n          gl_Position = vec4(position, 0, 1);\n        }",attributes:{position:[-4,-4,4,-4,0,4]},depth:{enable:!1},count:3})()}))}blur(t,e,n=3){let r=n-1;for(;r>-1;)this.single_blur_pass(t,e,[2**r,0]),this.single_blur_pass(e,t,[0,2**r]),r-=1}render_all(t){const{regl:e}=this;this.fbos.points.use((()=>{e.clear({color:[0,0,0,0]}),this.render_points(t)})),e.clear({color:[0,0,0,0]}),this.fbos.lines.use((()=>e.clear({color:[0,0,0,0]}))),this.scatterplot.trimap&&this.fbos.lines.use((()=>{this.scatterplot.trimap.zoom=this.zoom,this.scatterplot.trimap.tick("polygon")}));for(const n of[this.fbos.lines,this.fbos.points])e({profile:!0,blend:{enable:!0,func:{srcRGB:"one",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},frag:"\n        precision mediump float;\n        varying vec2 uv;\n        uniform sampler2D tex;\n        uniform float wRcp, hRcp;\n        void main() {\n          gl_FragColor = texture2D(tex, uv);\n        }\n      ",vert:"\n        precision mediump float;\n        attribute vec2 position;\n        varying vec2 uv;\n        void main() {\n          uv = 0.5 * (position + 1.0);\n          gl_Position = vec4(position, 0., 1.);\n        }\n      ",attributes:{position:this.fill_buffer},depth:{enable:!1},count:3,uniforms:{tex:()=>n,wRcp:({viewportWidth:t})=>1/t,hRcp:({viewportHeight:t})=>1/t}})()}initialize_textures(){const{regl:t}=this;this.fbos=this.fbos||{},this.textures=this.textures||{},this.textures.empty_texture=t.texture(Nt(128).map((t=>Nt(128).map((t=>[0,0,0]))))),this.fbos.minicounter=t.framebuffer({width:512,height:512,depth:!1}),this.fbos.lines=t.framebuffer({width:this.width,height:this.height,depth:!1}),this.fbos.points=t.framebuffer({width:this.width,height:this.height,depth:!1}),this.fbos.ping=t.framebuffer({width:this.width,height:this.height,depth:!1}),this.fbos.pong=t.framebuffer({width:this.width,height:this.height,depth:!1}),this.fbos.contour=this.fbos.contour||t.framebuffer({width:this.width,height:this.height,depth:!1}),this.fbos.colorpicker=this.fbos.colorpicker||t.framebuffer({width:this.width,height:this.height,depth:!1}),this.fbos.dummy=this.fbos.dummy||t.framebuffer({width:1,height:1,depth:!1})}get_image_texture(t){const{regl:e}=this;if(this.textures=this.textures||{},this.textures[t])return this.textures[t];const n=new Image;return n.src=t,n.addEventListener("load",(()=>{this.textures[t]=e.texture(n)})),this.textures[t]}n_visible(t=-1){let{width:e,height:n}=this;e=Math.floor(e),n=Math.floor(n),void 0===this.contour_vals&&(this.contour_vals=new Uint8Array(e*n*4));const{props:r}=this;let i;return r.only_color=t,this.fbos.contour.use((()=>{this.regl.clear({color:[0,0,0,0]}),this.render_points(r),this.regl.read(this.contour_vals),i=function(t,e){let n=0;if(void 0===e)for(let r of t)(r=+r)&&(n+=r);else{let r=-1;for(let i of t)(i=+e(i,++r,t))&&(n+=i)}return n}(this.contour_vals)})),i}get integer_buffer(){if(void 0===this._integer_buffer){const t=new Float32Array(65536);for(let e=0;e<65536;e++)t[e]=e;this._integer_buffer=this.regl.buffer(t)}return this._integer_buffer}color_pick(t,e){if(0===e)return null;const n=this.color_pick_single(t,e,"tile_id");if(-1==n)return null;const r=this.color_pick_single(t,e,"ix_in_tile");if(-1===r)return null;for(const i of this.visible_tiles())if(i.numeric_id===n)return i.record_batch.get(r);return null}color_pick_single(t,e,n="tile_id"){const{props:r,height:i}=this;r.color_picker_mode=["ix","tile_id","ix_in_tile"].indexOf(n)+1;let o=[0,0,0,0];this.fbos.colorpicker.use((()=>{this.regl.clear({color:[0,0,0,0]}),this.render_points(r);try{o=this.regl.read({x:t,y:i-e,width:1,height:1})}catch{console.warn("Read bad data from",{x:t,y:e,height:i,attempted:i-e})}}));const a=ha(...o)-1;return Math.round(a)}get fill_buffer(){if(!this._fill_buffer){const{regl:t}=this;this._fill_buffer=t.buffer({data:[-4,-4,4,-4,0,4]})}return this._fill_buffer}draw_contour_buffer(t,e){let{width:n,height:r}=this;n=Math.floor(n),r=Math.floor(r),this.contour_vals=this.contour_vals||new Uint8Array(4*n*r),this.contour_alpha_vals=this.contour_alpha_vals||new Uint16Array(n*r);const{props:i}=this;i.aes.encoding.color={field:t},i.only_color=e,this.fbos.contour.use((()=>{this.regl.clear({color:[0,0,0,0]}),this.render_points(i),this.regl.read(this.contour_vals)})),this.blur(this.fbos.contour,this.fbos.ping,3),this.fbos.contour.use((()=>{this.regl.read(this.contour_vals)}));let o=0;for(;o<n*r*4;)this.contour_alpha_vals[o/4]=255*this.contour_vals[o+3],o+=4;return this.contour_alpha_vals}remake_renderer(){const{regl:t}=this,e={depth:{enable:!1},stencil:{enable:!1},blend:{enable:(t,{color_picker_mode:e})=>e<.5,func:{srcRGB:"one",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},primitive:"points",frag:"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n\nprecision mediump float;\n#define GLSLIFY 1\n\nvarying vec4 fill;\nvarying vec2 letter_pos;\nvarying float point_size;\n\nuniform float u_only_color;\nuniform float u_color_picker_mode;\n//uniform float u_use_glyphset;\n//uniform sampler2D u_glyphset;\n\nfloat delta = 0.0, alpha = 1.0;\n\nbool out_of_circle(in vec2 coord) {\n  vec2 cxy = 2.0 * coord - 1.0;\n  float r_sq = dot(cxy, cxy);\n  if (r_sq > 1.03) {return true;}\n  return false;\n}\n\nbool out_of_hollow_circle(in vec2 coord) {\n  vec2 cxy = 2.0 * coord - 1.0;\n  float r_sq = dot(cxy, cxy);\n  if (r_sq > 1.01) {return true;}\n  float distance_from_edge = (1.0 - r_sq) * point_size;\n  if (distance_from_edge > 4.0) {return true;}\n  return false;\n}\n\nbool out_of_triangle(in vec2 coord) {\n  if (coord.y > (2. * abs(coord.x - .5))) {\n    return false;\n  }\n  return true;\n}\n\nvoid main() {\n  if (u_only_color >= -1.5) {\n    gl_FragColor = vec4(0., 0., 0., 1./255.);\n    return;\n  }\n\n  float alpha = fill.a;\n//  if (u_use_glyphset == 0. || point_size < 5.0) {\n    if (out_of_circle(gl_PointCoord)) {\n      discard;\n      return;\n    }\n    vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n    float r = dot(cxy, cxy);\n    #ifdef GL_OES_standard_derivatives\n      delta = fwidth(r);\n      alpha *= (1.0 - smoothstep(1.0 - delta, 1.0 + delta, r));\n    #endif\n/*  } else {\n    vec2 coords = letter_pos + gl_PointCoord/8.;\n//    vec2 coords = vec2(.2, .2);\n    vec4 sprite = texture2D(u_glyphset, coords);\n    alpha *= (sprite.a);  \n//    fill = vec4(1.0, 1.0, 1.0, alpha);  \n    if (alpha <= 0.03) discard;\n  }*/\n  // Pre-blend the alpha channel.\n  if (u_color_picker_mode >= 1.) {\n    // no alpha when color picking; we use all four channels for that.\n    gl_FragColor = fill;\n  } else {\n    gl_FragColor = vec4(fill.rgb * alpha, alpha);\n  }\n\n}\n",vert:'precision mediump float;\n#define GLSLIFY 1\n\nuniform float u_zoom_balance;\nuniform float u_tile_id;\nuniform float u_update_time;\nuniform float u_transition_duration;\n\n// Type of jitter.\nuniform float u_jitter;\nuniform float u_last_jitter;\n\n// Whether to plot only a single category.\nuniform float u_only_color;\nuniform float u_grid_mode;\n\nuniform vec3 u_filter_numeric; // An override for simple numeric operations.\nuniform vec3 u_last_filter_numeric; // An override for simple numeric operations.\n\nuniform vec3 u_filter2_numeric; // An override for simple numeric operations.\nuniform vec3 u_last_filter2_numeric; // An override for simple numeric operations.\n\nuniform vec3 u_foreground_numeric; // An override for simple numeric operations.\nuniform vec3 u_last_foreground_numeric; // An override for simple numeric operations.\n\n// Transform from data space to the open window.\nuniform mat3 u_window_scale;\nuniform mat3 u_last_window_scale;\n// Transform from the open window to the d3-zoom.\nuniform mat3 u_zoom;\n\nuniform float u_width;\nuniform float u_height;\nuniform float u_use_glyphset;\nvarying vec2 letter_pos; // store which letter to use.\n\nuniform float u_maxix;           // The maximum index to plot.\nuniform float u_time;            // The current time.\nuniform float u_k;               // The d3-scale factor.\nuniform float u_color_picker_mode;\nuniform float u_base_size;\nuniform float u_alpha;\nuniform float u_foreground_number; // -1 -- everything is foreground; 0 -- background; 1 -- foreground.\nuniform vec4 u_background_rgba;\nuniform float u_foreground_alpha;\nuniform float u_background_mouseover;\nuniform float u_foreground_size;\nuniform float u_background_size;\n\nuniform sampler2D u_one_d_aesthetic_map;\nuniform sampler2D u_color_aesthetic_map;\n\n// The same set of items for a variety of aesthetics.\n\n// whether to continuously interpolate between\n// x0 and x, y0 and y.\nuniform float u_position_interpolation_mode;\n\nfloat a_color;\nfloat a_last_color;\n\nuniform float u_color_buffer_num;\nuniform float u_last_color_buffer_num;\n\nuniform vec3 u_color_constant;\nuniform vec3 u_last_color_constant;\n\nuniform float u_color_transform;\nuniform float u_last_color_transform;\nuniform vec2 u_color_domain;\nuniform vec2 u_last_color_domain;\nuniform float u_last_color_map_position;\nuniform float u_color_map_position;\n\nbool a_color_is_constant;\nbool a_last_color_is_constant;\n\n/*\npython code to generate what follows.\ndef autogenerate_code():\n  ks = ["x", "y", "jitter_radius", "jitter_speed", "size", "filter", "filter2", "x0", "y0", "foreground"]\n  times = ["", "last_"]\n  print("""\n  //  BEGIN AUTOGENERATED. DO NOT EDIT. \n  // ------------------------------------------------    \n  """)\n  for k in ks:\n    for time in times:\n      timek = time + k\n      print(f"""\n  uniform float u_{timek}_buffer_num;\n  uniform float u_{timek}_constant;\n  uniform float u_{timek}_transform;\n  uniform vec2 u_{timek}_domain;\n  uniform vec2 u_{timek}_range;\n  uniform float u_{timek}_map_position;\n  float a_{timek};\n  bool a_{timek}_is_constant;\n      """)\n  for i in range(0, 16):\n    print(f"attribute float buffer_{i};")\n  for k in ks:\n    for time in times:\n      timek = time + k\n      print(f"""\n    if (u_{timek}_buffer_num > -0.5) {{\n      a_{timek} = get_buffer(u_{timek}_buffer_num);\n      a_{timek}_is_constant = false;\n    }} else {{\n      a_{timek} = u_{timek}_constant;\n      a_{timek}_is_constant = true;\n    }}""")\n  print("""\n//  END AUTOGENERATED. DO NOT EDIT ABOVE. \n// ------------------------------------------------    \n  """)\n\nautogenerate_code()\n*/\n\n  //  BEGIN AUTOGENERATED. DO NOT EDIT. \n  // ------------------------------------------------    \n  \n\n  uniform float u_x_buffer_num;\n  uniform float u_x_constant;\n  uniform float u_x_transform;\n  uniform vec2 u_x_domain;\n  uniform vec2 u_x_range;\n  uniform float u_x_map_position;\n  float a_x;\n  bool a_x_is_constant;\n      \n\n  uniform float u_last_x_buffer_num;\n  uniform float u_last_x_constant;\n  uniform float u_last_x_transform;\n  uniform vec2 u_last_x_domain;\n  uniform vec2 u_last_x_range;\n  uniform float u_last_x_map_position;\n  float a_last_x;\n  bool a_last_x_is_constant;\n      \n\n  uniform float u_y_buffer_num;\n  uniform float u_y_constant;\n  uniform float u_y_transform;\n  uniform vec2 u_y_domain;\n  uniform vec2 u_y_range;\n  uniform float u_y_map_position;\n  float a_y;\n  bool a_y_is_constant;\n      \n\n  uniform float u_last_y_buffer_num;\n  uniform float u_last_y_constant;\n  uniform float u_last_y_transform;\n  uniform vec2 u_last_y_domain;\n  uniform vec2 u_last_y_range;\n  uniform float u_last_y_map_position;\n  float a_last_y;\n  bool a_last_y_is_constant;\n      \n\n  uniform float u_jitter_radius_buffer_num;\n  uniform float u_jitter_radius_constant;\n  uniform float u_jitter_radius_transform;\n  uniform vec2 u_jitter_radius_domain;\n  uniform vec2 u_jitter_radius_range;\n  uniform float u_jitter_radius_map_position;\n  float a_jitter_radius;\n  bool a_jitter_radius_is_constant;\n      \n\n  uniform float u_last_jitter_radius_buffer_num;\n  uniform float u_last_jitter_radius_constant;\n  uniform float u_last_jitter_radius_transform;\n  uniform vec2 u_last_jitter_radius_domain;\n  uniform vec2 u_last_jitter_radius_range;\n  uniform float u_last_jitter_radius_map_position;\n  float a_last_jitter_radius;\n  bool a_last_jitter_radius_is_constant;\n      \n\n  uniform float u_jitter_speed_buffer_num;\n  uniform float u_jitter_speed_constant;\n  uniform float u_jitter_speed_transform;\n  uniform vec2 u_jitter_speed_domain;\n  uniform vec2 u_jitter_speed_range;\n  uniform float u_jitter_speed_map_position;\n  float a_jitter_speed;\n  bool a_jitter_speed_is_constant;\n      \n\n  uniform float u_last_jitter_speed_buffer_num;\n  uniform float u_last_jitter_speed_constant;\n  uniform float u_last_jitter_speed_transform;\n  uniform vec2 u_last_jitter_speed_domain;\n  uniform vec2 u_last_jitter_speed_range;\n  uniform float u_last_jitter_speed_map_position;\n  float a_last_jitter_speed;\n  bool a_last_jitter_speed_is_constant;\n      \n\n  uniform float u_size_buffer_num;\n  uniform float u_size_constant;\n  uniform float u_size_transform;\n  uniform vec2 u_size_domain;\n  uniform vec2 u_size_range;\n  uniform float u_size_map_position;\n  float a_size;\n  bool a_size_is_constant;\n      \n\n  uniform float u_last_size_buffer_num;\n  uniform float u_last_size_constant;\n  uniform float u_last_size_transform;\n  uniform vec2 u_last_size_domain;\n  uniform vec2 u_last_size_range;\n  uniform float u_last_size_map_position;\n  float a_last_size;\n  bool a_last_size_is_constant;\n      \n\n  uniform float u_filter_buffer_num;\n  uniform float u_filter_constant;\n  uniform float u_filter_transform;\n  uniform vec2 u_filter_domain;\n  uniform vec2 u_filter_range;\n  uniform float u_filter_map_position;\n  float a_filter;\n  bool a_filter_is_constant;\n      \n\n  uniform float u_last_filter_buffer_num;\n  uniform float u_last_filter_constant;\n  uniform float u_last_filter_transform;\n  uniform vec2 u_last_filter_domain;\n  uniform vec2 u_last_filter_range;\n  uniform float u_last_filter_map_position;\n  float a_last_filter;\n  bool a_last_filter_is_constant;\n      \n\n  uniform float u_filter2_buffer_num;\n  uniform float u_filter2_constant;\n  uniform float u_filter2_transform;\n  uniform vec2 u_filter2_domain;\n  uniform vec2 u_filter2_range;\n  uniform float u_filter2_map_position;\n  float a_filter2;\n  bool a_filter2_is_constant;\n      \n\n  uniform float u_last_filter2_buffer_num;\n  uniform float u_last_filter2_constant;\n  uniform float u_last_filter2_transform;\n  uniform vec2 u_last_filter2_domain;\n  uniform vec2 u_last_filter2_range;\n  uniform float u_last_filter2_map_position;\n  float a_last_filter2;\n  bool a_last_filter2_is_constant;\n      \n\n  uniform float u_x0_buffer_num;\n  uniform float u_x0_constant;\n  uniform float u_x0_transform;\n  uniform vec2 u_x0_domain;\n  uniform vec2 u_x0_range;\n  uniform float u_x0_map_position;\n  float a_x0;\n  bool a_x0_is_constant;\n      \n\n  uniform float u_last_x0_buffer_num;\n  uniform float u_last_x0_constant;\n  uniform float u_last_x0_transform;\n  uniform vec2 u_last_x0_domain;\n  uniform vec2 u_last_x0_range;\n  uniform float u_last_x0_map_position;\n  float a_last_x0;\n  bool a_last_x0_is_constant;\n      \n\n  uniform float u_y0_buffer_num;\n  uniform float u_y0_constant;\n  uniform float u_y0_transform;\n  uniform vec2 u_y0_domain;\n  uniform vec2 u_y0_range;\n  uniform float u_y0_map_position;\n  float a_y0;\n  bool a_y0_is_constant;\n      \n\n  uniform float u_last_y0_buffer_num;\n  uniform float u_last_y0_constant;\n  uniform float u_last_y0_transform;\n  uniform vec2 u_last_y0_domain;\n  uniform vec2 u_last_y0_range;\n  uniform float u_last_y0_map_position;\n  float a_last_y0;\n  bool a_last_y0_is_constant;\n      \n\n  uniform float u_foreground_buffer_num;\n  uniform float u_foreground_constant;\n  uniform float u_foreground_transform;\n  uniform vec2 u_foreground_domain;\n  uniform vec2 u_foreground_range;\n  uniform float u_foreground_map_position;\n  float a_foreground;\n  bool a_foreground_is_constant;\n      \n\n  uniform float u_last_foreground_buffer_num;\n  uniform float u_last_foreground_constant;\n  uniform float u_last_foreground_transform;\n  uniform vec2 u_last_foreground_domain;\n  uniform vec2 u_last_foreground_range;\n  uniform float u_last_foreground_map_position;\n  float a_last_foreground;\n  bool a_last_foreground_is_constant;\n      \nattribute float buffer_0;\nattribute float buffer_1;\nattribute float buffer_2;\nattribute float buffer_3;\nattribute float buffer_4;\nattribute float buffer_5;\nattribute float buffer_6;\nattribute float buffer_7;\nattribute float buffer_8;\nattribute float buffer_9;\nattribute float buffer_10;\nattribute float buffer_11;\nattribute float buffer_12;\nattribute float buffer_13;\nattribute float buffer_14;\nattribute float buffer_15;\n\n//  END AUTOGENERATED. DO NOT EDIT ABOVE. \n// ------------------------------------------------    \n\nhighp float ix_to_random(in float ix, in float seed) {\n  // For high numbers, taking the log avoids coincidence.\n  highp float seed2 = log(ix + 2.) + 1.;\n  vec2 co = vec2(seed2, seed);\n  highp float a = 12.9898;\n  highp float b = 78.233;\n  highp float c = 43758.5453;\n  highp float dt = dot(co.xy, vec2(a, b));\n  highp float sn = mod(dt, 3.14);\n  return fract(sin(sn) * c);\n}\n\n// The fill color.\nvarying vec4 fill;\nvarying float point_size;\n\nuniform float u_jitter_radius_lookup;\nuniform float u_jitter_radius_lookup_y_constant;\nuniform vec2 u_jitter_radius_lookup_x_domain;\nuniform vec2 u_jitter_radius_lookup_y_domain;\n\nfloat point_size_adjust;\n\n// A coordinate to throw away a vertex point.\nvec4 discard_me = vec4(100.0, 100.0, 1.0, 1.0);\n\n// Initialized in the main loop\n// mat3 from_coord_to_gl;\n\nconst float e = 1.618282;\n// I\'ve been convinced.\nconst float tau = 2. * 3.14159265359;\n\nfloat interpolate_raw(in float x, in float min, in float max) {\n  if (x < min) {return 0.;}\n  if (x > max) {return 1.;}\n  return (x - min)/(max - min);\n}\n\nfloat interpolate(in float x, in float min, in float max) {\n  if (max < min) {\n    return 1. - interpolate_raw(x, max, min);\n  } else {\n    return interpolate_raw(x, min, max);\n  }\n}\n\n/*\n\nThe following glsl code was written in python.\n\nbuffers = [*range(16)]\n\ndef write_buffs(buffs):\n    if len(buffs) == 1:\n        return[f"return buffer_{buffs[0]}"]\n    condition_1 = ["  " + line for line in write_buffs(buffs[:len(buffs)//2])]\n    condition_2 = ["" + line for line in write_buffs(buffs[len(buffs)//2:])]\n\n    args = [\n        f"if (i < {buffs[len(buffs) // 2 - 1]}.5) {{",\n        *condition_1,\n        "}",\n        *condition_2\n    ]\n    return args\n\nprint("\\n".join(write_buffs(buffers)))\n*/\n\nfloat get_buffer(in float i) {\n  //given an index, returns the appropriate buffer.\n  if (i < 7.5) {\n    if (i < 3.5) {\n      if (i < 1.5) {\n        if (i < 0.5) {\n          return buffer_0;\n        }\n        return buffer_1;\n      }\n      if (i < 2.5) {\n        return buffer_2;\n      }\n      return buffer_3;\n    }\n    if (i < 5.5) {\n      if (i < 4.5) {\n        return buffer_4;\n      }\n      return buffer_5;\n    }\n    if (i < 6.5) {\n      return buffer_6;\n    }\n    return buffer_7;\n  }\n  if (i < 11.5) {\n    if (i < 9.5) {\n      if (i < 8.5) {\n        return buffer_8;\n      }\n      return buffer_9;\n    }\n    if (i < 10.5) {\n      return buffer_10;\n    }\n    return buffer_11;\n  }\n  if (i < 13.5) {\n    if (i < 12.5) {\n      return buffer_12;\n    }\n    return buffer_13;\n  }\n  if (i < 14.5) {\n    return buffer_14;\n  }\n  return buffer_15;\n}\n\nfloat linstep(in vec2 range, in float x) {\n  return interpolate(x, range.x, range.y);\n  float scale_size = range.y - range.x;\n  float from_left = x - range.x;\n  return clamp(from_left / scale_size, 0.0, 1.0);\n}\n\nfloat linscale(in vec2 range, in float x) {\n  float scale_size = range.y - range.x;\n  float from_left = x - range.x;\n  return from_left / scale_size;\n}\n\nvec2 box_muller(in float ix, in float seed) {\n  // Box-Muller transform gives you two gaussian randoms for two uniforms.\n  highp float U = ix_to_random(ix, seed);\n  highp float V = ix_to_random(ix, seed + 17.123123);\n  return vec2(sqrt(-2. * log(U)) * cos(tau * V),\n              sqrt(-2. * log(U)) * sin(tau * V));\n}\n\n/*************** END COLOR SCALES *******************************/\n\nfloat domainify(in vec2 domain, in float transform, in float attr, in bool clamped) {\n\n  // Clamp an attribute into a domain, with an optional log or sqrt transform.\n  if (transform == 2.) {\n    domain = sqrt(domain);\n    attr = sqrt(attr);\n  }\n  if (transform == 3.) {\n    domain = log(domain);\n    attr = log(attr);\n  }\n  if (clamped) {\n    return linstep(domain, attr);\n  } else {\n    return linscale(domain, attr);\n  }\n}\n\nmat3 pixelspace_to_glspace;\n\nfloat run_numeric_filter (in float a_filter,\n  in float u_filter_op, in float u_filter_param_1,\n  in float u_filter_param_2) {\n  bool truthy;\n  if (u_filter_op < 1.5) {\n    truthy = a_filter < u_filter_param_1;\n  } else if (u_filter_op < 2.5) {\n    truthy = a_filter > u_filter_param_1;\n  } else if (u_filter_op < 3.5) {\n    truthy = a_filter == u_filter_param_1;\n  } else if (u_filter_op < 4.5) {\n    truthy = abs(a_filter - u_filter_param_2) < u_filter_param_1;\n  }\n  if (truthy) {return 1.;} else {return 0.;}\n}\n\nfloat choose_and_run_filter(\n  in vec3 u_filter_numeric,\n  in float a_filter,\n  in float map_location,\n  in bool filter_is_constant\n  ) {\n    if (filter_is_constant) {\n      return 1.;\n    }\n    if (u_filter_numeric.r < 0.5) {\n      // Must be on a dictionary. Unreasonable assumption, maybe?\n      float frac_filter = linstep(vec2(-2047., 2047), a_filter);\n      float map_coords = (map_location + .5) / 32.;\n      return texture2D(u_one_d_aesthetic_map, vec2(map_coords, frac_filter)).a;\n    } else {\n      return run_numeric_filter(a_filter,\n        u_filter_numeric.r, u_filter_numeric.g, u_filter_numeric.b);\n    }\n}\n\nconst float tau_0 = 2. * 3.14159265359;\n\nhighp float ix_to_random_1540259130(in float ix, in float seed) {\n  // For high numbers, taking the log avoids coincidence.\n  highp float seed2 = log(ix) + 1.;\n  vec2 co = vec2(seed2, seed);\n  highp float a = 12.9898;\n  highp float b = 78.233;\n  highp float c = 43758.5453;\n  highp float dt= dot(co.xy ,vec2(a,b));\n  highp float sn= mod(dt,3.14);\n  return fract(sin(sn) * c);\n}\n\nhighp vec2 box_muller_1540259130(in float ix, in float seed) {\n  // Box-Muller transform gives you two gaussian randoms for two uniforms.\n  highp float U = ix_to_random_1540259130(ix, seed);\n  highp float V = ix_to_random_1540259130(ix, seed + 17.123123);\n  return vec2(\n    sqrt(-2.*log(U))*cos(tau_0*V),\n    sqrt(-2.*log(U))*sin(tau_0*V)\n  );\n}\n\nvec2 logarithmic_spiral_jitter_1540259130(\n  in float ix, // a random seed.\n  in float a, // offset\n  in float angle_parameter_1540259130, // angle parameter\n  in float randomize_angle_1540259130, // sd radians\n  in float max_r_1540259130, // Maximum radius of spiral.\n  in float randomize_rotation_max_radians_1540259130, // in standard deviations to the log-multiplier.\n  in float randomize_radius_1540259130, // in standard deviation percentage points.\n  in float hole, // donut hole size.\n  in float speed_0, // webgl units per second.\n  in float time_0,// The time, in seconds, to plot at. Generally passed as a uniform or something.\n  in float acceleration,\n  in float n_spirals_1540259130,\n  in float shear,\n  in float aspect_ratio_1540259130\n  ) {\n  // Each point starts at a different place on the spiral.\n  vec2 two_gaussians_1540259130 = box_muller_1540259130(ix, 55.1);\n\n  highp float calculated_angle = angle_parameter_1540259130 + two_gaussians_1540259130.x * randomize_angle_1540259130;\n  float k = 1. / tan(calculated_angle);\n  if (k > 100000.) {\n    k = 0.;\n  }\n\n  // The length of the segment to be traversed.\n  float arc_length =  sqrt((1. + k*k)/k) * (max_r_1540259130 - a);\n  float period = arc_length / speed_0;\n\n  // Every point needs to start at a different place along the curve.\n  float stagger_time = ix_to_random_1540259130(ix, 3.);\n\n  // How long does a circuit take? Add some random noise.\n  float time_period = period * exp(box_muller_1540259130(ix, 0.031).x / 6.);\n\n  // Adjust u_time from the clock to our current spot.\n  float varying_time = time_0 + stagger_time * time_period;\n\n  // Adjust that time by raising to a power to set the speed along the curve.\n  // Not sure if this is the soundest way to parametrize.\n  float relative_time = pow(1. - mod(varying_time, time_period)/time_period, acceleration);\n\n  // Calculate the radius at this time point.\n  float radius = max_r_1540259130 * relative_time + a;\n\n  // The angle implied by that radius.\n  float theta  = 1./k * log(radius / a);\n\n  /* A different way to calculate radius from the theta. Not used\n  float max_theta = 1. / k * log(max_r / a);\n  float theta2 = max_theta * relative_time;\n  vec2 pos_theta_style = vec2(a * exp(k * theta2), theta2);\n  radius = pos_theta_style.x;\n  theta = pos_theta_style.y;\n  */\n\n  // If multiple spirals, the theta needs to be rotated for which spiral we\'re in.\n  // Choose it based on a new random seed.\n  float which_spiral = floor(ix_to_random_1540259130(ix, 13.13) * n_spirals_1540259130);\n  float which_spiral_adjust = which_spiral / n_spirals_1540259130 * tau_0;\n  theta = theta + which_spiral_adjust;\n\n  // Add some gaussian jitter to the polar coordinates.\n  vec2 polar_jitter = box_muller_1540259130(ix, 24.);\n\n  highp float radius_adjust = 1. + polar_jitter.x * randomize_radius_1540259130;\n  highp float theta_adjust = polar_jitter.y * randomize_rotation_max_radians_1540259130;\n\n  vec2 shear_adjust = box_muller_1540259130(ix, 59.1) * shear;\n\n  mat3 shear_mat = mat3(\n    1., shear_adjust.x, 0.,\n    shear_adjust.y, 1., 0.,\n    0., 0., 1.);\n  // into euclidean space.\n  vec3 pos_spiral = vec3(\n   cos(theta + theta_adjust)*(radius * radius_adjust + hole),\n   sin(theta + theta_adjust)*(radius * radius_adjust + hole),\n   0.\n  );\n  mat3 adjust_to_viewport =\n         mat3(\n            1./aspect_ratio_1540259130, 0., 0.,\n            0., 1., 0.,\n            0., 0., 1.);\n\n  pos_spiral = pos_spiral * shear_mat * \n               adjust_to_viewport;\n  return pos_spiral.xy;\n}\n\n#define FLOAT_MAX  1.70141184e38\n#define FLOAT_MIN  1.17549435e-38\n\nlowp vec4 encode_float_1604150559(highp float v) {\n  highp float av = abs(v);\n\n  //Handle special cases\n  if(av < FLOAT_MIN) {\n    return vec4(0.0, 0.0, 0.0, 0.0);\n  } else if(v > FLOAT_MAX) {\n    return vec4(127.0, 128.0, 0.0, 0.0) / 255.0;\n  } else if(v < -FLOAT_MAX) {\n    return vec4(255.0, 128.0, 0.0, 0.0) / 255.0;\n  }\n\n  highp vec4 c = vec4(0,0,0,0);\n\n  //Compute exponent and mantissa\n  highp float e = floor(log2(av));\n  highp float m = av * pow(2.0, -e) - 1.0;\n  \n  //Unpack mantissa\n  c[1] = floor(128.0 * m);\n  m -= c[1] / 128.0;\n  c[2] = floor(32768.0 * m);\n  m -= c[2] / 32768.0;\n  c[3] = floor(8388608.0 * m);\n  \n  //Unpack exponent\n  highp float ebias = e + 127.0;\n  c[0] = floor(ebias / 2.0);\n  ebias -= c[0] * 2.0;\n  c[1] += floor(ebias) * 128.0; \n\n  //Unpack sign bit\n  c[0] += 128.0 * step(0.0, -v);\n\n  //Scale back to range\n  return c / 255.0;\n}\n\n#ifndef PI\n#define PI 3.141592653589793\n#endif\n\nfloat sineInOut_0(float t) {\n  return -0.5 * (cos(PI * t) - 1.0);\n}\n\n#ifndef PI\n#define PI 3.141592653589793\n#endif\n\nvec2 bezier_interpolate(vec2 p1, vec2 p2, float frac, float ix) {\n  // Interpolates between two points on a Bezier curve around a jittered middle.\n  // Makes animations look cooler.\n    vec2 midpoint = box_muller(ix, 3.) * .05 *\n         dot(p2 - p1, p2 - p1)\n         + p2 / 2. + p1 / 2.;\n\n      return mix(\n        mix(p2, midpoint, frac),\n        mix(midpoint, p1, frac),\n      frac);\n}\n\nfloat sineInOut(float t) {\n  return -0.5 * (cos(PI * t) - 1.0);\n}\n\nconst vec4 decoder = vec4(1./256./256./256., 1. / 256. / 256., 1. / 256., 1.);\n\nfloat RGBAtoFloat(in vec4 floater) {\n  // Scale values up by 256.\n  return dot(floater, decoder);\n}\n\nfloat texture_float_lookup(in vec2 domain,\n                           in vec2 range,\n                           in float transform,\n                           in float attr,\n                           in float texture_position) {\n  if (transform == 4.0) {\n    // Literal transforms aren\'t looked up, just returned as is.\n    return attr;\n  }\n  float inrange = domainify(domain, transform, attr, true);\n  if (texture_position > 0.5) {\n    float y_pos = texture_position / 32. - 0.5 / 32.;\n    vec4 encoded = texture2D(u_one_d_aesthetic_map, vec2(y_pos, inrange));\n    return encoded.a;\n    return RGBAtoFloat(encoded); // unreachable.\n  } else {\n    return mix(range.x, range.y, inrange);\n  }\n}\n\nvec2 calculate_position(in vec2 position, in float x_scale_type,\n                        in vec2 x_domain, in vec2 x_range, in float y_scale_type,\n                        in vec2 y_domain, in vec2 y_range, in mat3 window_scale,\n                        in mat3 zoom, in float x_map_position,\n                        in float y_map_position\n                        ) {\n    float x;\n    float y;\n\n    if (x_scale_type < 4.0) {\n      float x_ = linscale(u_color_domain, a_color);\n      x = texture_float_lookup(x_domain, x_range,\n        x_scale_type,\n        position.x, 0. // ymap position 0 means never use a texture lookup.\n        );\n    } else {\n      x = position.x;\n    }\n\n    if (y_scale_type < 4.0) {\n      y = texture_float_lookup(y_domain, y_range, y_scale_type,\n        position.y, 0. // ymap position 0 means never use a texture lookup.\n        );\n    } else {\n      y = position.y;\n    }\n    vec3 pos2d = vec3(x, y, 1.0) * window_scale * zoom * pixelspace_to_glspace;\n    return pos2d.xy;\n}\n\nfloat cubicInOut(float t) {\n  return t < 0.5\n    ? 4.0 * t * t * t\n    : 1. - 4.0 * pow(1. - t, 3.0);\n}\n\nvec4 ixToRGBA(in float ix)  {\n  float min = fract(ix / 256.);\n  float mid = fract((ix - min) / 256.);\n  float high = fract((ix - min - mid * 256.) / (256.) / 256.);\n  return vec4(min, mid, high, 1.);\n}\n\nvec2 circle_jitter(in float ix, in float aspect_ratio, in float time,\n                   in float radius, in float speed) {\n  vec2 two_gaussians = box_muller(ix, 12.);\n\n  float stagger_time = two_gaussians.y * tau;\n\n  // How long does a circuit take?\n\n  float units_per_period = radius * tau;\n  float units_per_second = speed;\n  float seconds_per_period = units_per_period / units_per_second;\n  float time_period = seconds_per_period;\n  if (time_period > 1e4) {\n    return vec2(0., 0.);\n  }\n\n  // Adjust time from the clock to our current spot.\n  float varying_time = time + stagger_time * time_period;\n  // Where are we from 0 to 1 relative to the time period\n\n  float relative_time = 1. - mod(varying_time, time_period) / time_period;\n\n  float theta = relative_time * tau;\n  // Problem--should it lie on a disk, or on a circle?\n  float r_mult = 1.;//(sqrt(ix_to_random(ix, 7.)));\n\n  return vec2(cos(theta) * r_mult, aspect_ratio * sin(theta) * r_mult) *\n         radius;\n}\n\nvec2 calculate_jitter(\n  in float jitter_type,\n  in float ix, // distinguishing index\n  in vec2 jitter_radius_domain,\n  in vec2 jitter_radius_range,\n  in float jitter_radius_transform,\n  in float jitter_radius,\n  in float jitter_radius_map_position,\n  in bool jitter_radius_is_constant,\n  in vec2 jitter_speed_domain,\n  in vec2 jitter_speed_range,\n  in float jitter_speed_transform,\n  in float jitter_speed,\n  in float jitter_speed_map_position,\n  in bool jitter_speed_is_constant\n) {\n\n  // Jitter is calculated based on speed, so requires two full maps in.\n  if (jitter_type == 0.) {\n    // No jitter\n    return vec2(0., 0.);\n  }\n\n  if (jitter_type == 5.) {\n    // Temporal jitter--should be broken out into a separate channel/channels.\n    float time_period = 60.;\n    float share = 1./4.;\n    float offset = ix_to_random(ix, 12.);\n    float fractional = fract((offset * time_period + u_time)/time_period);\n    if (fractional > share) {\n      return vec2(0., 0.);\n    }\n    float size = 0.5 * (1. - cos(2. * 3.1415926 * min(fractional/share, 1. - fractional/share)));\n    size = clamp(size, 0., 1.);\n    return vec2(size, 0.);\n  }\n  float jitter_r;  \n  if (jitter_radius_is_constant) {\n    jitter_r = jitter_radius;\n  } else {\n    jitter_r = texture_float_lookup(\n    jitter_radius_domain,\n    jitter_radius_range,\n    jitter_radius_transform,\n    jitter_radius,\n    0.);\n  }\n  if (jitter_type == 3.) {\n    float r = box_muller(ix, 1.).r * jitter_r;\n    r = r * point_size_adjust;\n    float theta = ix_to_random(ix, 15.) * tau;\n    return vec2(cos(theta) * r, sin(theta) * r * u_width / u_height);\n  }\n\n  if (jitter_type == 2.) {\n    // uniform in the circle.\n    float theta = ix_to_random(ix, 15.) * tau;\n    float r = jitter_r * sqrt(ix_to_random(ix, 115.));\n    r = r * point_size_adjust;\n    return vec2(cos(theta) * r, sin(theta) * r * u_width / u_height);\n  }\n\n  /* Jittering that includes motion) */\n\n  float p_jitter_speed =\n      texture_float_lookup(jitter_speed_domain,\n                          jitter_speed_range,\n                          jitter_speed_transform, jitter_speed,\n                          jitter_speed_map_position);\n\n  if (jitter_type == 1.) {\n    return logarithmic_spiral_jitter_1540259130(\n                ix,\n                0.005 * jitter_r,                     // a\n                1.3302036,                       // angle parameter\n                0.005,                                 // angle random\n                jitter_r,                             // max radius\n                0.03,                                 // random_rotation\n                0.06,                                 // random radius\n                0.003 * point_size_adjust * jitter_r, // donut.\n                .5 * p_jitter_speed * jitter_r / point_size_adjust, // speed\n                u_time,                                           // time\n                0.8,                                              // acceleration\n                2.0,                                              // n_spirals\n                .09, //shear\n                u_width/u_height         // shear\n            );\n  }\n\n  if (jitter_type == 4.) {\n    // circle\n    return circle_jitter(ix, u_width/u_height, u_time, jitter_r, p_jitter_speed);\n  }\n}\n\nvoid run_color_fill(in float ease) {\n  float alpha = min(u_alpha, 1.0);\n  if (u_only_color >= -1.5) {\n    if (u_only_color > -.5 && a_color != u_only_color) {\n      gl_Position = discard_me;\n      return;\n    } else {\n      // -1 is a special value meaning \'plot everything\'.\n      fill = vec4(0., 0., 0., 1. / 255.);\n      gl_PointSize = 1.;\n    }\n  } else {\n    if (a_color_is_constant) {\n      fill = vec4(u_color_constant.rgb, alpha);\n    } else {\n      float fractional_color = linstep(u_color_domain, a_color);\n      float color_pos = (u_color_map_position * -1. - 1.) / 32. + 0.5 / 32.;\n      fractional_color = domainify(u_color_domain, u_color_transform, a_color, true);\n      fill = texture2D(u_color_aesthetic_map , vec2(color_pos, fractional_color));\n      fill = vec4(fill.rgb, alpha);\n    }\n    if (ease < 1.) {\n      vec4 last_fill;\n      if (a_last_color_is_constant) {\n        last_fill = vec4(u_last_color_constant.rgb, alpha);\n      } else {\n        float last_fractional = linstep(u_last_color_domain, a_last_color);\n        float color_pos = (u_last_color_map_position * -1. - 1.) / 32. + 0.5 / 32.;\n        last_fractional = domainify(u_last_color_domain, u_last_color_transform, a_last_color, true);\n        last_fill = texture2D(u_color_aesthetic_map, vec2(color_pos, last_fractional));\n        // Alpha channel interpolation already happened.\n        last_fill = vec4(last_fill.rgb, alpha);\n      }\n      // RGB blending is bad--maybe use https://www.shadertoy.com/view/lsdGzN\n      // instead?\n      fill = mix(last_fill, fill, ease);\n    }\n  }\n}\n\nvec2 calc_and_interpolate_positions(\n  inout vec2 old_position,\n  in float u_last_x_transform,\n  in vec2 u_last_x_domain,\n  in vec2 u_last_x_range,\n  in float u_last_y_transform,\n  in vec2 u_last_y_domain,\n  in vec2 u_last_y_range,\n  in mat3 u_last_window_scale,\n  in mat3 u_zoom,\n  in float u_last_x_map_position,\n  in float u_last_y_map_position,\n  inout vec2 position,\n  in float u_x_transform,\n  in vec2 u_x_domain,\n  in vec2 u_x_range,\n  in float u_y_transform,\n  in vec2 u_y_domain,\n  in vec2 u_y_range,\n  in mat3 u_window_scale,\n  in float u_x_map_position,\n  in float u_y_map_position,\n  in float interpolation,\n  in float u_grid_mode, \n  in float ix) {\n\n  old_position = calculate_position(old_position, u_last_x_transform,\n    u_last_x_domain, u_last_x_range,\n    u_last_y_transform, u_last_y_domain, u_last_y_range,\n    u_last_window_scale,\n    u_zoom, u_last_x_map_position,      \n    u_last_y_map_position);\n    \n  bool plot_actual_position = u_grid_mode < .5;\n\n  if (plot_actual_position) {\n    position = calculate_position(position, \n      u_x_transform,\n      u_x_domain, u_x_range,\n      u_y_transform, u_y_domain, \n      u_y_range, u_window_scale, u_zoom, \n      u_x_map_position, u_y_map_position);\n    float xpos = clamp((1. + position.x) / 2., 0., 1.);\n    float randy = ix_to_random(ix, 13.76);\n    float delay = xpos + randy * .1;\n    delay = delay * 3.;\n\n    float frac = interpolate(\n      u_update_time,\n      delay,\n      u_transition_duration + delay\n    );\n\n    frac = sineInOut_0(frac);\n\n    if (frac <= 0.) {\n      position = old_position;\n    } else if (frac < 1.) {\n      frac = fract(frac);\n      position = bezier_interpolate(position, old_position, frac, ix);\n    }\n  } else {\n    position.x = -1. + 2. * linscale(u_x_domain, position.x);\n    //position.y = -1.0;\n    vec2 jitterspec = vec2(\n      (ix_to_random(ix, 3.) * a_jitter_radius ) * 2.,\n      (ix_to_random(ix, 1.5) * a_jitter_speed ) * 2.\n    );\n    position = position + jitterspec;\n  }\n  return position;\n}\n\nvoid main() {\n  float debug_mode = 0.;\n  float ix = buffer_0;\n  float ix_in_tile = buffer_1;\n  if (ix > u_maxix) {\n    // throw away points that are too low.\n    gl_Position = discard_me;\n    return;\n  }\n\n  if (debug_mode > 1.5) {\n    // Debug mode.\n    gl_PointSize = 2.;\n    gl_Position = vec4(box_muller(ix, 2.).xy * .33, 0., 1.);\n    return;\n  }\n\n // Autogenerated below this point\n\n    if (u_x_buffer_num > -0.5) {\n      a_x = get_buffer(u_x_buffer_num);\n      a_x_is_constant = false;\n    } else {\n      a_x = u_x_constant;\n      a_x_is_constant = true;\n    }\n\n    if (u_last_x_buffer_num > -0.5) {\n      a_last_x = get_buffer(u_last_x_buffer_num);\n      a_last_x_is_constant = false;\n    } else {\n      a_last_x = u_last_x_constant;\n      a_last_x_is_constant = true;\n    }\n\n    if (u_y_buffer_num > -0.5) {\n      a_y = get_buffer(u_y_buffer_num);\n      a_y_is_constant = false;\n    } else {\n      a_y = u_y_constant;\n      a_y_is_constant = true;\n    }\n\n    if (u_last_y_buffer_num > -0.5) {\n      a_last_y = get_buffer(u_last_y_buffer_num);\n      a_last_y_is_constant = false;\n    } else {\n      a_last_y = u_last_y_constant;\n      a_last_y_is_constant = true;\n    }\n\n    if (u_jitter_radius_buffer_num > -0.5) {\n      a_jitter_radius = get_buffer(u_jitter_radius_buffer_num);\n      a_jitter_radius_is_constant = false;\n    } else {\n      a_jitter_radius = u_jitter_radius_constant;\n      a_jitter_radius_is_constant = true;\n    }\n\n    if (u_last_jitter_radius_buffer_num > -0.5) {\n      a_last_jitter_radius = get_buffer(u_last_jitter_radius_buffer_num);\n      a_last_jitter_radius_is_constant = false;\n    } else {\n      a_last_jitter_radius = u_last_jitter_radius_constant;\n      a_last_jitter_radius_is_constant = true;\n    }\n\n    if (u_jitter_speed_buffer_num > -0.5) {\n      a_jitter_speed = get_buffer(u_jitter_speed_buffer_num);\n      a_jitter_speed_is_constant = false;\n    } else {\n      a_jitter_speed = u_jitter_speed_constant;\n      a_jitter_speed_is_constant = true;\n    }\n\n    if (u_last_jitter_speed_buffer_num > -0.5) {\n      a_last_jitter_speed = get_buffer(u_last_jitter_speed_buffer_num);\n      a_last_jitter_speed_is_constant = false;\n    } else {\n      a_last_jitter_speed = u_last_jitter_speed_constant;\n      a_last_jitter_speed_is_constant = true;\n    }\n\n    if (u_size_buffer_num > -0.5) {\n      a_size = get_buffer(u_size_buffer_num);\n      a_size_is_constant = false;\n    } else {\n      a_size = u_size_constant;\n      a_size_is_constant = true;\n    }\n\n    if (u_last_size_buffer_num > -0.5) {\n      a_last_size = get_buffer(u_last_size_buffer_num);\n      a_last_size_is_constant = false;\n    } else {\n      a_last_size = u_last_size_constant;\n      a_last_size_is_constant = true;\n    }\n\n    if (u_filter_buffer_num > -0.5) {\n      a_filter = get_buffer(u_filter_buffer_num);\n      a_filter_is_constant = false;\n    } else {\n      a_filter = u_filter_constant;\n      a_filter_is_constant = true;\n    }\n\n    if (u_last_filter_buffer_num > -0.5) {\n      a_last_filter = get_buffer(u_last_filter_buffer_num);\n      a_last_filter_is_constant = false;\n    } else {\n      a_last_filter = u_last_filter_constant;\n      a_last_filter_is_constant = true;\n    }\n\n    if (u_filter2_buffer_num > -0.5) {\n      a_filter2 = get_buffer(u_filter2_buffer_num);\n      a_filter2_is_constant = false;\n    } else {\n      a_filter2 = u_filter2_constant;\n      a_filter2_is_constant = true;\n    }\n\n    if (u_last_filter2_buffer_num > -0.5) {\n      a_last_filter2 = get_buffer(u_last_filter2_buffer_num);\n      a_last_filter2_is_constant = false;\n    } else {\n      a_last_filter2 = u_last_filter2_constant;\n      a_last_filter2_is_constant = true;\n    }\n\n    if (u_x0_buffer_num > -0.5) {\n      a_x0 = get_buffer(u_x0_buffer_num);\n      a_x0_is_constant = false;\n    } else {\n      a_x0 = u_x0_constant;\n      a_x0_is_constant = true;\n    }\n\n    if (u_last_x0_buffer_num > -0.5) {\n      a_last_x0 = get_buffer(u_last_x0_buffer_num);\n      a_last_x0_is_constant = false;\n    } else {\n      a_last_x0 = u_last_x0_constant;\n      a_last_x0_is_constant = true;\n    }\n\n    if (u_y0_buffer_num > -0.5) {\n      a_y0 = get_buffer(u_y0_buffer_num);\n      a_y0_is_constant = false;\n    } else {\n      a_y0 = u_y0_constant;\n      a_y0_is_constant = true;\n    }\n\n    if (u_last_y0_buffer_num > -0.5) {\n      a_last_y0 = get_buffer(u_last_y0_buffer_num);\n      a_last_y0_is_constant = false;\n    } else {\n      a_last_y0 = u_last_y0_constant;\n      a_last_y0_is_constant = true;\n    }\n\n    if (u_foreground_buffer_num > -0.5) {\n      a_foreground = get_buffer(u_foreground_buffer_num);\n      a_foreground_is_constant = false;\n    } else {\n      a_foreground = u_foreground_constant;\n      a_foreground_is_constant = true;\n    }\n\n    if (u_last_foreground_buffer_num > -0.5) {\n      a_last_foreground = get_buffer(u_last_foreground_buffer_num);\n      a_last_foreground_is_constant = false;\n    } else {\n      a_last_foreground = u_last_foreground_constant;\n      a_last_foreground_is_constant = true;\n    }\n\n//  END AUTOGENERATED. DO NOT EDIT ABOVE. \n// ------------------------------------------------    \n  gl_PointSize = 1.;\n\n  if (u_color_buffer_num > -0.5) {\n    a_color = get_buffer(u_color_buffer_num);\n    a_color_is_constant = false;\n  } else {\n    a_color = ix;\n    a_color_is_constant = true;\n  }\n\n  if (u_last_color_buffer_num > -0.5) {\n    a_last_color = get_buffer(u_last_color_buffer_num);\n    a_last_color_is_constant = false;\n  } else {\n    a_last_color = ix;\n    a_last_color_is_constant = true;\n  }\n\n  pixelspace_to_glspace = mat3(\n      2. / u_width, 0., -1.,\n      0., - 2. / u_height, 1.,\n      0., 0., 1.\n  );\n\n  float interpolation =\n    interpolate(u_update_time, 0., u_transition_duration);\n    \n  float ease = interpolation;\n\n  // I set this sometimes.\n\n  vec2 position = vec2(a_x, a_y);\n  vec2 old_position = vec2(a_last_x, a_last_y);\n\n  position = calc_and_interpolate_positions(\n    old_position,\n    u_last_x_transform,\n    u_last_x_domain, u_last_x_range,\n    u_last_y_transform,\n    u_last_y_domain, u_last_y_range,\n    u_last_window_scale,\n    u_zoom,\n    u_last_x_map_position,\n    u_last_y_map_position,\n    position,\n    u_x_transform,\n    u_x_domain, u_x_range,\n    u_y_transform,\n    u_y_domain, u_y_range,\n    u_window_scale,\n    u_x_map_position,\n    u_y_map_position,\n    interpolation,\n    u_grid_mode,\n    ix\n  );\n\n  if (u_x0_buffer_num > 0.) {\n    vec2 position0 = vec2(a_x0, a_y0);\n    vec2 old_position0 = vec2(a_last_x0, a_last_y0);\n\n    position0 = calc_and_interpolate_positions(\n      old_position0,\n      u_last_x0_transform,\n      u_last_x0_domain, u_last_x0_range,\n      u_last_y0_transform,\n      u_last_y0_domain, u_last_y0_range,\n      u_last_window_scale,\n      u_zoom,\n      u_last_x0_map_position,\n      u_last_y0_map_position,\n      position0,\n      u_x0_transform,\n      u_x0_domain, u_x0_range,\n      u_y0_transform,\n      u_y0_domain, u_y0_range,\n      u_window_scale,\n      u_x0_map_position,\n      u_y0_map_position,\n      interpolation,\n      u_grid_mode,\n      ix\n    );\n\n    if (u_position_interpolation_mode > 0.) {\n      float rand2 = ix_to_random(ix, 11.76);\n\n      // If it\'s a continuous loop, just choose a random point along that loop.\n      float rand_offset = fract(u_update_time/u_transition_duration / 10. + rand2);\n      position = mix(position0, position, rand_offset);\n    }\n  }\n\n  bool plot_actual_position = u_grid_mode < .5;\n\n  if (u_position_interpolation_mode > 0.) {\n    float rand2 = ix_to_random(ix, 11.76);\n\n    // If it\'s a continuous loop, just choose a random point along that loop.\n    float rand_offset = fract(u_update_time/u_transition_duration + rand2);\n    \n  }\n\n/*  position = vec2(\n    ix_to_random(ix, .1),\n    ix_to_random(ix, .2)\n  );*/\n  /* FILTERING */\n\n  float filter_status = choose_and_run_filter(\n    u_filter_numeric,\n    a_filter,\n    u_filter_map_position,\n    a_filter_is_constant\n  );\n\n  float last_filter_status = choose_and_run_filter(\n    u_last_filter_numeric,\n    a_last_filter,\n    u_last_filter_map_position,\n    a_last_filter_is_constant\n  );\n\n  float filter2_status = choose_and_run_filter(\n    u_filter2_numeric,\n    a_filter2,\n    u_filter2_map_position,\n    a_filter2_is_constant\n  );\n\n  float last_filter2_status = choose_and_run_filter(\n    u_last_filter2_numeric,\n    a_last_filter2,\n    u_last_filter2_map_position,\n    a_last_filter2_is_constant\n  );\n\n  float foreground_status = choose_and_run_filter(\n    u_foreground_numeric,\n    a_foreground,\n    u_foreground_map_position,\n    a_foreground_is_constant\n  );\n\n  float last_foreground_status = choose_and_run_filter(\n    u_last_foreground_numeric,\n    a_last_foreground,\n    u_last_foreground_map_position,\n    a_last_foreground_is_constant\n  );\n  float fg_ease = mix(last_foreground_status, foreground_status, ease);\n  if (ease < ix_to_random(ix, 1.)) {\n    foreground_status = last_foreground_status;\n  }\n\n  /*if (a_foreground_is_constant) {\n    foreground_status = 1.;\n  }*/\n\n  bool was_filtered = last_filter2_status < .5 || last_filter_status < .5;\n  bool will_be_filtered = filter2_status < .5 || filter_status < .5;\n\n  bool overall_filter_status = will_be_filtered;\n\n  if (ease < ix_to_random(ix, 1.)) {\n    overall_filter_status = was_filtered;\n  }\n\n  if (overall_filter_status == true) {\n    gl_Position = discard_me;\n    return;\n  }\n\n  float size_multiplier = texture_float_lookup(\n    u_size_domain,\n    u_size_range,\n    u_size_transform, a_size,\n    u_size_map_position);\n\n  float last_size_multiplier = texture_float_lookup(\n    u_last_size_domain, u_last_size_range, u_last_size_transform, a_last_size,\n    u_last_size_map_position);\n\n  size_multiplier = u_base_size * \n     mix(last_size_multiplier, size_multiplier, ease);\n  \n  float depth_size_adjust = (1.0 - ix / (u_maxix));\n\n  point_size_adjust = exp(log(u_k) * u_zoom_balance) ;// * depth_size_adjust;\n//  point_size_adjust = exp(log(u_k) * u_zoom_balance);\n  gl_PointSize = point_size_adjust * size_multiplier;\n\n  if (gl_PointSize <= 5.1) {\n    // It\'s ugly on new macs when it jumps straight from one to two for a bunch of points at once.\n    float size_fuzz = exp(ix_to_random(ix, 3.1) * .5 - .25);\n    gl_PointSize *= size_fuzz;\n  }\n\n  if (gl_PointSize <= 0.01) {\n    gl_Position = discard_me;\n    return;\n  }\n  vec2 jitter = vec2(0., 0.);\n\n  if (plot_actual_position && (u_jitter > 0. || u_last_jitter > 0.)) {\n    /* JITTER */\n    jitter = vec2(ix_to_random(ix, 2. + u_time), ix_to_random(ix, 3. + u_time)) * .01;\n    float jitter_radius_fraction;\n      jitter = calculate_jitter(\n        u_jitter, ix,\n        u_jitter_radius_domain,        u_jitter_radius_range,\n        u_jitter_radius_transform,        a_jitter_radius,\n        u_jitter_radius_map_position,        a_jitter_radius_is_constant,\n        u_jitter_speed_domain,\n        u_jitter_speed_range,\n        u_jitter_speed_transform, a_jitter_speed,\n        u_jitter_speed_map_position, a_jitter_speed_is_constant\n      );\n    vec2 last_jitter;\n    if (ease < 1.) {\n      last_jitter = calculate_jitter(\n        u_last_jitter, ix,\n        u_last_jitter_radius_domain,       \n        u_last_jitter_radius_range,\n        u_last_jitter_radius_transform,        \n        a_last_jitter_radius,\n        u_last_jitter_radius_map_position,\n        a_last_jitter_radius_is_constant,\n        u_last_jitter_speed_domain,\n        u_last_jitter_speed_range,\n        u_last_jitter_speed_transform,\n        a_last_jitter_speed,\n        u_last_jitter_speed_map_position,\n        a_last_jitter_speed_is_constant\n      );\n      jitter = mix(last_jitter, jitter, ease);\n    }\n    if (u_jitter == 5.) {\n      // temporal jitter: rescale the point from the first dimension\n      gl_PointSize *= jitter.x;\n      jitter = vec2(0., 0.);\n      if (gl_PointSize < 0.05) {\n        gl_Position = discard_me;\n        return;\n      }\n    }\n    gl_Position = vec4(position + jitter, 0., 1.);\n  } else {\n    gl_Position = vec4(position + jitter, 0., 1.);\n  }  \n  if (u_color_picker_mode == 1.) {\n    // Add one so the first element is distinguishable.\n    fill = encode_float_1604150559(ix + 1.);\n  } else if (u_color_picker_mode == 2.) {\n    fill = encode_float_1604150559(u_tile_id + 1.);\n  } else if (u_color_picker_mode == 3.) {\n    fill = encode_float_1604150559(ix_in_tile + 1.);\n  } else {\n    run_color_fill(ease);\n  }\n\n  // Are we in a mode where we need to plot foreground and background?\n  if (u_foreground_number > -1.) {\n    // In that case, throw away points from the other half of the set.\n    if (u_foreground_number != foreground_status) {\n      gl_Position = discard_me;\n      return;\n    }\n    if (u_foreground_number == 1.) {\n      gl_PointSize *= u_foreground_size;\n      fill = vec4(fill.rgb, min(1., fill.a * u_foreground_alpha));\n    }\n    // If we\'re in background mode, got to change the points a bit.\n    if (u_foreground_number == 0.) { \n      gl_PointSize *= u_background_size;\n      // Should the color piker run?\n      if (u_color_picker_mode >= 1.) {\n        if (u_background_mouseover == 1.) {\n          // pass--keep the colors as are.\n        } else {\n          gl_Position = discard_me;\n          return;\n        }\n      } else {\n       float alpha = min(u_alpha * u_background_rgba.a, 1.);\n        if (alpha < 1./255.) {\n          // Very light alphas must be quantized. Only show an appropriate sample.\n          float seed = ix_to_random(ix, 38.6);\n          if (alpha * 255. < seed) {\n            gl_Position = discard_me;\n            return;\n          } else {\n            alpha = 1. / 255.;\n          }\n        }\n        fill = vec4(u_background_rgba.rgb, alpha);\n      }\n    }\n  }\n    \n  point_size = gl_PointSize;\n\n/*  if (u_use_glyphset > 0. && point_size > 5.0) {\n    float random_letter = floor(64. * ix_to_random(ix, 1.3));\n    letter_pos = vec2(\n      // start at a number between 0 and 7.\n      mod(random_letter, 8.) / 8.,\n      floor(random_letter / 8.) / 8.\n    );\n    gl_PointSize *= 3.0;\n  }*/\n}\n',count:(t,e)=>e.manager.count,attributes:{},uniforms:{u_update_time:t.prop("update_time"),u_transition_duration:(t,e)=>e.prefs.duration,u_only_color:(t,e)=>void 0!==e.only_color?e.only_color:-2,u_use_glyphset:(t,{prefs:e})=>e.glyph_set?1:0,u_glyphset:(t,{prefs:e})=>e.glyph_set?this.get_image_texture(e.glyph_set):this.textures.empty_texture,u_color_picker_mode:t.prop("color_picker_mode"),u_position_interpolation_mode(){return this.aes.position_interpolation?1:0},u_grid_mode:(t,{grid_mode:e})=>e,u_colors_as_grid:t.prop("colors_as_grid"),u_tile_id:(t,e)=>e.tile_id,u_width:({viewportWidth:t})=>t,u_height:({viewportHeight:t})=>t,u_one_d_aesthetic_map:this.aes.aesthetic_map.one_d_texture,u_color_aesthetic_map:this.aes.aesthetic_map.color_texture,u_aspect_ratio:({viewportWidth:t,viewportHeight:e})=>t/e,u_zoom_balance:t.prop("zoom_balance"),u_base_size:(t,{point_size:e})=>e,u_maxix:(t,{max_ix:e})=>e,u_alpha:(t,{alpha:e})=>e,u_foreground_number:(t,{foreground:e})=>e,u_foreground_alpha:()=>this.render_props.foreground_opacity,u_background_rgba:()=>{const t=this.prefs.background_options.color,{r:e,g:n,b:r}=xr(t);return[e/255,n/255,r/255,this.prefs.background_options.opacity]},u_background_mouseover:()=>this.prefs.background_options.mouseover?1:0,u_background_size:()=>this.render_props.background_size,u_foreground_size:()=>this.render_props.foreground_size,u_k:(t,e)=>e.transform.k,u_window_scale:t.prop("webgl_scale"),u_last_window_scale:t.prop("last_webgl_scale"),u_time:({time:t})=>t,u_filter_numeric(){return this.aes.dim("filter").current.ops_to_array()},u_last_filter_numeric(){return this.aes.dim("filter").last.ops_to_array()},u_filter2_numeric(){return this.aes.dim("filter2").current.ops_to_array()},u_last_filter2_numeric(){return this.aes.dim("filter2").last.ops_to_array()},u_foreground_numeric(){return this.aes.dim("foreground").current.ops_to_array()},u_last_foreground_numeric(){return this.aes.dim("foreground").last.ops_to_array()},u_jitter:()=>this.aes.dim("jitter_radius").current.jitter_int_format,u_last_jitter:()=>this.aes.dim("jitter_radius").last.jitter_int_format,u_zoom:(t,e)=>e.zoom_matrix}};for(const n of Nt(0,16))e.attributes[`buffer_${n}`]=(t,{manager:e,buffer_num_to_variable:r})=>e.regl_elements.get(r[n])||{constant:0};for(const n of["x","y","color","jitter_radius","x0","y0","jitter_speed","size","filter","filter2","foreground"])for(const t of["current","last"]){const r="current"===t?"":"last_";e.uniforms[`u_${r}${n}_map_position`]=()=>this.aes.dim(n)[t].map_position,e.uniforms[`u_${r}${n}_buffer_num`]=(e,{aes_to_buffer_num:r})=>{const i=r[`${n}--${t}`];return void 0===i?-1:i},e.uniforms[`u_${r}${n}_domain`]=()=>this.aes.dim(n)[t].webGLDomain,e.uniforms[`u_${r}${n}_range`]=()=>this.aes.dim(n)[t].range,e.uniforms[`u_${r}${n}_transform`]=()=>{const e=this.aes.dim(n)[t].transform;if("linear"===e)return 1;if("sqrt"===e)return 2;if("log"===e)return 3;if("literal"===e)return 4;throw"Invalid transform"},e.uniforms[`u_${r}${n}_constant`]=()=>this.aes.dim(n)[t].constant}return this._renderer=t(e),this._renderer}allocate_aesthetic_buffers(){const t=[],e=["x","y","color","x0","y0","size","jitter_radius","jitter_speed","filter","filter2","foreground"];for(const s of e){const e=["current","last"];for(const n of e)try{this.aes.dim(s)[n].field&&t.push({aesthetic:s,time:n,field:this.aes.dim(s)[n].field})}catch(a){throw this.reglframe=void 0,a}}t.sort(((t,n)=>t.time<n.time?-1:n.time<t.time?1:e.indexOf(t.aesthetic)-e.indexOf(n.aesthetic)));const n={},r={ix:0,ix_in_tile:1};let i=1;for(const{aesthetic:s,time:u,field:c}of t){const t=`${s}--${u}`;void 0===r[c]?i++<16?(n[t]=i,r[c]=i):n[t]=n[`${s}--current`]:n[t]=r[c]}const o=[...Object.keys(r)];this.aes_to_buffer_num=n,this.variable_to_buffer_num=r,this.buffer_num_to_variable=o}get discard_share(){return 0}}class bu{constructor(t,e,n){this.tile=e,this.regl=t,this.renderer=n,this.regl_elements=new Map([["ix_in_tile",{offset:0,stride:4,buffer:n.integer_buffer,byte_size:262144}]])}ready(){const{renderer:t}=this,e=new Set;for(const[n,r]of t.aes)for(const t of r.states)t.field&&e.add(t.field);for(const n of["ix","ix_in_tile",...e])if(!this.ready_or_not_here_it_comes(n).ready)return!1;return!0}ready_or_not_here_it_comes(t){const{renderer:e,regl_elements:n}=this,r=this.regl_elements.get(t);if(null===r)return{ready:!1,promise:null};if(void 0===r){if(!this.tile.ready)return{ready:!1,promise:null};n.set(t,null);return{ready:!1,promise:new Promise((n=>{e.deferred_functions.push((async()=>{await this.create_regl_buffer(t),n()}))}))}}return{ready:!0,promise:Promise.resolve()}}release(t){let e;(e=this.regl_elements.get(t))&&this.renderer.buffers.free_block(e)}get count(){return this.tile.record_batch.numRows}async create_buffer_data(t){const{tile:e}=this;if(!e.ready)throw new Error("Tile table not present.");let n=e.record_batch.getChild(t);if(!n){if(void 0===e.dataset.transformations[t]){const n=e.record_batch.schema.fields.map((t=>t.name));throw new Error(`Requested ${t} but table only has columns ["${n.join('", "')}]"`)}if(await e.apply_transformation(t),n=e.record_batch.getChild(t),!n)throw new Error(`${t} was not created.`)}if(1!==n.data.length)throw new Error(`Column ${t} has ${n.data.length} buffers, not 1.`);if(!n.type||!n.type.typeId)throw new Error(`Column ${t} has no type.`);if(!n.type||3!==n.type.typeId){const t=new Float32Array(e.record_batch.numRows),r=n.data[0];if(n.type.dictionary)for(let n=0;n<e.record_batch.numRows;n++)t[n]=r.values[n]-2047;else if(6===n.type.typeId)for(let i=0;i<e.record_batch.numRows;i++)t[i]=n.get(i)?1:0;else if(2===r.stride&&10===n.type.typeId){const i=new Int32Array(r.values).buffer,o=new BigInt64Array(i),a=n.type.unit,s=0===a?.001:1===a?1:2===a?1e3:3===a?1e6:42;if(42===s)throw new Error(`Unknown time type ${a}`);for(let n=0;n<e.record_batch.numRows;n++)t[n]=Number(o[n])/s}else for(let n=0;n<e.record_batch.numRows;n++)t[n]=Number(r.values[n]);return t}return n.data[0].values.constructor===Float64Array?new Float32Array(n.data[0].values):n.data[0].values}async create_regl_buffer(t){const{regl_elements:e,renderer:n}=this,r=await this.create_buffer_data(t);if(r.constructor!==Float32Array)throw console.warn(typeof r,r),new Error("Buffer data must be a Float32Array");const i=r.length,o=n.buffers.allocate_block(i,4);e.set(t,o),o.buffer.subdata(r,o.offset)}}class yu{constructor(t,e){this.freed_buffers=[],this.regl=t,this.buffer_size=e,this.buffers=[],this.pointer=0,this.generate_new_buffer()}generate_new_buffer(){this.buffers.length&&this.buffer_size-this.pointer>128&&this.freed_buffers.push({buffer:this.buffers[0],offset:this.pointer,stride:4,byte_size:this.buffer_size-this.pointer}),this.pointer=0,this.buffers.unshift(this.regl.buffer({type:"float",length:this.buffer_size,usage:"dynamic"}))}free_block(t){this.freed_buffers.push(t)}allocate_block(t,e){const n=t*e;let r=0;for(const o of this.freed_buffers){if(o.byte_size===n)return this.freed_buffers.splice(r,1),{buffer:o.buffer,offset:o.offset,stride:e,byte_size:n};r+=1}this.pointer+t*e>this.buffer_size&&this.generate_new_buffer();const i={buffer:this.buffers[0],offset:this.pointer,stride:e,byte_size:t*e};return this.pointer+=t*e,i}}function gu(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(e){o(e)}}function s(t){try{u(r.throw(t))}catch(e){o(e)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function vu(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function wu(t){return this instanceof wu?(this.v=t,this):new wu(t)}function xu(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),o=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(t){i[t]&&(r[t]=function(e){return new Promise((function(n,r){o.push([t,e,n,r])>1||s(t,e)}))})}function s(t,e){try{(n=i[t](e)).value instanceof wu?Promise.resolve(n.value.v).then(u,c):f(o[0][2],n)}catch(r){f(o[0][3],r)}var n}function u(t){s("next",t)}function c(t){s("throw",t)}function f(t,e){t(e),o.shift(),o.length&&s(o[0][0],o[0][1])}}function Au(t){var e,n;return e={},r("next"),r("throw",(function(t){throw t})),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,i){e[r]=t[r]?function(e){return(n=!n)?{value:wu(t[r](e)),done:!1}:i?i(e):e}:i}}function Su(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=vu(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,i){(function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)})(r,i,(e=t[n](e)).done,e.value)}))}}}"function"==typeof SuppressedError&&SuppressedError;const Iu=new TextDecoder("utf-8"),Ou=t=>Iu.decode(t),Tu=new TextEncoder,ku=t=>Tu.encode(t),[Mu,Eu]=(()=>{const t=()=>{throw new Error("BigInt64Array is not available in this environment")};return"undefined"!=typeof BigInt64Array?[BigInt64Array,!0]:[class{static get BYTES_PER_ELEMENT(){return 8}static of(){throw t()}static from(){throw t()}constructor(){throw t()}},!1]})(),[Bu,ju]=(()=>{const t=()=>{throw new Error("BigUint64Array is not available in this environment")};return"undefined"!=typeof BigUint64Array?[BigUint64Array,!0]:[class{static get BYTES_PER_ELEMENT(){return 8}static of(){throw t()}static from(){throw t()}constructor(){throw t()}},!1]})(),Du=t=>"function"==typeof t,zu=t=>null!=t&&Object(t)===t,Nu=t=>zu(t)&&Du(t.then),Fu=t=>zu(t)&&Du(t[Symbol.iterator]),Cu=t=>zu(t)&&Du(t[Symbol.asyncIterator]),Lu=t=>zu(t)&&zu(t.schema),Ru=t=>zu(t)&&"done"in t&&"value"in t,Uu=t=>zu(t)&&Du(t.stat)&&(t=>"number"==typeof t)(t.fd),Pu=t=>zu(t)&&$u(t.body),Vu=t=>"_getDOMStream"in t&&"_getNodeStream"in t,$u=t=>zu(t)&&Du(t.cancel)&&Du(t.getReader)&&!Vu(t),Yu=t=>zu(t)&&Du(t.read)&&Du(t.pipe)&&(t=>"boolean"==typeof t)(t.readable)&&!Vu(t),Wu=t=>zu(t)&&Du(t.clear)&&Du(t.bytes)&&Du(t.position)&&Du(t.setPosition)&&Du(t.capacity)&&Du(t.getBufferIdentifier)&&Du(t.createLong),Gu="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;function qu(t,e,n=0,r=e.byteLength){const i=t.byteLength,o=new Uint8Array(t.buffer,t.byteOffset,i),a=new Uint8Array(e.buffer,e.byteOffset,Math.min(r,i));return o.set(a,n),t}function Hu(t,e){const n=function(t){const e=t[0]?[t[0]]:[];let n,r,i,o;for(let a,s,u=0,c=0,f=t.length;++u<f;)a=e[c],s=t[u],!a||!s||a.buffer!==s.buffer||s.byteOffset<a.byteOffset?s&&(e[++c]=s):(({byteOffset:n,byteLength:i}=a),({byteOffset:r,byteLength:o}=s),n+i<r||r+o<n?s&&(e[++c]=s):e[c]=new Uint8Array(a.buffer,n,r-n+o));return e}(t),r=n.reduce(((t,e)=>t+e.byteLength),0);let i,o,a,s=0,u=-1;const c=Math.min(e||Number.POSITIVE_INFINITY,r);for(const f=n.length;++u<f;){if(i=n[u],o=i.subarray(0,Math.min(i.length,c-s)),c<=s+o.length){o.length<i.length?n[u]=i.subarray(o.length):o.length===i.length&&u++,a?qu(a,o,s):a=o;break}qu(a||(a=new Uint8Array(c)),o,s),s+=o.length}return[a||new Uint8Array(0),n.slice(u),r-(a?a.byteLength:0)]}function Xu(t,e){let n=Ru(e)?e.value:e;return n instanceof t?t===Uint8Array?new t(n.buffer,n.byteOffset,n.byteLength):n:n?("string"==typeof n&&(n=ku(n)),n instanceof ArrayBuffer||n instanceof Gu?new t(n):Wu(n)?Xu(t,n.bytes()):ArrayBuffer.isView(n)?n.byteLength<=0?new t(0):new t(n.buffer,n.byteOffset,n.byteLength/t.BYTES_PER_ELEMENT):t.from(n)):new t(0)}const Zu=t=>Xu(Int32Array,t),Ju=t=>Xu(Uint8Array,t),Ku=t=>(t.next(),t);const Qu=t=>function*(t,e){const n=function*(t){yield t},r="string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof Gu?n(e):Fu(e)?e:n(e);return yield*Ku(function*(e){let n=null;do{n=e.next(yield Xu(t,n))}while(!n.done)}(r[Symbol.iterator]())),new t}(Uint8Array,t);function tc(t,e){return xu(this,arguments,(function*(){if(Nu(e))return yield wu(yield wu(yield*Au(Su(tc(t,yield wu(e))))));const n=function(t){return xu(this,arguments,(function*(){yield yield wu(yield wu(t))}))},r="string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof Gu?n(e):Fu(e)?function(t){return xu(this,arguments,(function*(){yield wu(yield*Au(Su(Ku(function*(t){let e=null;do{e=t.next(yield null==e?void 0:e.value)}while(!e.done)}(t[Symbol.iterator]())))))}))}(e):Cu(e)?e:n(e);return yield wu(yield*Au(Su(Ku(function(e){return xu(this,arguments,(function*(){let n=null;do{n=yield wu(e.next(yield yield wu(Xu(t,n))))}while(!n.done)}))}(r[Symbol.asyncIterator]()))))),yield wu(new t)}))}const ec=t=>tc(Uint8Array,t);const nc={fromIterable:t=>rc(function*(t){let e,n,r,i,o=!1,a=[],s=0;function u(){return"peek"===r?Hu(a,i)[0]:([n,a,s]=Hu(a,i),n)}({cmd:r,size:i}=yield null);const c=Qu(t)[Symbol.iterator]();try{do{if(({done:e,value:n}=Number.isNaN(i-s)?c.next():c.next(i-s)),!e&&n.byteLength>0&&(a.push(n),s+=n.byteLength),e||i<=s)do{({cmd:r,size:i}=yield u())}while(i<s)}while(!e)}catch(f){(o=!0)&&"function"==typeof c.throw&&c.throw(f)}finally{!1===o&&"function"==typeof c.return&&c.return(null)}return null}(t)),fromAsyncIterable:t=>rc(function(t){return xu(this,arguments,(function*(){let e,n,r,i,o=!1,a=[],s=0;function u(){return"peek"===r?Hu(a,i)[0]:([n,a,s]=Hu(a,i),n)}({cmd:r,size:i}=yield yield wu(null));const c=ec(t)[Symbol.asyncIterator]();try{do{if(({done:e,value:n}=Number.isNaN(i-s)?yield wu(c.next()):yield wu(c.next(i-s))),!e&&n.byteLength>0&&(a.push(n),s+=n.byteLength),e||i<=s)do{({cmd:r,size:i}=yield yield wu(u()))}while(i<s)}while(!e)}catch(f){(o=!0)&&"function"==typeof c.throw&&(yield wu(c.throw(f)))}finally{!1===o&&"function"==typeof c.return&&(yield wu(c.return(new Uint8Array(0))))}return yield wu(null)}))}(t)),fromDOMStream:t=>rc(function(t){return xu(this,arguments,(function*(){let e,n,r,i=!1,o=!1,a=[],s=0;function u(){return"peek"===n?Hu(a,r)[0]:([e,a,s]=Hu(a,r),e)}({cmd:n,size:r}=yield yield wu(null));const c=new ic(t);try{do{if(({done:i,value:e}=Number.isNaN(r-s)?yield wu(c.read()):yield wu(c.read(r-s))),!i&&e.byteLength>0&&(a.push(Ju(e)),s+=e.byteLength),i||r<=s)do{({cmd:n,size:r}=yield yield wu(u()))}while(r<s)}while(!i)}catch(f){(o=!0)&&(yield wu(c.cancel(f)))}finally{!1===o?yield wu(c.cancel()):t.locked&&c.releaseLock()}return yield wu(null)}))}(t)),fromNodeStream:t=>rc(function(t){return xu(this,arguments,(function*(){const e=[];let n,r,i,o="error",a=!1,s=null,u=0,c=[];function f(){return"peek"===n?Hu(c,r)[0]:([i,c,u]=Hu(c,r),i)}if(({cmd:n,size:r}=yield yield wu(null)),t.isTTY)return yield yield wu(new Uint8Array(0)),yield wu(null);try{e[0]=oc(t,"end"),e[1]=oc(t,"error");do{if(e[2]=oc(t,"readable"),[o,s]=yield wu(Promise.race(e.map((t=>t[2])))),"error"===o)break;if((a="end"===o)||(Number.isFinite(r-u)?(i=Ju(t.read(r-u)),i.byteLength<r-u&&(i=Ju(t.read()))):i=Ju(t.read()),i.byteLength>0&&(c.push(i),u+=i.byteLength)),a||r<=u)do{({cmd:n,size:r}=yield yield wu(f()))}while(r<u)}while(!a)}finally{yield wu(l(e,"error"===o?s:null))}return yield wu(null);function l(e,n){return i=c=null,new Promise(((r,i)=>{for(const[n,a]of e)t.off(n,a);try{const e=t.destroy;e&&e.call(t,n),n=void 0}catch(o){n=o||n}finally{null!=n?i(n):r()}}))}}))}(t)),toDOMStream(t,e){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(t,e){throw new Error('"toNodeStream" not available in this environment')}},rc=t=>(t.next(),t);class ic{constructor(t){this.source=t,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch((()=>{}))}get closed(){return this.reader?this.reader.closed.catch((()=>{})):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(t){return gu(this,void 0,void 0,(function*(){const{reader:e,source:n}=this;e&&(yield e.cancel(t).catch((()=>{}))),n&&n.locked&&this.releaseLock()}))}read(t){return gu(this,void 0,void 0,(function*(){if(0===t)return{done:null==this.reader,value:new Uint8Array(0)};const e=yield this.reader.read();return!e.done&&(e.value=Ju(e)),e}))}}const oc=(t,e)=>{const n=t=>r([e,t]);let r;return[e,n,new Promise((i=>(r=i)&&t.once(e,n)))]};var ac,sc,uc,cc,fc,lc,dc,hc,pc,_c,mc,bc,yc,gc,vc,wc,xc,Ac;(sc=ac||(ac={}))[sc.V1=0]="V1",sc[sc.V2=1]="V2",sc[sc.V3=2]="V3",sc[sc.V4=3]="V4",sc[sc.V5=4]="V5",(cc=uc||(uc={}))[cc.Sparse=0]="Sparse",cc[cc.Dense=1]="Dense",(lc=fc||(fc={}))[lc.HALF=0]="HALF",lc[lc.SINGLE=1]="SINGLE",lc[lc.DOUBLE=2]="DOUBLE",(hc=dc||(dc={}))[hc.DAY=0]="DAY",hc[hc.MILLISECOND=1]="MILLISECOND",(_c=pc||(pc={}))[_c.SECOND=0]="SECOND",_c[_c.MILLISECOND=1]="MILLISECOND",_c[_c.MICROSECOND=2]="MICROSECOND",_c[_c.NANOSECOND=3]="NANOSECOND",(bc=mc||(mc={}))[bc.YEAR_MONTH=0]="YEAR_MONTH",bc[bc.DAY_TIME=1]="DAY_TIME",bc[bc.MONTH_DAY_NANO=2]="MONTH_DAY_NANO",(gc=yc||(yc={}))[gc.NONE=0]="NONE",gc[gc.Schema=1]="Schema",gc[gc.DictionaryBatch=2]="DictionaryBatch",gc[gc.RecordBatch=3]="RecordBatch",gc[gc.Tensor=4]="Tensor",gc[gc.SparseTensor=5]="SparseTensor",(wc=vc||(vc={}))[wc.NONE=0]="NONE",wc[wc.Null=1]="Null",wc[wc.Int=2]="Int",wc[wc.Float=3]="Float",wc[wc.Binary=4]="Binary",wc[wc.Utf8=5]="Utf8",wc[wc.Bool=6]="Bool",wc[wc.Decimal=7]="Decimal",wc[wc.Date=8]="Date",wc[wc.Time=9]="Time",wc[wc.Timestamp=10]="Timestamp",wc[wc.Interval=11]="Interval",wc[wc.List=12]="List",wc[wc.Struct=13]="Struct",wc[wc.Union=14]="Union",wc[wc.FixedSizeBinary=15]="FixedSizeBinary",wc[wc.FixedSizeList=16]="FixedSizeList",wc[wc.Map=17]="Map",wc[wc.Dictionary=-1]="Dictionary",wc[wc.Int8=-2]="Int8",wc[wc.Int16=-3]="Int16",wc[wc.Int32=-4]="Int32",wc[wc.Int64=-5]="Int64",wc[wc.Uint8=-6]="Uint8",wc[wc.Uint16=-7]="Uint16",wc[wc.Uint32=-8]="Uint32",wc[wc.Uint64=-9]="Uint64",wc[wc.Float16=-10]="Float16",wc[wc.Float32=-11]="Float32",wc[wc.Float64=-12]="Float64",wc[wc.DateDay=-13]="DateDay",wc[wc.DateMillisecond=-14]="DateMillisecond",wc[wc.TimestampSecond=-15]="TimestampSecond",wc[wc.TimestampMillisecond=-16]="TimestampMillisecond",wc[wc.TimestampMicrosecond=-17]="TimestampMicrosecond",wc[wc.TimestampNanosecond=-18]="TimestampNanosecond",wc[wc.TimeSecond=-19]="TimeSecond",wc[wc.TimeMillisecond=-20]="TimeMillisecond",wc[wc.TimeMicrosecond=-21]="TimeMicrosecond",wc[wc.TimeNanosecond=-22]="TimeNanosecond",wc[wc.DenseUnion=-23]="DenseUnion",wc[wc.SparseUnion=-24]="SparseUnion",wc[wc.IntervalDayTime=-25]="IntervalDayTime",wc[wc.IntervalYearMonth=-26]="IntervalYearMonth",(Ac=xc||(xc={}))[Ac.OFFSET=0]="OFFSET",Ac[Ac.DATA=1]="DATA",Ac[Ac.VALIDITY=2]="VALIDITY",Ac[Ac.TYPE=3]="TYPE";const Sc=void 0;function Ic(t){if(null===t)return"null";if(t===Sc)return"undefined";switch(typeof t){case"number":case"bigint":return`${t}`;case"string":return`"${t}"`}return"function"==typeof t[Symbol.toPrimitive]?t[Symbol.toPrimitive]("string"):ArrayBuffer.isView(t)?t instanceof Mu||t instanceof Bu?`[${[...t].map((t=>Ic(t)))}]`:`[${t}]`:ArrayBuffer.isView(t)?`[${t}]`:JSON.stringify(t,((t,e)=>"bigint"==typeof e?`${e}`:e))}const Oc=Symbol.for("isArrowBigNum");function Tc(t,...e){return 0===e.length?Object.setPrototypeOf(Xu(this.TypedArray,t),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(t,...e),this.constructor.prototype)}function kc(...t){return Tc.apply(this,t)}function Mc(...t){return Tc.apply(this,t)}function Ec(...t){return Tc.apply(this,t)}function Bc(t){const{buffer:e,byteOffset:n,length:r,signed:i}=t,o=new Bu(e,n,r),a=i&&o[o.length-1]&BigInt(1)<<BigInt(63);let s=a?BigInt(1):BigInt(0),u=BigInt(0);if(a){for(const t of o)s+=~t*(BigInt(1)<<BigInt(32)*u++);s*=BigInt(-1)}else for(const c of o)s+=c*(BigInt(1)<<BigInt(32)*u++);return s}Tc.prototype[Oc]=!0,Tc.prototype.toJSON=function(){return`"${jc(this)}"`},Tc.prototype.valueOf=function(){return Bc(this)},Tc.prototype.toString=function(){return jc(this)},Tc.prototype[Symbol.toPrimitive]=function(t="default"){switch(t){case"number":return Bc(this);case"string":return jc(this);case"default":return Dc(this)}return jc(this)},Object.setPrototypeOf(kc.prototype,Object.create(Int32Array.prototype)),Object.setPrototypeOf(Mc.prototype,Object.create(Uint32Array.prototype)),Object.setPrototypeOf(Ec.prototype,Object.create(Uint32Array.prototype)),Object.assign(kc.prototype,Tc.prototype,{constructor:kc,signed:!0,TypedArray:Int32Array,BigIntArray:Mu}),Object.assign(Mc.prototype,Tc.prototype,{constructor:Mc,signed:!1,TypedArray:Uint32Array,BigIntArray:Bu}),Object.assign(Ec.prototype,Tc.prototype,{constructor:Ec,signed:!0,TypedArray:Uint32Array,BigIntArray:Bu});const jc=t=>8===t.byteLength?`${new t.BigIntArray(t.buffer,t.byteOffset,1)[0]}`:zc(t),Dc=t=>8===t.byteLength?new t.BigIntArray(t.buffer,t.byteOffset,1)[0]:zc(t);function zc(t){let e="";const n=new Uint32Array(2);let r=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2);const i=new Uint32Array((r=new Uint16Array(r).reverse()).buffer);let o=-1;const a=r.length-1;do{for(n[0]=r[o=0];o<a;)r[o++]=n[1]=n[0]/10,n[0]=(n[0]-10*n[1]<<16)+r[o];r[o]=n[1]=n[0]/10,n[0]=n[0]-10*n[1],e=`${n[0]}${e}`}while(i[0]||i[1]||i[2]||i[3]);return null!=e?e:"0"}class Nc{static new(t,e){switch(e){case!0:return new kc(t);case!1:return new Mc(t)}switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:case Mu:return new kc(t)}return 16===t.byteLength?new Ec(t):new Mc(t)}static signed(t){return new kc(t)}static unsigned(t){return new Mc(t)}static decimal(t){return new Ec(t)}constructor(t,e){return Nc.new(t,e)}}function Fc(t){if("bigint"==typeof t&&(t<Number.MIN_SAFE_INTEGER||t>Number.MAX_SAFE_INTEGER))throw new TypeError(`${t} is not safe to convert to a number.`);return Number(t)}var Cc,Lc,Rc,Uc,Pc,Vc,$c,Yc,Wc,Gc,qc,Hc,Xc,Zc,Jc,Kc,Qc,tf,ef,nf;class rf{static isNull(t){return(null==t?void 0:t.typeId)===vc.Null}static isInt(t){return(null==t?void 0:t.typeId)===vc.Int}static isFloat(t){return(null==t?void 0:t.typeId)===vc.Float}static isBinary(t){return(null==t?void 0:t.typeId)===vc.Binary}static isUtf8(t){return(null==t?void 0:t.typeId)===vc.Utf8}static isBool(t){return(null==t?void 0:t.typeId)===vc.Bool}static isDecimal(t){return(null==t?void 0:t.typeId)===vc.Decimal}static isDate(t){return(null==t?void 0:t.typeId)===vc.Date}static isTime(t){return(null==t?void 0:t.typeId)===vc.Time}static isTimestamp(t){return(null==t?void 0:t.typeId)===vc.Timestamp}static isInterval(t){return(null==t?void 0:t.typeId)===vc.Interval}static isList(t){return(null==t?void 0:t.typeId)===vc.List}static isStruct(t){return(null==t?void 0:t.typeId)===vc.Struct}static isUnion(t){return(null==t?void 0:t.typeId)===vc.Union}static isFixedSizeBinary(t){return(null==t?void 0:t.typeId)===vc.FixedSizeBinary}static isFixedSizeList(t){return(null==t?void 0:t.typeId)===vc.FixedSizeList}static isMap(t){return(null==t?void 0:t.typeId)===vc.Map}static isDictionary(t){return(null==t?void 0:t.typeId)===vc.Dictionary}static isDenseUnion(t){return rf.isUnion(t)&&t.mode===uc.Dense}static isSparseUnion(t){return rf.isUnion(t)&&t.mode===uc.Sparse}get typeId(){return vc.NONE}}Cc=Symbol.toStringTag,rf[Cc]=((nf=rf.prototype).children=null,nf.ArrayType=Array,nf[Symbol.toStringTag]="DataType");let of=class extends rf{toString(){return"Null"}get typeId(){return vc.Null}};Lc=Symbol.toStringTag,of[Lc]=(t=>t[Symbol.toStringTag]="Null")(of.prototype);class af extends rf{constructor(t,e){super(),this.isSigned=t,this.bitWidth=e}get typeId(){return vc.Int}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?Mu:Bu}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}Rc=Symbol.toStringTag,af[Rc]=(t=>(t.isSigned=null,t.bitWidth=null,t[Symbol.toStringTag]="Int"))(af.prototype);class sf extends af{constructor(){super(!0,8)}get ArrayType(){return Int8Array}}class uf extends af{constructor(){super(!0,16)}get ArrayType(){return Int16Array}}class cf extends af{constructor(){super(!0,32)}get ArrayType(){return Int32Array}}let ff=class extends af{constructor(){super(!0,64)}get ArrayType(){return Mu}};class lf extends af{constructor(){super(!1,8)}get ArrayType(){return Uint8Array}}class df extends af{constructor(){super(!1,16)}get ArrayType(){return Uint16Array}}class hf extends af{constructor(){super(!1,32)}get ArrayType(){return Uint32Array}}let pf=class extends af{constructor(){super(!1,64)}get ArrayType(){return Bu}};Object.defineProperty(sf.prototype,"ArrayType",{value:Int8Array}),Object.defineProperty(uf.prototype,"ArrayType",{value:Int16Array}),Object.defineProperty(cf.prototype,"ArrayType",{value:Int32Array}),Object.defineProperty(ff.prototype,"ArrayType",{value:Mu}),Object.defineProperty(lf.prototype,"ArrayType",{value:Uint8Array}),Object.defineProperty(df.prototype,"ArrayType",{value:Uint16Array}),Object.defineProperty(hf.prototype,"ArrayType",{value:Uint32Array}),Object.defineProperty(pf.prototype,"ArrayType",{value:Bu});class _f extends rf{constructor(t){super(),this.precision=t}get typeId(){return vc.Float}get ArrayType(){switch(this.precision){case fc.HALF:return Uint16Array;case fc.SINGLE:return Float32Array;case fc.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}}Uc=Symbol.toStringTag,_f[Uc]=(t=>(t.precision=null,t[Symbol.toStringTag]="Float"))(_f.prototype);class mf extends _f{constructor(){super(fc.SINGLE)}}class bf extends _f{constructor(){super(fc.DOUBLE)}}Object.defineProperty(mf.prototype,"ArrayType",{value:Float32Array}),Object.defineProperty(bf.prototype,"ArrayType",{value:Float64Array});let yf=class extends rf{constructor(){super()}get typeId(){return vc.Binary}toString(){return"Binary"}};Pc=Symbol.toStringTag,yf[Pc]=(t=>(t.ArrayType=Uint8Array,t[Symbol.toStringTag]="Binary"))(yf.prototype);let gf=class extends rf{constructor(){super()}get typeId(){return vc.Utf8}toString(){return"Utf8"}};Vc=Symbol.toStringTag,gf[Vc]=(t=>(t.ArrayType=Uint8Array,t[Symbol.toStringTag]="Utf8"))(gf.prototype);let vf=class extends rf{constructor(){super()}get typeId(){return vc.Bool}toString(){return"Bool"}};$c=Symbol.toStringTag,vf[$c]=(t=>(t.ArrayType=Uint8Array,t[Symbol.toStringTag]="Bool"))(vf.prototype);let wf=class extends rf{constructor(t,e,n=128){super(),this.scale=t,this.precision=e,this.bitWidth=n}get typeId(){return vc.Decimal}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}};Yc=Symbol.toStringTag,wf[Yc]=(t=>(t.scale=null,t.precision=null,t.ArrayType=Uint32Array,t[Symbol.toStringTag]="Decimal"))(wf.prototype);class xf extends rf{constructor(t){super(),this.unit=t}get typeId(){return vc.Date}toString(){return`Date${32*(this.unit+1)}<${dc[this.unit]}>`}}Wc=Symbol.toStringTag,xf[Wc]=(t=>(t.unit=null,t.ArrayType=Int32Array,t[Symbol.toStringTag]="Date"))(xf.prototype);class Af extends rf{constructor(t,e){super(),this.unit=t,this.bitWidth=e}get typeId(){return vc.Time}toString(){return`Time${this.bitWidth}<${pc[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return Mu}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}}Gc=Symbol.toStringTag,Af[Gc]=(t=>(t.unit=null,t.bitWidth=null,t[Symbol.toStringTag]="Time"))(Af.prototype);class Sf extends rf{constructor(t,e){super(),this.unit=t,this.timezone=e}get typeId(){return vc.Timestamp}toString(){return`Timestamp<${pc[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}}qc=Symbol.toStringTag,Sf[qc]=(t=>(t.unit=null,t.timezone=null,t.ArrayType=Int32Array,t[Symbol.toStringTag]="Timestamp"))(Sf.prototype);class If extends rf{constructor(t){super(),this.unit=t}get typeId(){return vc.Interval}toString(){return`Interval<${mc[this.unit]}>`}}Hc=Symbol.toStringTag,If[Hc]=(t=>(t.unit=null,t.ArrayType=Int32Array,t[Symbol.toStringTag]="Interval"))(If.prototype);let Of=class extends rf{constructor(t){super(),this.children=[t]}get typeId(){return vc.List}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}};Xc=Symbol.toStringTag,Of[Xc]=(t=>(t.children=null,t[Symbol.toStringTag]="List"))(Of.prototype);class Tf extends rf{constructor(t){super(),this.children=t}get typeId(){return vc.Struct}toString(){return`Struct<{${this.children.map((t=>`${t.name}:${t.type}`)).join(", ")}}>`}}Zc=Symbol.toStringTag,Tf[Zc]=(t=>(t.children=null,t[Symbol.toStringTag]="Struct"))(Tf.prototype);class kf extends rf{constructor(t,e,n){super(),this.mode=t,this.children=n,this.typeIds=e=Int32Array.from(e),this.typeIdToChildIndex=e.reduce(((t,e,n)=>(t[e]=n)&&t||t),Object.create(null))}get typeId(){return vc.Union}toString(){return`${this[Symbol.toStringTag]}<${this.children.map((t=>`${t.type}`)).join(" | ")}>`}}Jc=Symbol.toStringTag,kf[Jc]=(t=>(t.mode=null,t.typeIds=null,t.children=null,t.typeIdToChildIndex=null,t.ArrayType=Int8Array,t[Symbol.toStringTag]="Union"))(kf.prototype);let Mf=class extends rf{constructor(t){super(),this.byteWidth=t}get typeId(){return vc.FixedSizeBinary}toString(){return`FixedSizeBinary[${this.byteWidth}]`}};Kc=Symbol.toStringTag,Mf[Kc]=(t=>(t.byteWidth=null,t.ArrayType=Uint8Array,t[Symbol.toStringTag]="FixedSizeBinary"))(Mf.prototype);let Ef=class extends rf{constructor(t,e){super(),this.listSize=t,this.children=[e]}get typeId(){return vc.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}};Qc=Symbol.toStringTag,Ef[Qc]=(t=>(t.children=null,t.listSize=null,t[Symbol.toStringTag]="FixedSizeList"))(Ef.prototype);class Bf extends rf{constructor(t,e=!1){super(),this.children=[t],this.keysSorted=e}get typeId(){return vc.Map}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map((t=>`${t.name}:${t.type}`)).join(", ")}}>`}}tf=Symbol.toStringTag,Bf[tf]=(t=>(t.children=null,t.keysSorted=null,t[Symbol.toStringTag]="Map_"))(Bf.prototype);const jf=(Df=-1,()=>++Df);var Df;class zf extends rf{constructor(t,e,n,r){super(),this.indices=e,this.dictionary=t,this.isOrdered=r||!1,this.id=null==n?jf():Fc(n)}get typeId(){return vc.Dictionary}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}}function Nf(t){const e=t;switch(t.typeId){case vc.Decimal:return t.bitWidth/32;case vc.Timestamp:return 2;case vc.Date:case vc.Interval:return 1+e.unit;case vc.FixedSizeList:return e.listSize;case vc.FixedSizeBinary:return e.byteWidth;default:return 1}}ef=Symbol.toStringTag,zf[ef]=(t=>(t.id=null,t.indices=null,t.isOrdered=null,t.dictionary=null,t[Symbol.toStringTag]="Dictionary"))(zf.prototype);class Ff{visitMany(t,...e){return t.map(((t,n)=>this.visit(t,...e.map((t=>t[n])))))}visit(...t){return this.getVisitFn(t[0],!1).apply(this,t)}getVisitFn(t,e=!0){return function(t,e,n=!0){if("number"==typeof e)return Cf(t,e,n);if("string"==typeof e&&e in vc)return Cf(t,vc[e],n);if(e&&e instanceof rf)return Cf(t,Lf(e),n);if((null==e?void 0:e.type)&&e.type instanceof rf)return Cf(t,Lf(e.type),n);return Cf(t,vc.NONE,n)}(this,t,e)}getVisitFnByTypeId(t,e=!0){return Cf(this,t,e)}visitNull(t,...e){return null}visitBool(t,...e){return null}visitInt(t,...e){return null}visitFloat(t,...e){return null}visitUtf8(t,...e){return null}visitBinary(t,...e){return null}visitFixedSizeBinary(t,...e){return null}visitDate(t,...e){return null}visitTimestamp(t,...e){return null}visitTime(t,...e){return null}visitDecimal(t,...e){return null}visitList(t,...e){return null}visitStruct(t,...e){return null}visitUnion(t,...e){return null}visitDictionary(t,...e){return null}visitInterval(t,...e){return null}visitFixedSizeList(t,...e){return null}visitMap(t,...e){return null}}function Cf(t,e,n=!0){let r=null;switch(e){case vc.Null:r=t.visitNull;break;case vc.Bool:r=t.visitBool;break;case vc.Int:r=t.visitInt;break;case vc.Int8:r=t.visitInt8||t.visitInt;break;case vc.Int16:r=t.visitInt16||t.visitInt;break;case vc.Int32:r=t.visitInt32||t.visitInt;break;case vc.Int64:r=t.visitInt64||t.visitInt;break;case vc.Uint8:r=t.visitUint8||t.visitInt;break;case vc.Uint16:r=t.visitUint16||t.visitInt;break;case vc.Uint32:r=t.visitUint32||t.visitInt;break;case vc.Uint64:r=t.visitUint64||t.visitInt;break;case vc.Float:r=t.visitFloat;break;case vc.Float16:r=t.visitFloat16||t.visitFloat;break;case vc.Float32:r=t.visitFloat32||t.visitFloat;break;case vc.Float64:r=t.visitFloat64||t.visitFloat;break;case vc.Utf8:r=t.visitUtf8;break;case vc.Binary:r=t.visitBinary;break;case vc.FixedSizeBinary:r=t.visitFixedSizeBinary;break;case vc.Date:r=t.visitDate;break;case vc.DateDay:r=t.visitDateDay||t.visitDate;break;case vc.DateMillisecond:r=t.visitDateMillisecond||t.visitDate;break;case vc.Timestamp:r=t.visitTimestamp;break;case vc.TimestampSecond:r=t.visitTimestampSecond||t.visitTimestamp;break;case vc.TimestampMillisecond:r=t.visitTimestampMillisecond||t.visitTimestamp;break;case vc.TimestampMicrosecond:r=t.visitTimestampMicrosecond||t.visitTimestamp;break;case vc.TimestampNanosecond:r=t.visitTimestampNanosecond||t.visitTimestamp;break;case vc.Time:r=t.visitTime;break;case vc.TimeSecond:r=t.visitTimeSecond||t.visitTime;break;case vc.TimeMillisecond:r=t.visitTimeMillisecond||t.visitTime;break;case vc.TimeMicrosecond:r=t.visitTimeMicrosecond||t.visitTime;break;case vc.TimeNanosecond:r=t.visitTimeNanosecond||t.visitTime;break;case vc.Decimal:r=t.visitDecimal;break;case vc.List:r=t.visitList;break;case vc.Struct:r=t.visitStruct;break;case vc.Union:r=t.visitUnion;break;case vc.DenseUnion:r=t.visitDenseUnion||t.visitUnion;break;case vc.SparseUnion:r=t.visitSparseUnion||t.visitUnion;break;case vc.Dictionary:r=t.visitDictionary;break;case vc.Interval:r=t.visitInterval;break;case vc.IntervalDayTime:r=t.visitIntervalDayTime||t.visitInterval;break;case vc.IntervalYearMonth:r=t.visitIntervalYearMonth||t.visitInterval;break;case vc.FixedSizeList:r=t.visitFixedSizeList;break;case vc.Map:r=t.visitMap}if("function"==typeof r)return r;if(!n)return()=>null;throw new Error(`Unrecognized type '${vc[e]}'`)}function Lf(t){switch(t.typeId){case vc.Null:return vc.Null;case vc.Int:{const{bitWidth:e,isSigned:n}=t;switch(e){case 8:return n?vc.Int8:vc.Uint8;case 16:return n?vc.Int16:vc.Uint16;case 32:return n?vc.Int32:vc.Uint32;case 64:return n?vc.Int64:vc.Uint64}return vc.Int}case vc.Float:switch(t.precision){case fc.HALF:return vc.Float16;case fc.SINGLE:return vc.Float32;case fc.DOUBLE:return vc.Float64}return vc.Float;case vc.Binary:return vc.Binary;case vc.Utf8:return vc.Utf8;case vc.Bool:return vc.Bool;case vc.Decimal:return vc.Decimal;case vc.Time:switch(t.unit){case pc.SECOND:return vc.TimeSecond;case pc.MILLISECOND:return vc.TimeMillisecond;case pc.MICROSECOND:return vc.TimeMicrosecond;case pc.NANOSECOND:return vc.TimeNanosecond}return vc.Time;case vc.Timestamp:switch(t.unit){case pc.SECOND:return vc.TimestampSecond;case pc.MILLISECOND:return vc.TimestampMillisecond;case pc.MICROSECOND:return vc.TimestampMicrosecond;case pc.NANOSECOND:return vc.TimestampNanosecond}return vc.Timestamp;case vc.Date:switch(t.unit){case dc.DAY:return vc.DateDay;case dc.MILLISECOND:return vc.DateMillisecond}return vc.Date;case vc.Interval:switch(t.unit){case mc.DAY_TIME:return vc.IntervalDayTime;case mc.YEAR_MONTH:return vc.IntervalYearMonth}return vc.Interval;case vc.Map:return vc.Map;case vc.List:return vc.List;case vc.Struct:return vc.Struct;case vc.Union:switch(t.mode){case uc.Dense:return vc.DenseUnion;case uc.Sparse:return vc.SparseUnion}return vc.Union;case vc.FixedSizeBinary:return vc.FixedSizeBinary;case vc.FixedSizeList:return vc.FixedSizeList;case vc.Dictionary:return vc.Dictionary}throw new Error(`Unrecognized type '${vc[t.typeId]}'`)}Ff.prototype.visitInt8=null,Ff.prototype.visitInt16=null,Ff.prototype.visitInt32=null,Ff.prototype.visitInt64=null,Ff.prototype.visitUint8=null,Ff.prototype.visitUint16=null,Ff.prototype.visitUint32=null,Ff.prototype.visitUint64=null,Ff.prototype.visitFloat16=null,Ff.prototype.visitFloat32=null,Ff.prototype.visitFloat64=null,Ff.prototype.visitDateDay=null,Ff.prototype.visitDateMillisecond=null,Ff.prototype.visitTimestampSecond=null,Ff.prototype.visitTimestampMillisecond=null,Ff.prototype.visitTimestampMicrosecond=null,Ff.prototype.visitTimestampNanosecond=null,Ff.prototype.visitTimeSecond=null,Ff.prototype.visitTimeMillisecond=null,Ff.prototype.visitTimeMicrosecond=null,Ff.prototype.visitTimeNanosecond=null,Ff.prototype.visitDenseUnion=null,Ff.prototype.visitSparseUnion=null,Ff.prototype.visitIntervalDayTime=null,Ff.prototype.visitIntervalYearMonth=null;const Rf=new Float64Array(1),Uf=new Uint32Array(Rf.buffer);function Pf(t){const e=(31744&t)>>10,n=(1023&t)/1024,r=Math.pow(-1,(32768&t)>>15);switch(e){case 31:return r*(n?Number.NaN:1/0);case 0:return r*(n?6103515625e-14*n:0)}return r*Math.pow(2,e-15)*(1+n)}class Vf extends Ff{}function $f(t){return(e,n,r)=>{if(e.setValid(n,null!=r))return t(e,n,r)}}const Yf=(t,e,n)=>{t[e]=Math.trunc(n%4294967296),t[e+1]=Math.trunc(n/4294967296)},Wf=(t,e,n,r)=>{if(n+1<e.length){const{[n]:i,[n+1]:o}=e;t.set(r.subarray(0,o-i),i)}},Gf=({values:t},e,n)=>{t[e]=n},qf=({values:t},e,n)=>{t[e]=n},Hf=({values:t},e,n)=>{t[e]=function(t){if(t!=t)return 32256;Rf[0]=t;const e=(2147483648&Uf[1])>>16&65535;let n=2146435072&Uf[1],r=0;return n>=1089470464?Uf[0]>0?n=31744:(n=(2080374784&n)>>16,r=(1048575&Uf[1])>>10):n<=1056964608?(r=1048576+(1048575&Uf[1]),r=1048576+(r<<(n>>20)-998)>>21,n=0):(n=n-1056964608>>10,r=512+(1048575&Uf[1])>>10),e|n|65535&r}(n)},Xf=({values:t},e,n)=>{((t,e,n)=>{t[e]=Math.trunc(n/864e5)})(t,e,n.valueOf())},Zf=({values:t},e,n)=>{Yf(t,2*e,n.valueOf())},Jf=({values:t},e,n)=>Yf(t,2*e,n/1e3),Kf=({values:t},e,n)=>Yf(t,2*e,n),Qf=({values:t},e,n)=>((t,e,n)=>{t[e]=Math.trunc(1e3*n%4294967296),t[e+1]=Math.trunc(1e3*n/4294967296)})(t,2*e,n),tl=({values:t},e,n)=>((t,e,n)=>{t[e]=Math.trunc(1e6*n%4294967296),t[e+1]=Math.trunc(1e6*n/4294967296)})(t,2*e,n),el=({values:t},e,n)=>{t[e]=n},nl=({values:t},e,n)=>{t[e]=n},rl=({values:t},e,n)=>{t[e]=n},il=({values:t},e,n)=>{t[e]=n},ol=(t,e,n)=>{const r=t.type.typeIdToChildIndex[t.typeIds[e]],i=t.children[r];cl.visit(i,t.valueOffsets[e],n)},al=(t,e,n)=>{const r=t.type.typeIdToChildIndex[t.typeIds[e]],i=t.children[r];cl.visit(i,e,n)},sl=({values:t},e,n)=>{t.set(n.subarray(0,2),2*e)},ul=({values:t},e,n)=>{t[e]=12*n[0]+n[1]%12};Vf.prototype.visitBool=$f((({offset:t,values:e},n,r)=>{const i=t+n;r?e[i>>3]|=1<<i%8:e[i>>3]&=~(1<<i%8)})),Vf.prototype.visitInt=$f(Gf),Vf.prototype.visitInt8=$f(Gf),Vf.prototype.visitInt16=$f(Gf),Vf.prototype.visitInt32=$f(Gf),Vf.prototype.visitInt64=$f(Gf),Vf.prototype.visitUint8=$f(Gf),Vf.prototype.visitUint16=$f(Gf),Vf.prototype.visitUint32=$f(Gf),Vf.prototype.visitUint64=$f(Gf),Vf.prototype.visitFloat=$f(((t,e,n)=>{switch(t.type.precision){case fc.HALF:return Hf(t,e,n);case fc.SINGLE:case fc.DOUBLE:return qf(t,e,n)}})),Vf.prototype.visitFloat16=$f(Hf),Vf.prototype.visitFloat32=$f(qf),Vf.prototype.visitFloat64=$f(qf),Vf.prototype.visitUtf8=$f((({values:t,valueOffsets:e},n,r)=>{Wf(t,e,n,ku(r))})),Vf.prototype.visitBinary=$f((({values:t,valueOffsets:e},n,r)=>Wf(t,e,n,r))),Vf.prototype.visitFixedSizeBinary=$f((({stride:t,values:e},n,r)=>{e.set(r.subarray(0,t),t*n)})),Vf.prototype.visitDate=$f(((t,e,n)=>{t.type.unit===dc.DAY?Xf(t,e,n):Zf(t,e,n)})),Vf.prototype.visitDateDay=$f(Xf),Vf.prototype.visitDateMillisecond=$f(Zf),Vf.prototype.visitTimestamp=$f(((t,e,n)=>{switch(t.type.unit){case pc.SECOND:return Jf(t,e,n);case pc.MILLISECOND:return Kf(t,e,n);case pc.MICROSECOND:return Qf(t,e,n);case pc.NANOSECOND:return tl(t,e,n)}})),Vf.prototype.visitTimestampSecond=$f(Jf),Vf.prototype.visitTimestampMillisecond=$f(Kf),Vf.prototype.visitTimestampMicrosecond=$f(Qf),Vf.prototype.visitTimestampNanosecond=$f(tl),Vf.prototype.visitTime=$f(((t,e,n)=>{switch(t.type.unit){case pc.SECOND:return el(t,e,n);case pc.MILLISECOND:return nl(t,e,n);case pc.MICROSECOND:return rl(t,e,n);case pc.NANOSECOND:return il(t,e,n)}})),Vf.prototype.visitTimeSecond=$f(el),Vf.prototype.visitTimeMillisecond=$f(nl),Vf.prototype.visitTimeMicrosecond=$f(rl),Vf.prototype.visitTimeNanosecond=$f(il),Vf.prototype.visitDecimal=$f((({values:t,stride:e},n,r)=>{t.set(r.subarray(0,e),e*n)})),Vf.prototype.visitList=$f(((t,e,n)=>{const r=t.children[0],i=t.valueOffsets,o=cl.getVisitFn(r);if(Array.isArray(n))for(let a=-1,s=i[e],u=i[e+1];s<u;)o(r,s++,n[++a]);else for(let a=-1,s=i[e],u=i[e+1];s<u;)o(r,s++,n.get(++a))})),Vf.prototype.visitStruct=$f(((t,e,n)=>{const r=t.type.children.map((t=>cl.getVisitFn(t.type))),i=n instanceof Map?(o=e,a=n,(t,e,n,r)=>e&&t(e,o,a.get(n.name))):n instanceof kd?((t,e)=>(n,r,i,o)=>r&&n(r,t,e.get(o)))(e,n):Array.isArray(n)?((t,e)=>(n,r,i,o)=>r&&n(r,t,e[o]))(e,n):((t,e)=>(n,r,i,o)=>r&&n(r,t,e[i.name]))(e,n);var o,a;t.type.children.forEach(((e,n)=>i(r[n],t.children[n],e,n)))})),Vf.prototype.visitUnion=$f(((t,e,n)=>{t.type.mode===uc.Dense?ol(t,e,n):al(t,e,n)})),Vf.prototype.visitDenseUnion=$f(ol),Vf.prototype.visitSparseUnion=$f(al),Vf.prototype.visitDictionary=$f(((t,e,n)=>{var r;null===(r=t.dictionary)||void 0===r||r.set(t.values[e],n)})),Vf.prototype.visitInterval=$f(((t,e,n)=>{t.type.unit===mc.DAY_TIME?sl(t,e,n):ul(t,e,n)})),Vf.prototype.visitIntervalDayTime=$f(sl),Vf.prototype.visitIntervalYearMonth=$f(ul),Vf.prototype.visitFixedSizeList=$f(((t,e,n)=>{const{stride:r}=t,i=t.children[0],o=cl.getVisitFn(i);if(Array.isArray(n))for(let a=-1,s=e*r;++a<r;)o(i,s+a,n[a]);else for(let a=-1,s=e*r;++a<r;)o(i,s+a,n.get(a))})),Vf.prototype.visitMap=$f(((t,e,n)=>{const r=t.children[0],{valueOffsets:i}=t,o=cl.getVisitFn(r);let{[e]:a,[e+1]:s}=i;const u=n instanceof Map?n.entries():Object.entries(n);for(const c of u)if(o(r,a,c),++a>=s)break}));const cl=new Vf,fl=Symbol.for("parent"),ll=Symbol.for("rowIndex");class dl{constructor(t,e){return this[fl]=t,this[ll]=e,new Proxy(this,new pl)}toArray(){return Object.values(this.toJSON())}toJSON(){const t=this[ll],e=this[fl],n=e.type.children,r={};for(let i=-1,o=n.length;++i<o;)r[n[i].name]=Fl.visit(e.children[i],t);return r}toString(){return`{${[...this].map((([t,e])=>`${Ic(t)}: ${Ic(e)}`)).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new hl(this[fl],this[ll])}}class hl{constructor(t,e){this.childIndex=0,this.children=t.children,this.rowIndex=e,this.childFields=t.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){const t=this.childIndex;return t<this.numChildren?(this.childIndex=t+1,{done:!1,value:[this.childFields[t].name,Fl.visit(this.children[t],this.rowIndex)]}):{done:!0,value:null}}}Object.defineProperties(dl.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[fl]:{writable:!0,enumerable:!1,configurable:!1,value:null},[ll]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});class pl{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[fl].type.children.map((t=>t.name))}has(t,e){return-1!==t[fl].type.children.findIndex((t=>t.name===e))}getOwnPropertyDescriptor(t,e){if(-1!==t[fl].type.children.findIndex((t=>t.name===e)))return{writable:!0,enumerable:!0,configurable:!0}}get(t,e){if(Reflect.has(t,e))return t[e];const n=t[fl].type.children.findIndex((t=>t.name===e));if(-1!==n){const r=Fl.visit(t[fl].children[n],t[ll]);return Reflect.set(t,e,r),r}}set(t,e,n){const r=t[fl].type.children.findIndex((t=>t.name===e));return-1!==r?(cl.visit(t[fl].children[r],t[ll],n),Reflect.set(t,e,n)):!(!Reflect.has(t,e)&&"symbol"!=typeof e)&&Reflect.set(t,e,n)}}class _l extends Ff{}function ml(t){return(e,n)=>e.getValid(n)?t(e,n):null}const bl=(t,e)=>4294967296*t[e+1]+(t[e]>>>0),yl=t=>new Date(t),gl=(t,e,n)=>{if(n+1>=e.length)return null;const r=e[n],i=e[n+1];return t.subarray(r,i)},vl=({values:t},e)=>((t,e)=>yl(((t,e)=>864e5*t[e])(t,e)))(t,e),wl=({values:t},e)=>((t,e)=>yl(bl(t,e)))(t,2*e),xl=({stride:t,values:e},n)=>e[t*n],Al=({values:t},e)=>t[e],Sl=({values:t},e)=>1e3*bl(t,2*e),Il=({values:t},e)=>bl(t,2*e),Ol=({values:t},e)=>((t,e)=>t[e+1]/1e3*4294967296+(t[e]>>>0)/1e3)(t,2*e),Tl=({values:t},e)=>((t,e)=>t[e+1]/1e6*4294967296+(t[e]>>>0)/1e6)(t,2*e),kl=({values:t},e)=>t[e],Ml=({values:t},e)=>t[e],El=({values:t},e)=>t[e],Bl=({values:t},e)=>t[e],jl=(t,e)=>{const n=t.type.typeIdToChildIndex[t.typeIds[e]],r=t.children[n];return Fl.visit(r,t.valueOffsets[e])},Dl=(t,e)=>{const n=t.type.typeIdToChildIndex[t.typeIds[e]],r=t.children[n];return Fl.visit(r,e)},zl=({values:t},e)=>t.subarray(2*e,2*(e+1)),Nl=({values:t},e)=>{const n=t[e],r=new Int32Array(2);return r[0]=Math.trunc(n/12),r[1]=Math.trunc(n%12),r};_l.prototype.visitNull=ml(((t,e)=>null)),_l.prototype.visitBool=ml((({offset:t,values:e},n)=>{const r=t+n;return 0!=(e[r>>3]&1<<r%8)})),_l.prototype.visitInt=ml((({values:t},e)=>t[e])),_l.prototype.visitInt8=ml(xl),_l.prototype.visitInt16=ml(xl),_l.prototype.visitInt32=ml(xl),_l.prototype.visitInt64=ml(Al),_l.prototype.visitUint8=ml(xl),_l.prototype.visitUint16=ml(xl),_l.prototype.visitUint32=ml(xl),_l.prototype.visitUint64=ml(Al),_l.prototype.visitFloat=ml((({type:t,values:e},n)=>t.precision!==fc.HALF?e[n]:Pf(e[n]))),_l.prototype.visitFloat16=ml((({stride:t,values:e},n)=>Pf(e[t*n]))),_l.prototype.visitFloat32=ml(xl),_l.prototype.visitFloat64=ml(xl),_l.prototype.visitUtf8=ml((({values:t,valueOffsets:e},n)=>{const r=gl(t,e,n);return null!==r?Ou(r):null})),_l.prototype.visitBinary=ml((({values:t,valueOffsets:e},n)=>gl(t,e,n))),_l.prototype.visitFixedSizeBinary=ml((({stride:t,values:e},n)=>e.subarray(t*n,t*(n+1)))),_l.prototype.visitDate=ml(((t,e)=>t.type.unit===dc.DAY?vl(t,e):wl(t,e))),_l.prototype.visitDateDay=ml(vl),_l.prototype.visitDateMillisecond=ml(wl),_l.prototype.visitTimestamp=ml(((t,e)=>{switch(t.type.unit){case pc.SECOND:return Sl(t,e);case pc.MILLISECOND:return Il(t,e);case pc.MICROSECOND:return Ol(t,e);case pc.NANOSECOND:return Tl(t,e)}})),_l.prototype.visitTimestampSecond=ml(Sl),_l.prototype.visitTimestampMillisecond=ml(Il),_l.prototype.visitTimestampMicrosecond=ml(Ol),_l.prototype.visitTimestampNanosecond=ml(Tl),_l.prototype.visitTime=ml(((t,e)=>{switch(t.type.unit){case pc.SECOND:return kl(t,e);case pc.MILLISECOND:return Ml(t,e);case pc.MICROSECOND:return El(t,e);case pc.NANOSECOND:return Bl(t,e)}})),_l.prototype.visitTimeSecond=ml(kl),_l.prototype.visitTimeMillisecond=ml(Ml),_l.prototype.visitTimeMicrosecond=ml(El),_l.prototype.visitTimeNanosecond=ml(Bl),_l.prototype.visitDecimal=ml((({values:t,stride:e},n)=>Nc.decimal(t.subarray(e*n,e*(n+1))))),_l.prototype.visitList=ml(((t,e)=>{const{valueOffsets:n,stride:r,children:i}=t,{[e*r]:o,[e*r+1]:a}=n,s=i[0].slice(o,a-o);return new kd([s])})),_l.prototype.visitStruct=ml(((t,e)=>new dl(t,e))),_l.prototype.visitUnion=ml(((t,e)=>t.type.mode===uc.Dense?jl(t,e):Dl(t,e))),_l.prototype.visitDenseUnion=ml(jl),_l.prototype.visitSparseUnion=ml(Dl),_l.prototype.visitDictionary=ml(((t,e)=>{var n;return null===(n=t.dictionary)||void 0===n?void 0:n.get(t.values[e])})),_l.prototype.visitInterval=ml(((t,e)=>t.type.unit===mc.DAY_TIME?zl(t,e):Nl(t,e))),_l.prototype.visitIntervalDayTime=ml(zl),_l.prototype.visitIntervalYearMonth=ml(Nl),_l.prototype.visitFixedSizeList=ml(((t,e)=>{const{stride:n,children:r}=t,i=r[0].slice(e*n,n);return new kd([i])})),_l.prototype.visitMap=ml(((t,e)=>{const{valueOffsets:n,children:r}=t,{[e]:i,[e+1]:o}=n,a=r[0];return new Rl(a.slice(i,o-i))}));const Fl=new _l,Cl=Symbol.for("keys"),Ll=Symbol.for("vals");class Rl{constructor(t){return this[Cl]=new kd([t.children[0]]).memoize(),this[Ll]=t.children[1],new Proxy(this,new Pl)}[Symbol.iterator](){return new Ul(this[Cl],this[Ll])}get size(){return this[Cl].length}toArray(){return Object.values(this.toJSON())}toJSON(){const t=this[Cl],e=this[Ll],n={};for(let r=-1,i=t.length;++r<i;)n[t.get(r)]=Fl.visit(e,r);return n}toString(){return`{${[...this].map((([t,e])=>`${Ic(t)}: ${Ic(e)}`)).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}class Ul{constructor(t,e){this.keys=t,this.vals=e,this.keyIndex=0,this.numKeys=t.length}[Symbol.iterator](){return this}next(){const t=this.keyIndex;return t===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(t),Fl.visit(this.vals,t)]})}}class Pl{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[Cl].toArray().map(String)}has(t,e){return t[Cl].includes(e)}getOwnPropertyDescriptor(t,e){if(-1!==t[Cl].indexOf(e))return{writable:!0,enumerable:!0,configurable:!0}}get(t,e){if(Reflect.has(t,e))return t[e];const n=t[Cl].indexOf(e);if(-1!==n){const r=Fl.visit(Reflect.get(t,Ll),n);return Reflect.set(t,e,r),r}}set(t,e,n){const r=t[Cl].indexOf(e);return-1!==r?(cl.visit(Reflect.get(t,Ll),r,n),Reflect.set(t,e,n)):!!Reflect.has(t,e)&&Reflect.set(t,e,n)}}let Vl;function $l(t,e,n,r){const{length:i=0}=t;let o="number"!=typeof e?0:e,a="number"!=typeof n?i:n;return o<0&&(o=(o%i+i)%i),a<0&&(a=(a%i+i)%i),a<o&&(Vl=o,o=a,a=Vl),a>i&&(a=i),r?r(t,o,a):[o,a]}Object.defineProperties(Rl.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[Cl]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Ll]:{writable:!0,enumerable:!1,configurable:!1,value:null}});const Yl=t=>t!=t;function Wl(t){if("object"!==typeof t||null===t)return Yl(t)?Yl:e=>e===t;if(t instanceof Date){const e=t.valueOf();return t=>t instanceof Date&&t.valueOf()===e}return ArrayBuffer.isView(t)?e=>!!e&&function(t,e){let n=0;const r=t.length;if(r!==e.length)return!1;if(r>0)do{if(t[n]!==e[n])return!1}while(++n<r);return!0}(t,e):t instanceof Map?function(t){let e=-1;const n=[];for(const r of t.values())n[++e]=Wl(r);return Gl(n)}(t):Array.isArray(t)?function(t){const e=[];for(let n=-1,r=t.length;++n<r;)e[n]=Wl(t[n]);return Gl(e)}(t):t instanceof kd?function(t){const e=[];for(let n=-1,r=t.length;++n<r;)e[n]=Wl(t.get(n));return Gl(e)}(t):function(t,e=!1){const n=Object.keys(t);if(!e&&0===n.length)return()=>!1;const r=[];for(let i=-1,o=n.length;++i<o;)r[i]=Wl(t[n[i]]);return Gl(r,n)}(t,!0)}function Gl(t,e){return n=>{if(!n||"object"!=typeof n)return!1;switch(n.constructor){case Array:return function(t,e){const n=t.length;if(e.length!==n)return!1;for(let r=-1;++r<n;)if(!t[r](e[r]))return!1;return!0}(t,n);case Map:return ql(t,n,n.keys());case Rl:case dl:case Object:case void 0:return ql(t,n,e||Object.keys(n))}return n instanceof kd&&function(t,e){const n=t.length;if(e.length!==n)return!1;for(let r=-1;++r<n;)if(!t[r](e.get(r)))return!1;return!0}(t,n)}}function ql(t,e,n){const r=n[Symbol.iterator](),i=e instanceof Map?e.keys():Object.keys(e)[Symbol.iterator](),o=e instanceof Map?e.values():Object.values(e)[Symbol.iterator]();let a=0;const s=t.length;let u=o.next(),c=r.next(),f=i.next();for(;a<s&&!c.done&&!f.done&&!u.done&&(c.value===f.value&&t[a](u.value));++a,c=r.next(),f=i.next(),u=o.next());return!!(a===s&&c.done&&f.done&&u.done)||(r.return&&r.return(),i.return&&i.return(),o.return&&o.return(),!1)}function Hl(t,e,n,r){return 0!=(n&1<<r)}function Xl(t,e,n,r){return(n&1<<r)>>r}function Zl(t){const e=[];let n=0,r=0,i=0;for(const a of t)a&&(i|=1<<r),8==++r&&(e[n++]=i,i=r=0);(0===n||r>0)&&(e[n++]=i);const o=new Uint8Array(e.length+7&-8);return o.set(e),o}class Jl{constructor(t,e,n,r,i){this.bytes=t,this.length=n,this.context=r,this.get=i,this.bit=e%8,this.byteIndex=e>>3,this.byte=t[this.byteIndex++],this.index=0}next(){return this.index<this.length?(8===this.bit&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}}function Kl(t,e,n){if(n-e<=0)return 0;if(n-e<8){let r=0;for(const i of new Jl(t,e,n-e,t,Xl))r+=i;return r}const r=n>>3<<3,i=e+(e%8==0?0:8-e%8);return Kl(t,e,i)+Kl(t,r,n)+function(t,e,n){let r=0,i=Math.trunc(e);const o=new DataView(t.buffer,t.byteOffset,t.byteLength),a=void 0===n?t.byteLength:i+n;for(;a-i>=4;)r+=Ql(o.getUint32(i)),i+=4;for(;a-i>=2;)r+=Ql(o.getUint16(i)),i+=2;for(;a-i>=1;)r+=Ql(o.getUint8(i)),i+=1;return r}(t,i>>3,r-i>>3)}function Ql(t){let e=Math.trunc(t);return e-=e>>>1&1431655765,e=(858993459&e)+(e>>>2&858993459),16843009*(e+(e>>>4)&252645135)>>>24}class td{get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get byteLength(){let t=0;const{valueOffsets:e,values:n,nullBitmap:r,typeIds:i}=this;return e&&(t+=e.byteLength),n&&(t+=n.byteLength),r&&(t+=r.byteLength),i&&(t+=i.byteLength),this.children.reduce(((t,e)=>t+e.byteLength),t)}get nullCount(){let t,e=this._nullCount;return e<=-1&&(t=this.nullBitmap)&&(this._nullCount=e=this.length-Kl(t,this.offset,this.offset+this.length)),e}constructor(t,e,n,r,i,o=[],a){let s;this.type=t,this.children=o,this.dictionary=a,this.offset=Math.floor(Math.max(e||0,0)),this.length=Math.floor(Math.max(n||0,0)),this._nullCount=Math.floor(Math.max(r||0,-1)),i instanceof td?(this.stride=i.stride,this.values=i.values,this.typeIds=i.typeIds,this.nullBitmap=i.nullBitmap,this.valueOffsets=i.valueOffsets):(this.stride=Nf(t),i&&((s=i[0])&&(this.valueOffsets=s),(s=i[1])&&(this.values=s),(s=i[2])&&(this.nullBitmap=s),(s=i[3])&&(this.typeIds=s))),this.nullable=0!==this._nullCount&&this.nullBitmap&&this.nullBitmap.byteLength>0}getValid(t){if(this.nullable&&this.nullCount>0){const e=this.offset+t;return 0!=(this.nullBitmap[e>>3]&1<<e%8)}return!0}setValid(t,e){if(!this.nullable)return e;if(!this.nullBitmap||this.nullBitmap.byteLength<=t>>3){const{nullBitmap:t}=this._changeLengthAndBackfillNullBitmap(this.length);Object.assign(this,{nullBitmap:t,_nullCount:0})}const{nullBitmap:n,offset:r}=this,i=r+t>>3,o=(r+t)%8,a=n[i]>>o&1;return e?0===a&&(n[i]|=1<<o,this._nullCount=this.nullCount+1):1===a&&(n[i]&=~(1<<o),this._nullCount=this.nullCount-1),e}clone(t=this.type,e=this.offset,n=this.length,r=this._nullCount,i=this,o=this.children){return new td(t,e,n,r,i,o,this.dictionary)}slice(t,e){const{stride:n,typeId:r,children:i}=this,o=+(0===this._nullCount)-1,a=16===r?n:1,s=this._sliceBuffers(t,e,n,r);return this.clone(this.type,this.offset+t,e,o,s,0===i.length||this.valueOffsets?i:this._sliceChildren(i,a*t,a*e))}_changeLengthAndBackfillNullBitmap(t){if(this.typeId===vc.Null)return this.clone(this.type,0,t,0);const{length:e,nullCount:n}=this,r=new Uint8Array((t+63&-64)>>3).fill(255,0,e>>3);r[e>>3]=(1<<e-(-8&e))-1,n>0&&r.set(function(t,e,n){const r=n.byteLength+7&-8;if(t>0||n.byteLength<r){const i=new Uint8Array(r);return i.set(t%8==0?n.subarray(t>>3):Zl(new Jl(n,t,e,null,Hl)).subarray(0,r)),i}return n}(this.offset,e,this.nullBitmap),0);const i=this.buffers;return i[xc.VALIDITY]=r,this.clone(this.type,0,t,n+(t-e),i)}_sliceBuffers(t,e,n,r){let i;const{buffers:o}=this;return(i=o[xc.TYPE])&&(o[xc.TYPE]=i.subarray(t,t+e)),(i=o[xc.OFFSET])&&(o[xc.OFFSET]=i.subarray(t,t+e+1))||(i=o[xc.DATA])&&(o[xc.DATA]=6===r?i:i.subarray(n*t,n*(t+e))),o}_sliceChildren(t,e,n){return t.map((t=>t.slice(e,n)))}}td.prototype.children=Object.freeze([]);class ed extends Ff{visit(t){return this.getVisitFn(t.type).call(this,t)}visitNull(t){const{type:e,offset:n=0,length:r=0}=t;return new td(e,n,r,0)}visitBool(t){const{type:e,offset:n=0}=t,r=Ju(t.nullBitmap),i=Xu(e.ArrayType,t.data),{length:o=i.length>>3,nullCount:a=(t.nullBitmap?-1:0)}=t;return new td(e,n,o,a,[void 0,i,r])}visitInt(t){const{type:e,offset:n=0}=t,r=Ju(t.nullBitmap),i=Xu(e.ArrayType,t.data),{length:o=i.length,nullCount:a=(t.nullBitmap?-1:0)}=t;return new td(e,n,o,a,[void 0,i,r])}visitFloat(t){const{type:e,offset:n=0}=t,r=Ju(t.nullBitmap),i=Xu(e.ArrayType,t.data),{length:o=i.length,nullCount:a=(t.nullBitmap?-1:0)}=t;return new td(e,n,o,a,[void 0,i,r])}visitUtf8(t){const{type:e,offset:n=0}=t,r=Ju(t.data),i=Ju(t.nullBitmap),o=Zu(t.valueOffsets),{length:a=o.length-1,nullCount:s=(t.nullBitmap?-1:0)}=t;return new td(e,n,a,s,[o,r,i])}visitBinary(t){const{type:e,offset:n=0}=t,r=Ju(t.data),i=Ju(t.nullBitmap),o=Zu(t.valueOffsets),{length:a=o.length-1,nullCount:s=(t.nullBitmap?-1:0)}=t;return new td(e,n,a,s,[o,r,i])}visitFixedSizeBinary(t){const{type:e,offset:n=0}=t,r=Ju(t.nullBitmap),i=Xu(e.ArrayType,t.data),{length:o=i.length/Nf(e),nullCount:a=(t.nullBitmap?-1:0)}=t;return new td(e,n,o,a,[void 0,i,r])}visitDate(t){const{type:e,offset:n=0}=t,r=Ju(t.nullBitmap),i=Xu(e.ArrayType,t.data),{length:o=i.length/Nf(e),nullCount:a=(t.nullBitmap?-1:0)}=t;return new td(e,n,o,a,[void 0,i,r])}visitTimestamp(t){const{type:e,offset:n=0}=t,r=Ju(t.nullBitmap),i=Xu(e.ArrayType,t.data),{length:o=i.length/Nf(e),nullCount:a=(t.nullBitmap?-1:0)}=t;return new td(e,n,o,a,[void 0,i,r])}visitTime(t){const{type:e,offset:n=0}=t,r=Ju(t.nullBitmap),i=Xu(e.ArrayType,t.data),{length:o=i.length/Nf(e),nullCount:a=(t.nullBitmap?-1:0)}=t;return new td(e,n,o,a,[void 0,i,r])}visitDecimal(t){const{type:e,offset:n=0}=t,r=Ju(t.nullBitmap),i=Xu(e.ArrayType,t.data),{length:o=i.length/Nf(e),nullCount:a=(t.nullBitmap?-1:0)}=t;return new td(e,n,o,a,[void 0,i,r])}visitList(t){const{type:e,offset:n=0,child:r}=t,i=Ju(t.nullBitmap),o=Zu(t.valueOffsets),{length:a=o.length-1,nullCount:s=(t.nullBitmap?-1:0)}=t;return new td(e,n,a,s,[o,void 0,i],[r])}visitStruct(t){const{type:e,offset:n=0,children:r=[]}=t,i=Ju(t.nullBitmap),{length:o=r.reduce(((t,{length:e})=>Math.max(t,e)),0),nullCount:a=(t.nullBitmap?-1:0)}=t;return new td(e,n,o,a,[void 0,void 0,i],r)}visitUnion(t){const{type:e,offset:n=0,children:r=[]}=t,i=Ju(t.nullBitmap),o=Xu(e.ArrayType,t.typeIds),{length:a=o.length,nullCount:s=(t.nullBitmap?-1:0)}=t;if(rf.isSparseUnion(e))return new td(e,n,a,s,[void 0,void 0,i,o],r);const u=Zu(t.valueOffsets);return new td(e,n,a,s,[u,void 0,i,o],r)}visitDictionary(t){const{type:e,offset:n=0}=t,r=Ju(t.nullBitmap),i=Xu(e.indices.ArrayType,t.data),{dictionary:o=new kd([(new ed).visit({type:e.dictionary})])}=t,{length:a=i.length,nullCount:s=(t.nullBitmap?-1:0)}=t;return new td(e,n,a,s,[void 0,i,r],[],o)}visitInterval(t){const{type:e,offset:n=0}=t,r=Ju(t.nullBitmap),i=Xu(e.ArrayType,t.data),{length:o=i.length/Nf(e),nullCount:a=(t.nullBitmap?-1:0)}=t;return new td(e,n,o,a,[void 0,i,r])}visitFixedSizeList(t){const{type:e,offset:n=0,child:r=(new ed).visit({type:e.valueType})}=t,i=Ju(t.nullBitmap),{length:o=r.length/Nf(e),nullCount:a=(t.nullBitmap?-1:0)}=t;return new td(e,n,o,a,[void 0,void 0,i],[r])}visitMap(t){const{type:e,offset:n=0,child:r=(new ed).visit({type:e.childType})}=t,i=Ju(t.nullBitmap),o=Zu(t.valueOffsets),{length:a=o.length-1,nullCount:s=(t.nullBitmap?-1:0)}=t;return new td(e,n,a,s,[o,void 0,i],[r])}}function nd(t){return(new ed).visit(t)}class rd{constructor(t=0,e){this.numChunks=t,this.getChunkIterator=e,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){const t=this.chunkIterator.next();if(!t.done)return t;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}}function id(t){return t.reduce(((t,e)=>t+e.nullCount),0)}function od(t){return t.reduce(((t,e,n)=>(t[n+1]=t[n]+e.length,t)),new Uint32Array(t.length+1))}function ad(t,e,n,r){const i=[];for(let o=-1,a=t.length;++o<a;){const a=t[o],s=e[o],{length:u}=a;if(s>=r)break;if(n>=s+u)continue;if(s>=n&&s+u<=r){i.push(a);continue}const c=Math.max(0,n-s),f=Math.min(r-s,u);i.push(a.slice(c,f-c))}return 0===i.length&&i.push(t[0].slice(0,0)),i}function sd(t,e,n,r){let i=0,o=0,a=e.length-1;do{if(i>=a-1)return n<e[a]?r(t,i,n-e[i]):null;o=i+Math.trunc(.5*(a-i)),n<e[o]?a=o:i=o}while(i<a)}function ud(t,e){return t.getValid(e)}function cd(t){function e(e,n,r){return t(e[n],r)}return function(t){return sd(this.data,this._offsets,t,e)}}function fd(t){let e;function n(n,r,i){return t(n[r],i,e)}return function(t,r){const i=this.data;e=r;const o=sd(i,this._offsets,t,n);return e=void 0,o}}function ld(t){let e;function n(n,r,i){let o=i,a=0,s=0;for(let u=r-1,c=n.length;++u<c;){const r=n[u];if(~(a=t(r,e,o)))return s+a;o=0,s+=r.length}return-1}return function(t,r){e=t;const i=this.data,o="number"!=typeof r?n(i,0,0):sd(i,this._offsets,r,n);return e=void 0,o}}class dd extends Ff{}function hd(t,e,n){if(void 0===e)return-1;if(null===e)return function(t,e){const{nullBitmap:n}=t;if(!n||t.nullCount<=0)return-1;let r=0;for(const i of new Jl(n,t.offset+(e||0),t.length,n,Hl)){if(!i)return r;++r}return-1}(t,n);const r=Fl.getVisitFn(t),i=Wl(e);for(let o=(n||0)-1,a=t.length;++o<a;)if(i(r(t,o)))return o;return-1}function pd(t,e,n){const r=Fl.getVisitFn(t),i=Wl(e);for(let o=(n||0)-1,a=t.length;++o<a;)if(i(r(t,o)))return o;return-1}dd.prototype.visitNull=function(t,e){return null===e&&t.length>0?0:-1},dd.prototype.visitBool=hd,dd.prototype.visitInt=hd,dd.prototype.visitInt8=hd,dd.prototype.visitInt16=hd,dd.prototype.visitInt32=hd,dd.prototype.visitInt64=hd,dd.prototype.visitUint8=hd,dd.prototype.visitUint16=hd,dd.prototype.visitUint32=hd,dd.prototype.visitUint64=hd,dd.prototype.visitFloat=hd,dd.prototype.visitFloat16=hd,dd.prototype.visitFloat32=hd,dd.prototype.visitFloat64=hd,dd.prototype.visitUtf8=hd,dd.prototype.visitBinary=hd,dd.prototype.visitFixedSizeBinary=hd,dd.prototype.visitDate=hd,dd.prototype.visitDateDay=hd,dd.prototype.visitDateMillisecond=hd,dd.prototype.visitTimestamp=hd,dd.prototype.visitTimestampSecond=hd,dd.prototype.visitTimestampMillisecond=hd,dd.prototype.visitTimestampMicrosecond=hd,dd.prototype.visitTimestampNanosecond=hd,dd.prototype.visitTime=hd,dd.prototype.visitTimeSecond=hd,dd.prototype.visitTimeMillisecond=hd,dd.prototype.visitTimeMicrosecond=hd,dd.prototype.visitTimeNanosecond=hd,dd.prototype.visitDecimal=hd,dd.prototype.visitList=hd,dd.prototype.visitStruct=hd,dd.prototype.visitUnion=hd,dd.prototype.visitDenseUnion=pd,dd.prototype.visitSparseUnion=pd,dd.prototype.visitDictionary=hd,dd.prototype.visitInterval=hd,dd.prototype.visitIntervalDayTime=hd,dd.prototype.visitIntervalYearMonth=hd,dd.prototype.visitFixedSizeList=hd,dd.prototype.visitMap=hd;const _d=new dd;class md extends Ff{}function bd(t){const{type:e}=t;if(0===t.nullCount&&1===t.stride&&(e.typeId===vc.Timestamp||e instanceof af&&64!==e.bitWidth||e instanceof Af&&64!==e.bitWidth||e instanceof _f&&e.precision!==fc.HALF))return new rd(t.data.length,(e=>{const n=t.data[e];return n.values.subarray(0,n.length)[Symbol.iterator]()}));let n=0;return new rd(t.data.length,(e=>{const r=t.data[e].length,i=t.slice(n,n+r);return n+=r,new yd(i)}))}class yd{constructor(t){this.vector=t,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}}md.prototype.visitNull=bd,md.prototype.visitBool=bd,md.prototype.visitInt=bd,md.prototype.visitInt8=bd,md.prototype.visitInt16=bd,md.prototype.visitInt32=bd,md.prototype.visitInt64=bd,md.prototype.visitUint8=bd,md.prototype.visitUint16=bd,md.prototype.visitUint32=bd,md.prototype.visitUint64=bd,md.prototype.visitFloat=bd,md.prototype.visitFloat16=bd,md.prototype.visitFloat32=bd,md.prototype.visitFloat64=bd,md.prototype.visitUtf8=bd,md.prototype.visitBinary=bd,md.prototype.visitFixedSizeBinary=bd,md.prototype.visitDate=bd,md.prototype.visitDateDay=bd,md.prototype.visitDateMillisecond=bd,md.prototype.visitTimestamp=bd,md.prototype.visitTimestampSecond=bd,md.prototype.visitTimestampMillisecond=bd,md.prototype.visitTimestampMicrosecond=bd,md.prototype.visitTimestampNanosecond=bd,md.prototype.visitTime=bd,md.prototype.visitTimeSecond=bd,md.prototype.visitTimeMillisecond=bd,md.prototype.visitTimeMicrosecond=bd,md.prototype.visitTimeNanosecond=bd,md.prototype.visitDecimal=bd,md.prototype.visitList=bd,md.prototype.visitStruct=bd,md.prototype.visitUnion=bd,md.prototype.visitDenseUnion=bd,md.prototype.visitSparseUnion=bd,md.prototype.visitDictionary=bd,md.prototype.visitInterval=bd,md.prototype.visitIntervalDayTime=bd,md.prototype.visitIntervalYearMonth=bd,md.prototype.visitFixedSizeList=bd,md.prototype.visitMap=bd;const gd=new md,vd=(t,e)=>t+e;class wd extends Ff{visitNull(t,e){return 0}visitInt(t,e){return t.type.bitWidth/8}visitFloat(t,e){return t.type.ArrayType.BYTES_PER_ELEMENT}visitBool(t,e){return 1/8}visitDecimal(t,e){return t.type.bitWidth/8}visitDate(t,e){return 4*(t.type.unit+1)}visitTime(t,e){return t.type.bitWidth/8}visitTimestamp(t,e){return t.type.unit===pc.SECOND?4:8}visitInterval(t,e){return 4*(t.type.unit+1)}visitStruct(t,e){return t.children.reduce(((t,n)=>t+Sd.visit(n,e)),0)}visitFixedSizeBinary(t,e){return t.type.byteWidth}visitMap(t,e){return 8+t.children.reduce(((t,n)=>t+Sd.visit(n,e)),0)}visitDictionary(t,e){var n;return t.type.indices.bitWidth/8+((null===(n=t.dictionary)||void 0===n?void 0:n.getByteLength(t.values[e]))||0)}}const xd=({type:t,children:e,typeIds:n,valueOffsets:r},i)=>{const o=t.typeIdToChildIndex[n[i]];return 8+Sd.visit(e[o],r[i])},Ad=({children:t},e)=>4+Sd.visitMany(t,t.map((()=>e))).reduce(vd,0);wd.prototype.visitUtf8=({valueOffsets:t},e)=>t[e+1]-t[e]+8,wd.prototype.visitBinary=({valueOffsets:t},e)=>t[e+1]-t[e]+8,wd.prototype.visitList=({valueOffsets:t,stride:e,children:n},r)=>{const i=n[0],{[r*e]:o}=t,{[r*e+1]:a}=t,s=Sd.getVisitFn(i.type),u=i.slice(o,a-o);let c=8;for(let f=-1,l=a-o;++f<l;)c+=s(u,f);return c},wd.prototype.visitFixedSizeList=({stride:t,children:e},n)=>{const r=e[0],i=r.slice(n*t,t),o=Sd.getVisitFn(r.type);let a=0;for(let s=-1,u=i.length;++s<u;)a+=o(i,s);return a},wd.prototype.visitUnion=(t,e)=>t.type.mode===uc.Dense?xd(t,e):Ad(t,e),wd.prototype.visitDenseUnion=xd,wd.prototype.visitSparseUnion=Ad;const Sd=new wd;var Id;const Od={},Td={};class kd{constructor(t){var e,n,r;const i=t[0]instanceof kd?t.flatMap((t=>t.data)):t;if(0===i.length||i.some((t=>!(t instanceof td))))throw new TypeError("Vector constructor expects an Array of Data instances.");const o=null===(e=i[0])||void 0===e?void 0:e.type;switch(i.length){case 0:this._offsets=[0];break;case 1:{const{get:t,set:e,indexOf:n,byteLength:r}=Od[o.typeId],a=i[0];this.isValid=t=>ud(a,t),this.get=e=>t(a,e),this.set=(t,n)=>e(a,t,n),this.indexOf=t=>n(a,t),this.getByteLength=t=>r(a,t),this._offsets=[0,a.length];break}default:Object.setPrototypeOf(this,Td[o.typeId]),this._offsets=od(i)}this.data=i,this.type=o,this.stride=Nf(o),this.numChildren=null!==(r=null===(n=o.children)||void 0===n?void 0:n.length)&&void 0!==r?r:0,this.length=this._offsets[this._offsets.length-1]}get byteLength(){return-1===this._byteLength&&(this._byteLength=this.data.reduce(((t,e)=>t+e.byteLength),0)),this._byteLength}get nullCount(){return-1===this._nullCount&&(this._nullCount=id(this.data)),this._nullCount}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${vc[this.type.typeId]}Vector`}isValid(t){return!1}get(t){return null}set(t,e){}indexOf(t,e){return-1}includes(t,e){return this.indexOf(t,e)>0}getByteLength(t){return 0}[Symbol.iterator](){return gd.visit(this)}concat(...t){return new kd(this.data.concat(t.flatMap((t=>t.data)).flat(Number.POSITIVE_INFINITY)))}slice(t,e){return new kd($l(this,t,e,(({data:t,_offsets:e},n,r)=>ad(t,e,n,r))))}toJSON(){return[...this]}toArray(){const{type:t,data:e,length:n,stride:r,ArrayType:i}=this;switch(t.typeId){case vc.Int:case vc.Float:case vc.Decimal:case vc.Time:case vc.Timestamp:switch(e.length){case 0:return new i;case 1:return e[0].values.subarray(0,n*r);default:return e.reduce(((t,{values:e,length:n})=>(t.array.set(e.subarray(0,n*r),t.offset),t.offset+=n*r,t)),{array:new i(n*r),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(t){var e;return this.getChildAt(null===(e=this.type.children)||void 0===e?void 0:e.findIndex((e=>e.name===t)))}getChildAt(t){return t>-1&&t<this.numChildren?new kd(this.data.map((({children:e})=>e[t]))):null}get isMemoized(){return!!rf.isDictionary(this.type)&&this.data[0].dictionary.isMemoized}memoize(){if(rf.isDictionary(this.type)){const t=new Md(this.data[0].dictionary),e=this.data.map((e=>{const n=e.clone();return n.dictionary=t,n}));return new kd(e)}return new Md(this)}unmemoize(){if(rf.isDictionary(this.type)&&this.isMemoized){const t=this.data[0].dictionary.unmemoize(),e=this.data.map((e=>{const n=e.clone();return n.dictionary=t,n}));return new kd(e)}return this}}Id=Symbol.toStringTag,kd[Id]=(t=>{t.type=rf.prototype,t.data=[],t.length=0,t.stride=1,t.numChildren=0,t._nullCount=-1,t._byteLength=-1,t._offsets=new Uint32Array([0]),t[Symbol.isConcatSpreadable]=!0;const e=Object.keys(vc).map((t=>vc[t])).filter((t=>"number"==typeof t&&t!==vc.NONE));for(const n of e){const e=Fl.getVisitFnByTypeId(n),r=cl.getVisitFnByTypeId(n),i=_d.getVisitFnByTypeId(n),o=Sd.getVisitFnByTypeId(n);Od[n]={get:e,set:r,indexOf:i,byteLength:o},Td[n]=Object.create(t,{isValid:{value:cd(ud)},get:{value:cd(Fl.getVisitFnByTypeId(n))},set:{value:fd(cl.getVisitFnByTypeId(n))},indexOf:{value:ld(_d.getVisitFnByTypeId(n))},getByteLength:{value:cd(Sd.getVisitFnByTypeId(n))}})}return"Vector"})(kd.prototype);class Md extends kd{constructor(t){super(t.data);const e=this.get,n=this.set,r=this.slice,i=new Array(this.length);Object.defineProperty(this,"get",{value(t){const n=i[t];if(void 0!==n)return n;const r=e.call(this,t);return i[t]=r,r}}),Object.defineProperty(this,"set",{value(t,e){n.call(this,t,e),i[t]=e}}),Object.defineProperty(this,"slice",{value:(t,e)=>new Md(r.call(this,t,e))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new kd(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}}function Ed(t){if(t){if(t instanceof td)return new kd([t]);if(t instanceof kd)return new kd(t.data);if(t.type instanceof rf)return new kd([nd(t)]);if(Array.isArray(t))return new kd(t.flatMap((t=>{return(e=t)instanceof td?[e]:e instanceof kd?e.data:Ed(e).data;var e})));if(ArrayBuffer.isView(t)){t instanceof DataView&&(t=new Uint8Array(t.buffer));const e={offset:0,length:t.length,nullCount:0,data:t};if(t instanceof Int8Array)return new kd([nd(Object.assign(Object.assign({},e),{type:new sf}))]);if(t instanceof Int16Array)return new kd([nd(Object.assign(Object.assign({},e),{type:new uf}))]);if(t instanceof Int32Array)return new kd([nd(Object.assign(Object.assign({},e),{type:new cf}))]);if(t instanceof Mu)return new kd([nd(Object.assign(Object.assign({},e),{type:new ff}))]);if(t instanceof Uint8Array||t instanceof Uint8ClampedArray)return new kd([nd(Object.assign(Object.assign({},e),{type:new lf}))]);if(t instanceof Uint16Array)return new kd([nd(Object.assign(Object.assign({},e),{type:new df}))]);if(t instanceof Uint32Array)return new kd([nd(Object.assign(Object.assign({},e),{type:new hf}))]);if(t instanceof Bu)return new kd([nd(Object.assign(Object.assign({},e),{type:new pf}))]);if(t instanceof Float32Array)return new kd([nd(Object.assign(Object.assign({},e),{type:new mf}))]);if(t instanceof Float64Array)return new kd([nd(Object.assign(Object.assign({},e),{type:new bf}))]);throw new Error("Unrecognized input")}}throw new Error("Unrecognized input")}class Bd{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(t,e,n,r){return t.prep(8,24),t.writeInt64(BigInt(null!=r?r:0)),t.pad(4),t.writeInt32(n),t.writeInt64(BigInt(null!=e?e:0)),t.offset()}}const jd=new Int32Array(2),Dd=new Float32Array(jd.buffer),zd=new Float64Array(jd.buffer),Nd=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0];var Fd,Cd;(Cd=Fd||(Fd={}))[Cd.UTF8_BYTES=1]="UTF8_BYTES",Cd[Cd.UTF16_STRING=2]="UTF16_STRING";let Ld=class t{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new t(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return jd[0]=this.readInt32(t),Dd[0]}readFloat64(t){return jd[Nd?0:1]=this.readInt32(t),jd[Nd?1:0]=this.readInt32(t+4),zd[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){Dd[0]=e,this.writeInt32(t,jd[0])}writeFloat64(t,e){zd[0]=e,this.writeInt32(t,jd[Nd?0:1]),this.writeInt32(t+4,jd[Nd?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<4;e++)t+=String.fromCharCode(this.readInt8(this.position_+4+e));return t}__offset(t,e){const n=t-this.readInt32(t);return e<this.readInt16(n)?this.readInt16(n+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const n=this.readInt32(t);t+=4;const r=this.bytes_.subarray(t,t+n);return e===Fd.UTF8_BYTES?r:this.text_decoder_.decode(r)}__union_with_string(t,e){return"string"==typeof t?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+4}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(4!=t.length)throw new Error("FlatBuffers: file identifier must be length 4");for(let e=0;e<4;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+4+e))return!1;return!0}createScalarList(t,e){const n=[];for(let r=0;r<e;++r){const e=t(r);null!==e&&n.push(e)}return n}createObjList(t,e){const n=[];for(let r=0;r<e;++r){const e=t(r);null!==e&&n.push(e.unpack())}return n}},Rd=class t{constructor(t){let e;this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder,e=t||1024,this.bb=Ld.allocate(e),this.space=e}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(t){this.force_defaults=t}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,n){e>this.minalign&&(this.minalign=e);const r=1+~(this.bb.capacity()-this.space+n)&e-1;for(;this.space<r+e+n;){const e=this.bb.capacity();this.bb=t.growByteBuffer(this.bb),this.space+=this.bb.capacity()-e}this.pad(r)}pad(t){for(let e=0;e<t;e++)this.bb.writeInt8(--this.space,0)}writeInt8(t){this.bb.writeInt8(this.space-=1,t)}writeInt16(t){this.bb.writeInt16(this.space-=2,t)}writeInt32(t){this.bb.writeInt32(this.space-=4,t)}writeInt64(t){this.bb.writeInt64(this.space-=8,t)}writeFloat32(t){this.bb.writeFloat32(this.space-=4,t)}writeFloat64(t){this.bb.writeFloat64(this.space-=8,t)}addInt8(t){this.prep(1,0),this.writeInt8(t)}addInt16(t){this.prep(2,0),this.writeInt16(t)}addInt32(t){this.prep(4,0),this.writeInt32(t)}addInt64(t){this.prep(8,0),this.writeInt64(t)}addFloat32(t){this.prep(4,0),this.writeFloat32(t)}addFloat64(t){this.prep(8,0),this.writeFloat64(t)}addFieldInt8(t,e,n){(this.force_defaults||e!=n)&&(this.addInt8(e),this.slot(t))}addFieldInt16(t,e,n){(this.force_defaults||e!=n)&&(this.addInt16(e),this.slot(t))}addFieldInt32(t,e,n){(this.force_defaults||e!=n)&&(this.addInt32(e),this.slot(t))}addFieldInt64(t,e,n){(this.force_defaults||e!==n)&&(this.addInt64(e),this.slot(t))}addFieldFloat32(t,e,n){(this.force_defaults||e!=n)&&(this.addFloat32(e),this.slot(t))}addFieldFloat64(t,e,n){(this.force_defaults||e!=n)&&(this.addFloat64(e),this.slot(t))}addFieldOffset(t,e,n){(this.force_defaults||e!=n)&&(this.addOffset(e),this.slot(t))}addFieldStruct(t,e,n){e!=n&&(this.nested(e),this.slot(t))}nested(t){if(t!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(t){null!==this.vtable&&(this.vtable[t]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(t){const e=t.capacity();if(3221225472&e)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const n=e<<1,r=Ld.allocate(n);return r.setPosition(n-e),r.bytes().set(t.bytes(),n-e),r}addOffset(t){this.prep(4,0),this.writeInt32(this.offset()-t+4)}startObject(t){this.notNested(),null==this.vtable&&(this.vtable=[]),this.vtable_in_use=t;for(let e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(null==this.vtable||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const t=this.offset();let e=this.vtable_in_use-1;for(;e>=0&&0==this.vtable[e];e--);const n=e+1;for(;e>=0;e--)this.addInt16(0!=this.vtable[e]?t-this.vtable[e]:0);this.addInt16(t-this.object_start);const r=2*(n+2);this.addInt16(r);let i=0;const o=this.space;t:for(e=0;e<this.vtables.length;e++){const t=this.bb.capacity()-this.vtables[e];if(r==this.bb.readInt16(t)){for(let e=2;e<r;e+=2)if(this.bb.readInt16(o+e)!=this.bb.readInt16(t+e))continue t;i=this.vtables[e];break}}return i?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,i-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t}finish(t,e,n){const r=n?4:0;if(e){const t=e;if(this.prep(this.minalign,8+r),4!=t.length)throw new Error("FlatBuffers: file identifier must be length 4");for(let e=3;e>=0;e--)this.writeInt8(t.charCodeAt(e))}this.prep(this.minalign,4+r),this.addOffset(t),r&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(t,e){this.finish(t,e,!0)}requiredField(t,e){const n=this.bb.capacity()-t,r=n-this.bb.readInt32(n);if(!(e<this.bb.readInt16(r)&&0!=this.bb.readInt16(r+e)))throw new Error("FlatBuffers: field "+e+" must be set")}startVector(t,e,n){this.notNested(),this.vector_num_elems=e,this.prep(4,t*e),this.prep(n,t*e)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);const e=this.createString(t);return this.string_maps.set(t,e),e}createString(t){if(null==t)return 0;let e;e=t instanceof Uint8Array?t:this.text_encoder.encode(t),this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length);for(let n=0,r=this.space,i=this.bb.bytes();n<e.length;n++)i[r++]=e[n];return this.endVector()}createObjectOffset(t){return null===t?0:"string"==typeof t?this.createString(t):t.pack(this)}createObjectOffsetList(t){const e=[];for(let n=0;n<t.length;++n){const r=t[n];if(null===r)throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.");e.push(this.createObjectOffset(r))}return e}createStructOffsetList(t,e){return e(this,t.length),this.createObjectOffsetList(t.slice().reverse()),this.endVector()}};class Ud{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsKeyValue(t,e){return(e||new Ud).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsKeyValue(t,e){return t.setPosition(t.position()+4),(e||new Ud).__init(t.readInt32(t.position())+t.position(),t)}key(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}value(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}static startKeyValue(t){t.startObject(2)}static addKey(t,e){t.addFieldOffset(0,e,0)}static addValue(t,e){t.addFieldOffset(1,e,0)}static endKeyValue(t){return t.endObject()}static createKeyValue(t,e,n){return Ud.startKeyValue(t),Ud.addKey(t,e),Ud.addValue(t,n),Ud.endKeyValue(t)}}var Pd,Vd,$d,Yd,Wd,Gd;!function(t){t[t.V1=0]="V1",t[t.V2=1]="V2",t[t.V3=2]="V3",t[t.V4=3]="V4",t[t.V5=4]="V5"}(Pd||(Pd={})),($d=Vd||(Vd={}))[$d.Little=0]="Little",$d[$d.Big=1]="Big",(Wd=Yd||(Yd={}))[Wd.DenseArray=0]="DenseArray";class qd{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsInt(t,e){return(e||new qd).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInt(t,e){return t.setPosition(t.position()+4),(e||new qd).__init(t.readInt32(t.position())+t.position(),t)}bitWidth(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}isSigned(){const t=this.bb.__offset(this.bb_pos,6);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}static startInt(t){t.startObject(2)}static addBitWidth(t,e){t.addFieldInt32(0,e,0)}static addIsSigned(t,e){t.addFieldInt8(1,+e,0)}static endInt(t){return t.endObject()}static createInt(t,e,n){return qd.startInt(t),qd.addBitWidth(t,e),qd.addIsSigned(t,n),qd.endInt(t)}}class Hd{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDictionaryEncoding(t,e){return(e||new Hd).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryEncoding(t,e){return t.setPosition(t.position()+4),(e||new Hd).__init(t.readInt32(t.position())+t.position(),t)}id(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}indexType(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new qd).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}isOrdered(){const t=this.bb.__offset(this.bb_pos,8);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}dictionaryKind(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt16(this.bb_pos+t):Yd.DenseArray}static startDictionaryEncoding(t){t.startObject(4)}static addId(t,e){t.addFieldInt64(0,e,BigInt("0"))}static addIndexType(t,e){t.addFieldOffset(1,e,0)}static addIsOrdered(t,e){t.addFieldInt8(2,+e,0)}static addDictionaryKind(t,e){t.addFieldInt16(3,e,Yd.DenseArray)}static endDictionaryEncoding(t){return t.endObject()}}class Xd{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBinary(t,e){return(e||new Xd).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBinary(t,e){return t.setPosition(t.position()+4),(e||new Xd).__init(t.readInt32(t.position())+t.position(),t)}static startBinary(t){t.startObject(0)}static endBinary(t){return t.endObject()}static createBinary(t){return Xd.startBinary(t),Xd.endBinary(t)}}class Zd{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBool(t,e){return(e||new Zd).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBool(t,e){return t.setPosition(t.position()+4),(e||new Zd).__init(t.readInt32(t.position())+t.position(),t)}static startBool(t){t.startObject(0)}static endBool(t){return t.endObject()}static createBool(t){return Zd.startBool(t),Zd.endBool(t)}}!function(t){t[t.DAY=0]="DAY",t[t.MILLISECOND=1]="MILLISECOND"}(Gd||(Gd={}));let Jd=class t{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDate(e,n){return(n||new t).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDate(e,n){return e.setPosition(e.position()+4),(n||new t).__init(e.readInt32(e.position())+e.position(),e)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Gd.MILLISECOND}static startDate(t){t.startObject(1)}static addUnit(t,e){t.addFieldInt16(0,e,Gd.MILLISECOND)}static endDate(t){return t.endObject()}static createDate(e,n){return t.startDate(e),t.addUnit(e,n),t.endDate(e)}};class Kd{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDecimal(t,e){return(e||new Kd).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDecimal(t,e){return t.setPosition(t.position()+4),(e||new Kd).__init(t.readInt32(t.position())+t.position(),t)}precision(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}scale(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}bitWidth(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt32(this.bb_pos+t):128}static startDecimal(t){t.startObject(3)}static addPrecision(t,e){t.addFieldInt32(0,e,0)}static addScale(t,e){t.addFieldInt32(1,e,0)}static addBitWidth(t,e){t.addFieldInt32(2,e,128)}static endDecimal(t){return t.endObject()}static createDecimal(t,e,n,r){return Kd.startDecimal(t),Kd.addPrecision(t,e),Kd.addScale(t,n),Kd.addBitWidth(t,r),Kd.endDecimal(t)}}var Qd,th,eh;!function(t){t[t.SECOND=0]="SECOND",t[t.MILLISECOND=1]="MILLISECOND",t[t.MICROSECOND=2]="MICROSECOND",t[t.NANOSECOND=3]="NANOSECOND"}(Qd||(Qd={}));class nh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFixedSizeBinary(t,e){return(e||new nh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeBinary(t,e){return t.setPosition(t.position()+4),(e||new nh).__init(t.readInt32(t.position())+t.position(),t)}byteWidth(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeBinary(t){t.startObject(1)}static addByteWidth(t,e){t.addFieldInt32(0,e,0)}static endFixedSizeBinary(t){return t.endObject()}static createFixedSizeBinary(t,e){return nh.startFixedSizeBinary(t),nh.addByteWidth(t,e),nh.endFixedSizeBinary(t)}}class rh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFixedSizeList(t,e){return(e||new rh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeList(t,e){return t.setPosition(t.position()+4),(e||new rh).__init(t.readInt32(t.position())+t.position(),t)}listSize(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeList(t){t.startObject(1)}static addListSize(t,e){t.addFieldInt32(0,e,0)}static endFixedSizeList(t){return t.endObject()}static createFixedSizeList(t,e){return rh.startFixedSizeList(t),rh.addListSize(t,e),rh.endFixedSizeList(t)}}!function(t){t[t.HALF=0]="HALF",t[t.SINGLE=1]="SINGLE",t[t.DOUBLE=2]="DOUBLE"}(th||(th={}));class ih{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFloatingPoint(t,e){return(e||new ih).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFloatingPoint(t,e){return t.setPosition(t.position()+4),(e||new ih).__init(t.readInt32(t.position())+t.position(),t)}precision(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):th.HALF}static startFloatingPoint(t){t.startObject(1)}static addPrecision(t,e){t.addFieldInt16(0,e,th.HALF)}static endFloatingPoint(t){return t.endObject()}static createFloatingPoint(t,e){return ih.startFloatingPoint(t),ih.addPrecision(t,e),ih.endFloatingPoint(t)}}!function(t){t[t.YEAR_MONTH=0]="YEAR_MONTH",t[t.DAY_TIME=1]="DAY_TIME",t[t.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"}(eh||(eh={}));class oh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsInterval(t,e){return(e||new oh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInterval(t,e){return t.setPosition(t.position()+4),(e||new oh).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):eh.YEAR_MONTH}static startInterval(t){t.startObject(1)}static addUnit(t,e){t.addFieldInt16(0,e,eh.YEAR_MONTH)}static endInterval(t){return t.endObject()}static createInterval(t,e){return oh.startInterval(t),oh.addUnit(t,e),oh.endInterval(t)}}class ah{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsList(t,e){return(e||new ah).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsList(t,e){return t.setPosition(t.position()+4),(e||new ah).__init(t.readInt32(t.position())+t.position(),t)}static startList(t){t.startObject(0)}static endList(t){return t.endObject()}static createList(t){return ah.startList(t),ah.endList(t)}}let sh=class t{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsMap(e,n){return(n||new t).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsMap(e,n){return e.setPosition(e.position()+4),(n||new t).__init(e.readInt32(e.position())+e.position(),e)}keysSorted(){const t=this.bb.__offset(this.bb_pos,4);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}static startMap(t){t.startObject(1)}static addKeysSorted(t,e){t.addFieldInt8(0,+e,0)}static endMap(t){return t.endObject()}static createMap(e,n){return t.startMap(e),t.addKeysSorted(e,n),t.endMap(e)}};class uh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsNull(t,e){return(e||new uh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsNull(t,e){return t.setPosition(t.position()+4),(e||new uh).__init(t.readInt32(t.position())+t.position(),t)}static startNull(t){t.startObject(0)}static endNull(t){return t.endObject()}static createNull(t){return uh.startNull(t),uh.endNull(t)}}class ch{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsStruct_(t,e){return(e||new ch).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsStruct_(t,e){return t.setPosition(t.position()+4),(e||new ch).__init(t.readInt32(t.position())+t.position(),t)}static startStruct_(t){t.startObject(0)}static endStruct_(t){return t.endObject()}static createStruct_(t){return ch.startStruct_(t),ch.endStruct_(t)}}class fh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsTime(t,e){return(e||new fh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTime(t,e){return t.setPosition(t.position()+4),(e||new fh).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Qd.MILLISECOND}bitWidth(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):32}static startTime(t){t.startObject(2)}static addUnit(t,e){t.addFieldInt16(0,e,Qd.MILLISECOND)}static addBitWidth(t,e){t.addFieldInt32(1,e,32)}static endTime(t){return t.endObject()}static createTime(t,e,n){return fh.startTime(t),fh.addUnit(t,e),fh.addBitWidth(t,n),fh.endTime(t)}}class lh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsTimestamp(t,e){return(e||new lh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTimestamp(t,e){return t.setPosition(t.position()+4),(e||new lh).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Qd.SECOND}timezone(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}static startTimestamp(t){t.startObject(2)}static addUnit(t,e){t.addFieldInt16(0,e,Qd.SECOND)}static addTimezone(t,e){t.addFieldOffset(1,e,0)}static endTimestamp(t){return t.endObject()}static createTimestamp(t,e,n){return lh.startTimestamp(t),lh.addUnit(t,e),lh.addTimezone(t,n),lh.endTimestamp(t)}}var dh,hh;!function(t){t[t.Sparse=0]="Sparse",t[t.Dense=1]="Dense"}(dh||(dh={}));class ph{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsUnion(t,e){return(e||new ph).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUnion(t,e){return t.setPosition(t.position()+4),(e||new ph).__init(t.readInt32(t.position())+t.position(),t)}mode(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):dh.Sparse}typeIds(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+4*t):0}typeIdsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}typeIdsArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startUnion(t){t.startObject(2)}static addMode(t,e){t.addFieldInt16(0,e,dh.Sparse)}static addTypeIds(t,e){t.addFieldOffset(1,e,0)}static createTypeIdsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addInt32(e[n]);return t.endVector()}static startTypeIdsVector(t,e){t.startVector(4,e,4)}static endUnion(t){return t.endObject()}static createUnion(t,e,n){return ph.startUnion(t),ph.addMode(t,e),ph.addTypeIds(t,n),ph.endUnion(t)}}class _h{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsUtf8(t,e){return(e||new _h).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUtf8(t,e){return t.setPosition(t.position()+4),(e||new _h).__init(t.readInt32(t.position())+t.position(),t)}static startUtf8(t){t.startObject(0)}static endUtf8(t){return t.endObject()}static createUtf8(t){return _h.startUtf8(t),_h.endUtf8(t)}}!function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.FloatingPoint=3]="FloatingPoint",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct_=13]="Struct_",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Duration=18]="Duration",t[t.LargeBinary=19]="LargeBinary",t[t.LargeUtf8=20]="LargeUtf8",t[t.LargeList=21]="LargeList",t[t.RunEndEncoded=22]="RunEndEncoded"}(hh||(hh={}));let mh=class t{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsField(e,n){return(n||new t).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsField(e,n){return e.setPosition(e.position()+4),(n||new t).__init(e.readInt32(e.position())+e.position(),e)}name(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}nullable(){const t=this.bb.__offset(this.bb_pos,6);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}typeType(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):hh.NONE}type(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__union(t,this.bb_pos+e):null}dictionary(t){const e=this.bb.__offset(this.bb_pos,12);return e?(t||new Hd).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}children(e,n){const r=this.bb.__offset(this.bb_pos,14);return r?(n||new t).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*e),this.bb):null}childrenLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const n=this.bb.__offset(this.bb_pos,16);return n?(e||new Ud).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*t),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}static startField(t){t.startObject(7)}static addName(t,e){t.addFieldOffset(0,e,0)}static addNullable(t,e){t.addFieldInt8(1,+e,0)}static addTypeType(t,e){t.addFieldInt8(2,e,hh.NONE)}static addType(t,e){t.addFieldOffset(3,e,0)}static addDictionary(t,e){t.addFieldOffset(4,e,0)}static addChildren(t,e){t.addFieldOffset(5,e,0)}static createChildrenVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startChildrenVector(t,e){t.startVector(4,e,4)}static addCustomMetadata(t,e){t.addFieldOffset(6,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endField(t){return t.endObject()}},bh=class t{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSchema(e,n){return(n||new t).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSchema(e,n){return e.setPosition(e.position()+4),(n||new t).__init(e.readInt32(e.position())+e.position(),e)}endianness(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Vd.Little}fields(t,e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new mh).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*t),this.bb):null}fieldsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const n=this.bb.__offset(this.bb_pos,8);return n?(e||new Ud).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*t),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}features(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt64(this.bb.__vector(this.bb_pos+e)+8*t):BigInt(0)}featuresLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}static startSchema(t){t.startObject(4)}static addEndianness(t,e){t.addFieldInt16(0,e,Vd.Little)}static addFields(t,e){t.addFieldOffset(1,e,0)}static createFieldsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startFieldsVector(t,e){t.startVector(4,e,4)}static addCustomMetadata(t,e){t.addFieldOffset(2,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static addFeatures(t,e){t.addFieldOffset(3,e,0)}static createFeaturesVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addInt64(e[n]);return t.endVector()}static startFeaturesVector(t,e){t.startVector(8,e,8)}static endSchema(t){return t.endObject()}static finishSchemaBuffer(t,e){t.finish(e)}static finishSizePrefixedSchemaBuffer(t,e){t.finish(e,void 0,!0)}static createSchema(e,n,r,i,o){return t.startSchema(e),t.addEndianness(e,n),t.addFields(e,r),t.addCustomMetadata(e,i),t.addFeatures(e,o),t.endSchema(e)}};class yh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFooter(t,e){return(e||new yh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFooter(t,e){return t.setPosition(t.position()+4),(e||new yh).__init(t.readInt32(t.position())+t.position(),t)}version(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Pd.V1}schema(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new bh).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}dictionaries(t,e){const n=this.bb.__offset(this.bb_pos,8);return n?(e||new Bd).__init(this.bb.__vector(this.bb_pos+n)+24*t,this.bb):null}dictionariesLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}recordBatches(t,e){const n=this.bb.__offset(this.bb_pos,10);return n?(e||new Bd).__init(this.bb.__vector(this.bb_pos+n)+24*t,this.bb):null}recordBatchesLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const n=this.bb.__offset(this.bb_pos,12);return n?(e||new Ud).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*t),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFooter(t){t.startObject(5)}static addVersion(t,e){t.addFieldInt16(0,e,Pd.V1)}static addSchema(t,e){t.addFieldOffset(1,e,0)}static addDictionaries(t,e){t.addFieldOffset(2,e,0)}static startDictionariesVector(t,e){t.startVector(24,e,8)}static addRecordBatches(t,e){t.addFieldOffset(3,e,0)}static startRecordBatchesVector(t,e){t.startVector(24,e,8)}static addCustomMetadata(t,e){t.addFieldOffset(4,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endFooter(t){return t.endObject()}static finishFooterBuffer(t,e){t.finish(e)}static finishSizePrefixedFooterBuffer(t,e){t.finish(e,void 0,!0)}}class gh{constructor(t=[],e,n){this.fields=t||[],this.metadata=e||new Map,n||(n=xh(t)),this.dictionaries=n}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map((t=>t.name))}toString(){return`Schema<{ ${this.fields.map(((t,e)=>`${e}: ${t}`)).join(", ")} }>`}select(t){const e=new Set(t),n=this.fields.filter((t=>e.has(t.name)));return new gh(n,this.metadata)}selectAt(t){const e=t.map((t=>this.fields[t])).filter(Boolean);return new gh(e,this.metadata)}assign(...t){const e=t[0]instanceof gh?t[0]:Array.isArray(t[0])?new gh(t[0]):new gh(t),n=[...this.fields],r=wh(wh(new Map,this.metadata),e.metadata),i=e.fields.filter((t=>{const e=n.findIndex((e=>e.name===t.name));return!~e||(n[e]=t.clone({metadata:wh(wh(new Map,n[e].metadata),t.metadata)}))&&!1})),o=xh(i,new Map);return new gh([...n,...i],r,new Map([...this.dictionaries,...o]))}}gh.prototype.fields=null,gh.prototype.metadata=null,gh.prototype.dictionaries=null;class vh{static new(...t){let[e,n,r,i]=t;return t[0]&&"object"==typeof t[0]&&(({name:e}=t[0]),void 0===n&&(n=t[0].type),void 0===r&&(r=t[0].nullable),void 0===i&&(i=t[0].metadata)),new vh(`${e}`,n,r,i)}constructor(t,e,n=!1,r){this.name=t,this.type=e,this.nullable=n,this.metadata=r||new Map}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...t){let[e,n,r,i]=t;return t[0]&&"object"==typeof t[0]?({name:e=this.name,type:n=this.type,nullable:r=this.nullable,metadata:i=this.metadata}=t[0]):[e=this.name,n=this.type,r=this.nullable,i=this.metadata]=t,vh.new(e,n,r,i)}}function wh(t,e){return new Map([...t||new Map,...e||new Map])}function xh(t,e=new Map){for(let n=-1,r=t.length;++n<r;){const r=t[n].type;if(rf.isDictionary(r))if(e.has(r.id)){if(e.get(r.id)!==r.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}else e.set(r.id,r.dictionary);r.children&&r.children.length>0&&xh(r.children,e)}return e}vh.prototype.type=null,vh.prototype.name=null,vh.prototype.nullable=null,vh.prototype.metadata=null;var Ah=Rd,Sh=Ld;class Ih{static decode(t){t=new Sh(Ju(t));const e=yh.getRootAsFooter(t),n=gh.decode(e.schema());return new Oh(n,e)}static encode(t){const e=new Ah,n=gh.encode(e,t.schema);yh.startRecordBatchesVector(e,t.numRecordBatches);for(const o of[...t.recordBatches()].slice().reverse())Th.encode(e,o);const r=e.endVector();yh.startDictionariesVector(e,t.numDictionaries);for(const o of[...t.dictionaryBatches()].slice().reverse())Th.encode(e,o);const i=e.endVector();return yh.startFooter(e),yh.addSchema(e,n),yh.addVersion(e,ac.V4),yh.addRecordBatches(e,r),yh.addDictionaries(e,i),yh.finishFooterBuffer(e,yh.endFooter(e)),e.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}constructor(t,e=ac.V4,n,r){this.schema=t,this.version=e,n&&(this._recordBatches=n),r&&(this._dictionaryBatches=r)}*recordBatches(){for(let t,e=-1,n=this.numRecordBatches;++e<n;)(t=this.getRecordBatch(e))&&(yield t)}*dictionaryBatches(){for(let t,e=-1,n=this.numDictionaries;++e<n;)(t=this.getDictionaryBatch(e))&&(yield t)}getRecordBatch(t){return t>=0&&t<this.numRecordBatches&&this._recordBatches[t]||null}getDictionaryBatch(t){return t>=0&&t<this.numDictionaries&&this._dictionaryBatches[t]||null}}class Oh extends Ih{get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}constructor(t,e){super(t,e.version()),this._footer=e}getRecordBatch(t){if(t>=0&&t<this.numRecordBatches){const e=this._footer.recordBatches(t);if(e)return Th.decode(e)}return null}getDictionaryBatch(t){if(t>=0&&t<this.numDictionaries){const e=this._footer.dictionaries(t);if(e)return Th.decode(e)}return null}}class Th{static decode(t){return new Th(t.metaDataLength(),t.bodyLength(),t.offset())}static encode(t,e){const{metaDataLength:n}=e,r=BigInt(e.offset),i=BigInt(e.bodyLength);return Bd.createBlock(t,r,n,i)}constructor(t,e,n){this.metaDataLength=t,this.offset=Fc(n),this.bodyLength=Fc(e)}}const kh=Object.freeze({done:!0,value:void 0});class Mh{constructor(t){this._json=t}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}}class Eh{tee(){return this._getDOMStream().tee()}pipe(t,e){return this._getNodeStream().pipe(t,e)}pipeTo(t,e){return this._getDOMStream().pipeTo(t,e)}pipeThrough(t,e){return this._getDOMStream().pipeThrough(t,e)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}}class Bh extends Eh{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise((t=>this._closedPromiseResolve=t))}get closed(){return this._closedPromise}cancel(t){return gu(this,void 0,void 0,(function*(){yield this.return(t)}))}write(t){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(t):this.resolvers.shift().resolve({done:!1,value:t}))}abort(t){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:t}:this.resolvers.shift().reject({done:!0,value:t}))}close(){if(this._closedPromiseResolve){const{resolvers:t}=this;for(;t.length>0;)t.shift().resolve(kh);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(t){return nc.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,t)}toNodeStream(t){return nc.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,t)}throw(t){return gu(this,void 0,void 0,(function*(){return yield this.abort(t),kh}))}return(t){return gu(this,void 0,void 0,(function*(){return yield this.close(),kh}))}read(t){return gu(this,void 0,void 0,(function*(){return(yield this.next(t,"read")).value}))}peek(t){return gu(this,void 0,void 0,(function*(){return(yield this.next(t,"peek")).value}))}next(...t){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise(((t,e)=>{this.resolvers.push({resolve:t,reject:e})})):Promise.resolve(kh)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}}class jh extends Bh{write(t){if((t=Ju(t)).byteLength>0)return super.write(t)}toString(t=!1){return t?Ou(this.toUint8Array(!0)):this.toUint8Array(!1).then(Ou)}toUint8Array(t=!1){return t?Hu(this._values)[0]:(()=>gu(this,void 0,void 0,(function*(){var t,e,n,r;const i=[];let o=0;try{for(var a,s=!0,u=Su(this);!(t=(a=yield u.next()).done);){r=a.value,s=!1;try{const t=r;i.push(t),o+=t.byteLength}finally{s=!0}}}catch(c){e={error:c}}finally{try{s||t||!(n=u.return)||(yield n.call(u))}finally{if(e)throw e.error}}return Hu(i,o)[0]})))()}}class Dh{constructor(t){t&&(this.source=new Nh(nc.fromIterable(t)))}[Symbol.iterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}}class zh{constructor(t){t instanceof zh?this.source=t.source:t instanceof jh?this.source=new Fh(nc.fromAsyncIterable(t)):Yu(t)?this.source=new Fh(nc.fromNodeStream(t)):$u(t)?this.source=new Fh(nc.fromDOMStream(t)):Pu(t)?this.source=new Fh(nc.fromDOMStream(t.body)):Fu(t)?this.source=new Fh(nc.fromIterable(t)):(Nu(t)||Cu(t))&&(this.source=new Fh(nc.fromAsyncIterable(t)))}[Symbol.asyncIterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}get closed(){return this.source.closed}cancel(t){return this.source.cancel(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}}class Nh{constructor(t){this.source=t}cancel(t){this.return(t)}peek(t){return this.next(t,"peek").value}read(t){return this.next(t,"read").value}next(t,e="read"){return this.source.next({cmd:e,size:t})}throw(t){return Object.create(this.source.throw&&this.source.throw(t)||kh)}return(t){return Object.create(this.source.return&&this.source.return(t)||kh)}}class Fh{constructor(t){this.source=t,this._closedPromise=new Promise((t=>this._closedPromiseResolve=t))}cancel(t){return gu(this,void 0,void 0,(function*(){yield this.return(t)}))}get closed(){return this._closedPromise}read(t){return gu(this,void 0,void 0,(function*(){return(yield this.next(t,"read")).value}))}peek(t){return gu(this,void 0,void 0,(function*(){return(yield this.next(t,"peek")).value}))}next(t,e="read"){return gu(this,void 0,void 0,(function*(){return yield this.source.next({cmd:e,size:t})}))}throw(t){return gu(this,void 0,void 0,(function*(){const e=this.source.throw&&(yield this.source.throw(t))||kh;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(e)}))}return(t){return gu(this,void 0,void 0,(function*(){const e=this.source.return&&(yield this.source.return(t))||kh;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(e)}))}}class Ch extends Dh{constructor(t,e){super(),this.position=0,this.buffer=Ju(t),this.size=void 0===e?this.buffer.byteLength:e}readInt32(t){const{buffer:e,byteOffset:n}=this.readAt(t,4);return new DataView(e,n).getInt32(0,!0)}seek(t){return this.position=Math.min(t,this.size),t<this.size}read(t){const{buffer:e,size:n,position:r}=this;return e&&r<n?("number"!=typeof t&&(t=Number.POSITIVE_INFINITY),this.position=Math.min(n,r+Math.min(n-r,t)),e.subarray(r,this.position)):null}readAt(t,e){const n=this.buffer,r=Math.min(this.size,t+e);return n?n.subarray(t,r):new Uint8Array(e)}close(){this.buffer&&(this.buffer=null)}throw(t){return this.close(),{done:!0,value:t}}return(t){return this.close(),{done:!0,value:t}}}class Lh extends zh{constructor(t,e){super(),this.position=0,this._handle=t,"number"==typeof e?this.size=e:this._pending=(()=>gu(this,void 0,void 0,(function*(){this.size=(yield t.stat()).size,delete this._pending})))()}readInt32(t){return gu(this,void 0,void 0,(function*(){const{buffer:e,byteOffset:n}=yield this.readAt(t,4);return new DataView(e,n).getInt32(0,!0)}))}seek(t){return gu(this,void 0,void 0,(function*(){return this._pending&&(yield this._pending),this.position=Math.min(t,this.size),t<this.size}))}read(t){return gu(this,void 0,void 0,(function*(){this._pending&&(yield this._pending);const{_handle:e,size:n,position:r}=this;if(e&&r<n){"number"!=typeof t&&(t=Number.POSITIVE_INFINITY);let i=r,o=0,a=0;const s=Math.min(n,i+Math.min(n-i,t)),u=new Uint8Array(Math.max(0,(this.position=s)-i));for(;(i+=a)<s&&(o+=a)<u.byteLength;)({bytesRead:a}=yield e.read(u,o,u.byteLength-o,i));return u}return null}))}readAt(t,e){return gu(this,void 0,void 0,(function*(){this._pending&&(yield this._pending);const{_handle:n,size:r}=this;if(n&&t+e<r){const i=Math.min(r,t+e),o=new Uint8Array(i-t);return(yield n.read(o,0,e,t)).buffer}return new Uint8Array(e)}))}close(){return gu(this,void 0,void 0,(function*(){const t=this._handle;this._handle=null,t&&(yield t.close())}))}throw(t){return gu(this,void 0,void 0,(function*(){return yield this.close(),{done:!0,value:t}}))}return(t){return gu(this,void 0,void 0,(function*(){return yield this.close(),{done:!0,value:t}}))}}function Rh(t){return t<0&&(t=4294967295+t+1),`0x${t.toString(16)}`}const Uh=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8];class Ph{constructor(t){this.buffer=t}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(t){const e=new Uint32Array([this.buffer[1]>>>16,65535&this.buffer[1],this.buffer[0]>>>16,65535&this.buffer[0]]),n=new Uint32Array([t.buffer[1]>>>16,65535&t.buffer[1],t.buffer[0]>>>16,65535&t.buffer[0]]);let r=e[3]*n[3];this.buffer[0]=65535&r;let i=r>>>16;return r=e[2]*n[3],i+=r,r=e[3]*n[2]>>>0,i+=r,this.buffer[0]+=i<<16,this.buffer[1]=i>>>0<r?65536:0,this.buffer[1]+=i>>>16,this.buffer[1]+=e[1]*n[3]+e[2]*n[2]+e[3]*n[1],this.buffer[1]+=e[0]*n[3]+e[1]*n[2]+e[2]*n[1]+e[3]*n[0]<<16,this}_plus(t){const e=this.buffer[0]+t.buffer[0]>>>0;this.buffer[1]+=t.buffer[1],e<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=e}lessThan(t){return this.buffer[1]<t.buffer[1]||this.buffer[1]===t.buffer[1]&&this.buffer[0]<t.buffer[0]}equals(t){return this.buffer[1]===t.buffer[1]&&this.buffer[0]==t.buffer[0]}greaterThan(t){return t.lessThan(this)}hex(){return`${Rh(this.buffer[1])} ${Rh(this.buffer[0])}`}}class Vh extends Ph{times(t){return this._times(t),this}plus(t){return this._plus(t),this}static from(t,e=new Uint32Array(2)){return Vh.fromString("string"==typeof t?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(2)){return Vh.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(2)){const n=t.length,r=new Vh(e);for(let i=0;i<n;){const e=8<n-i?8:n-i,o=new Vh(new Uint32Array([Number.parseInt(t.slice(i,i+e),10),0])),a=new Vh(new Uint32Array([Uh[e],0]));r.times(a),r.plus(o),i+=e}return r}static convertArray(t){const e=new Uint32Array(2*t.length);for(let n=-1,r=t.length;++n<r;)Vh.from(t[n],new Uint32Array(e.buffer,e.byteOffset+2*n*4,2));return e}static multiply(t,e){return new Vh(new Uint32Array(t.buffer)).times(e)}static add(t,e){return new Vh(new Uint32Array(t.buffer)).plus(e)}}class $h extends Ph{negate(){return this.buffer[0]=1+~this.buffer[0],this.buffer[1]=~this.buffer[1],0==this.buffer[0]&&++this.buffer[1],this}times(t){return this._times(t),this}plus(t){return this._plus(t),this}lessThan(t){const e=this.buffer[1]<<0,n=t.buffer[1]<<0;return e<n||e===n&&this.buffer[0]<t.buffer[0]}static from(t,e=new Uint32Array(2)){return $h.fromString("string"==typeof t?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(2)){return $h.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(2)){const n=t.startsWith("-"),r=t.length,i=new $h(e);for(let o=n?1:0;o<r;){const e=8<r-o?8:r-o,n=new $h(new Uint32Array([Number.parseInt(t.slice(o,o+e),10),0])),a=new $h(new Uint32Array([Uh[e],0]));i.times(a),i.plus(n),o+=e}return n?i.negate():i}static convertArray(t){const e=new Uint32Array(2*t.length);for(let n=-1,r=t.length;++n<r;)$h.from(t[n],new Uint32Array(e.buffer,e.byteOffset+2*n*4,2));return e}static multiply(t,e){return new $h(new Uint32Array(t.buffer)).times(e)}static add(t,e){return new $h(new Uint32Array(t.buffer)).plus(e)}}class Yh{constructor(t){this.buffer=t}high(){return new $h(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new $h(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=1+~this.buffer[0],this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],0==this.buffer[0]&&++this.buffer[1],0==this.buffer[1]&&++this.buffer[2],0==this.buffer[2]&&++this.buffer[3],this}times(t){const e=new Vh(new Uint32Array([this.buffer[3],0])),n=new Vh(new Uint32Array([this.buffer[2],0])),r=new Vh(new Uint32Array([this.buffer[1],0])),i=new Vh(new Uint32Array([this.buffer[0],0])),o=new Vh(new Uint32Array([t.buffer[3],0])),a=new Vh(new Uint32Array([t.buffer[2],0])),s=new Vh(new Uint32Array([t.buffer[1],0])),u=new Vh(new Uint32Array([t.buffer[0],0]));let c=Vh.multiply(i,u);this.buffer[0]=c.low();const f=new Vh(new Uint32Array([c.high(),0]));c=Vh.multiply(r,u),f.plus(c),c=Vh.multiply(i,s),f.plus(c),this.buffer[1]=f.low(),this.buffer[3]=f.lessThan(c)?1:0,this.buffer[2]=f.high();return new Vh(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(Vh.multiply(n,u)).plus(Vh.multiply(r,s)).plus(Vh.multiply(i,a)),this.buffer[3]+=Vh.multiply(e,u).plus(Vh.multiply(n,s)).plus(Vh.multiply(r,a)).plus(Vh.multiply(i,o)).low(),this}plus(t){const e=new Uint32Array(4);return e[3]=this.buffer[3]+t.buffer[3]>>>0,e[2]=this.buffer[2]+t.buffer[2]>>>0,e[1]=this.buffer[1]+t.buffer[1]>>>0,e[0]=this.buffer[0]+t.buffer[0]>>>0,e[0]<this.buffer[0]>>>0&&++e[1],e[1]<this.buffer[1]>>>0&&++e[2],e[2]<this.buffer[2]>>>0&&++e[3],this.buffer[3]=e[3],this.buffer[2]=e[2],this.buffer[1]=e[1],this.buffer[0]=e[0],this}hex(){return`${Rh(this.buffer[3])} ${Rh(this.buffer[2])} ${Rh(this.buffer[1])} ${Rh(this.buffer[0])}`}static multiply(t,e){return new Yh(new Uint32Array(t.buffer)).times(e)}static add(t,e){return new Yh(new Uint32Array(t.buffer)).plus(e)}static from(t,e=new Uint32Array(4)){return Yh.fromString("string"==typeof t?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(4)){return Yh.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(4)){const n=t.startsWith("-"),r=t.length,i=new Yh(e);for(let o=n?1:0;o<r;){const e=8<r-o?8:r-o,n=new Yh(new Uint32Array([Number.parseInt(t.slice(o,o+e),10),0,0,0])),a=new Yh(new Uint32Array([Uh[e],0,0,0]));i.times(a),i.plus(n),o+=e}return n?i.negate():i}static convertArray(t){const e=new Uint32Array(4*t.length);for(let n=-1,r=t.length;++n<r;)Yh.from(t[n],new Uint32Array(e.buffer,e.byteOffset+16*n,4));return e}}class Wh extends Ff{constructor(t,e,n,r){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=t,this.nodes=e,this.buffers=n,this.dictionaries=r}visit(t){return super.visit(t instanceof vh?t.type:t)}visitNull(t,{length:e}=this.nextFieldNode()){return nd({type:t,length:e})}visitBool(t,{length:e,nullCount:n}=this.nextFieldNode()){return nd({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitInt(t,{length:e,nullCount:n}=this.nextFieldNode()){return nd({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitFloat(t,{length:e,nullCount:n}=this.nextFieldNode()){return nd({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitUtf8(t,{length:e,nullCount:n}=this.nextFieldNode()){return nd({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitBinary(t,{length:e,nullCount:n}=this.nextFieldNode()){return nd({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitFixedSizeBinary(t,{length:e,nullCount:n}=this.nextFieldNode()){return nd({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitDate(t,{length:e,nullCount:n}=this.nextFieldNode()){return nd({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitTimestamp(t,{length:e,nullCount:n}=this.nextFieldNode()){return nd({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitTime(t,{length:e,nullCount:n}=this.nextFieldNode()){return nd({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitDecimal(t,{length:e,nullCount:n}=this.nextFieldNode()){return nd({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitList(t,{length:e,nullCount:n}=this.nextFieldNode()){return nd({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}visitStruct(t,{length:e,nullCount:n}=this.nextFieldNode()){return nd({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),children:this.visitMany(t.children)})}visitUnion(t){return t.mode===uc.Sparse?this.visitSparseUnion(t):this.visitDenseUnion(t)}visitDenseUnion(t,{length:e,nullCount:n}=this.nextFieldNode()){return nd({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),typeIds:this.readTypeIds(t),valueOffsets:this.readOffsets(t),children:this.visitMany(t.children)})}visitSparseUnion(t,{length:e,nullCount:n}=this.nextFieldNode()){return nd({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),typeIds:this.readTypeIds(t),children:this.visitMany(t.children)})}visitDictionary(t,{length:e,nullCount:n}=this.nextFieldNode()){return nd({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t.indices),dictionary:this.readDictionary(t)})}visitInterval(t,{length:e,nullCount:n}=this.nextFieldNode()){return nd({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitFixedSizeList(t,{length:e,nullCount:n}=this.nextFieldNode()){return nd({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),child:this.visit(t.children[0])})}visitMap(t,{length:e,nullCount:n}=this.nextFieldNode()){return nd({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(t,e,n=this.nextBufferRange()){return e>0&&this.readData(t,n)||new Uint8Array(0)}readOffsets(t,e){return this.readData(t,e)}readTypeIds(t,e){return this.readData(t,e)}readData(t,{length:e,offset:n}=this.nextBufferRange()){return this.bytes.subarray(n,n+e)}readDictionary(t){return this.dictionaries.get(t.id)}}class Gh extends Wh{constructor(t,e,n,r){super(new Uint8Array(0),e,n,r),this.sources=t}readNullBitmap(t,e,{offset:n}=this.nextBufferRange()){return e<=0?new Uint8Array(0):Zl(this.sources[n])}readOffsets(t,{offset:e}=this.nextBufferRange()){return Xu(Uint8Array,Xu(Int32Array,this.sources[e]))}readTypeIds(t,{offset:e}=this.nextBufferRange()){return Xu(Uint8Array,Xu(t.ArrayType,this.sources[e]))}readData(t,{offset:e}=this.nextBufferRange()){const{sources:n}=this;return rf.isTimestamp(t)||(rf.isInt(t)||rf.isTime(t))&&64===t.bitWidth||rf.isDate(t)&&t.unit===dc.MILLISECOND?Xu(Uint8Array,$h.convertArray(n[e])):rf.isDecimal(t)?Xu(Uint8Array,Yh.convertArray(n[e])):rf.isBinary(t)||rf.isFixedSizeBinary(t)?function(t){const e=t.join(""),n=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)n[r>>1]=Number.parseInt(e.slice(r,r+2),16);return n}(n[e]):rf.isBool(t)?Zl(n[e]):rf.isUtf8(t)?ku(n[e].join("")):Xu(Uint8Array,Xu(t.ArrayType,n[e].map((t=>+t))))}}class qh extends Ff{compareSchemas(t,e){return t===e||e instanceof t.constructor&&this.compareManyFields(t.fields,e.fields)}compareManyFields(t,e){return t===e||Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every(((t,n)=>this.compareFields(t,e[n])))}compareFields(t,e){return t===e||e instanceof t.constructor&&t.name===e.name&&t.nullable===e.nullable&&this.visit(t.type,e.type)}}function Hh(t,e){return e instanceof t.constructor}function Xh(t,e){return t===e||Hh(t,e)}function Zh(t,e){return t===e||Hh(t,e)&&t.bitWidth===e.bitWidth&&t.isSigned===e.isSigned}function Jh(t,e){return t===e||Hh(t,e)&&t.precision===e.precision}function Kh(t,e){return t===e||Hh(t,e)&&t.unit===e.unit}function Qh(t,e){return t===e||Hh(t,e)&&t.unit===e.unit&&t.timezone===e.timezone}function tp(t,e){return t===e||Hh(t,e)&&t.unit===e.unit&&t.bitWidth===e.bitWidth}function ep(t,e){return t===e||Hh(t,e)&&t.mode===e.mode&&t.typeIds.every(((t,n)=>t===e.typeIds[n]))&&rp.compareManyFields(t.children,e.children)}function np(t,e){return t===e||Hh(t,e)&&t.unit===e.unit}qh.prototype.visitNull=Xh,qh.prototype.visitBool=Xh,qh.prototype.visitInt=Zh,qh.prototype.visitInt8=Zh,qh.prototype.visitInt16=Zh,qh.prototype.visitInt32=Zh,qh.prototype.visitInt64=Zh,qh.prototype.visitUint8=Zh,qh.prototype.visitUint16=Zh,qh.prototype.visitUint32=Zh,qh.prototype.visitUint64=Zh,qh.prototype.visitFloat=Jh,qh.prototype.visitFloat16=Jh,qh.prototype.visitFloat32=Jh,qh.prototype.visitFloat64=Jh,qh.prototype.visitUtf8=Xh,qh.prototype.visitBinary=Xh,qh.prototype.visitFixedSizeBinary=function(t,e){return t===e||Hh(t,e)&&t.byteWidth===e.byteWidth},qh.prototype.visitDate=Kh,qh.prototype.visitDateDay=Kh,qh.prototype.visitDateMillisecond=Kh,qh.prototype.visitTimestamp=Qh,qh.prototype.visitTimestampSecond=Qh,qh.prototype.visitTimestampMillisecond=Qh,qh.prototype.visitTimestampMicrosecond=Qh,qh.prototype.visitTimestampNanosecond=Qh,qh.prototype.visitTime=tp,qh.prototype.visitTimeSecond=tp,qh.prototype.visitTimeMillisecond=tp,qh.prototype.visitTimeMicrosecond=tp,qh.prototype.visitTimeNanosecond=tp,qh.prototype.visitDecimal=Xh,qh.prototype.visitList=function(t,e){return t===e||Hh(t,e)&&t.children.length===e.children.length&&rp.compareManyFields(t.children,e.children)},qh.prototype.visitStruct=function(t,e){return t===e||Hh(t,e)&&t.children.length===e.children.length&&rp.compareManyFields(t.children,e.children)},qh.prototype.visitUnion=ep,qh.prototype.visitDenseUnion=ep,qh.prototype.visitSparseUnion=ep,qh.prototype.visitDictionary=function(t,e){return t===e||Hh(t,e)&&t.id===e.id&&t.isOrdered===e.isOrdered&&rp.visit(t.indices,e.indices)&&rp.visit(t.dictionary,e.dictionary)},qh.prototype.visitInterval=np,qh.prototype.visitIntervalDayTime=np,qh.prototype.visitIntervalYearMonth=np,qh.prototype.visitFixedSizeList=function(t,e){return t===e||Hh(t,e)&&t.listSize===e.listSize&&t.children.length===e.children.length&&rp.compareManyFields(t.children,e.children)},qh.prototype.visitMap=function(t,e){return t===e||Hh(t,e)&&t.keysSorted===e.keysSorted&&t.children.length===e.children.length&&rp.compareManyFields(t.children,e.children)};const rp=new qh;function ip(t,e){return rp.compareSchemas(t,e)}function op(t,e){return function(t,e){const n=[...t.fields],r=[],i={numBatches:e.reduce(((t,e)=>Math.max(t,e.length)),0)};let o=0,a=0,s=-1;const u=e.length;let c,f=[];for(;i.numBatches-- >0;){for(a=Number.POSITIVE_INFINITY,s=-1;++s<u;)f[s]=c=e[s].shift(),a=Math.min(a,c?c.length:a);Number.isFinite(a)&&(f=ap(n,a,f,e,i),a>0&&(r[o++]=nd({type:new Tf(n),length:a,nullCount:0,children:f.slice()})))}return[t=t.assign(n),r.map((e=>new fp(t,e)))]}(t,e.map((t=>t.data.concat())))}function ap(t,e,n,r,i){var o;const a=(e+63&-64)>>3;for(let s=-1,u=r.length;++s<u;){const u=n[s],c=null==u?void 0:u.length;if(c>=e)c===e?n[s]=u:(n[s]=u.slice(0,e),i.numBatches=Math.max(i.numBatches,r[s].unshift(u.slice(e,c-e))));else{const r=t[s];t[s]=r.clone({nullable:!0}),n[s]=null!==(o=null==u?void 0:u._changeLengthAndBackfillNullBitmap(e))&&void 0!==o?o:nd({type:r.type,length:e,nullCount:e,nullBitmap:new Uint8Array(a)})}}return n}var sp,up;class cp{constructor(...t){var e,n;if(0===t.length)return this.batches=[],this.schema=new gh([]),this._offsets=[0],this;let r,i;t[0]instanceof gh&&(r=t.shift()),t[t.length-1]instanceof Uint32Array&&(i=t.pop());const o=t=>{if(t){if(t instanceof fp)return[t];if(t instanceof cp)return t.batches;if(t instanceof td){if(t.type instanceof Tf)return[new fp(new gh(t.type.children),t)]}else{if(Array.isArray(t))return t.flatMap((t=>o(t)));if("function"==typeof t[Symbol.iterator])return[...t].flatMap((t=>o(t)));if("object"==typeof t){const e=Object.keys(t),n=e.map((e=>new kd([t[e]]))),r=new gh(e.map(((t,e)=>new vh(String(t),n[e].type)))),[,i]=op(r,n);return 0===i.length?[new fp(t)]:i}}}return[]},a=t.flatMap((t=>o(t)));if(r=null!==(n=null!=r?r:null===(e=a[0])||void 0===e?void 0:e.schema)&&void 0!==n?n:new gh([]),!(r instanceof gh))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(const s of a){if(!(s instanceof fp))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!ip(r,s.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=r,this.batches=a,this._offsets=null!=i?i:od(this.data)}get data(){return this.batches.map((({data:t})=>t))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce(((t,e)=>t+e.length),0)}get nullCount(){return-1===this._nullCount&&(this._nullCount=id(this.data)),this._nullCount}isValid(t){return!1}get(t){return null}set(t,e){}indexOf(t,e){return-1}getByteLength(t){return 0}[Symbol.iterator](){return this.batches.length>0?gd.visit(new kd(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[\n  ${this.toArray().join(",\n  ")}\n]`}concat(...t){const e=this.schema,n=this.data.concat(t.flatMap((({data:t})=>t)));return new cp(e,n.map((t=>new fp(e,t))))}slice(t,e){const n=this.schema;[t,e]=$l({length:this.numRows},t,e);const r=ad(this.data,this._offsets,t,e);return new cp(n,r.map((t=>new fp(n,t))))}getChild(t){return this.getChildAt(this.schema.fields.findIndex((e=>e.name===t)))}getChildAt(t){if(t>-1&&t<this.schema.fields.length){const e=this.data.map((e=>e.children[t]));if(0===e.length){const{type:n}=this.schema.fields[t],r=nd({type:n,length:0,nullCount:0});e.push(r._changeLengthAndBackfillNullBitmap(this.numRows))}return new kd(e)}return null}setChild(t,e){var n;return this.setChildAt(null===(n=this.schema.fields)||void 0===n?void 0:n.findIndex((e=>e.name===t)),e)}setChildAt(t,e){let n=this.schema,r=[...this.batches];if(t>-1&&t<this.numCols){e||(e=new kd([nd({type:new of,length:this.numRows})]));const i=n.fields.slice(),o=i[t].clone({type:e.type}),a=this.schema.fields.map(((t,e)=>this.getChildAt(e)));[i[t],a[t]]=[o,e],[n,r]=op(n,a)}return new cp(n,r)}select(t){const e=this.schema.fields.reduce(((t,e,n)=>t.set(e.name,n)),new Map);return this.selectAt(t.map((t=>e.get(t))).filter((t=>t>-1)))}selectAt(t){const e=this.schema.selectAt(t),n=this.batches.map((e=>e.selectAt(t)));return new cp(e,n)}assign(t){const e=this.schema.fields,[n,r]=t.schema.fields.reduce(((t,n,r)=>{const[i,o]=t,a=e.findIndex((t=>t.name===n.name));return~a?o[a]=r:i.push(r),t}),[[],[]]),i=this.schema.assign(t.schema),o=[...e.map(((t,e)=>[e,r[e]])).map((([e,n])=>void 0===n?this.getChildAt(e):t.getChildAt(n))),...n.map((e=>t.getChildAt(e)))].filter(Boolean);return new cp(...op(i,o))}}sp=Symbol.toStringTag,cp[sp]=(t=>(t.schema=null,t.batches=[],t._offsets=new Uint32Array([0]),t._nullCount=-1,t[Symbol.isConcatSpreadable]=!0,t.isValid=cd(ud),t.get=cd(Fl.getVisitFn(vc.Struct)),t.set=fd(cl.getVisitFn(vc.Struct)),t.indexOf=ld(_d.getVisitFn(vc.Struct)),t.getByteLength=cd(Sd.getVisitFn(vc.Struct)),"Table"))(cp.prototype);let fp=class t{constructor(...t){switch(t.length){case 2:if([this.schema]=t,!(this.schema instanceof gh))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=nd({nullCount:0,type:new Tf(this.schema.fields),children:this.schema.fields.map((t=>nd({type:t.type,nullCount:0})))})]=t,!(this.data instanceof td))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=lp(this.schema,this.data.children);break;case 1:{const[e]=t,{fields:n,children:r,length:i}=Object.keys(e).reduce(((t,n,r)=>(t.children[r]=e[n],t.length=Math.max(t.length,e[n].length),t.fields[r]=vh.new({name:n,type:e[n].type,nullable:!0}),t)),{length:0,fields:new Array,children:new Array}),o=new gh(n),a=nd({type:new Tf(n),length:i,children:r,nullCount:0});[this.schema,this.data]=lp(o,a.children,i);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=dp(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(t){return this.data.getValid(t)}get(t){return Fl.visit(this.data,t)}set(t,e){return cl.visit(this.data,t,e)}indexOf(t,e){return _d.visit(this.data,t,e)}getByteLength(t){return Sd.visit(this.data,t)}[Symbol.iterator](){return gd.visit(new kd([this.data]))}toArray(){return[...this]}concat(...t){return new cp(this.schema,[this,...t])}slice(e,n){const[r]=new kd([this.data]).slice(e,n).data;return new t(this.schema,r)}getChild(t){var e;return this.getChildAt(null===(e=this.schema.fields)||void 0===e?void 0:e.findIndex((e=>e.name===t)))}getChildAt(t){return t>-1&&t<this.schema.fields.length?new kd([this.data.children[t]]):null}setChild(t,e){var n;return this.setChildAt(null===(n=this.schema.fields)||void 0===n?void 0:n.findIndex((e=>e.name===t)),e)}setChildAt(e,n){let r=this.schema,i=this.data;if(e>-1&&e<this.numCols){n||(n=new kd([nd({type:new of,length:this.numRows})]));const t=r.fields.slice(),o=i.children.slice(),a=t[e].clone({type:n.type});[t[e],o[e]]=[a,n.data[0]],r=new gh(t,new Map(this.schema.metadata)),i=nd({type:new Tf(t),children:o})}return new t(r,i)}select(e){const n=this.schema.select(e),r=new Tf(n.fields),i=[];for(const t of e){const e=this.schema.fields.findIndex((e=>e.name===t));~e&&(i[e]=this.data.children[e])}return new t(n,nd({type:r,length:this.numRows,children:i}))}selectAt(e){const n=this.schema.selectAt(e),r=e.map((t=>this.data.children[t])).filter(Boolean),i=nd({type:new Tf(n.fields),length:this.numRows,children:r});return new t(n,i)}};function lp(t,e,n=e.reduce(((t,e)=>Math.max(t,e.length)),0)){var r;const i=[...t.fields],o=[...e],a=(n+63&-64)>>3;for(const[s,u]of t.fields.entries()){const t=e[s];t&&t.length===n||(i[s]=u.clone({nullable:!0}),o[s]=null!==(r=null==t?void 0:t._changeLengthAndBackfillNullBitmap(n))&&void 0!==r?r:nd({type:u.type,length:n,nullCount:n,nullBitmap:new Uint8Array(a)}))}return[t.assign(i),nd({type:new Tf(i),length:n,children:o})]}function dp(t,e,n=new Map){for(let r=-1,i=t.length;++r<i;){const i=t[r].type,o=e[r];if(rf.isDictionary(i))if(n.has(i.id)){if(n.get(i.id)!==o.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}else o.dictionary&&n.set(i.id,o.dictionary);i.children&&i.children.length>0&&dp(i.children,o.children,n)}return n}up=Symbol.toStringTag,fp[up]=(t=>(t._nullCount=-1,t[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(fp.prototype);class hp extends fp{constructor(t){const e=t.fields.map((t=>nd({type:t.type})));super(t,nd({type:new Tf(t.fields),nullCount:0,children:e}))}}var pp,_p,mp,bp;(_p=pp||(pp={}))[_p.BUFFER=0]="BUFFER",(bp=mp||(mp={}))[bp.LZ4_FRAME=0]="LZ4_FRAME",bp[bp.ZSTD=1]="ZSTD";class yp{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBodyCompression(t,e){return(e||new yp).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBodyCompression(t,e){return t.setPosition(t.position()+4),(e||new yp).__init(t.readInt32(t.position())+t.position(),t)}codec(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt8(this.bb_pos+t):mp.LZ4_FRAME}method(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt8(this.bb_pos+t):pp.BUFFER}static startBodyCompression(t){t.startObject(2)}static addCodec(t,e){t.addFieldInt8(0,e,mp.LZ4_FRAME)}static addMethod(t,e){t.addFieldInt8(1,e,pp.BUFFER)}static endBodyCompression(t){return t.endObject()}static createBodyCompression(t,e,n){return yp.startBodyCompression(t),yp.addCodec(t,e),yp.addMethod(t,n),yp.endBodyCompression(t)}}class gp{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(t,e,n){return t.prep(8,16),t.writeInt64(BigInt(null!=n?n:0)),t.writeInt64(BigInt(null!=e?e:0)),t.offset()}}let vp=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(t,e,n){return t.prep(8,16),t.writeInt64(BigInt(null!=n?n:0)),t.writeInt64(BigInt(null!=e?e:0)),t.offset()}},wp=class t{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsRecordBatch(e,n){return(n||new t).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsRecordBatch(e,n){return e.setPosition(e.position()+4),(n||new t).__init(e.readInt32(e.position())+e.position(),e)}length(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}nodes(t,e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new vp).__init(this.bb.__vector(this.bb_pos+n)+16*t,this.bb):null}nodesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}buffers(t,e){const n=this.bb.__offset(this.bb_pos,8);return n?(e||new gp).__init(this.bb.__vector(this.bb_pos+n)+16*t,this.bb):null}buffersLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}compression(t){const e=this.bb.__offset(this.bb_pos,10);return e?(t||new yp).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}static startRecordBatch(t){t.startObject(4)}static addLength(t,e){t.addFieldInt64(0,e,BigInt("0"))}static addNodes(t,e){t.addFieldOffset(1,e,0)}static startNodesVector(t,e){t.startVector(16,e,8)}static addBuffers(t,e){t.addFieldOffset(2,e,0)}static startBuffersVector(t,e){t.startVector(16,e,8)}static addCompression(t,e){t.addFieldOffset(3,e,0)}static endRecordBatch(t){return t.endObject()}},xp=class t{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDictionaryBatch(e,n){return(n||new t).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDictionaryBatch(e,n){return e.setPosition(e.position()+4),(n||new t).__init(e.readInt32(e.position())+e.position(),e)}id(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}data(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new wp).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}isDelta(){const t=this.bb.__offset(this.bb_pos,8);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}static startDictionaryBatch(t){t.startObject(3)}static addId(t,e){t.addFieldInt64(0,e,BigInt("0"))}static addData(t,e){t.addFieldOffset(1,e,0)}static addIsDelta(t,e){t.addFieldInt8(2,+e,0)}static endDictionaryBatch(t){return t.endObject()}};var Ap;!function(t){t[t.NONE=0]="NONE",t[t.Schema=1]="Schema",t[t.DictionaryBatch=2]="DictionaryBatch",t[t.RecordBatch=3]="RecordBatch",t[t.Tensor=4]="Tensor",t[t.SparseTensor=5]="SparseTensor"}(Ap||(Ap={}));let Sp=class t{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsMessage(e,n){return(n||new t).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsMessage(e,n){return e.setPosition(e.position()+4),(n||new t).__init(e.readInt32(e.position())+e.position(),e)}version(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Pd.V1}headerType(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):Ap.NONE}header(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__union(t,this.bb_pos+e):null}bodyLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}customMetadata(t,e){const n=this.bb.__offset(this.bb_pos,12);return n?(e||new Ud).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*t),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startMessage(t){t.startObject(5)}static addVersion(t,e){t.addFieldInt16(0,e,Pd.V1)}static addHeaderType(t,e){t.addFieldInt8(1,e,Ap.NONE)}static addHeader(t,e){t.addFieldOffset(2,e,0)}static addBodyLength(t,e){t.addFieldInt64(3,e,BigInt("0"))}static addCustomMetadata(t,e){t.addFieldOffset(4,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endMessage(t){return t.endObject()}static finishMessageBuffer(t,e){t.finish(e)}static finishSizePrefixedMessageBuffer(t,e){t.finish(e,void 0,!0)}static createMessage(e,n,r,i,o,a){return t.startMessage(e),t.addVersion(e,n),t.addHeaderType(e,r),t.addHeader(e,i),t.addBodyLength(e,o),t.addCustomMetadata(e,a),t.endMessage(e)}};const Ip=new class extends Ff{visit(t,e){return null==t||null==e?void 0:super.visit(t,e)}visitNull(t,e){return uh.startNull(e),uh.endNull(e)}visitInt(t,e){return qd.startInt(e),qd.addBitWidth(e,t.bitWidth),qd.addIsSigned(e,t.isSigned),qd.endInt(e)}visitFloat(t,e){return ih.startFloatingPoint(e),ih.addPrecision(e,t.precision),ih.endFloatingPoint(e)}visitBinary(t,e){return Xd.startBinary(e),Xd.endBinary(e)}visitBool(t,e){return Zd.startBool(e),Zd.endBool(e)}visitUtf8(t,e){return _h.startUtf8(e),_h.endUtf8(e)}visitDecimal(t,e){return Kd.startDecimal(e),Kd.addScale(e,t.scale),Kd.addPrecision(e,t.precision),Kd.addBitWidth(e,t.bitWidth),Kd.endDecimal(e)}visitDate(t,e){return Jd.startDate(e),Jd.addUnit(e,t.unit),Jd.endDate(e)}visitTime(t,e){return fh.startTime(e),fh.addUnit(e,t.unit),fh.addBitWidth(e,t.bitWidth),fh.endTime(e)}visitTimestamp(t,e){const n=t.timezone&&e.createString(t.timezone)||void 0;return lh.startTimestamp(e),lh.addUnit(e,t.unit),void 0!==n&&lh.addTimezone(e,n),lh.endTimestamp(e)}visitInterval(t,e){return oh.startInterval(e),oh.addUnit(e,t.unit),oh.endInterval(e)}visitList(t,e){return ah.startList(e),ah.endList(e)}visitStruct(t,e){return ch.startStruct_(e),ch.endStruct_(e)}visitUnion(t,e){ph.startTypeIdsVector(e,t.typeIds.length);const n=ph.createTypeIdsVector(e,t.typeIds);return ph.startUnion(e),ph.addMode(e,t.mode),ph.addTypeIds(e,n),ph.endUnion(e)}visitDictionary(t,e){const n=this.visit(t.indices,e);return Hd.startDictionaryEncoding(e),Hd.addId(e,BigInt(t.id)),Hd.addIsOrdered(e,t.isOrdered),void 0!==n&&Hd.addIndexType(e,n),Hd.endDictionaryEncoding(e)}visitFixedSizeBinary(t,e){return nh.startFixedSizeBinary(e),nh.addByteWidth(e,t.byteWidth),nh.endFixedSizeBinary(e)}visitFixedSizeList(t,e){return rh.startFixedSizeList(e),rh.addListSize(e,t.listSize),rh.endFixedSizeList(e)}visitMap(t,e){return sh.startMap(e),sh.addKeysSorted(e,t.keysSorted),sh.endMap(e)}};function Op(t){return new Fp(t.count,kp(t.columns),Mp(t.columns))}function Tp(t,e){return(t.children||[]).filter(Boolean).map((t=>vh.fromJSON(t,e)))}function kp(t){return(t||[]).reduce(((t,e)=>{return[...t,new Rp(e.count,(n=e.VALIDITY,(n||[]).reduce(((t,e)=>t+ +(0===e)),0))),...kp(e.children)];var n}),[])}function Mp(t,e=[]){for(let n=-1,r=(t||[]).length;++n<r;){const r=t[n];r.VALIDITY&&e.push(new Lp(e.length,r.VALIDITY.length)),r.TYPE&&e.push(new Lp(e.length,r.TYPE.length)),r.OFFSET&&e.push(new Lp(e.length,r.OFFSET.length)),r.DATA&&e.push(new Lp(e.length,r.DATA.length)),e=Mp(r.children,e)}return e}function Ep(t){return new Map(Object.entries(t||{}))}function Bp(t){return new af(t.isSigned,t.bitWidth)}function jp(t,e){const n=t.type.name;switch(n){case"NONE":case"null":return new of;case"binary":return new yf;case"utf8":return new gf;case"bool":return new vf;case"list":return new Of((e||[])[0]);case"struct":case"struct_":return new Tf(e||[])}switch(n){case"int":{const e=t.type;return new af(e.isSigned,e.bitWidth)}case"floatingpoint":{const e=t.type;return new _f(fc[e.precision])}case"decimal":{const e=t.type;return new wf(e.scale,e.precision,e.bitWidth)}case"date":{const e=t.type;return new xf(dc[e.unit])}case"time":{const e=t.type;return new Af(pc[e.unit],e.bitWidth)}case"timestamp":{const e=t.type;return new Sf(pc[e.unit],e.timezone)}case"interval":{const e=t.type;return new If(mc[e.unit])}case"union":{const n=t.type;return new kf(uc[n.mode],n.typeIds||[],e||[])}case"fixedsizebinary":{const e=t.type;return new Mf(e.byteWidth)}case"fixedsizelist":{const n=t.type;return new Ef(n.listSize,(e||[])[0])}case"map":{const n=t.type;return new Bf((e||[])[0],n.keysSorted)}}throw new Error(`Unrecognized type: "${n}"`)}var Dp=Rd,zp=Ld;class Np{static fromJSON(t,e){const n=new Np(0,ac.V4,e);return n._createHeader=function(t,e){return()=>{switch(e){case yc.Schema:return gh.fromJSON(t);case yc.RecordBatch:return Fp.fromJSON(t);case yc.DictionaryBatch:return Cp.fromJSON(t)}throw new Error(`Unrecognized Message type: { name: ${yc[e]}, type: ${e} }`)}}(t,e),n}static decode(t){t=new zp(Ju(t));const e=Sp.getRootAsMessage(t),n=e.bodyLength(),r=e.version(),i=e.headerType(),o=new Np(n,r,i);return o._createHeader=function(t,e){return()=>{switch(e){case yc.Schema:return gh.decode(t.header(new bh));case yc.RecordBatch:return Fp.decode(t.header(new wp),t.version());case yc.DictionaryBatch:return Cp.decode(t.header(new xp),t.version())}throw new Error(`Unrecognized Message type: { name: ${yc[e]}, type: ${e} }`)}}(e,i),o}static encode(t){const e=new Dp;let n=-1;return t.isSchema()?n=gh.encode(e,t.header()):t.isRecordBatch()?n=Fp.encode(e,t.header()):t.isDictionaryBatch()&&(n=Cp.encode(e,t.header())),Sp.startMessage(e),Sp.addVersion(e,ac.V4),Sp.addHeader(e,n),Sp.addHeaderType(e,t.headerType),Sp.addBodyLength(e,BigInt(t.bodyLength)),Sp.finishMessageBuffer(e,Sp.endMessage(e)),e.asUint8Array()}static from(t,e=0){if(t instanceof gh)return new Np(0,ac.V4,yc.Schema,t);if(t instanceof Fp)return new Np(e,ac.V4,yc.RecordBatch,t);if(t instanceof Cp)return new Np(e,ac.V4,yc.DictionaryBatch,t);throw new Error(`Unrecognized Message header: ${t}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===yc.Schema}isRecordBatch(){return this.headerType===yc.RecordBatch}isDictionaryBatch(){return this.headerType===yc.DictionaryBatch}constructor(t,e,n,r){this._version=e,this._headerType=n,this.body=new Uint8Array(0),r&&(this._createHeader=()=>r),this._bodyLength=Fc(t)}}class Fp{get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}constructor(t,e,n){this._nodes=e,this._buffers=n,this._length=Fc(t)}}class Cp{get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}constructor(t,e,n=!1){this._data=t,this._isDelta=n,this._id=Fc(e)}}class Lp{constructor(t,e){this.offset=Fc(t),this.length=Fc(e)}}class Rp{constructor(t,e){this.length=Fc(t),this.nullCount=Fc(e)}}function Up(t,e){const n=[];for(let r,i=-1,o=-1,a=t.childrenLength();++i<a;)(r=t.children(i))&&(n[++o]=vh.decode(r,e));return n}function Pp(t){const e=new Map;if(t)for(let n,r,i=-1,o=Math.trunc(t.customMetadataLength());++i<o;)(n=t.customMetadata(i))&&null!=(r=n.key())&&e.set(r,n.value());return e}function Vp(t){return new af(t.isSigned(),t.bitWidth())}function $p(t,e){const n=t.typeType();switch(n){case hh.NONE:case hh.Null:return new of;case hh.Binary:return new yf;case hh.Utf8:return new gf;case hh.Bool:return new vf;case hh.List:return new Of((e||[])[0]);case hh.Struct_:return new Tf(e||[])}switch(n){case hh.Int:{const e=t.type(new qd);return new af(e.isSigned(),e.bitWidth())}case hh.FloatingPoint:{const e=t.type(new ih);return new _f(e.precision())}case hh.Decimal:{const e=t.type(new Kd);return new wf(e.scale(),e.precision(),e.bitWidth())}case hh.Date:{const e=t.type(new Jd);return new xf(e.unit())}case hh.Time:{const e=t.type(new fh);return new Af(e.unit(),e.bitWidth())}case hh.Timestamp:{const e=t.type(new lh);return new Sf(e.unit(),e.timezone())}case hh.Interval:{const e=t.type(new oh);return new If(e.unit())}case hh.Union:{const n=t.type(new ph);return new kf(n.mode(),n.typeIdsArray()||[],e||[])}case hh.FixedSizeBinary:{const e=t.type(new nh);return new Mf(e.byteWidth())}case hh.FixedSizeList:{const n=t.type(new rh);return new Ef(n.listSize(),(e||[])[0])}case hh.Map:{const n=t.type(new sh);return new Bf((e||[])[0],n.keysSorted())}}throw new Error(`Unrecognized type: "${hh[n]}" (${n})`)}vh.encode=function(t,e){let n=-1,r=-1,i=-1;const o=e.type;let a=e.typeId;rf.isDictionary(o)?(a=o.dictionary.typeId,i=Ip.visit(o,t),r=Ip.visit(o.dictionary,t)):r=Ip.visit(o,t);const s=(o.children||[]).map((e=>vh.encode(t,e))),u=mh.createChildrenVector(t,s),c=e.metadata&&e.metadata.size>0?mh.createCustomMetadataVector(t,[...e.metadata].map((([e,n])=>{const r=t.createString(`${e}`),i=t.createString(`${n}`);return Ud.startKeyValue(t),Ud.addKey(t,r),Ud.addValue(t,i),Ud.endKeyValue(t)}))):-1;e.name&&(n=t.createString(e.name));mh.startField(t),mh.addType(t,r),mh.addTypeType(t,a),mh.addChildren(t,u),mh.addNullable(t,!!e.nullable),-1!==n&&mh.addName(t,n);-1!==i&&mh.addDictionary(t,i);-1!==c&&mh.addCustomMetadata(t,c);return mh.endField(t)},vh.decode=function(t,e){let n,r,i,o,a,s;e&&(s=t.dictionary())?e.has(n=Fc(s.id()))?(o=(o=s.indexType())?Vp(o):new cf,a=new zf(e.get(n),o,n,s.isOrdered()),r=new vh(t.name(),a,t.nullable(),Pp(t))):(o=(o=s.indexType())?Vp(o):new cf,e.set(n,i=$p(t,Up(t,e))),a=new zf(i,o,n,s.isOrdered()),r=new vh(t.name(),a,t.nullable(),Pp(t))):(i=$p(t,Up(t,e)),r=new vh(t.name(),i,t.nullable(),Pp(t)));return r||null},vh.fromJSON=function(t,e){let n,r,i,o,a,s;return e&&(o=t.dictionary)?e.has(n=o.id)?(r=(r=o.indexType)?Bp(r):new cf,s=new zf(e.get(n),r,n,o.isOrdered),i=new vh(t.name,s,t.nullable,Ep(t.customMetadata))):(r=(r=o.indexType)?Bp(r):new cf,e.set(n,a=jp(t,Tp(t,e))),s=new zf(a,r,n,o.isOrdered),i=new vh(t.name,s,t.nullable,Ep(t.customMetadata))):(a=jp(t,Tp(t,e)),i=new vh(t.name,a,t.nullable,Ep(t.customMetadata))),i||null},gh.encode=function(t,e){const n=e.fields.map((e=>vh.encode(t,e)));bh.startFieldsVector(t,n.length);const r=bh.createFieldsVector(t,n),i=e.metadata&&e.metadata.size>0?bh.createCustomMetadataVector(t,[...e.metadata].map((([e,n])=>{const r=t.createString(`${e}`),i=t.createString(`${n}`);return Ud.startKeyValue(t),Ud.addKey(t,r),Ud.addValue(t,i),Ud.endKeyValue(t)}))):-1;bh.startSchema(t),bh.addFields(t,r),bh.addEndianness(t,Yp?Vd.Little:Vd.Big),-1!==i&&bh.addCustomMetadata(t,i);return bh.endSchema(t)},gh.decode=function(t,e=new Map){const n=function(t,e){const n=[];for(let r,i=-1,o=-1,a=t.fieldsLength();++i<a;)(r=t.fields(i))&&(n[++o]=vh.decode(r,e));return n}(t,e);return new gh(n,Pp(t),e)},gh.fromJSON=function(t,e=new Map){return new gh(function(t,e){return(t.fields||[]).filter(Boolean).map((t=>vh.fromJSON(t,e)))}(t,e),Ep(t.customMetadata),e)},Fp.encode=function(t,e){const n=e.nodes||[],r=e.buffers||[];wp.startNodesVector(t,n.length);for(const a of n.slice().reverse())Rp.encode(t,a);const i=t.endVector();wp.startBuffersVector(t,r.length);for(const a of r.slice().reverse())Lp.encode(t,a);const o=t.endVector();return wp.startRecordBatch(t),wp.addLength(t,BigInt(e.length)),wp.addNodes(t,i),wp.addBuffers(t,o),wp.endRecordBatch(t)},Fp.decode=function(t,e=ac.V4){if(null!==t.compression())throw new Error("Record batch compression not implemented");return new Fp(t.length(),function(t){const e=[];for(let n,r=-1,i=-1,o=t.nodesLength();++r<o;)(n=t.nodes(r))&&(e[++i]=Rp.decode(n));return e}(t),function(t,e){const n=[];for(let r,i=-1,o=-1,a=t.buffersLength();++i<a;)(r=t.buffers(i))&&(e<ac.V4&&(r.bb_pos+=8*(i+1)),n[++o]=Lp.decode(r));return n}(t,e))},Fp.fromJSON=Op,Cp.encode=function(t,e){const n=Fp.encode(t,e.data);return xp.startDictionaryBatch(t),xp.addId(t,BigInt(e.id)),xp.addIsDelta(t,e.isDelta),xp.addData(t,n),xp.endDictionaryBatch(t)},Cp.decode=function(t,e=ac.V4){return new Cp(Fp.decode(t.data(),e),t.id(),t.isDelta())},Cp.fromJSON=function(t){return new Cp(Op(t.data),t.id,t.isDelta)},Rp.encode=function(t,e){return vp.createFieldNode(t,BigInt(e.length),BigInt(e.nullCount))},Rp.decode=function(t){return new Rp(t.length(),t.nullCount())},Lp.encode=function(t,e){return gp.createBuffer(t,BigInt(e.offset),BigInt(e.length))},Lp.decode=function(t){return new Lp(t.offset(),t.length())};const Yp=(()=>{const t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]})(),Wp=t=>`Expected ${yc[t]} Message in stream, but was null or length 0.`,Gp=t=>`Header pointer of flatbuffer-encoded ${yc[t]} Message is null or length 0.`,qp=(t,e)=>`Expected to read ${t} metadata bytes, but only read ${e}.`,Hp=(t,e)=>`Expected to read ${t} bytes for message body, but only read ${e}.`;class Xp{constructor(t){this.source=t instanceof Dh?t:new Dh(t)}[Symbol.iterator](){return this}next(){let t;return(t=this.readMetadataLength()).done||-1===t.value&&(t=this.readMetadataLength()).done||(t=this.readMetadata(t.value)).done?kh:t}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}readMessage(t){let e;if((e=this.next()).done)return null;if(null!=t&&e.value.headerType!==t)throw new Error(Wp(t));return e.value}readMessageBody(t){if(t<=0)return new Uint8Array(0);const e=Ju(this.source.read(t));if(e.byteLength<t)throw new Error(Hp(t,e.byteLength));return e.byteOffset%8==0&&e.byteOffset+e.byteLength<=e.buffer.byteLength?e:e.slice()}readSchema(t=!1){const e=yc.Schema,n=this.readMessage(e),r=null==n?void 0:n.header();if(t&&!r)throw new Error(Gp(e));return r}readMetadataLength(){const t=this.source.read(Kp),e=t&&new Ld(t),n=(null==e?void 0:e.readInt32(0))||0;return{done:0===n,value:n}}readMetadata(t){const e=this.source.read(t);if(!e)return kh;if(e.byteLength<t)throw new Error(qp(t,e.byteLength));return{done:!1,value:Np.decode(e)}}}class Zp{constructor(t,e){this.source=t instanceof zh?t:Uu(t)?new Lh(t,e):new zh(t)}[Symbol.asyncIterator](){return this}next(){return gu(this,void 0,void 0,(function*(){let t;return(t=yield this.readMetadataLength()).done||-1===t.value&&(t=yield this.readMetadataLength()).done||(t=yield this.readMetadata(t.value)).done?kh:t}))}throw(t){return gu(this,void 0,void 0,(function*(){return yield this.source.throw(t)}))}return(t){return gu(this,void 0,void 0,(function*(){return yield this.source.return(t)}))}readMessage(t){return gu(this,void 0,void 0,(function*(){let e;if((e=yield this.next()).done)return null;if(null!=t&&e.value.headerType!==t)throw new Error(Wp(t));return e.value}))}readMessageBody(t){return gu(this,void 0,void 0,(function*(){if(t<=0)return new Uint8Array(0);const e=Ju(yield this.source.read(t));if(e.byteLength<t)throw new Error(Hp(t,e.byteLength));return e.byteOffset%8==0&&e.byteOffset+e.byteLength<=e.buffer.byteLength?e:e.slice()}))}readSchema(t=!1){return gu(this,void 0,void 0,(function*(){const e=yc.Schema,n=yield this.readMessage(e),r=null==n?void 0:n.header();if(t&&!r)throw new Error(Gp(e));return r}))}readMetadataLength(){return gu(this,void 0,void 0,(function*(){const t=yield this.source.read(Kp),e=t&&new Ld(t),n=(null==e?void 0:e.readInt32(0))||0;return{done:0===n,value:n}}))}readMetadata(t){return gu(this,void 0,void 0,(function*(){const e=yield this.source.read(t);if(!e)return kh;if(e.byteLength<t)throw new Error(qp(t,e.byteLength));return{done:!1,value:Np.decode(e)}}))}}class Jp extends Xp{constructor(t){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=t instanceof Mh?t:new Mh(t)}next(){const{_json:t}=this;if(!this._schema){this._schema=!0;return{done:!1,value:Np.fromJSON(t.schema,yc.Schema)}}if(this._dictionaryIndex<t.dictionaries.length){const e=t.dictionaries[this._dictionaryIndex++];this._body=e.data.columns;return{done:!1,value:Np.fromJSON(e,yc.DictionaryBatch)}}if(this._batchIndex<t.batches.length){const e=t.batches[this._batchIndex++];this._body=e.columns;return{done:!1,value:Np.fromJSON(e,yc.RecordBatch)}}return this._body=[],kh}readMessageBody(t){return function t(e){return(e||[]).reduce(((e,n)=>[...e,...n.VALIDITY&&[n.VALIDITY]||[],...n.TYPE&&[n.TYPE]||[],...n.OFFSET&&[n.OFFSET]||[],...n.DATA&&[n.DATA]||[],...t(n.children)]),[])}(this._body)}readMessage(t){let e;if((e=this.next()).done)return null;if(null!=t&&e.value.headerType!==t)throw new Error(Wp(t));return e.value}readSchema(){const t=yc.Schema,e=this.readMessage(t),n=null==e?void 0:e.header();if(!e||!n)throw new Error(Gp(t));return n}}const Kp=4,Qp="ARROW1",t_=new Uint8Array(Qp.length);for(let H_=0;H_<Qp.length;H_+=1)t_[H_]=Qp.codePointAt(H_);function e_(t,e=0){for(let n=-1,r=t_.length;++n<r;)if(t_[n]!==t[e+n])return!1;return!0}const n_=t_.length,r_=n_+Kp,i_=2*n_+Kp;class o_ extends Eh{constructor(t){super(),this._impl=t}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(t){return this._impl.throw(t)}return(t){return this._impl.return(t)}cancel(){return this._impl.cancel()}reset(t){return this._impl.reset(t),this._DOMStream=void 0,this._nodeStream=void 0,this}open(t){const e=this._impl.open(t);return Nu(e)?e.then((()=>this)):this}readRecordBatch(t){return this._impl.isFile()?this._impl.readRecordBatch(t):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return nc.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return nc.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t,e){throw new Error('"throughDOM" not available in this environment')}static from(t){return t instanceof o_?t:Lu(t)?function(t){return new a_(new __(t))}(t):Uu(t)?function(t){return gu(this,void 0,void 0,(function*(){const{size:e}=yield t.stat(),n=new Lh(t,e);return e>=i_&&e_(yield n.readAt(0,n_+7&-8))?new c_(new p_(n)):new s_(new d_(n))}))}(t):Nu(t)?(()=>gu(this,void 0,void 0,(function*(){return yield o_.from(yield t)})))():Pu(t)||$u(t)||Yu(t)||Cu(t)?function(t){return gu(this,void 0,void 0,(function*(){const e=yield t.peek(n_+7&-8);return e&&e.byteLength>=4?e_(e)?new u_(new h_(yield t.read())):new s_(new d_(t)):new s_(new d_(function(){return xu(this,arguments,(function*(){}))}()))}))}(new zh(t)):function(t){const e=t.peek(n_+7&-8);return e&&e.byteLength>=4?e_(e)?new u_(new h_(t.read())):new a_(new l_(t)):new a_(new l_(function*(){}()))}(new Dh(t))}static readAll(t){return t instanceof o_?t.isSync()?b_(t):y_(t):Lu(t)||ArrayBuffer.isView(t)||Fu(t)||Ru(t)?b_(t):y_(t)}}class a_ extends o_{constructor(t){super(t),this._impl=t}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return xu(this,arguments,(function*(){yield wu(yield*Au(Su(this[Symbol.iterator]())))}))}}class s_ extends o_{constructor(t){super(t),this._impl=t}readAll(){var t,e,n,r;return gu(this,void 0,void 0,(function*(){const i=new Array;try{for(var o,a=!0,s=Su(this);o=yield s.next(),!(t=o.done);){r=o.value,a=!1;try{const t=r;i.push(t)}finally{a=!0}}}catch(u){e={error:u}}finally{try{a||t||!(n=s.return)||(yield n.call(s))}finally{if(e)throw e.error}}return i}))}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}}class u_ extends a_{constructor(t){super(t),this._impl=t}}class c_ extends s_{constructor(t){super(t),this._impl=t}}class f_{get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}constructor(t=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=t}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(t){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=t,this.dictionaries=new Map,this}_loadRecordBatch(t,e){const n=this._loadVectors(t,e,this.schema.fields),r=nd({type:new Tf(this.schema.fields),length:t.length,children:n});return new fp(this.schema,r)}_loadDictionaryBatch(t,e){const{id:n,isDelta:r}=t,{dictionaries:i,schema:o}=this,a=i.get(n);if(r||!a){const i=o.dictionaries.get(n),s=this._loadVectors(t.data,e,[i]);return(a&&r?a.concat(new kd(s)):new kd(s)).memoize()}return a.memoize()}_loadVectors(t,e,n){return new Wh(e,t.nodes,t.buffers,this.dictionaries).visitMany(n)}}class l_ extends f_{constructor(t,e){super(e),this._reader=Lu(t)?new Jp(this._handle=t):new Xp(this._handle=t)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(t){return this.closed||(this.autoDestroy=m_(this,t),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(t):kh}return(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(t):kh}next(){if(this.closed)return kh;let t;const{_reader:e}=this;for(;t=this._readNextMessageAndValidate();)if(t.isSchema())this.reset(t.header());else{if(t.isRecordBatch()){this._recordBatchIndex++;const n=t.header(),r=e.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(n,r)}}if(t.isDictionaryBatch()){this._dictionaryIndex++;const n=t.header(),r=e.readMessageBody(t.bodyLength),i=this._loadDictionaryBatch(n,r);this.dictionaries.set(n.id,i)}}return this.schema&&0===this._recordBatchIndex?(this._recordBatchIndex++,{done:!1,value:new hp(this.schema)}):this.return()}_readNextMessageAndValidate(t){return this._reader.readMessage(t)}}class d_ extends f_{constructor(t,e){super(e),this._reader=new Zp(this._handle=t)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return gu(this,void 0,void 0,(function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}))}open(t){return gu(this,void 0,void 0,(function*(){return this.closed||(this.autoDestroy=m_(this,t),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this}))}throw(t){return gu(this,void 0,void 0,(function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(t):kh}))}return(t){return gu(this,void 0,void 0,(function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(t):kh}))}next(){return gu(this,void 0,void 0,(function*(){if(this.closed)return kh;let t;const{_reader:e}=this;for(;t=yield this._readNextMessageAndValidate();)if(t.isSchema())yield this.reset(t.header());else{if(t.isRecordBatch()){this._recordBatchIndex++;const n=t.header(),r=yield e.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(n,r)}}if(t.isDictionaryBatch()){this._dictionaryIndex++;const n=t.header(),r=yield e.readMessageBody(t.bodyLength),i=this._loadDictionaryBatch(n,r);this.dictionaries.set(n.id,i)}}return this.schema&&0===this._recordBatchIndex?(this._recordBatchIndex++,{done:!1,value:new hp(this.schema)}):yield this.return()}))}_readNextMessageAndValidate(t){return gu(this,void 0,void 0,(function*(){return yield this._reader.readMessage(t)}))}}class h_ extends l_{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(t,e){super(t instanceof Ch?t:new Ch(t),e)}isSync(){return!0}isFile(){return!0}open(t){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(const t of this._footer.dictionaryBatches())t&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(t)}readRecordBatch(t){var e;if(this.closed)return null;this._footer||this.open();const n=null===(e=this._footer)||void 0===e?void 0:e.getRecordBatch(t);if(n&&this._handle.seek(n.offset)){const t=this._reader.readMessage(yc.RecordBatch);if(null==t?void 0:t.isRecordBatch()){const e=t.header(),n=this._reader.readMessageBody(t.bodyLength);return this._loadRecordBatch(e,n)}}return null}_readDictionaryBatch(t){var e;const n=null===(e=this._footer)||void 0===e?void 0:e.getDictionaryBatch(t);if(n&&this._handle.seek(n.offset)){const t=this._reader.readMessage(yc.DictionaryBatch);if(null==t?void 0:t.isDictionaryBatch()){const e=t.header(),n=this._reader.readMessageBody(t.bodyLength),r=this._loadDictionaryBatch(e,n);this.dictionaries.set(e.id,r)}}}_readFooter(){const{_handle:t}=this,e=t.size-r_,n=t.readInt32(e),r=t.readAt(e-n,n);return Ih.decode(r)}_readNextMessageAndValidate(t){var e;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){const n=null===(e=this._footer)||void 0===e?void 0:e.getRecordBatch(this._recordBatchIndex);if(n&&this._handle.seek(n.offset))return this._reader.readMessage(t)}return null}}class p_ extends d_{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(t,...e){const n="number"!=typeof e[0]?e.shift():void 0,r=e[0]instanceof Map?e.shift():void 0;super(t instanceof Lh?t:new Lh(t,n),r)}isFile(){return!0}isAsync(){return!0}open(t){const e=Object.create(null,{open:{get:()=>super.open}});return gu(this,void 0,void 0,(function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(const t of this._footer.dictionaryBatches())t&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield e.open.call(this,t)}))}readRecordBatch(t){var e;return gu(this,void 0,void 0,(function*(){if(this.closed)return null;this._footer||(yield this.open());const n=null===(e=this._footer)||void 0===e?void 0:e.getRecordBatch(t);if(n&&(yield this._handle.seek(n.offset))){const t=yield this._reader.readMessage(yc.RecordBatch);if(null==t?void 0:t.isRecordBatch()){const e=t.header(),n=yield this._reader.readMessageBody(t.bodyLength);return this._loadRecordBatch(e,n)}}return null}))}_readDictionaryBatch(t){var e;return gu(this,void 0,void 0,(function*(){const n=null===(e=this._footer)||void 0===e?void 0:e.getDictionaryBatch(t);if(n&&(yield this._handle.seek(n.offset))){const t=yield this._reader.readMessage(yc.DictionaryBatch);if(null==t?void 0:t.isDictionaryBatch()){const e=t.header(),n=yield this._reader.readMessageBody(t.bodyLength),r=this._loadDictionaryBatch(e,n);this.dictionaries.set(e.id,r)}}}))}_readFooter(){return gu(this,void 0,void 0,(function*(){const{_handle:t}=this;t._pending&&(yield t._pending);const e=t.size-r_,n=yield t.readInt32(e),r=yield t.readAt(e-n,n);return Ih.decode(r)}))}_readNextMessageAndValidate(t){return gu(this,void 0,void 0,(function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){const e=this._footer.getRecordBatch(this._recordBatchIndex);if(e&&(yield this._handle.seek(e.offset)))return yield this._reader.readMessage(t)}return null}))}}class __ extends l_{constructor(t,e){super(t,e)}_loadVectors(t,e,n){return new Gh(e,t.nodes,t.buffers,this.dictionaries).visitMany(n)}}function m_(t,e){return e&&"boolean"==typeof e.autoDestroy?e.autoDestroy:t.autoDestroy}function*b_(t){const e=o_.from(t);try{if(!e.open({autoDestroy:!1}).closed)do{yield e}while(!e.reset().open().closed)}finally{e.cancel()}}function y_(t){return xu(this,arguments,(function*(){const e=yield wu(o_.from(t));try{if(!(yield wu(e.open({autoDestroy:!1}))).closed)do{yield yield wu(e)}while(!(yield wu(e.reset().open())).closed)}finally{yield wu(e.cancel())}}))}function g_(t){const e=o_.from(t);return Nu(e)?e.then((t=>g_(t))):e.isAsync()?e.readAll().then((t=>new cp(t))):new cp(e.readAll())}let v_=0;class w_{constructor(t){if(this.max_ix=-1,this._children=[],this.promise=Promise.resolve(),this.download_state="Unattempted",this.key=String(Math.random()),this.parent=null,this.dataset=t,this.ready=!1,void 0===t)throw new Error("No dataset provided");this.numeric_id=v_++}get children(){return this._children}get dictionary_lookups(){return this.dataset.dictionary_lookups}download(){throw new Error("Not implemented")}delete_column_if_exists(t){var e;this._batch&&(null==(e=this._buffer_manager)||e.release(t),this._batch=D_(this.record_batch,t,null))}async get_column(t){void 0===this._batch&&await this.promise;const e=this.record_batch.getChild(t);if(e)return e;if(this.dataset.transformations[t])return await this.apply_transformation(t),this.record_batch.getChild(t);throw new Error(`Column ${t} not found`)}async apply_transformation(t){const e=this.dataset.transformations[t];if(void 0===e)throw new Error(`Transformation ${t} is not defined`);const n=await e(this);if(void 0===n)throw new Error(`Transformation ${t} failed`);this._batch=D_(this.record_batch,t,n)}add_column(t,e){return this._batch=D_(this.record_batch,t,e),this._batch}is_visible(t,e){if(void 0===this.min_ix)return!1;if(this.min_ix>t)return!1;if(void 0===e)return!0;const n=this.extent;return!(n.x[0]>e.x[1]||n.x[1]<e.x[0]||n.y[0]>e.y[1]||n.y[1]<e.y[0])}*points(t,e=!1){for(const n of this)S_([n.x,n.y],t)&&(yield n);if(!1===e){for(const n of this.children)if(n.ready&&(!t||n.is_visible(1e100,t)))for(const r of n.points(t,e))S_([r.x,r.y],t)&&(yield r)}else{let n=this.children.map((n=>{const r={t:n,iterator:n.points(t,e),next:void 0};return r.next=r.iterator.next(),r}));for(n=n.filter((t=>{var e;return null==(e=null==t?void 0:t.next)?void 0:e.value}));n.length>0;){let t=0;for(let e=1;e<n.length;e++)n[e].next.value.ix<n[t].next.value.ix&&(t=e);yield n[t].next.value,n[t].next=n[t].iterator.next(),n[t].next.done&&(n=n.splice(t,1))}}}forEach(t){for(const e of this.points(void 0,!1))void 0!==e&&t(e)}set highest_known_ix(t){(null==this._highest_known_ix||this._highest_known_ix<t)&&(this._highest_known_ix=t,this.parent&&(this.parent.highest_known_ix=t))}get highest_known_ix(){return this._highest_known_ix||-1}get record_batch(){if(this._batch)return this._batch;throw new Error("Attempted to access table on tile without table buffer.")}get min_ix(){return void 0!==this._min_ix?this._min_ix:this.parent?this.parent.max_ix+1:0}async schema(){return await this.download(),this._schema}extend_promise(t){return this.promise=this.promise.then((()=>t())),this.promise}get _schema(){if(this.__schema)return this.__schema;const t=[];for(const e of this.record_batch.schema.fields){const{name:n,type:r}=e;if(5==(null==r?void 0:r.typeId)&&t.push({name:n,type:"string",extent:[]}),r&&r.dictionary&&t.push({name:n,type:"dictionary",keys:this.record_batch.getChild(n).data[0].dictionary.toArray(),extent:[-2047,this.record_batch.getChild(n).data[0].dictionary.length-2047]}),r&&8==r.typeId&&t.push({name:n,type:"date",extent:wt(this.record_batch.getChild(n).data[0].values)}),10===(null==r?void 0:r.typeId))return[10,100];r&&3==r.typeId&&t.push({name:n,type:"float",extent:wt(this.record_batch.getChild(n).data[0].values)})}return this.__schema=t,t}*yielder(){for(const t of this.record_batch)t&&(yield t)}get extent(){return this._extent?this._extent:{x:[Number.MIN_VALUE,Number.MAX_VALUE],y:[Number.MIN_VALUE,Number.MAX_VALUE]}}[Symbol.iterator](){return this.yielder()}get root_extent(){return null===this.parent?{x:[Number.MIN_VALUE,Number.MAX_VALUE],y:[Number.MIN_VALUE,Number.MAX_VALUE]}:this.parent.root_extent}}class x_ extends w_{constructor(t,e,n,r){super(r),this._children=[],this._already_called=!1,this.child_locations=[],this.url=t,this.parent=n,this.key=e;const[i,o,a]=e.split("/").map((t=>Number.parseInt(t)));this.codes=[i,o,a]}get extent(){return this._extent?this._extent:this.theoretical_extent}async download_to_depth(t){await this.download();let e=[];this.max_ix<t&&(e=this.children.map((e=>e.download_to_depth(t)))),await Promise.all(e)}async get_arrow(t=undefined){let e,n,r=`${this.url}/${this.key}.feather`;if(t&&(r=r.replace(".feather",`.${t}.feather`)),void 0!==this.dataset.tileProxy){const t=new URL(r).pathname;e=g_(await this.dataset.tileProxy.apiCall(t,"GET",null,null,{octetStreamAsUint8:!0}))}else{let t={};if("true"===window.localStorage.getItem("isLoggedIn")){r=r.replace("/public","");t={Authorization:`Bearer ${localStorage.getItem("access_token")}`}}const i={method:"GET",...t},o=await fetch(r,i);n=await o.arrayBuffer(),e=g_(n)}e.batches.length>1&&console.warn(`More than one record batch at ${r}; all but first batch will be ignored.`);const i=e.batches[0];return void 0===t&&(this.download_state="Complete",this._batch=e.batches[0]),i}async download(){if(this._download)return this._download;if(this._already_called)throw"Illegally attempting to download twice";return this._already_called=!0,this.download_state="In progress",this._download=this.get_arrow().then((t=>{this.ready=!0;const e=t.schema.metadata,n=e.get("extent");n&&(this._extent=JSON.parse(n));const r=e.get("children");r&&(this.child_locations=JSON.parse(r));const i=t.getChild("ix");if(null===i)throw"No ix column in table";this._min_ix=Number(i.get(0)),this.max_ix=Number(i.get(i.length-1)),this._min_ix>this.max_ix&&(this.max_ix=this._min_ix+1e5,this._min_ix=0),this.highest_known_ix=this.max_ix})).catch((t=>{throw this.download_state="Failed",console.error(`Error: Remote Tile at ${this.url}/${this.key}.feather not found.\n        `),console.warn(t),t})),this._download}get macrotile(){return I_(this.key)}get macro_siblings(){return function(t,e=2,n=2){return function(t,e=2,n=2){if(O_.has(t))return O_.get(t);const r=[[t]];for(;r.length<n;)r.unshift(r[0].map(T_).flat());const i=[r[0].map(T_).flat()];for(;i.length<e;)i.unshift(i[0].map(T_).flat());i.reverse();const o=i.flat();return O_.set(t,o),o}(I_(t,e,n),e,n)}(this.key)}get children(){if("Complete"!==this.download_state)return[];const t=this.constructor;if(this._children.length<this.child_locations.length)for(const e of this.child_locations){const n=new t(this.url,e,this,this.dataset);this._children.push(n)}return this._children}get theoretical_extent(){const t=this.dataset.extent,[e,n,r]=this.codes,i=(t.x[1]-t.x[0])/2**e,o=(t.y[1]-t.y[0])/2**e;return{x:[t.x[0]+n*i,t.x[0]+(n+1)*i],y:[t.y[0]+r*o,t.y[0]+(r+1)*o]}}}class A_ extends w_{constructor(t,e,n,r=null){if(super(e),this.full_tab=t,this._batch=t.batches[n],this.download_state="Complete",this.batch_num=n,null===this._batch.getChild("ix")){console.warn("Manually setting ix");const t=this._batch,e=new Float32Array(t.numRows),n=this.dataset._ix_seed;this.dataset._ix_seed+=t.numRows;for(let r=0;r<t.numRows;r++)e[r]=r+n;this._min_ix=n,this._max_ix=n+t.numRows,this.highest_known_ix=this._max_ix,this._batch=D_(this.record_batch,"ix",e)}this._extent={x:wt(this._batch.getChild("x")),y:wt(this._batch.getChild("y"))},this.parent=r;const i=this._batch.get(this._batch.numRows-1);if(null===i)throw"No rows in table";this.max_ix=Number(i.ix),this.highest_known_ix=Number(this.max_ix);const o=this._batch.get(0);if(null===o)throw"No rows in table";this._min_ix=Number(o.ix),this.highest_known_ix=Number(this.max_ix),this.create_children(),this.ready=!0}create_children(){let t=4*this.batch_num;for(;++t<=4*this.batch_num+4;)t<this.full_tab.batches.length&&this._children.push(new A_(this.full_tab,this.dataset,t,this));for(const e of this._children)for(const t of["x","y"])this._extent[t][0]=Math.min(this._extent[t][0],e._extent[t][0]),this._extent[t][1]=Math.max(this._extent[t][1],e._extent[t][1])}download(){return Promise.resolve(this._batch)}}function S_(t,e){return void 0===e||t[0]<e.x[1]&&t[0]>e.x[0]&&t[1]<e.y[1]&&t[1]>e.y[0]}function I_(t,e=2,n=2){let[r,i,o]=t.split("/").map((t=>parseInt(t))),a=0;for(;!(a>=n&&r%e==0);)i=Math.floor(i/2),o=Math.floor(o/2),r-=1,a++;return`${r}/${i}/${o}`}const O_=new Map;function T_(t){const[e,n,r]=t.split("/").map((t=>parseInt(t))),i=[];for(let o=0;o<4;o++)i.push(`${e+1}/${2*n+o%2}/${2*r+Math.floor(o/2)}`);return i}function k_(){}class M_{constructor(t){this.transformations={},this.extents={},this._ix_seed=0,this.plot=t}get highest_known_ix(){return this.root_tile.highest_known_ix}get table(){return new cp(this.map((t=>t)).filter((t=>t.ready)).map((t=>t.record_batch)))}static from_quadfeather(t,e,n){const r={};return n.tileProxy&&(r.tileProxy=n.tileProxy),new B_(t,e,n,r)}static from_arrow_table(t,e,n){return new E_(t,e,n)}has_column(t){return this.root_tile.record_batch.schema.fields.some((e=>e.name==t))||t in this.transformations}delete_column_if_exists(t){this.map((e=>e.delete_column_if_exists(t))),delete this.transformations[t]}domain(t,e=1e6){var n,r;if(this.extents[t])return this.extents[t];const i=null==(n=this._schema)?void 0:n.fields.find((e=>e.name===t));if(void 0!==i){let e,n;const o=i.metadata.get("extent");o&&([e,n]=JSON.parse(o));const a=i.metadata.get("min");a&&(e=JSON.parse(a));const s=i.metadata.get("max");if(s&&(n=JSON.parse(s)),10==i.type.typeId&&"string"==typeof e&&(e=Number(new Date(e))),10==(null==(r=i.type)?void 0:r.typeId)&&"string"==typeof n&&(n=Number(new Date(n))),"string"==typeof n)throw new Error("Failed to parse min-max as numbers");if(void 0!==e)return this.extents[t]=[e,n]}return this.extents[t]=wt([...this.table.getChild(t)])}*points(t,e=1e99){const n=[this.root_tile];let r;for(;r=n.shift();)if("Complete"==r.download_state&&(void 0===t||r.is_visible(e,t))){for(const n of r)S_([n.x,n.y],t)&&n.ix<=e&&(yield n);n.push(...r.children)}}map(t,e=!1){const n=[];return this.visit((e=>{n.push(t(e))}),e),n}visit(t,e=!1,n=(t=>!0)){const r=[this.root_tile],i=[];let o;for(;o=r.shift();)e?i.push(o):t(o),n(o)&&"Complete"==o.download_state&&r.push(...o.children);if(e)for(;o=i.pop();)t(o)}async schema(){return await this.ready,this._schema?this._schema:(this._schema=this.root_tile.record_batch.schema,this.root_tile.record_batch.schema)}add_tiled_column(t,e){const n=g_(e),r={};for(const i of n.batches){const t=i.getChild("data").data[0].valueOffsets,e=i.getChild("data").data[0].children[0];for(let n=0;n<i.data.length;n++){const o=i.getChild("_tile").get(n);r[o]=e.values.slice(t[n],t[n+1])}}this.transformations[t]=function(t){const{key:e}=t;return r[e]}}add_sparse_identifiers(t,e){this.transformations[t]=function(t){var n;const{key:r}=t,i=t.record_batch.numRows,o=new Float32Array(i),a=null!=(n=e.values[r])?n:[];for(const[e,s]of Object.entries(a))o[Number.parseInt(e)]=s;return o}}add_label_identifiers(t,e,n="_id"){if(this.transformations[e])throw new Error(`Can't overwrite existing transformation for ${e}`);this.transformations[e]=function(e){return function(t,e,n,r="_id"){var i;const o=new Float32Array(t.numRows),a=t.getChild(r);if(null===a)throw new Error(`Field ${r} not found in batch`);let s="string";2===(null==(i=null==a?void 0:a.type)?void 0:i.typeId)&&(s="bigint");if("bigint"===s){for(let n=0;n<t.numRows;n++){const t=e[String(a.get(n))];void 0!==t&&(o[n]=t)}return o}const u=new Set;for(const l of Object.keys(e)){const t=[0,1,2,3].map((t=>l.charCodeAt(t)||"")).join("");u.add(t)}const c=a.data[0].valueOffsets,f=a.data[0].values;for(let l=0;l<t.numRows;l++){const t=f.slice(c[l],c[l+1]),n=t.slice(0,4).join("");if(u.has(n)){const n=String.fromCharCode(...t);void 0!==e[n]&&(o[l]=e[n])}}return o}(e.record_batch,t,0,n)}}async applyTransformationToPoint(t,e){const n=this.findPointRaw(e);if(0==n.length)throw new Error(`No point for ix ${e}`);const[r,i]=n[0];if(null!==r.record_batch.getChild(t))return i;await r.apply_transformation(t);const o=r.record_batch.getChild("ix"),a=vt([...o.data[0].values],e);return r.record_batch.get(a)}findPoint(t){return this.findPointRaw(t).map((([,t])=>t))}findPointRaw(t){const e=[];return this.visit((n=>{if(!(n.ready&&n.record_batch&&n.min_ix<=t&&n.max_ix>=t))return;const r=vt([...n.record_batch.getChild("ix").data[0].values],t),i=n.record_batch.get(r);null!==i&&i.ix===t&&e.push([n,i])})),e}}class E_ extends M_{constructor(t,e,n){super(n),this.promise=Promise.resolve(),this.root_tile=new A_(t,this,0,n)}get extent(){return this.root_tile.extent}get ready(){return Promise.resolve()}download_most_needed_tiles(t,e,n){}}class B_ extends M_{constructor(t,e,n,r={}){super(n),this._download_queue=new Set,this.promise=new Promise(k_),r.tileProxy&&(this.tileProxy=r.tileProxy),this.root_tile=new x_(t,"0/0/0",null,this),this.promise=this.root_tile.download().then((t=>{const e=this.root_tile.record_batch.schema;if(e.metadata.has("sidecars")){const t=e.metadata.get("sidecars"),n=JSON.parse(t);for(const[e,r]of Object.entries(n))this.transformations[e]=async function(t){const n=await t.get_arrow(r),i=n.getChild(e);if(null===i)throw new Error(`No column named ${e} in sidecar tile ${n.schema.fields.map((t=>t.name)).join(", ")}`);return i}}}))}get ready(){return this.root_tile.download()}get extent(){return this.root_tile.extent}async download_to_depth(t){await this.root_tile.download_to_depth(t)}download_most_needed_tiles(t,e,n=4){const r=this._download_queue;if(r.size>=n)return;const i=[];for(this.visit((function(e){if(void 0===t)return 1/e.codes[0];if("Unattempted"===e.download_state){const n=function(t,e){const n=t.extent;if(n.x[0]>e.x[1]||n.x[1]<e.x[0]||n.y[0]>e.y[1]||n.y[1]<e.y[0])return 0;const r={x:[jt([e.x[0],n.x[0]]),Dt([e.x[1],n.x[1]])],y:[jt([e.y[0],n.y[0]]),Dt([e.y[1],n.y[1]])]},{x:i,y:o}=r;let a=0;i[0]>i[1]&&(a-=1);o[0]>o[1]&&(a-=2);if(a<0)return a;return j_(r)/j_(e)}(e,t);i.push([n,e,t])}})),i.sort(((t,e)=>Number(t[0])-Number(e[0])));i.length>0&&r.size<n;){const t=i.pop();if(void 0===t)throw new Error("Ran out of tiles unexpectedly");const[n,o,a]=t;o.min_ix&&o.min_ix>e||n<=0||(r.add(o.key),o.download().then((()=>r.delete(o.key))).catch((t=>{throw console.warn("Error on",o.key),r.delete(o.key),t})))}}add_macrotiled_column(t,e){const n={},r={};this.transformations[t]=async function(t){await async function(t){const{key:i,macrotile:o}=t;return void 0!==n[o]?await n[o]:(n[o]=e(t.macro_siblings).then((t=>{const e=g_(t);for(const n of e.batches){const t=n.getChild("data").data[0].valueOffsets,e=n.getChild("data").data[0].children[0];for(let i=0;i<n.data.length;i++){const o=n.getChild("_tile").get(i);r[o]=e.values.slice(t[i],t[i+1])}}})),n[o])}(t);const i=r[t.key];if(i instanceof Uint8Array){const e=new Float32Array(i.length);for(let n=0;n<t.record_batch.numRows;n++){const t=i[n];for(let r=0;r<8;r++){const i=t>>r&1;e[8*n+r]=i}}return e}return i}}}function j_(t){return(t.x[1]-t.x[0])*(t.y[1]-t.y[0])}function D_(t,e,n){var r;const i={};for(const s of t.schema.fields){if(s.name===e){if(null===n)continue;throw new Error(`Name ${s.name} already exists, can't add.`)}i[s.name]=t.getChild(s.name).data[0]}if(null===n)throw new Error(`Name ${e} doesn't exist, can't drop.`);if(void 0===n)throw new Error("Must pass data to bind_column");null!==n&&(n instanceof Float32Array?i[e]=Ed({type:new mf,data:n,length:n.length}).data[0]:n instanceof BigInt64Array?i[e]=Ed({type:new ff,data:n,length:n.length}).data[0]:(null==(r=n.data)?void 0:r.length)>0?i[e]=n.data[0]:i[e]=n);const o=new fp(i);for(const[s,u]of t.schema.metadata)o.schema.metadata.set(s,u);for(const s of t.schema.fields){const t=o.schema.fields.find((t=>t.name===s.name));if(void 0!==t)for(const[e,n]of s.metadata)t.metadata.set(e,n);else if(null!==n)throw new Error("Error!")}if(null!==n){const t=o.schema.fields.find((t=>t.name===e));null==t||t.metadata.set("created by deepscatter",(new Date).toISOString())}window.state={new_batch:o,batch:t,data:n,tb:i};const a=t.schema.fields.map((t=>t.name));window.old_batch=t,window.new_batch=o;for(const s of a);return o}var z_={},N_={};!function(t,e){t.exports=function(){function t(t,n,i,o,a){e(t,n,i||0,o||t.length-1,a||r)}function e(t,r,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=r-i+1,c=Math.log(s),f=.5*Math.exp(2*c/3),l=.5*Math.sqrt(c*f*(s-f)/s)*(u-s/2<0?-1:1);e(t,r,Math.max(i,Math.floor(r-u*f/s+l)),Math.min(o,Math.floor(r+(s-u)*f/s+l)),a)}var d=t[r],h=i,p=o;for(n(t,i,r),a(t[o],d)>0&&n(t,i,o);h<p;){for(n(t,h,p),h++,p--;a(t[h],d)<0;)h++;for(;a(t[p],d)>0;)p--}0===a(t[i],d)?n(t,i,p):n(t,++p,o),p<=r&&(i=p+1),r<=p&&(o=p-1)}}function n(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function r(t,e){return t<e?-1:t>e?1:0}return t}()}({get exports(){return N_},set exports(t){N_=t}}),function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=N_,n=[],r=function(t){return n.push(t)},i=function(t){t&&(r(t),u(t)||t.children.forEach(i))},o=function(t){var e=n.pop();return e?(e.children=t,e.height=1,e.leaf=!0,e.minX=1/0,e.minY=1/0,e.minZ=1/0,e.maxX=-1/0,e.maxY=-1/0,e.maxZ=-1/0):e={children:t,height:1,leaf:!0,minX:1/0,minY:1/0,minZ:1/0,maxX:-1/0,maxY:-1/0,maxZ:-1/0},e},a=[],s=function(t,e){var n=a.pop();return n?(n.dist=t,n.node=e):n={dist:t,node:e},n},u=function(t){return t.leaf},c=function(t,e){return t.leaf},f=function(t,e,n){if(!n)return e.indexOf(t);for(var r=0;r<e.length;r++)if(n(t,e[r]))return r;return-1},l=function(t){d(t,0,t.children.length,t)},d=function(t,e,n,r){var i=r;i?(i.minX=1/0,i.minY=1/0,i.minZ=1/0,i.maxX=-1/0,i.maxY=-1/0,i.maxZ=-1/0):i=o([]);for(var a=e,s=void 0;a<n;a++)s=t.children[a],h(i,s);return i},h=function(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.minZ=Math.min(t.minZ,e.minZ),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t.maxZ=Math.max(t.maxZ,e.maxZ),t},p=function(t){return(t.maxX-t.minX)*(t.maxY-t.minY)*(t.maxZ-t.minZ)},_=function(t){return t.maxX-t.minX+(t.maxY-t.minY)+(t.maxZ-t.minZ)},m=function(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&t.minZ<=e.minZ&&e.maxX<=t.maxX&&e.maxY<=t.maxY&&e.maxZ<=t.maxZ};t.intersects=function(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.minZ<=t.maxZ&&e.maxX>=t.minX&&e.maxY>=t.minY&&e.maxZ>=t.minZ},t.boxRayIntersects=function(t,e,n,r,i,o,a){var s=(t.minX-e)*i,u=(t.maxX-e)*i,c=(t.minY-n)*o,f=(t.maxY-n)*o,l=(t.minZ-r)*a,d=(t.maxZ-r)*a,h=Math.min(l,d),p=Math.max(l,d),_=Math.min(c,f),m=Math.max(c,f),b=Math.min(s,u),y=Math.max(s,u),g=Math.max(0,b,_,h);return Math.min(y,m,p)>=g?g:1/0};var b=function(t,n,r,i,o){for(var a,s=[n,r];s.length;)(r=s.pop())-(n=s.pop())<=i||(a=n+Math.ceil((r-n)/i/2)*i,e(t,a,n,r,o),s.push(n,a,a,r))},y=function(t,e){return t.minX-e.minX},g=function(t,e){return t.minY-e.minY},v=function(t,e){return t.minZ-e.minZ},w=function(){function e(t){void 0===t&&(t=16),this.maxEntries=Math.max(t,8),this.minEntries=Math.max(4,Math.ceil(.4*this.maxEntries)),this.clear()}return e.alloc=function(){return this.pool.pop()||new this},e.free=function(t){t.clear(),this.pool.push(t)},e.prototype.search=function(e){var n=this.data,r=[];if(!t.intersects(e,n))return r;for(var i=[];n;){for(var o=0,a=n.children.length;o<a;o++){var s=n.children[o];t.intersects(e,s)&&(c(n)?r.push(s):m(e,s)?this._all(s,r):i.push(s))}n=i.pop()}return r},e.prototype.collides=function(e){var n=this.data;if(!t.intersects(e,n))return!1;for(var r=[];n;){for(var i=0,o=n.children.length;i<o;i++){var a=n.children[i];if(t.intersects(e,a)){if(c(n)||m(e,a))return!0;r.push(a)}}n=r.pop()}return!1},e.prototype.raycastInv=function(e,n,r,i,o,u,f){void 0===f&&(f=1/0);var l=this.data;if(i===1/0&&o===1/0&&u===1/0)return s(1/0,void 0);if(t.boxRayIntersects(l,e,n,r,i,o,u)===1/0)return s(1/0,void 0);for(var d,h=[s(0,l)],p=function(t,e){var n=h[t];h[t]=h[e],h[e]=n},_=function(){var t=h[0],e=h.length-1;h[0]=h[e],h.length=e;for(var n=0;;){var r=n<<1|1;if(r>=e)break;var i=r+1;if(i<e&&h[i].dist<h[r].dist&&(r=i),h[n].dist<h[r].dist)break;p(n,r),n=r}return function(t){a.push(t)}(t),t.node},m=function(t,e){var n=h.length;for(h.push(s(t,e));n>0;){var r=n-1>>1;if(h[r].dist<=h[n].dist)break;p(n,r),n=r}},b=f;h.length&&h[0].dist<b;)for(var y=0,g=(l=_()).children.length;y<g;y++){var v=l.children[y],w=t.boxRayIntersects(v,e,n,r,i,o,u);if(c(l)){if(w<b){if(0===w)return s(w,v);b=w,d=v}}else m(w,v)}return s(b<f?b:1/0,d)},e.prototype.raycast=function(t,e,n,r,i,o,a){return void 0===a&&(a=1/0),this.raycastInv(t,e,n,1/r,1/i,1/o,a)},e.prototype.all=function(){return this._all(this.data,[])},e.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this.minEntries){for(var e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}var r=this.build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this.splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},e.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},e.prototype.clear=function(){return this.data&&i(this.data),this.data=o([]),this},e.prototype.remove=function(t,e){if(!t)return this;for(var n,r,i=this.data,o=0,a=!1,s=[],c=[];i||s.length;){if(i||(i=s.pop(),o=c.pop(),r=s[s.length-1],a=!0),u(i)&&-1!==(n=f(t,i.children,e)))return i.children.splice(n,1),s.push(i),this.condense(s),this;a||u(i)||!m(i,t)?r?(o++,i=r.children[o],a=!1):i=void 0:(s.push(i),c.push(o),o=0,r=i,i=i.children[0])}return this},e.prototype.toJSON=function(){return this.data},e.prototype.fromJSON=function(t){return i(this.data),this.data=t,this},e.prototype.build=function(t,e,n,r){var i,a=n-e+1,s=this.maxEntries;if(a<=s)return i=o(t.slice(e,n+1)),l(i),i;r||(r=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,r-1))),(i=o([])).leaf=!1,i.height=r;var u=Math.ceil(a/s),c=u*Math.ceil(Math.pow(s,2/3)),f=u*Math.ceil(Math.pow(s,1/3));b(t,e,n,f,y);for(var d=e;d<=n;d+=f){var h=Math.min(d+f-1,n);b(t,d,h,c,g);for(var p=d;p<=h;p+=c){var _=Math.min(p+c-1,h);b(t,p,_,u,v);for(var m=p;m<=_;m+=u){var w=Math.min(m+u-1,_);i.children.push(this.build(t,m,w,r-1))}}}return l(i),i},e.prototype._all=function(t,e){for(var n=[];t;)u(t)?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},e.prototype.chooseSubtree=function(t,e,n,r){for(var i,o,a,s,c,f,l,d;r.push(e),!u(e)&&r.length-1!==n;){i=o=1/0;for(var h=0,_=e.children.length;h<_;h++){var m=e.children[h],b=p(m),y=(s=t,c=m,f=void 0,l=void 0,d=void 0,f=Math.min(s.minX,c.minX),l=Math.min(s.minY,c.minY),d=Math.min(s.minZ,c.minZ),(Math.max(s.maxX,c.maxX)-f)*(Math.max(s.maxY,c.maxY)-l)*(Math.max(s.maxZ,c.maxZ)-d)-b);y<o?(o=y,i=b<i?b:i,a=m):y===o&&b<i&&(i=b,a=m)}e=a||e.children[0]}return e},e.prototype.split=function(t,e){var n=t[e],r=n.children.length,i=this.minEntries;this.chooseSplitAxis(n,i,r);var a=this.chooseSplitIndex(n,i,r),s=o(n.children.splice(a,n.children.length-a));s.height=n.height,s.leaf=n.leaf,l(n),l(s),e?t[e-1].children.push(s):this.splitRoot(n,s)},e.prototype.splitRoot=function(t,e){this.data=o([t,e]),this.data.height=t.height+1,this.data.leaf=!1,l(this.data)},e.prototype.chooseSplitIndex=function(t,e,n){for(var r,i,o,a,s,u,c,f,l,h=1/0,_=1/0,m=e;m<=n-e;m++){var b=d(t,0,m),y=d(t,m,n),g=(i=b,o=y,a=void 0,s=void 0,u=void 0,c=void 0,f=void 0,l=void 0,a=Math.max(i.minX,o.minX),s=Math.max(i.minY,o.minY),u=Math.max(i.minZ,o.minZ),c=Math.min(i.maxX,o.maxX),f=Math.min(i.maxY,o.maxY),l=Math.min(i.maxZ,o.maxZ),Math.max(0,c-a)*Math.max(0,f-s)*Math.max(0,l-u)),v=p(b)+p(y);g<h?(h=g,r=m,_=v<_?v:_):g===h&&v<_&&(_=v,r=m)}return r},e.prototype.chooseSplitAxis=function(t,e,n){var r=this.allDistMargin(t,e,n,y),i=this.allDistMargin(t,e,n,g),o=this.allDistMargin(t,e,n,v);r<i&&r<o?t.children.sort(y):i<r&&i<o&&t.children.sort(g)},e.prototype.allDistMargin=function(t,e,n,r){t.children.sort(r);for(var i=d(t,0,e),o=d(t,n-e,n),a=_(i)+_(o),s=e;s<n-e;s++){var u=t.children[s];h(i,u),a+=_(i)}for(s=n-e-1;s>=e;s--){u=t.children[s];h(o,u),a+=_(o)}return a},e.prototype.adjustParentBBoxes=function(t,e,n){for(var r=n;r>=0;r--)h(e[r],t)},e.prototype.condense=function(t){for(var e=t.length-1,n=void 0;e>=0;e--)0===t[e].children.length?e>0?((n=t[e-1].children).splice(n.indexOf(t[e]),1),r(t[e])):this.clear():l(t[e])},e.prototype._insert=function(t,e,n){var r=[],i=this.chooseSubtree(t,this.data,e,r);for(i.children.push(t),h(i,t);e>=0&&r[e].children.length>this.maxEntries;)this.split(r,e),e--;this.adjustParentBBoxes(t,r,e)},e.pool=[],e}();t.RBush3D=w}(z_);const F_=function(){var t,e,n,r,i=Zn,o=Jn,a=Kn,s=Qn,u={},c=Ln("start","drag","end"),f=0,l=0;function d(t){t.on("mousedown.drag",h).filter(s).on("touchstart.drag",m).on("touchmove.drag",b,Vn).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function h(a,s){if(!r&&i.call(this,a,s)){var u=g(this,o.call(this,a,s),a,s,"mouse");u&&(dt(a.view).on("mousemove.drag",p,$n).on("mouseup.drag",_,$n),Gn(a.view),Yn(a),n=!1,t=a.clientX,e=a.clientY,u("start",a))}}function p(r){if(Wn(r),!n){var i=r.clientX-t,o=r.clientY-e;n=i*i+o*o>l}u.mouse("drag",r)}function _(t){dt(t.view).on("mousemove.drag mouseup.drag",null),qn(t.view,n),Wn(t),u.mouse("end",t)}function m(t,e){if(i.call(this,t,e)){var n,r,a=t.changedTouches,s=o.call(this,t,e),u=a.length;for(n=0;n<u;++n)(r=g(this,s,t,e,a[n].identifier,a[n]))&&(Yn(t),r("start",t,a[n]))}}function b(t){var e,n,r=t.changedTouches,i=r.length;for(e=0;e<i;++e)(n=u[r[e].identifier])&&(Wn(t),n("drag",t,r[e]))}function y(t){var e,n,i=t.changedTouches,o=i.length;for(r&&clearTimeout(r),r=setTimeout((function(){r=null}),500),e=0;e<o;++e)(n=u[i[e].identifier])&&(Yn(t),n("end",t,i[e]))}function g(t,e,n,r,i,o){var s,l,h,p=c.copy(),_=ht(o||n,e);if(null!=(h=a.call(t,new Xn("beforestart",{sourceEvent:n,target:d,identifier:i,active:f,x:_[0],y:_[1],dx:0,dy:0,dispatch:p}),r)))return s=h.x-_[0]||0,l=h.y-_[1]||0,function n(o,a,c){var m,b=_;switch(o){case"start":u[i]=n,m=f++;break;case"end":delete u[i],--f;case"drag":_=ht(c||a,e),m=f}p.call(o,t,new Xn(o,{sourceEvent:a,subject:h,target:d,identifier:i,active:m,x:_[0]+s,y:_[1]+l,dx:_[0]-b[0],dy:_[1]-b[1],dispatch:p}),r)}}return d.filter=function(t){return arguments.length?(i="function"==typeof t?t:Hn(!!t),d):i},d.container=function(t){return arguments.length?(o="function"==typeof t?t:Hn(t),d):o},d.subject=function(t){return arguments.length?(a="function"==typeof t?t:Hn(t),d):a},d.touchable=function(t){return arguments.length?(s="function"==typeof t?t:Hn(!!t),d):s},d.on=function(){var t=c.on.apply(c,arguments);return t===c?d:t},d.clickDistance=function(t){return arguments.length?(l=(t=+t)*t,d):Math.sqrt(l)},d}();class C_ extends ya{constructor(t,e,n={}){super(t.div.node(),t._root,t),this.layers=[],this.options={},this.options=n,this.canvas=t.elements[2].selectAll("canvas").node();const r=t.elements[3].selectAll("svg").node(),i=e.replace(/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~]/g,"---"),o=r.querySelectorAll(`#${i}`);if(0===o.length?this.labelgroup=dt(r).select("#labelrects").append("g").attr("id",i).node():this.labelgroup=o[1],void 0===this.canvas)throw new Error("WTF?");this.ctx=this.canvas.getContext("2d"),this.tree=new U_(this.ctx,function(t){const[e,n]=t._zoom.scales().x.range(),[r,i]=t._zoom.scales().x.domain();return(n-e)/(i-r)}(t),.5,[.5,1e6],void 0===n.margin?30:n.margin),this.bind_zoom(t._renderer.zoom)}start(t=1e9){this.timer&&this.timer.stop(),dt(this.labelgroup).attr("display","inline"),this.timer=jn((()=>{this.render(),(t-=1)<=0&&this.stop()}))}delete(){dt(this.labelgroup).remove()}stop(){this.timer&&(this.timer.stop(),dt(this.labelgroup).attr("display","none"),this.ctx.clearRect(0,0,4096,4096),this.timer=void 0)}update(t,e,n){var r;this.label_key=e;for(const i of t.features){const{properties:t,geometry:o}=i;if(null!==t&&"Point"===o.type){const i=null!=(r=t[n])?r:16;let a="";void 0!==t[e]&&null!==t[e]&&(a=t[e]);const s={x:o.coordinates[0]+.1*Math.random(),y:o.coordinates[1]+.1*Math.random(),text:a,height:i,properties:t};this.tree.insert_point(s)}}}render(){const t=this.ctx,{x_:e,y_:n}=this.zoom.scales(),{transform:r}=this.zoom,{width:i,height:o}=this;t.clearRect(0,0,i,o),t.textAlign="center",t.textBaseline="middle",t.globalAlpha=1;const a=this.zoom.current_corners(),s=this.tree.search({minX:a.x[0],minY:a.y[0],minZ:r.k,maxX:a.x[1],maxY:a.y[1],maxZ:r.k});t.clearRect(0,0,4096,4096);const u=this.scatterplot.dim("color"),c=dt(this.labelgroup).selectAll("rect.labelbbox").data(s,(t=>""+t.minZ+t.minX)).join((t=>t.append("rect").attr("class","labellbox").style("opacity",0)));for(const f of s){const r=f.data,i=e(r.x),o=n(r.y);t.globalAlpha=1,t.fillStyle="white";let a=!1;for(const t of[this.scatterplot.dim("filter"),this.scatterplot.dim("filter2")])r.properties[t.field]&&(t.apply(r.properties)||(a=!0));if(a){r.properties.__display="none";continue}if(r.properties.__display="inline",!1===this.options.useColorScale||void 0===this.options.useColorScale)t.shadowColor="#71797E",t.strokeStyle="#71797E";else if(r.properties[u.field]){u.scale.domain().indexOf(r.properties[u.field])>-1?(t.shadowColor=u.scale(r.properties[u.field]),t.strokeStyle=u.scale(r.properties[u.field])):(t.shadowColor="gray",t.strokeStyle="gray")}else t.shadowColor="black";let s=0;this.hovered===""+f.minZ+f.minX&&(s+=2),t.font=`${1*r.height+s}pt verdana`,t.shadowBlur=12+3*s,t.lineWidth=3+s,t.strokeText(r.text,i,o),t.shadowBlur=0,t.lineWidth=4+s,t.fillStyle="white",t.fillText(r.text,i,o)}c.attr("class","labelbbox").attr("x",(t=>e(t.data.x)-t.data.pixel_width*this.tree.pixel_ratio/2)).attr("y",(t=>n(t.data.y)-t.data.pixel_height*this.tree.pixel_ratio/2-5)).attr("width",(t=>t.data.pixel_width*this.tree.pixel_ratio)).attr("stroke","red").attr("height",(t=>t.data.pixel_height*this.tree.pixel_ratio+10)).attr("display",(t=>t.data.properties.__display||"inline")).on("mouseover",((t,e)=>{dt(t.target).style("opacity",0),this.hovered=""+e.minZ+e.minX,t.stopPropagation()})).on("mousemove",(function(t,e){t.stopPropagation()})).on("click",((t,e)=>{this.scatterplot.label_click(e.data,this.scatterplot,this)})).on("mouseout",((t,e)=>{this.hovered=void 0,t.stopPropagation()})),this.options.draggable_labels&&(F_.on("drag",((t,r)=>{r.data.x=e.invert(t.x),r.data.y=n.invert(t.y)})),F_.on("end",((t,e)=>{console.log({text:e.data.text,x:e.data.x,y:e.data.y})})),c.call(F_)),t.shadowColor="black",t.strokeStyle="black"}}let L_=null;function R_(t,e,n){const r=function(){if(null!==L_)return L_;const t=document.createElement("canvas");return t.width=500,t.height=400,L_=t.getContext("2d"),L_}();if(r.font=`${t.height}pt verdana`,""===t.text)return null;const i=r.measureText(t.text);let{actualBoundingBoxLeft:o,actualBoundingBoxRight:a,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u}=i;return(Number.isNaN(o)||void 0===o)&&(o=0,a=i.width,s=t.height,u=0),{pixel_height:(s-u)/e+n/e,pixel_width:(a-o)/e+n/e}}class U_ extends z_.RBush3D{constructor(t,e,n=.5,r=[.1,1e3],i=10){super(),this._accessor=t=>[t.x,t.y],this.scale_factor=n,this.mindepth=r[0],this.maxdepth=r[1],this.context=t,this.pixel_ratio=e,this.margin=i}max_collision_depth(t,e){const[n,r]=this._accessor(t),[i,o]=this._accessor(e),a=Math.abs(n-i),s=(t.pixel_width+e.pixel_width)/2/a,u=Math.abs(r-o),c=(t.pixel_height+e.pixel_height)/2/u;return Math.min(s,c)}set accessor(t){this._accessor=t}get accessor(){return this._accessor}to3d(t,e=1,n){const[r,i]=this.accessor(t),{pixel_height:o,pixel_width:a}=t,s={minX:r-a/e/2,maxX:r+a/e/2,minY:i-o/e/2,maxY:i+o/e/2,minZ:e,maxZ:n||this.maxdepth,data:t};if(Number.isNaN(r)||Number.isNaN(i))throw"Missing position"+JSON.stringify(t);if(Number.isNaN(a))throw"Missing Aspect Ratio"+JSON.stringify(t);return s}insert_point(t,e=1/4){if(void 0===t.text||""===t.text)return;let n;n=void 0===t.pixel_width?{...t,...R_(t,this.pixel_ratio,this.margin)}:t;const r=this.to3d(n,e,this.maxdepth);this.collides(r)?this.insert_after_collisions(r):e<=this.mindepth?this.insert(r):this.insert_point(t,e/2)}insert_after_collisions(t){let e,n=-1;for(const r of this.search(t)){const i=this.max_collision_depth(t.data,r.data);i>n&&(n=i,e=r)}if(e&&n<this.maxdepth){const r=e.data,i=e.minZ,o=e.maxZ;if(i<n){this.remove(e);const t=this.to3d(r,i,n);this.insert(t);const a=this.to3d(r,n,o);this.insert(a)}const a=this.to3d(t.data,n,this.maxdepth);this.insert(a)}}}class P_{constructor(t,e){this.cursor=0,this.complete=!1,this.selectionSize=0,this.evaluationSetSize=0,this.tiles=[],this.events={},this.match_count=[],this.plot=t,this.dataset=t.dataset,this.name=e.name;let n=function(){};this.ready=new Promise(((t,e)=>{n=t})),!function(t){return void 0!==t.ids}(e)?!function(t){return void 0!==t.field}(e)?function(t){return void 0!==t.tileFunction}(e)&&this.add_function_column(e.name,e.tileFunction).then(n):this.add_boolean_column(e.name,e.field).then(n):this.add_identifier_column(e.name,e.ids,e.idField).then(n)}on(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)}dispatch(t,e){this.events[t]&&this.events[t].forEach((t=>t(e)))}moveCursor(t){return this.cursor+=t,this.cursor>=this.selectionSize&&(this.cursor=this.cursor%this.selectionSize),this.cursor<0&&(this.cursor=this.selectionSize+this.cursor),this}async removePoints(t,e){return this.add_or_remove_points(t,e,"remove")}async addPoints(t,e){return this.add_or_remove_points(t,e,"add")}async export(t,e="json"){const n=Object.fromEntries(t.map((t=>[t,[]])));for(let r of this)for(let e of t)n[e].push(r[e]);return n}async add_or_remove_points(t,e,n){let r,i=0;const o=new P_(this.plot,{name:t,tileFunction:async t=>{i=-1,await this.ready;let o=(await t.get_column(this.name)).toArray();const a=t.record_batch.getChild("ix").data[0].values;for(let s of e){const u=vt([...a],s),c=t.record_batch.get(u);if(null!==c&&c.ix===s)if(o=new Float32Array(o),"add"===n){if(o[u]=1,1===e.length){r=t.key;let e=0;for(let t=0;t<u;t++)o[t]>0&&(e+=1);i=e}}else o[u]=0}return o}});o.on("tile loaded",(()=>{if(i>=0){o.cursor=i;for(let t=0;t<o.tiles.length;t++){if(o.tiles[t].key===r)break;o.cursor+=this.match_count[t]}}})),await o.ready;for(const a of this.tiles)await a.get_column(t);return o}async add_function_column(t,e){if(this.dataset.has_column(t))throw new Error(`Column ${t} already exists, can't create`);this.plot.dataset.transformations[t]=this.wrapWithSelectionMetadata(e),await this.dataset.root_tile.apply_transformation(t)}wrapWithSelectionMetadata(t){return async e=>{const n=await t(e),r=e.record_batch;let i=0;for(let t=0;t<r.numRows;t++)n[t]>0&&i++;return this.match_count.push(i),this.tiles.push(e),this.selectionSize+=i,this.evaluationSetSize+=r.numRows,this.dispatch("tile loaded",e),n}}get totalSetSize(){return this.dataset.highest_known_ix}get(t){if(void 0===t&&(t=this.cursor),t>this.selectionSize)throw new Error(`Index ${t} out of bounds for selection of size ${this.selectionSize}`);let e,n=0,r=0;for(let s of this.match_count){if(t<n+s){e=this.tiles[r];break}r+=1,n+=s}if(void 0===e)return null;const i=e.record_batch.getChild(this.name).toArray(),o=t-n;let a=0;for(let s=0;s<i.length;s++)if(i[s]>0){if(a===o)return e.record_batch.get(s);a++}throw new Error(`unable to locate point ${t}`)}*[Symbol.iterator](){for(let t of this.tiles){const e=t.record_batch.getChild(this.name).toArray();for(let n=0;n<e.length;n++)e[n]>0&&(yield t.record_batch.get(n))}}async add_identifier_column(t,e,n,r={}){if(this.dataset.has_column(t))throw new Error(`Column ${t} already exists, can't create`);if("string"==typeof e[0]){const r=function(t,e){const n=[];function r(t){let e=n;for(const n of t)e[n]||(e[n]=[]),e=e[n];e[256]=[]}const i=new TextEncoder;for(const o of e){r(i.encode(o))}return async function(e){const r=(await e.get_column(t)).data[0],i=r.values,o=r.valueOffsets,a=new Float32Array(e.record_batch.numRows);function s(t,e){let r=n;for(let n=0;n<e;n++){if(r=r[i[t+n]],!r)return!1}return void 0!==r[256]}for(let t=0;t<e.record_batch.numRows;t++){const e=o[t];s(e,o[t+1]-e)&&(a[t]=1)}return a}}(n,e);this.plot.dataset.transformations[t]=this.wrapWithSelectionMetadata(r),await this.dataset.root_tile.apply_transformation(t)}else if("bigint"==typeof e[0]){const r=function(t,e){const n=new Set(e);return async function(e){const r=(await e.get_column(t)).data[0].values,i=new Float32Array(e.record_batch.numRows);for(let t=0;t<e.record_batch.numRows;t++)i[t]=n.has(r[t])?1:0;return i}}(n,e);this.plot.dataset.transformations[t]=this.wrapWithSelectionMetadata(r),await this.dataset.root_tile.apply_transformation(t)}else console.error("Unable to match type",typeof e[0]);if(r.plot_after)return this.apply_to_foreground({})}async add_boolean_column(t,e){throw new Error("Method not implemented.")}combine(t,e,n){}apply_to_foreground(t){const e=this.name,n={size:[.5,10],...t};return this.plot.plotAPI({background_options:n,encoding:{foreground:{field:e,op:"gt",a:0}}})}}const V_={zoom_balance:.35,duration:1e3,max_points:1e3,encoding:{},point_size:1,alpha:40,background_options:{color:"gray",opacity:[.2,1],size:[.66,1],mouseover:!1},zoom_align:"center"},$_=[{id:"canvas-2d-background",nodetype:"canvas"},{id:"webgl-canvas",nodetype:"canvas"},{id:"canvas-2d",nodetype:"canvas"},{id:"deepscatter-svg",nodetype:"svg"}];class Y_{constructor(t){this.string_rep="",this.plot=t}get f(){return void 0===this._f?this.default:this._f}set f(t){"string"==typeof t?this.string_rep!==t&&(this.string_rep=t,this._f=Function("datum","plot",t)):this._f=t}}class W_ extends Y_{default(t,e=undefined,n=undefined){let r;null!==t&&(1==t.__activated?(r=null,t.__activated=void 0):(t.__activated=!0,r={field:n.label_key,lambda:`d => d === '${t.properties[n.label_key]}'`}),this.plot.plotAPI({encoding:{filter:r}}))}}class G_ extends Y_{default(t,e=undefined){console.log({...t})}}class q_ extends Y_{default(t,e=undefined){let n="<dl>";const r=new Set(["x","y","ix",null,"tile_key"]);for(const[i,o]of t)null!==o&&(r.has(i)||""!==o&&(n+=` <dt>${String(i)}</dt>\n`,n+=`   <dd>${String(o)}<dd>\n`));return`${n}</dl>\n`}}return class{constructor(t,e,n,r={}){this.secondary_renderers={},this.selection_history=[],this.plot_queue=Promise.resolve(),this.hooks={},this.mark_ready=function(){},this.bound=!1,void 0!==t&&this.bind(t,e,n),this.width=e,this.height=n,this.ready=new Promise(((t,e)=>{this.mark_ready=t})),this.click_handler=new G_(this),this.tooltip_handler=new q_(this),this.label_click_handler=new W_(this),r.tileProxy&&(this.tileProxy=r.tileProxy),this.prefs={...V_}}bind(t,e,n){if(this.div=dt(t).selectAll("div.deepscatter_container").data([1]).join("div").attr("class","deepscatter_container").style("position","absolute"),this.div.empty())throw console.error(t),"Must pass a valid div selector";this.elements=[];for(const r of $_){const t=this.div.append("div").attr("id",`container-for-${r.id}`).style("position","absolute").style("top",0).style("left",0).style("pointer-events","deepscatter-svg"===r.id?"auto":"none"),i=t.append(r.nodetype).attr("id",r.id).attr("width",e||window.innerWidth).attr("height",n||window.innerHeight);"svg"===r.nodetype&&(i.append("g").attr("id","mousepoints"),i.append("g").attr("id","labelrects")),this.elements.push(t)}this.bound=!0}async select_and_plot(t,e=this.prefs.duration){const n=await this.select_data(t);await n.ready,await this.plotAPI({duration:e,encoding:{foreground:{field:n.name,op:"eq",a:1}}})}async select_data(t){const e=new P_(this,t);return await e.ready,this.selection_history.push({selection:e,name:e.name,flushed:!1}),e}add_identifier_column(t,e,n){const r=Array.isArray(e)?Object.fromEntries(e.map((t=>[t,1]))):e;this._root.add_label_identifiers(r,t,n)}async add_labels_from_url(t,e,n,r,i){return await this.ready,await this._root.promise,fetch(t).then((async t=>{const o=await t.json();this.add_labels(o,e,n,r,i)})).catch((t=>{console.warn(t),console.error("Broken addition of ",e)}))}add_labels(t,e,n,r,i={}){const o=new C_(this,e,i);o.update(t,n,r),this.secondary_renderers[e]=o,this.secondary_renderers[e].start()}get dataset(){if(void 0===this._root)throw"No dataset has been loaded";return this._root}add_api_label(t){const e={type:"FeatureCollection",features:t.labels.map((t=>({type:"Feature",geometry:{type:"Point",coordinates:[t.x,t.y]},properties:{text:t.text,size:t.size||void 0}})))};this.add_labels(e,t.name,"text","size",t.options||{})}async reinitialize(){const{prefs:t}=this;if(void 0!==t.source_url)this._root=M_.from_quadfeather(t.source_url,t,this);else{if(void 0===t.arrow_table)throw new Error("No source_url or arrow_table specified");this._root=M_.from_arrow_table(t.arrow_table,t,this)}await this._root.ready,this._renderer=new mu("#container-for-webgl-canvas",this._root,this),this._zoom=new la("#deepscatter-svg",this.prefs,this),this._zoom.attach_tiles(this._root),this._zoom.attach_renderer("regl",this._renderer),this._zoom.initialize_zoom();const e=dt("#container-for-canvas-2d-background").select("canvas").node().getContext("2d");return e.fillStyle=t.background_color||"rgba(133, 133, 111, .8)",e.fillRect(0,0,2*window.innerWidth,2*window.innerHeight),this._renderer.initialize(),this._root.promise.then((()=>this.mark_ready())),this.ready}visualize_tiles(){const t=this,e=t.elements[2].selectAll("canvas").node().getContext("2d");e.clearRect(0,0,1e4,1e4);const{x_:n,y_:r}=t._zoom.scales();e.strokeStyle="#888888";const i=t._root.map((t=>t));for(const o of Nt(13))setTimeout((()=>{for(const t of i){if(t.codes[0]!=o)continue;if(!t.extent)continue;const[i,a]=t.extent.x.map((t=>n(t))),[s,u]=t.extent.y.map((t=>r(t))),c=t.codes[0];e.lineWidth=8/Math.sqrt(c),e.globalAlpha=.33,e.strokeRect(i,s,a-i,u-s),"Unattempted"!==t.download_state&&e.fillRect(i,s,a-i,u-s),e.globalAlpha=1}}),400*o);setTimeout((()=>e.clearRect(0,0,1e4,1e4)),6800)}async make_big_png(t=3,e=1e7,n=100){await this._root.download_to_depth(e);const{width:r,height:i}=this._renderer;this.plotAPI({duration:0});const o=document.createElement("canvas");o.setAttribute("width",(t*r).toString()),o.setAttribute("height",(t*i).toString());const a=o.getContext("2d"),s=this._zoom.current_corners();this._zoom.transform.k;const u=(s.x[1]-s.x[0])/t,c=(s.y[1]-s.y[0])/t;new Promise(((e,o)=>{for(let f=0;f<t;f++)for(let o=0;o<t;o++)setTimeout((()=>{this._zoom.zoom_to_bbox({x:[s.x[0]+u*f,s.x[0]+u*(f+1)],y:[s.y[0]+c*o,s.y[0]+c*(o+1)]},n/5,1),setTimeout((()=>{this._renderer.fbos.colorpicker.use((()=>{this._renderer.render_all(this._renderer.props);const t=this._renderer.regl.read(0,0,r,i),e=i/2|0,n=4*r;for(var s=new Uint8Array(4*r),u=0;u<e;++u){var c=u*n,l=(i-u-1)*n;s.set(t.subarray(c,c+n)),t.copyWithin(c,l,l+n),t.set(s,l)}const d=new ImageData(new Uint8ClampedArray(t),r);a.putImageData(d,r*f,i*o)})),f==t-1&&o===t-1&&e()}),n/2)}),f*n*t+o*n)})).then((()=>{const t=o.toDataURL(),e=document.createElement("a");e.href=t,e.style="position:fixed;top:40vh;left:40vw;z-index:999;",e.download="deepscatter",e.click(),e.remove()}))}destroy(){var t,e,n;null==(e=null==(t=this._renderer)?void 0:t.regl)||e.destroy(),null==(n=this.div)||n.node().parentElement.replaceChildren()}update_prefs(t){if(this.prefs.encoding&&t.encoding)for(const e of Object.keys(this.prefs.encoding))void 0!==t.encoding[e]&&(this.prefs.encoding[e]=t.encoding[e]);bn(this.prefs,t)}add_hook(t,e,n=!1){if(void 0!==this.hooks[t]&&!n)throw new Error(`Hook ${t} already exists`);this.hooks[t]=e}remove_hook(t,e=!1){if(void 0===this.hooks[t]){if(e)return;throw new Error(`Hook ${t} does not exist`)}delete this.hooks[t]}stop_labellers(){console.log("Stopping labels");for(const[t,e]of Object.entries(this.secondary_renderers))e&&void 0!==e.label_key&&(this.secondary_renderers[t].stop(),this.secondary_renderers[t].delete(),this.secondary_renderers[t]=void 0)}dim(t){return this._renderer.aes.dim(t).current}set tooltip_html(t){this.tooltip_handler.f=t}get tooltip_html(){return this.tooltip_handler.f}set label_click(t){this.label_click_handler.f=t}get label_click(){return this.label_click_handler.f.bind(this.label_click_handler)}set click_function(t){this.click_handler.f=t}get click_function(){return this.click_handler.f}async plotAPI(t){if(void 0!==t){await this.plot_queue,t&&await this.start_transformations(t),this.plot_queue=this.unsafe_plotAPI(t),await this.plot_queue;for(const[t,e]of Object.entries(this.hooks))e()}}async start_transformations(t,e=110){return new Promise((n=>{this.prefs.duration<e&&(e=this.prefs.duration);const r=new Set;t.encoding||n();for(const[e,i]of Object.entries(t.encoding))i&&"string"!=typeof i&&void 0!==i.field&&r.add(i.field);if(this._renderer){const t=[],i=[];for(const e of this._renderer.visible_tiles()){const n=e._buffer_manager;if(void 0!==n&&n.ready())for(const o of r){const{ready:r,promise:a}=n.ready_or_not_here_it_comes(o);r||null!==a&&(t.push(a),"0/0/0"===e.key&&i.push(a))}}if(0===t.length)n();else{const t=Date.now();Promise.all(i).then((()=>{const r=Date.now()-t;r<e?setTimeout((()=>{n()}),e-r):n()}))}}else n()}))}async unsafe_plotAPI(t){var e;if(null===t)return;t.click_function&&(this.click_function=Function("datum",t.click_function)),t.tooltip_html&&(this.tooltip_html=Function("datum",t.tooltip_html)),t.background_options&&(t.background_options.opacity&&"number"==typeof t.background_options.opacity&&(t.background_options.opacity=[t.background_options.opacity,1]),t.background_options.size&&"number"==typeof t.background_options.size&&(t.background_options.size=[t.background_options.size,1])),this.update_prefs(t),void 0===this._root&&await this.reinitialize(),t.basemap_gleofeather&&(t.polygons=[{file:t.basemap_gleofeather}]),await this._root.promise,this._renderer.render_props.apply_prefs(this.prefs);const{width:n,height:r}=this;if(this.update_prefs(t),void 0!==t.zoom&&(null===t.zoom?(this._zoom.zoom_to(1,n/2,r/2),t.zoom=void 0):(null==(e=t.zoom)?void 0:e.bbox)&&this._zoom.zoom_to_bbox(t.zoom.bbox,t.duration)),this._renderer.most_recent_restart=Date.now(),this._renderer.aes.apply_encoding(t.encoding),this._renderer.apply_webgl_scale&&this._renderer.apply_webgl_scale(t),this._renderer.reglframe&&(this._renderer.reglframe.cancel(),this._renderer.reglframe=void 0),this._renderer.reglframe=this._renderer.regl.frame((()=>{this._renderer.tick("Basic")})),void 0!==t.labels)if(null!==(i=t.labels)&&void 0!==i.url){const{url:e,label_field:n,size_field:r}=t.labels,i=t.labels.name||e;this.secondary_renderers[i]||(this.stop_labellers(),this.add_labels_from_url(e,i,n,r).catch((t=>{console.error("Label addition failed."),console.error(t)})))}else if(function(t){return null!==t&&void 0!==t.labels}(t.labels)){if(!t.labels.name)throw new Error("API field `labels` must have a name.");this.stop_labellers(),this.add_api_label(t.labels)}else{if(null!==t.labels)throw new Error("API field `labels` format not recognized.");this.stop_labellers()}var i;this._zoom.restart_timer(6e4)}async root_table(){return!!this._root&&this._root.record_batch}get query(){const t=JSON.parse(JSON.stringify(this.prefs));return t.zoom={bbox:this._renderer.zoom.current_corners()},t}drawContours(t,e){const n=(e||dt("body")).select("#canvas-2d").node().getContext("2d");for(const r of t){n.fillStyle="rgba(25, 25, 29, 1)",n.fillRect(0,0,2*window.innerWidth,2*window.innerHeight),n.strokeStyle="#8a0303",n.fillStyle="rgba(30, 30, 34, 1)",n.lineWidth=jt([.45,.25*Math.exp(Math.log(this._zoom.transform.k/2))]);const t=ln(_n().scale(this._zoom.transform.k).translate([this._zoom.transform.x,this._zoom.transform.y]),n);n.beginPath(),t(r),n.fill()}}sample_points(t=10){const e=[];for(const n of this._root.points(this._zoom.current_corners()))if(e.push({...n}),e.length>=3*t)break;return e.sort(((t,e)=>Number(t.ix)-Number(e.ix))),e.slice(0,t)}contours(t){const e=this._renderer.calculate_contours(t),{x:n,y:r,x_:i,y_:o}=this._zoom.scales();!function t(e){if(e){if(e.coordinates)return t(e.coordinates);if(0!==e.length){if(e[0].length>0)return e.map(t);e[0]=n(i.invert(e[0])),e[1]=r(o.invert(e[1]))}}}(e),this.drawContours(e)}}}));
